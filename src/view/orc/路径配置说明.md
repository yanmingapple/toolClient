# Tesseract.js è·¯å¾„é…ç½®è¯´æ˜

## ä¸€ã€é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯

```
Failed to execute 'importScripts' on 'WorkerGlobalScope': 
The script at 'http://localhost:3000/tesseract/worker.min.js' failed to load.
```

### æ ¹æœ¬åŸå› 

è·¯å¾„é…ç½®ä¸ä¸€è‡´ï¼š
- âŒ é”™è¯¯è·¯å¾„ï¼š`/tesseract/worker.min.js`
- âœ… æ­£ç¡®è·¯å¾„ï¼š`/tessdata/worker.min.js`

## äºŒã€æ–‡ä»¶ç»“æ„

### æ­£ç¡®çš„ç›®å½•ç»“æ„

```
e:\toolClient\public\
â””â”€â”€ tessdata\              # âœ… æ­£ç¡®çš„ç›®å½•å
    â”œâ”€â”€ worker.min.js       # Worker è„šæœ¬
    â”œâ”€â”€ tesseract-core.wasm.js  # WebAssembly æ ¸å¿ƒ
    â”œâ”€â”€ chi_sim.traineddata.gz  # ä¸­æ–‡è¯­è¨€åŒ…
    â”œâ”€â”€ eng.traineddata.gz      # è‹±æ–‡è¯­è¨€åŒ…
    â”œâ”€â”€ jpn.traineddata.gz      # æ—¥æ–‡è¯­è¨€åŒ…
    â”œâ”€â”€ kor.traineddata.gz      # éŸ©æ–‡è¯­è¨€åŒ…
    â”œâ”€â”€ osd.traineddata.gz      # æ–¹å‘æ£€æµ‹è¯­è¨€åŒ…
    â””â”€â”€ README.md           # è¯´æ˜æ–‡æ¡£
```

### é”™è¯¯çš„é…ç½®

```typescript
// âŒ é”™è¯¯
workerPath: '/tesseract/worker.min.js'
corePath: '/tesseract/tesseract-core.wasm.js'

// âœ… æ­£ç¡®
workerPath: '/tessdata/worker.min.js'
corePath: '/tessdata/tesseract-core.wasm.js'
langPath: '/tessdata/'
```

## ä¸‰ã€é…ç½®ä½ç½®

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

#### 1. `src/view/orc/engine/tesseract-engine.ts`

**ä½ç½® 1ï¼šåˆå§‹åŒ– Worker**ï¼ˆç¬¬ 43-53 è¡Œï¼‰

```typescript
// âœ… æ­£ç¡®é…ç½®
this.worker = await Tesseract.createWorker(
  'eng',
  1,
  {
    logger: () => { },
    workerPath: '/tessdata/worker.min.js',      // âœ…
    corePath: '/tessdata/tesseract-core.wasm.js', // âœ…
    langPath: '/tessdata/',                     // âœ… æ–°å¢
    legacyCore: true
  }
)
```

**ä½ç½® 2ï¼šOSD Worker**ï¼ˆç¬¬ 83-94 è¡Œï¼‰

```typescript
// âœ… æ­£ç¡®é…ç½®
const osdWorker = await Tesseract.createWorker(
  'osd',
  1,
  {
    logger: (m: any) => {
      if (m.status === 'recognizing text') {
        onProgress?.(15, 'æ£€æµ‹è¯­è¨€ä¸­...')
      }
    },
    workerPath: '/tessdata/worker.min.js',      // âœ…
    corePath: '/tessdata/tesseract-core.wasm.js', // âœ…
    langPath: '/tessdata/',                     // âœ… æ–°å¢
    legacyCore: true
  }
)
```

## å››ã€é…ç½®è¯´æ˜

### è·¯å¾„å‚æ•°è¯¦è§£

| å‚æ•° | ä½œç”¨ | ç¤ºä¾‹ |
|-----|------|------|
| `workerPath` | Worker è„šæœ¬è·¯å¾„ | `/tessdata/worker.min.js` |
| `corePath` | WebAssembly æ ¸å¿ƒè·¯å¾„ | `/tessdata/tesseract-core.wasm.js` |
| `langPath` | è¯­è¨€åŒ…è·¯å¾„ | `/tessdata/` |
| `legacyCore` | æ˜¯å¦ä½¿ç”¨æ—§ç‰ˆæ ¸å¿ƒ | `true` |

### è·¯å¾„æ ¼å¼è¯´æ˜

**ç»å¯¹è·¯å¾„**ï¼ˆæ¨èï¼‰ï¼š
```typescript
// âœ… æ¨èï¼šä»æ ¹ç›®å½•å¼€å§‹
workerPath: '/tessdata/worker.min.js'

// âŒ ä¸æ¨èï¼šç›¸å¯¹è·¯å¾„ï¼ˆå¯èƒ½å‡ºé”™ï¼‰
workerPath: '../tessdata/worker.min.js'
workerPath: './tessdata/worker.min.js'
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Ÿ**
- ä¸å—å½“å‰æ–‡ä»¶ä½ç½®å½±å“
- é¿å…ç›¸å¯¹è·¯å¾„è®¡ç®—é”™è¯¯
- æ›´æ¸…æ™°ï¼Œæ›´å®¹æ˜“ç»´æŠ¤

## äº”ã€éªŒè¯é…ç½®

### æ–¹æ³• 1ï¼šæµè§ˆå™¨æ§åˆ¶å°

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Network é¢æ¿
3. è¿‡æ»¤ JS æ–‡ä»¶
4. ç‚¹å‡»"å¼€å§‹è¯†åˆ«"
5. æ£€æŸ¥ä»¥ä¸‹æ–‡ä»¶æ˜¯å¦æˆåŠŸåŠ è½½ï¼š
   - âœ… `worker.min.js`
   - âœ… `tesseract-core.wasm.js`
   - âœ… `chi_sim.traineddata.gz`ï¼ˆå¦‚æœé€‰æ‹©ä¸­æ–‡ï¼‰
   - âœ… `eng.traineddata.gz`ï¼ˆå¦‚æœé€‰æ‹©è‹±æ–‡ï¼‰

### æ–¹æ³• 2ï¼šç›´æ¥è®¿é—®

åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼š
```
http://localhost:3001/tessdata/worker.min.js
http://localhost:3001/tessdata/tesseract-core.wasm.js
```

åº”è¯¥èƒ½çœ‹åˆ°æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯ 404 é”™è¯¯ã€‚

### æ–¹æ³• 3ï¼šæ£€æŸ¥é”™è¯¯æ—¥å¿—

å¦‚æœé…ç½®é”™è¯¯ï¼Œæ§åˆ¶å°ä¼šæ˜¾ç¤ºï¼š
```
Failed to load resource: the server responded with a status of 404 (Not Found)
```

## å…­ã€å¸¸è§é—®é¢˜

### Q1ï¼š404 é”™è¯¯

**é—®é¢˜**ï¼š
```
GET http://localhost:3001/tesseract/worker.min.js 404 (Not Found)
```

**åŸå› **ï¼šè·¯å¾„é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
```typescript
// å°†
workerPath: '/tesseract/worker.min.js'
// æ”¹ä¸º
workerPath: '/tessdata/worker.min.js'
```

### Q2ï¼šWebAssembly åŠ è½½å¤±è´¥

**é—®é¢˜**ï¼š
```
TypeError: WebAssembly.instantiate(): Import #0 module="env" error: 
  module is not an object or function
```

**åŸå› **ï¼š
- `corePath` é…ç½®é”™è¯¯
- `legacyCore` è®¾ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**ï¼š
```typescript
corePath: '/tessdata/tesseract-core.wasm.js',
legacyCore: true,  // âœ… å¿…é¡»è®¾ç½®ä¸º true
```

### Q3ï¼šè¯­è¨€åŒ…åŠ è½½å¤±è´¥

**é—®é¢˜**ï¼š
```
Error: Failed to load language 'chi_sim'
```

**åŸå› **ï¼š
- `langPath` æœªé…ç½®
- è¯­è¨€åŒ…æ–‡ä»¶ç¼ºå¤±
- è·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
```typescript
// 1. æ·»åŠ  langPath é…ç½®
langPath: '/tessdata/',

// 2. ç¡®ä¿è¯­è¨€åŒ…å­˜åœ¨
// æ£€æŸ¥ public/tessdata/chi_sim.traineddata.gz
```

### Q4ï¼šWorker åˆå§‹åŒ–å¤±è´¥

**é—®é¢˜**ï¼š
```
Error: Tesseract.js æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ index.html ä¸­çš„è„šæœ¬å¼•ç”¨
```

**åŸå› **ï¼š
- Tesseract.js ä¸»åº“æœªåŠ è½½
- index.html é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š

æ£€æŸ¥ `index.html`ï¼š
```html
<script src="/tessdata/tesseract.min.js"></script>
```

## ä¸ƒã€éƒ¨ç½²æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒ

```bash
# å¼€å‘æœåŠ¡å™¨
npm run dev
# è®¿é—®ï¼šhttp://localhost:3001
```

è·¯å¾„ï¼š`http://localhost:3001/tessdata/...`

### ç”Ÿäº§ç¯å¢ƒ

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬
npm run preview
```

è·¯å¾„ï¼š`https://your-domain.com/tessdata/...`

### Docker éƒ¨ç½²

ç¡®ä¿ Dockerfile åŒ…å«ï¼š
```dockerfile
COPY public/tessdata/ /app/dist/tessdata/
```

## å…«ã€æ–‡ä»¶æ¥æº

### è·å– Tesseract.js æ–‡ä»¶

**æ–¹æ³• 1ï¼šä» npm åŒ…å¤åˆ¶**

```bash
# æŸ¥çœ‹å®‰è£…çš„åŒ…
npm list tesseract.js

# å¤åˆ¶æ–‡ä»¶
cp node_modules/tesseract.js/dist/worker.min.js public/tessdata/
cp node_modules/tesseract.js/dist/tesseract-core.wasm.js public/tessdata/
cp node_modules/tesseract.js/dist/tesseract.min.js public/tessdata/
```

**æ–¹æ³• 2ï¼šä» CDN ä¸‹è½½**

```bash
# Worker è„šæœ¬
curl -o public/tessdata/worker.min.js \
  https://cdn.jsdelivr.net/npm/tesseract.js@v4.1.4/dist/worker.min.js

# æ ¸å¿ƒæ–‡ä»¶
curl -o public/tessdata/tesseract-core.wasm.js \
  https://cdn.jsdelivr.net/npm/tesseract.js@v4.1.4/dist/tesseract-core.wasm.js

# ä¸»åº“
curl -o public/tessdata/tesseract.min.js \
  https://cdn.jsdelivr.net/npm/tesseract.js@v4.1.4/dist/tesseract.min.js
```

**æ–¹æ³• 3ï¼šæ‰‹åŠ¨ä¸‹è½½**

è®¿é—® Tesseract.js GitHubï¼š
https://github.com/naptha/tesseract.js/tree/master/dist

### è·å–è¯­è¨€åŒ…

**å®˜æ–¹ä¸‹è½½åœ°å€**ï¼š

- **ä¸­æ–‡**ï¼šhttps://github.com/tesseract-ocr/tessdata/blob/main/chi_sim.traineddata.gz
- **è‹±æ–‡**ï¼šhttps://github.com/tesseract-ocr/tessdata/blob/main/eng.traineddata.gz
- **æ—¥æ–‡**ï¼šhttps://github.com/tesseract-ocr/tessdata/blob/main/jpn.traineddata.gz
- **éŸ©æ–‡**ï¼šhttps://github.com/tesseract-ocr/tessdata/blob/main/kor.traineddata.gz
- **OSD**ï¼šhttps://github.com/tesseract-ocr/tessdata/blob/main/osd.traineddata.gz

**PowerShell ä¸‹è½½è„šæœ¬**ï¼š

```powershell
# ä¸‹è½½ä¸­æ–‡è¯­è¨€åŒ…
Invoke-WebRequest -Uri "https://github.com/tesseract-ocr/tessdata/raw/main/chi_sim.traineddata.gz" -OutFile "e:\toolClient\public\tessdata\chi_sim.traineddata.gz"

# ä¸‹è½½è‹±æ–‡è¯­è¨€åŒ…
Invoke-WebRequest -Uri "https://github.com/tesseract-ocr/tessdata/raw/main/eng.traineddata.gz" -OutFile "e:\toolClient\public\tessdata\eng.traineddata.gz"

# ä¸‹è½½æ—¥æ–‡è¯­è¨€åŒ…
Invoke-WebRequest -Uri "https://github.com/tesseract-ocr/tessdata/raw/main/jpn.traineddata.gz" -OutFile "e:\toolClient\public\tessdata\jpn.traineddata.gz"

# ä¸‹è½½éŸ©æ–‡è¯­è¨€åŒ…
Invoke-WebRequest -Uri "https://github.com/tesseract-ocr/tessdata/raw/main/kor.traineddata.gz" -OutFile "e:\toolClient\public\tessdata\kor.traineddata.gz"

# ä¸‹è½½OSDè¯­è¨€åŒ…
Invoke-WebRequest -Uri "https://github.com/tesseract-ocr/tessdata/raw/main/osd.traineddata.gz" -OutFile "e:\toolClient\public\tessdata\osd.traineddata.gz"
```

## ä¹ã€æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥

- [ ] `public/tessdata/` ç›®å½•å­˜åœ¨
- [ ] `worker.min.js` æ–‡ä»¶å­˜åœ¨
- [ ] `tesseract-core.wasm.js` æ–‡ä»¶å­˜åœ¨
- [ ] `tesseract.min.js` æ–‡ä»¶å­˜åœ¨
- [ ] æ‰€éœ€çš„è¯­è¨€åŒ…å­˜åœ¨ï¼ˆchi_sim.traineddata.gz ç­‰ï¼‰
- [ ] `tesseract-engine.ts` è·¯å¾„é…ç½®æ­£ç¡®
- [ ] `index.html` å¼•ç”¨æ­£ç¡®
- [ ] æµè§ˆå™¨è®¿é—®æµ‹è¯•é€šè¿‡
- [ ] Network é¢æ¿æ—  404 é”™è¯¯
- [ ] æ§åˆ¶å°æ— é”™è¯¯ä¿¡æ¯

## åã€æ€»ç»“

### å…³é”®è¦ç‚¹

1. **ç›®å½•å**ï¼šä½¿ç”¨ `tessdata` è€Œä¸æ˜¯ `tesseract`
2. **è·¯å¾„æ ¼å¼**ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„ `/tessdata/...`
3. **ä¸‰ä¸ªå‚æ•°**ï¼šå¿…é¡»é…ç½® `workerPath`ã€`corePath`ã€`langPath`
4. **legacyCore**ï¼šå¿…é¡»è®¾ç½®ä¸º `true`
5. **éªŒè¯æ–¹æ³•**ï¼šä½¿ç”¨æµè§ˆå™¨ Network é¢æ¿æ£€æŸ¥

### å¸¸è§é”™è¯¯

| é”™è¯¯ç±»å‹ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|----------|
| 404 é”™è¯¯ | è·¯å¾„é”™è¯¯ | ä¿®æ­£è·¯å¾„é…ç½® |
| WebAssembly é”™è¯¯ | corePath é”™è¯¯ | æ£€æŸ¥ corePath å’Œ legacyCore |
| è¯­è¨€åŒ…é”™è¯¯ | langPath ç¼ºå¤± | æ·»åŠ  langPath é…ç½® |
| Worker æœªåŠ è½½ | Tesseract.js æœªå¼•å…¥ | æ£€æŸ¥ index.html |

---

**æœ€åæ›´æ–°**: 2025-01-18  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

**ğŸ“ å¦‚æœ‰é—®é¢˜**ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
3. éªŒè¯æ–‡ä»¶è·¯å¾„å’Œé…ç½®
4. è”ç³»å¼€å‘å›¢é˜Ÿ
