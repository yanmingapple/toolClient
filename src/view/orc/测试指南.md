# OCR 功能测试指南

## 一、测试环境

- **Node.js 版本**: 18.x 或更高
- **浏览器**: Chrome 100+ / Firefox 90+ / Edge 100+
- **开发服务器**: `http://localhost:3001`

## 二、测试步骤

### 2.1 启动项目

```bash
cd e:\toolClient
npm run dev
```

访问 `http://localhost:3001`

### 2.2 功能测试清单

#### ✅ 基础功能

1. **文件上传**
   - [ ] 点击选择文件按钮
   - [ ] 选择图片文件（JPG、PNG、BMP）
   - [ ] 确认文件列表显示正确

2. **拖拽上传**
   - [ ] 拖拽图片到上传区域
   - [ ] 确认拖拽状态提示正确
   - [ ] 确认文件成功添加

3. **粘贴图片**
   - [ ] 复制图片到剪贴板
   - [ ] 在页面任意位置粘贴（Ctrl+V）
   - [ ] 确认图片成功添加

4. **图片预览**
   - [ ] 上传图片后查看预览
   - [ ] 确认预览图片显示正常

5. **删除文件**
   - [ ] 删除单个文件
   - [ ] 确认文件从列表中移除

#### ✅ OCR 引擎选择

6. **引擎选择器**
   - [ ] 查看引擎列表
   - [ ] 确认 Tesseract.js 显示为可用
   - [ ] 确认其他引擎显示为暂未实现
   - [ ] 点击 Tesseract.js 卡片
   - [ ] 确认选中状态正确

7. **语言选择**
   - [ ] 查看语言下拉列表
   - [ ] 选择不同语言（自动识别、中文、英文等）
   - [ ] 确认语言切换正常

#### ✅ 图像处理选项

8. **缩放处理**
   - [ ] 调整缩放比例滑块
   - [ ] 确认数值变化正确

9. **灰度化**
   - [ ] 开启/关闭灰度化开关
   - [ ] 确认状态切换正常

10. **二值化**
    - [ ] 开启二值化开关
    - [ ] 调整二值化阈值
    - [ ] 确认阈值变化正常

11. **降噪处理**
    - [ ] 开启降噪开关
    - [ ] 调整降噪强度
    - [ ] 确认强度变化正常

12. **对比度和亮度**
    - [ ] 调整对比度滑块
    - [ ] 调整亮度滑块
    - [ ] 确认数值变化正常

#### ✅ OCR 识别功能

13. **开始识别**
    - [ ] 上传一张包含文字的图片
    - [ ] 点击"开始识别"按钮
    - [ ] 确认进度条开始动
    - [ ] 确认状态消息更新

14. **识别进度**
    - [ ] 观察进度百分比变化
    - [ ] 观察状态消息变化
    - [ ] 确认最终进度达到 100%

15. **识别结果**
    - [ ] 确认识别结果显示在右侧面板
    - [ ] 检查识别文本的准确性
    - [ ] 确认统计信息显示（处理时间、置信度、字符数）

16. **批量识别**
    - [ ] 上传多张图片
    - [ ] 点击开始识别
    - [ ] 确认所有图片都被处理
    - [ ] 确认结果中包含文件分隔符

#### ✅ 结果操作

17. **复制结果**
    - [ ] 完成识别后点击"复制"按钮
    - [ ] 粘贴到文本编辑器
    - [ ] 确认内容正确

18. **导出 TXT**
    - [ ] 点击"导出 TXT"按钮
    - [ ] 确认文件下载
    - [ ] 打开下载的文件
    - [ ] 确认内容正确

#### ✅ 错误处理

19. **无文件识别**
    - [ ] 不上传任何文件
    - [ ] 点击"开始识别"
    - [ ] 确认提示"请先上传图片"

20. **重复识别**
    - [ ] 识别过程中再次点击"开始识别"
    - [ ] 确认按钮被禁用

## 三、测试用例

### 3.1 测试图片建议

1. **简单文本**
   - 清晰打印的文字
   - 单一语言
   - 良好光照

2. **复杂文本**
   - 多种字体和字号
   - 混合语言（中文+英文）
   - 表格或列表

3. **低质量图片**
   - 模糊或失焦
   - 倾斜或旋转
   - 低光照或高对比度
   - 有噪点或水印

### 3.2 预期结果

| 测试场景 | 预期结果 |
|---------|---------|
| 清晰中文文档 | 识别准确率 > 90% |
| 清晰英文文档 | 识别准确率 > 95% |
| 混合语言文档 | 识别准确率 > 85% |
| 低质量图片 | 识别准确率 > 70% |
| 单张图片处理 | 处理时间 < 5 秒 |
| 批量处理（5张） | 总处理时间 < 30 秒 |

## 四、常见问题排查

### Q1: 识别结果为空

**可能原因**：
- 图片中没有可识别的文字
- 图片质量太差
- 语言选择不正确

**解决方法**：
- 尝试使用高质量图片
- 调整图像处理选项（增加对比度、缩放等）
- 确认语言选择正确

### Q2: 识别速度慢

**可能原因**：
- 图片尺寸太大
- 浏览器性能限制
- 同时处理多张图片

**解决方法**：
- 缩小图片尺寸后再上传
- 关闭其他占用资源的标签页
- 减少同时处理的图片数量

### Q3: 引擎初始化失败

**可能原因**：
- Tesseract.js 脚本未正确加载
- 本地模型文件缺失
- 浏览器不支持 WebAssembly

**解决方法**：
- 检查浏览器控制台错误信息
- 确认 `public/tesseract/` 目录下有必要的文件
- 更新浏览器到最新版本

### Q4: 粘贴功能无效

**可能原因**：
- 剪贴板中没有图片
- 浏览器不支持 Clipboard API
- 页面没有获得焦点

**解决方法**：
- 确保复制了图片到剪贴板
- 使用现代浏览器
- 点击页面后再尝试粘贴

## 五、性能测试

### 5.1 速度测试

```bash
# 测试单张图片处理时间
# 预期: < 5 秒

# 测试批量处理（5张）
# 预期: 总时间 < 30 秒，平均 < 6 秒/张
```

### 5.2 准确率测试

使用标准测试数据集：
- ICDAR 数据集
- 自建测试集（包含不同场景的图片）

计算识别准确率：
```
准确率 = 正确识别字符数 / 总字符数 × 100%
```

## 六、浏览器兼容性测试

### 支持的浏览器

| 浏览器 | 最低版本 | 支持状态 |
|--------|---------|---------|
| Chrome | 100+ | ✅ 完全支持 |
| Firefox | 90+ | ✅ 完全支持 |
| Edge | 100+ | ✅ 完全支持 |
| Safari | 15+ | ⚠️ 部分支持 |
| Opera | 85+ | ✅ 完全支持 |

### 不支持的浏览器

- Internet Explorer（任何版本）
- Safari < 15
- 其他老旧浏览器

## 七、移动端测试

### 7.1 测试设备

- iOS 设备（iPhone/iPad）
- Android 设备
- 不同屏幕尺寸

### 7.2 移动端功能

- [ ] 触摸操作正常
- [ ] 响应式布局正确
- [ ] 相机拍照上传（如果支持）
- [ ] 图片选择器正常工作

## 八、测试报告模板

```
测试报告
--------
测试日期: YYYY-MM-DD
测试人员: 姓名
测试环境: 浏览器版本、操作系统

测试结果:

1. 文件上传: ✅ 通过 / ❌ 失败
   - 问题描述: ...
   - 重现步骤: ...

2. 拖拽上传: ✅ 通过 / ❌ 失败
   - ...

...

总体评价: ✅ 通过 / ⚠️ 部分通过 / ❌ 不通过

备注:
- ...
```

## 九、自动化测试（可选）

### 9.1 使用 Cypress

```javascript
// cypress/e2e/ocr.spec.js
describe('OCR 功能测试', () => {
  it('应该能够上传图片并识别', () => {
    cy.visit('/orc')
    
    // 上传图片
    cy.get('input[type="file"]').attachFile('test-image.png')
    
    // 点击识别
    cy.get('button:contains("开始识别")').click()
    
    // 等待完成
    cy.get('.progress-section').should('contain', '100%')
    
    // 检查结果
    cy.get('.result-text pre').should('not.be.empty')
  })
})
```

### 9.2 使用 Playwright

```typescript
// tests/ocr.spec.ts
test('OCR 识别测试', async ({ page }) => {
  await page.goto('/orc')
  
  // 上传图片
  await page.setInputFiles('input[type="file"]', 'test-image.png')
  
  // 点击识别
  await page.click('button:has-text("开始识别")')
  
  // 等待完成
  await page.waitForSelector('.progress-section:has-text("100%")')
  
  // 检查结果
  const result = await page.textContent('.result-text pre')
  expect(result).not.toBe('')
})
```

## 十、性能监控

### 10.1 浏览器 DevTools

- **Performance 面板**: 分析识别过程的性能瓶颈
- **Memory 面板**: 检查内存使用情况
- **Network 面板**: 确认模型文件加载正常

### 10.2 性能指标

```typescript
// 记录性能数据
const startTime = performance.now()
// ... 识别逻辑
const endTime = performance.now()

console.log(`处理时间: ${endTime - startTime}ms`)

// 使用 Performance API
performance.mark('ocr-start')
// ... 识别逻辑
performance.mark('ocr-end')
performance.measure('ocr-duration', 'ocr-start', 'ocr-end')
```

## 十一、安全测试

### 11.1 XSS 防护

- [ ] 识别结果正确转义
- [ ] 不执行恶意脚本
- [ ] 用户输入正确过滤

### 11.2 文件上传安全

- [ ] 只允许图片格式
- [ ] 文件大小限制
- [ ] 病毒扫描（可选）

## 十二、测试完成标准

所有测试用例通过：
- ✅ 功能测试: 100% 通过
- ✅ 性能测试: 达到预期指标
- ✅ 兼容性测试: 支持所有目标浏览器
- ✅ 安全测试: 无安全漏洞
- ✅ 移动端测试: 正常工作

## 十三、后续优化建议

根据测试结果，可能需要优化：

1. **性能优化**
   - 优化图片预处理算法
   - 使用 Web Worker 进行后台处理
   - 缓存引擎实例

2. **准确率优化**
   - 调整图像处理参数
   - 尝试不同的 OCR 引擎
   - 添加后处理算法

3. **用户体验优化**
   - 改进错误提示
   - 添加操作引导
   - 优化加载状态

## 十四、联系方式

如有问题，请联系：
- 开发团队: ...
- 测试团队: ...
- 文档维护: ...

---

**最后更新**: 2025-01-18
**版本**: v1.0.0
**状态**: 待测试
