<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <title>试卷预览生成中……</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="author" content="nop">
    <meta name="generator" content="wkhtmltopdf">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0">
    <script src="./static/pdfrender/jquery.min.js"></script>
    <script src="./static/pdfrender/patch.min.js"></script>
    <script src="./static/pdfrender/lodash.min.js"></script>
    <script src="./static/pdfrender/pdfjs/latest/bookjs-eazy.min.js"></script>

    <style>
        table{
            border: 1px solid black;
            width: 100%;
            border-spacing: 0;
            text-align: center;
            border-collapse: collapse;
        }
        th,tr,td{
            border: 1px solid black;
            text-align: center !important;
        }
    </style>
</head>

<body>
    <div id="content-box" style="display:none">
    </div>
    
    <script>

        function getUrlParams() {
            let url = window.location.href;
            const paramsRegex = /[?&]+([^=&]+)=([^&]*)/gi;
            const params = {};
            let match;
            while (match = paramsRegex.exec(url)) {
                params[match[1]] = match[2];
            }
            return params;
        }

        const urlParam = getUrlParams();
        var pxOfCm = function () {
                var e = document.createElement("div");
                e.id = "cm", e.style.width = "1cm", e.style.display = "block", document.querySelector("body")
                    .appendChild(e);
                var t = document.getElementById("cm").getBoundingClientRect().width;
                return $("#cm").remove(), t
            }(),
            pageMap = {
                paper: {
                    name: "ISO_" + urlParam.paperSize,
                    pxSizeOfW: 21 * pxOfCm,
                    pxSizeOfH: 29.6 * pxOfCm
                },
                padding: urlParam.margin.split(",").map(item => item + "cm").join(" ")
            },
            bookConfig = {
                pageSize: pageMap.paper.name,
                orientation: urlParam.layout || "portrait",// portrait/landscape 定义纸张是竖屏/横屏放置
                pageFixedHeightOffset: -1,
                padding: pageMap.padding,
                textNoBreakChars: ["，", "。", "：", "”", "！", "？", "、", "；", "》", "】", "…", ".", ",", "!", "]", "}", "｝"],
                simpleCatalog: {
                    positionSelector: ".pendant-title:first",
                    showCatalog: !1
                },
                simplePageNum: {
                    pageBegin: urlParam.startNum,
                    pageEnd:   urlParam.endNum,
                    // pageBegin: 5,
                    // pageEnd:   -1,
                    // pendant : '<div class="page-num-simple"><span style="">$' + '{PAGE + PAGE_BEGIN_INDEX * 2 - 1} / $' + '{PAGE_BEGIN_INDEX} - ${PAGE_BEGIN_INDEX - 1 + TOTAL_PAGE_REAL}</span></div>',
                    pendant : '<div class=\"page-num-simple\"><span style=\"\">第${PAGE}页 / 共${TOTAL_PAGE}页</span></div>',
                    //PAGE: -4  PAGE_BEGIN_INDEX: 5  PAGE_END_INDEX: 7  TOTAL_PAGE: 3  TOTAL_PAGE_REAL: 8
                },
                simpleCatalog: {
                    showCatalog: !1,
                    header: '<div class="catalog-title">目 录</div>',
                    itemFillChar: "…",
                    positionSelector: ".nop-page-item-pagenum-1",
                    makeItem: function (e, t) {
                        return "<div>自定义的目录项html内容，根据itemInfo自己构造</div>"
                    },
                    showSlide: !1,
                    slideOn: !1,
                    slideHeader: '<div class="title">目&nbsp;&nbsp;录</div>',
                    slideClassName: "",
                    slidePosition: "left",
                    slideMakeContent: null
                },
                toolBar: {
                    serverPrint: !1,
                    webPrint: !0,
                    saveHtml: !1,
                    buttons: []
                },
                start: !1
            },
            d1 = $.Deferred();

        function setPaperHtml(e) {
            $("#content-box").html(e)
 
            d1.resolve()
        }

        function handleMessage(html) { 
            setPaperHtml(html)   
        }
        $.when(d1).then((function () {
            bookConfig.start = !0
        }))

              // 接收试卷数据
      window.onmessage = function(e) {
        
        handleMessage( e.data)
      }

   
    </script>
</body>

</html>