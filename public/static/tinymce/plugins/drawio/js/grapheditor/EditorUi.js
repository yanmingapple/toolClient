function ChangeGridColor(t,e){this.ui=t,this.color=e}function ChangePageSetup(t,e,i,n,o){this.ui=t,this.color=e,this.previousColor=e,this.image=i,this.previousImage=i,this.format=n,this.previousFormat=n,this.pageScale=o,this.previousPageScale=o,this.ignoreColor=!1,this.ignoreImage=!1}EditorUi=function(t,e,i){mxEventSource.call(this),this.destroyFunctions=[],this.editor=t||new Editor,this.container=e||document.body;var T=this.editor.graph;T.lightbox=i;var o=T.getGraphBounds;if(T.getGraphBounds=function(t){var e,i,n=o.apply(this,arguments),t=this.backgroundImage;return null!=t&&(e=this.view.translate,i=this.view.scale,(n=mxRectangle.fromRectangle(n)).add(new mxRectangle((e.x+t.x)*i,(e.y+t.y)*i,t.width*i,t.height*i))),n},T.useCssTransforms&&(this.lazyZoomDelay=0),mxClient.IS_SVG?mxPopupMenu.prototype.submenuImage="data:image/gif;base64,R0lGODlhCQAJAIAAAP///zMzMyH5BAEAAAAALAAAAAAJAAkAAAIPhI8WebHsHopSOVgb26AAADs=":(new Image).src=mxPopupMenu.prototype.submenuImage,mxClient.IS_SVG||null==mxConnectionHandler.prototype.connectImage||((new Image).src=mxConnectionHandler.prototype.connectImage.src),this.editor.chromeless&&!this.editor.editable&&(this.footerHeight=0,T.isEnabled=function(){return!1},T.panningHandler.isForcePanningEvent=function(t){return!mxEvent.isPopupTrigger(t.getEvent())}),this.actions=new Actions(this),this.menus=this.createMenus(),!T.standalone){var M=["rounded","shadow","glass","dashed","dashPattern","labelBackgroundColor","labelBorderColor","comic","sketch","fillWeight","hachureGap","hachureAngle","jiggle","disableMultiStroke","disableMultiStrokeFill","fillStyle","curveFitting","simplification","sketchStyle","pointerEvents"],h=["shape","edgeStyle","curved","rounded","elbow","jumpStyle","jumpSize","comic","sketch","fillWeight","hachureGap","hachureAngle","jiggle","disableMultiStroke","disableMultiStrokeFill","fillStyle","curveFitting","simplification","sketchStyle"],P=["curved","sourcePerimeterSpacing","targetPerimeterSpacing","startArrow","startFill","startSize","endArrow","endFill","endSize"];this.setDefaultStyle=function(t){try{var e=T.view.getState(t);if(null!=e){var i=t.clone();i.style="";var n=T.getCellStyle(i),o=[],r=[];for(d in e.style)n[d]!=e.style[d]&&(o.push(e.style[d]),r.push(d));for(var l=T.getModel().getStyle(e.cell),s=null!=l?l.split(";"):[],a=0;a<s.length;a++){var d,h,c=s[a],u=c.indexOf("=");0<=u&&(d=c.substring(0,u),h=c.substring(u+1),null!=n[d]&&"none"==h&&(o.push(h),r.push(d)))}T.getModel().isEdge(e.cell)?T.currentEdgeStyle={}:T.currentVertexStyle={},this.fireEvent(new mxEventObject("styleChanged","keys",r,"values",o,"cells",[e.cell]))}}catch(t){this.handleError(t)}},this.clearDefaultStyle=function(){T.currentEdgeStyle=mxUtils.clone(T.defaultEdgeStyle),T.currentVertexStyle=mxUtils.clone(T.defaultVertexStyle),this.fireEvent(new mxEventObject("styleChanged","keys",[],"values",[],"cells",[]))};for(var c=["fontFamily","fontSource","fontSize","fontColor"],n=0;n<c.length;n++)mxUtils.indexOf(M,c[n])<0&&M.push(c[n]);for(var u=["edgeStyle","startArrow","startFill","startSize","endArrow","endFill","endSize"],k=[["startArrow","startFill","endArrow","endFill"],["startSize","endSize"],["sourcePerimeterSpacing","targetPerimeterSpacing"],["strokeColor","strokeWidth"],["fillColor","gradientColor","gradientDirection"],["align","verticalAlign"],["opacity"],["html"]],n=0;n<k.length;n++)for(var r=0;r<k[n].length;r++)M.push(k[n][r]);for(n=0;n<h.length;n++)mxUtils.indexOf(M,h[n])<0&&M.push(h[n]);function l(t,e,i,n,o,r,l){if(n=null!=n?n:T.currentVertexStyle,o=null!=o?o:T.currentEdgeStyle,r=null==r||r,i=null!=i?i:T.getModel(),l){for(var s=[],a=0;a<t.length;a++)s=s.concat(i.getDescendants(t[a]));t=s}i.beginUpdate();try{for(a=0;a<t.length;a++){var d=t[a];if(e)u=["fontSize","fontFamily","fontColor"];else for(var h=i.getStyle(d),c=null!=h?h.split(";"):[],u=M.slice(),g=0;g<c.length;g++){var p=c[g],m=p.indexOf("=");if(0<=m){var f=p.substring(0,m),x=mxUtils.indexOf(u,f);0<=x&&u.splice(x,1);for(var y=0;y<k.length;y++){var v=k[y];if(0<=mxUtils.indexOf(v,f))for(var E=0;E<v.length;E++){var b=mxUtils.indexOf(u,v[E]);0<=b&&u.splice(b,1)}}}}for(var C=i.isEdge(d),S=C?o:n,w=i.getStyle(d),g=0;g<u.length;g++){var U=S[f=u[g]];null==U||"edgeStyle"==f||"shape"==f&&!C||(!C||r||mxUtils.indexOf(P,f)<0)&&(w=mxUtils.setStyle(w,f,U))}Editor.simpleLabels&&(w=mxUtils.setStyle(mxUtils.setStyle(w,"html",null),"whiteSpace",null)),i.setStyle(d,w)}}finally{i.endUpdate()}return t}T.addListener("cellsInserted",function(t,e){l(e.getProperty("cells"),null,null,null,null,!0,!0)}),T.addListener("textInserted",function(t,e){l(e.getProperty("cells"),!0)}),this.insertHandler=l,this.createDivs(),this.createUi(),this.refresh();var s,a,d=mxUtils.bind(this,function(t){return null==t&&(t=window.event),T.isEditing()||null!=t&&this.isSelectionAllowed(t)});this.container==document.body&&(this.menubarContainer.onselectstart=d,this.menubarContainer.onmousedown=d,this.toolbarContainer.onselectstart=d,this.toolbarContainer.onmousedown=d,this.diagramContainer.onselectstart=d,this.diagramContainer.onmousedown=d,this.sidebarContainer.onselectstart=d,this.sidebarContainer.onmousedown=d,this.formatContainer.onselectstart=d,this.formatContainer.onmousedown=d,this.footerContainer.onselectstart=d,this.footerContainer.onmousedown=d,null!=this.tabContainer&&(this.tabContainer.onselectstart=d)),!this.editor.chromeless||this.editor.editable?(s=function(t){if(null!=t){var e=mxEvent.getSource(t);if("A"==e.nodeName)for(;null!=e;){if("geHint"==e.className)return!0;e=e.parentNode}}return d(t)},mxClient.IS_IE&&(void 0===document.documentMode||document.documentMode<9)?mxEvent.addListener(this.diagramContainer,"contextmenu",s):this.diagramContainer.oncontextmenu=s):T.panningHandler.usePopupTrigger=!1,T.init(this.diagramContainer),!mxClient.IS_SVG||null==T.view.getDrawPane()||null!=(s=T.view.getDrawPane().ownerSVGElement)&&(s.style.position="absolute"),this.hoverIcons=this.createHoverIcons(),null!=T.graphHandler&&(a=T.graphHandler.start,T.graphHandler.start=function(){null!=S.hoverIcons&&S.hoverIcons.reset(),a.apply(this,arguments)}),mxEvent.addListener(this.diagramContainer,"mousemove",mxUtils.bind(this,function(t){var e=mxUtils.getOffset(this.diagramContainer);0<mxEvent.getClientX(t)-e.x-this.diagramContainer.clientWidth||0<mxEvent.getClientY(t)-e.y-this.diagramContainer.clientHeight?this.diagramContainer.setAttribute("title",mxResources.get("panTooltip")):this.diagramContainer.removeAttribute("title")}));var g=!1,p=this.hoverIcons.isResetEvent;this.hoverIcons.isResetEvent=function(t,e){return g||p.apply(this,arguments)},this.keydownHandler=mxUtils.bind(this,function(t){32!=t.which||T.isEditing()?mxEvent.isConsumed(t)||27!=t.keyCode||this.hideDialog(null,!0):(g=!0,this.hoverIcons.reset(),T.container.style.cursor="move",T.isEditing()||mxEvent.getSource(t)!=T.container||mxEvent.consume(t))}),mxEvent.addListener(document,"keydown",this.keydownHandler),this.keyupHandler=mxUtils.bind(this,function(t){T.container.style.cursor="",g=!1}),mxEvent.addListener(document,"keyup",this.keyupHandler);var m=T.panningHandler.isForcePanningEvent;T.panningHandler.isForcePanningEvent=function(t){return m.apply(this,arguments)||g||mxEvent.isMouseEvent(t.getEvent())&&(this.usePopupTrigger||!mxEvent.isPopupTrigger(t.getEvent()))&&(!mxEvent.isControlDown(t.getEvent())&&mxEvent.isRightMouseButton(t.getEvent())||mxEvent.isMiddleMouseButton(t.getEvent()))};var f=T.cellEditor.isStopEditingEvent;T.cellEditor.isStopEditingEvent=function(t){return f.apply(this,arguments)||13==t.keyCode&&(!mxClient.IS_SF&&mxEvent.isControlDown(t)||mxClient.IS_MAC&&mxEvent.isMetaDown(t)||mxClient.IS_SF&&mxEvent.isShiftDown(t))};var x=T.isZoomWheelEvent,y=!(T.isZoomWheelEvent=function(){return g||x.apply(this,arguments)}),v=null,E=null,b=null,C=mxUtils.bind(this,function(){if(null!=this.toolbar&&y!=T.cellEditor.isContentEditing()){for(var t=this.toolbar.container.firstChild,e=[];null!=t;){var i=t.nextSibling;mxUtils.indexOf(this.toolbar.staticElements,t)<0&&(t.parentNode.removeChild(t),e.push(t)),t=i}var n=this.toolbar.fontMenu,o=this.toolbar.sizeMenu;if(null==b)this.toolbar.createTextToolbar();else{for(var r=0;r<b.length;r++)this.toolbar.container.appendChild(b[r]);this.toolbar.fontMenu=v,this.toolbar.sizeMenu=E}y=T.cellEditor.isContentEditing(),v=n,E=o,b=e}}),S=this,w=T.cellEditor.startEditing;T.cellEditor.startEditing=function(){var e,t;w.apply(this,arguments),C(),T.cellEditor.isContentEditing()&&(e=!1,t=function(){e||(e=!0,window.setTimeout(function(){var t=T.getSelectedEditingElement();null==t||null!=(t=mxUtils.getCurrentStyle(t))&&null!=S.toolbar&&(S.toolbar.setFontName(Graph.stripQuotes(t.fontFamily)),S.toolbar.setFontSize(parseInt(t.fontSize))),e=!1},0))},mxEvent.addListener(T.cellEditor.textarea,"input",t),mxEvent.addListener(T.cellEditor.textarea,"touchend",t),mxEvent.addListener(T.cellEditor.textarea,"mouseup",t),mxEvent.addListener(T.cellEditor.textarea,"keyup",t),t())};var U=T.cellEditor.stopEditing;if(T.cellEditor.stopEditing=function(t,e){try{U.apply(this,arguments),C()}catch(t){S.handleError(t)}},T.container.setAttribute("tabindex","0"),T.container.style.cursor="default",window.self===window.top&&null!=T.container.parentNode)try{T.container.focus()}catch(t){}var A=T.fireMouseEvent;T.fireMouseEvent=function(t,e,i){t==mxEvent.MOUSE_DOWN&&this.container.focus(),A.apply(this,arguments)},T.popupMenuHandler.autoExpand=!0,null!=this.menus&&(T.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(t,e,i){this.menus.createPopupMenu(t,e,i)})),mxEvent.addGestureListeners(document,mxUtils.bind(this,function(t){T.popupMenuHandler.hideMenu()})),this.keyHandler=this.createKeyHandler(t),this.getKeyHandler=function(){return keyHandler},T.connectionHandler.addListener(mxEvent.CONNECT,function(t,e){var i=[e.getProperty("cell")];e.getProperty("terminalInserted")&&(i.push(e.getProperty("terminal")),window.setTimeout(function(){null!=S.hoverIcons&&S.hoverIcons.update(T.view.getState(i[i.length-1]))},0)),l(i)}),this.addListener("styleChanged",mxUtils.bind(this,function(t,e){var i=e.getProperty("cells"),n=!1,o=!1;if(0<i.length)for(var r=0;r<i.length&&(n=T.getModel().isVertex(i[r])||n,!(o=T.getModel().isEdge(i[r])||o)||!n);r++);else o=n=!0;for(var l,s=e.getProperty("keys"),a=e.getProperty("values"),r=0;r<s.length;r++){var d=0<=mxUtils.indexOf(c,s[r]);("strokeColor"!=s[r]||null!=a[r]&&"none"!=a[r])&&(0<=mxUtils.indexOf(h,s[r])?o||0<=mxUtils.indexOf(u,s[r])?null==a[r]?delete T.currentEdgeStyle[s[r]]:T.currentEdgeStyle[s[r]]=a[r]:n&&0<=mxUtils.indexOf(M,s[r])&&(null==a[r]?delete T.currentVertexStyle[s[r]]:T.currentVertexStyle[s[r]]=a[r]):0<=mxUtils.indexOf(M,s[r])&&((n||d)&&(null==a[r]?delete T.currentVertexStyle[s[r]]:T.currentVertexStyle[s[r]]=a[r]),(o||d||0<=mxUtils.indexOf(u,s[r]))&&(null==a[r]?delete T.currentEdgeStyle[s[r]]:T.currentEdgeStyle[s[r]]=a[r])))}null!=this.toolbar&&(this.toolbar.setFontName(T.currentVertexStyle.fontFamily||Menus.prototype.defaultFont),this.toolbar.setFontSize(T.currentVertexStyle.fontSize||Menus.prototype.defaultFontSize),null!=this.toolbar.edgeStyleMenu&&(l=this.toolbar.edgeStyleMenu.getElementsByTagName("div")[0],"orthogonalEdgeStyle"==T.currentEdgeStyle.edgeStyle&&"1"==T.currentEdgeStyle.curved?l.className="geSprite geSprite-curved":"straight"==T.currentEdgeStyle.edgeStyle||"none"==T.currentEdgeStyle.edgeStyle||null==T.currentEdgeStyle.edgeStyle?l.className="geSprite geSprite-straight":"entityRelationEdgeStyle"==T.currentEdgeStyle.edgeStyle?l.className="geSprite geSprite-entity":"elbowEdgeStyle"==T.currentEdgeStyle.edgeStyle?l.className="geSprite geSprite-"+("vertical"==T.currentEdgeStyle.elbow?"verticalelbow":"horizontalelbow"):"isometricEdgeStyle"==T.currentEdgeStyle.edgeStyle?l.className="geSprite geSprite-"+("vertical"==T.currentEdgeStyle.elbow?"verticalisometric":"horizontalisometric"):l.className="geSprite geSprite-orthogonal"),null!=this.toolbar.edgeShapeMenu&&(l=this.toolbar.edgeShapeMenu.getElementsByTagName("div")[0],"link"==T.currentEdgeStyle.shape?l.className="geSprite geSprite-linkedge":"flexArrow"==T.currentEdgeStyle.shape?l.className="geSprite geSprite-arrow":"arrow"==T.currentEdgeStyle.shape?l.className="geSprite geSprite-simplearrow":l.className="geSprite geSprite-connection"),null!=this.toolbar.lineStartMenu&&(this.toolbar.lineStartMenu.getElementsByTagName("div")[0].className=this.getCssClassForMarker("start",T.currentEdgeStyle.shape,T.currentEdgeStyle[mxConstants.STYLE_STARTARROW],mxUtils.getValue(T.currentEdgeStyle,"startFill","1"))),null!=this.toolbar.lineEndMenu&&(this.toolbar.lineEndMenu.getElementsByTagName("div")[0].className=this.getCssClassForMarker("end",T.currentEdgeStyle.shape,T.currentEdgeStyle[mxConstants.STYLE_ENDARROW],mxUtils.getValue(T.currentEdgeStyle,"endFill","1"))))})),null!=this.toolbar&&(t=mxUtils.bind(this,function(){var t=T.currentVertexStyle.fontFamily||"Helvetica",e=String(T.currentVertexStyle.fontSize||"12"),i=T.getView().getState(T.getSelectionCell());null!=i&&(t=i.style[mxConstants.STYLE_FONTFAMILY]||t,e=i.style[mxConstants.STYLE_FONTSIZE]||e,10<t.length&&(t=t.substring(0,8)+"...")),this.toolbar.setFontName(t),this.toolbar.setFontSize(e)}),T.getSelectionModel().addListener(mxEvent.CHANGE,t),T.getModel().addListener(mxEvent.CHANGE,t)),T.addListener(mxEvent.CELLS_ADDED,function(t,e){var i=e.getProperty("cells"),e=e.getProperty("parent");null!=e&&T.getModel().isLayer(e)&&!T.isCellVisible(e)&&null!=i&&0<i.length&&T.getModel().setVisible(e,!0)}),this.gestureHandler=mxUtils.bind(this,function(t){null!=this.currentMenu&&mxEvent.getSource(t)!=this.currentMenu.div&&this.hideCurrentMenu()}),mxEvent.addGestureListeners(document,this.gestureHandler),this.resizeHandler=mxUtils.bind(this,function(){window.setTimeout(mxUtils.bind(this,function(){null!=this.editor.graph&&this.refresh()}),0)}),mxEvent.addListener(window,"resize",this.resizeHandler),this.orientationChangeHandler=mxUtils.bind(this,function(){this.refresh()}),mxEvent.addListener(window,"orientationchange",this.orientationChangeHandler),mxClient.IS_IOS&&!window.navigator.standalone&&(this.scrollHandler=mxUtils.bind(this,function(){window.scrollTo(0,0)}),mxEvent.addListener(window,"scroll",this.scrollHandler)),this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.resetScrollbars()})),this.addListener("gridEnabledChanged",mxUtils.bind(this,function(){T.view.validateBackground()})),this.addListener("backgroundColorChanged",mxUtils.bind(this,function(){T.view.validateBackground()})),T.addListener("gridSizeChanged",mxUtils.bind(this,function(){T.isGridEnabled()&&T.view.validateBackground()})),this.editor.resetGraph()}this.init(),T.standalone||this.open()},mxUtils.extend(EditorUi,mxEventSource),EditorUi.compactUi=!0,EditorUi.prototype.splitSize=mxClient.IS_TOUCH||mxClient.IS_POINTER?12:8,EditorUi.prototype.menubarHeight=30,EditorUi.prototype.formatEnabled=!0,EditorUi.prototype.formatWidth=240,EditorUi.prototype.toolbarHeight=38,EditorUi.prototype.footerHeight=28,EditorUi.prototype.sidebarFooterHeight=34,EditorUi.prototype.hsplitPosition=screen.width<=640?118:"large"!=urlParams["sidebar-entries"]?212:240,EditorUi.prototype.allowAnimation=!0,EditorUi.prototype.lightboxMaxFitScale=2,EditorUi.prototype.lightboxVerticalDivider=4,EditorUi.prototype.hsplitClickEnabled=!1,EditorUi.prototype.init=function(){var t,e,i=this.editor.graph;i.standalone||("0"!=urlParams["shape-picker"]&&this.installShapePicker(),mxEvent.addListener(i.container,"scroll",mxUtils.bind(this,function(){i.tooltipHandler.hide(),null!=i.connectionHandler&&null!=i.connectionHandler.constraintHandler&&i.connectionHandler.constraintHandler.reset()})),i.addListener(mxEvent.ESCAPE,mxUtils.bind(this,function(){i.tooltipHandler.hide();var t=i.getRubberband();null!=t&&t.cancel()})),mxEvent.addListener(i.container,"keydown",mxUtils.bind(this,function(t){this.onKeyDown(t)})),mxEvent.addListener(i.container,"keypress",mxUtils.bind(this,function(t){this.onKeyPress(t)})),this.addUndoListener(),this.addBeforeUnloadListener(),i.getSelectionModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()})),i.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()})),t=i.setDefaultParent,(e=this).editor.graph.setDefaultParent=function(){t.apply(this,arguments),e.updateActionStates()},i.editLink=e.actions.get("editLink").funct,this.updateActionStates(),this.initClipboard(),this.initCanvas(),null!=this.format&&this.format.init())},EditorUi.prototype.installShapePicker=function(){var a=this.editor.graph,d=this;a.addListener(mxEvent.FIRE_MOUSE_EVENT,mxUtils.bind(this,function(t,e){"mouseDown"==e.getProperty("eventName")&&d.hideShapePicker()}));var t=mxUtils.bind(this,function(){d.hideShapePicker(!0)});a.addListener("wheel",t),a.addListener(mxEvent.ESCAPE,t),a.view.addListener(mxEvent.SCALE,t),a.view.addListener(mxEvent.SCALE_AND_TRANSLATE,t),a.getSelectionModel().addListener(mxEvent.CHANGE,t),a.getModel().addListener(mxEvent.CHANGE,t);var e=a.popupMenuHandler.isMenuShowing;a.popupMenuHandler.isMenuShowing=function(){return e.apply(this,arguments)||null!=d.shapePicker};var i,n,o,r=a.dblClick;a.dblClick=function(t,e){var i;this.isEnabled()&&(null!=e||null==d.sidebar||mxEvent.isShiftDown(t)||a.isCellLocked(a.getDefaultParent())?r.apply(this,arguments):(i=mxUtils.convertPoint(this.container,mxEvent.getClientX(t),mxEvent.getClientY(t)),mxEvent.consume(t),window.setTimeout(mxUtils.bind(this,function(){d.showShapePicker(i.x,i.y)}),30)))},null!=this.hoverIcons&&(this.hoverIcons.addListener("reset",t),i=this.hoverIcons.drag,this.hoverIcons.drag=function(){d.hideShapePicker(),i.apply(this,arguments)},n=this.hoverIcons.execute,this.hoverIcons.execute=function(r,l,s){var e=s.getEvent();this.graph.isCloneEvent(e)||mxEvent.isShiftDown(e)?n.apply(this,arguments):this.graph.connectVertex(r.cell,l,this.graph.defaultEdgeLength,e,null,null,mxUtils.bind(this,function(t,e,i){var n=a.getCompositeParent(r.cell),o=a.getCellGeometry(n);for(s.consume();null!=n&&a.model.isVertex(n)&&null!=o&&o.relative;)cell=n,n=a.model.getParent(cell),o=a.getCellGeometry(n);window.setTimeout(mxUtils.bind(this,function(){d.showShapePicker(s.getGraphX(),s.getGraphY(),n,mxUtils.bind(this,function(t){i(t),null!=d.hoverIcons&&d.hoverIcons.update(a.view.getState(t))}),l)}),30)}),mxUtils.bind(this,function(t){this.graph.selectCellsForConnectVertex(t,e,this)}))},o=null,this.hoverIcons.addListener("focus",mxUtils.bind(this,function(t,s){null!=o&&window.clearTimeout(o),o=window.setTimeout(mxUtils.bind(this,function(){var t=s.getProperty("arrow"),e=s.getProperty("direction"),i=s.getProperty("event"),n=t.getBoundingClientRect(),o=mxUtils.getOffset(a.container),t=a.container.scrollLeft+n.x-o.x,o=a.container.scrollTop+n.y-o.y,r=a.getCompositeParent(null!=this.hoverIcons.currentState?this.hoverIcons.currentState.cell:null),l=d.showShapePicker(t,o,r,mxUtils.bind(this,function(n){null!=n&&a.connectVertex(r,e,a.defaultEdgeLength,i,!0,!0,function(t,e,i){i(n),null!=d.hoverIcons&&d.hoverIcons.update(a.view.getState(n))},function(t){a.selectCellsForConnectVertex(t)},i,this.hoverIcons)}),e,!0);this.centerShapePicker(l,n,t,o,e),mxUtils.setOpacity(l,30),mxEvent.addListener(l,"mouseenter",function(){mxUtils.setOpacity(l,100)}),mxEvent.addListener(l,"mouseleave",function(){d.hideShapePicker()})}),Editor.shapePickerHoverDelay)})),this.hoverIcons.addListener("blur",mxUtils.bind(this,function(t,e){null!=o&&window.clearTimeout(o)})))},EditorUi.prototype.centerShapePicker=function(t,e,i,n,o){o!=mxConstants.DIRECTION_EAST&&o!=mxConstants.DIRECTION_WEST||(t.style.width="40px");var r=t.getBoundingClientRect();o==mxConstants.DIRECTION_NORTH?(i-=r.width/2-10,n-=r.height+6):o==mxConstants.DIRECTION_SOUTH?(i-=r.width/2-10,n+=e.height+6):o==mxConstants.DIRECTION_WEST?(i-=r.width+6,n-=r.height/2-10):o==mxConstants.DIRECTION_EAST&&(i+=e.width+6,n-=r.height/2-10),t.style.left=i+"px",t.style.top=n+"px"},EditorUi.prototype.showShapePicker=function(t,e,i,n,o,r){i=this.createShapePicker(t,e,i,n,o,mxUtils.bind(this,function(){this.hideShapePicker()}),this.getCellsForShapePicker(i,r),r);return null!=i&&(null==this.hoverIcons||r||this.hoverIcons.reset(),(r=this.editor.graph).popupMenuHandler.hideMenu(),r.tooltipHandler.hideTooltip(),this.hideCurrentMenu(),this.hideShapePicker(),this.shapePickerCallback=n,this.shapePicker=i),i},EditorUi.prototype.createShapePicker=function(i,n,t,o,e,r,l,s){var a=null;if(null!=l&&0<l.length){var d=this,h=this.editor.graph,a=document.createElement("div"),c=h.view.getState(t),u=null==t||null!=c&&h.isTransparentState(c)?null:h.copyStyle(t),t=l.length<6?35*l.length:140;a.className="geToolbarContainer geSidebarContainer",a.style.cssText="position:absolute;left:"+i+"px;top:"+n+"px;width:"+t+"px;border-radius:10px;padding:4px;text-align:center;box-shadow:0px 0px 3px 1px #d1d1d1;padding: 6px 0 8px 0;z-index: "+mxPopupMenu.prototype.zIndex+"1;",s||mxUtils.setPrefixedStyle(a.style,"transform","translate(-22px,-22px)"),null!=h.background&&h.background!=mxConstants.NONE&&(a.style.backgroundColor=h.background),h.container.appendChild(a);for(var g=mxUtils.bind(this,function(e){var t=document.createElement("a");t.className="geItem",t.style.cssText="position:relative;display:inline-block;position:relative;width:30px;height:30px;cursor:pointer;overflow:hidden;padding:3px 0 0 3px;",a.appendChild(t),null!=u&&"1"!=urlParams.sketch?this.sidebar.graph.pasteStyle(u,[e]):d.insertHandler([e],""!=e.value&&"1"!=urlParams.sketch,this.sidebar.graph.model),this.sidebar.createThumb([e],25,25,t,null,!0,!1,e.geometry.width,e.geometry.height),mxEvent.addListener(t,"click",function(){var t=h.cloneCell(e);if(null!=o)o(t);else{t.geometry.x=h.snap(Math.round(i/h.view.scale)-h.view.translate.x-e.geometry.width/2),t.geometry.y=h.snap(Math.round(n/h.view.scale)-h.view.translate.y-e.geometry.height/2),h.model.beginUpdate();try{h.addCell(t)}finally{h.model.endUpdate()}h.setSelectionCell(t),h.scrollCellToVisible(t),h.startEditingAtCell(t),null!=d.hoverIcons&&d.hoverIcons.update(h.view.getState(t))}null!=r&&r()})}),p=0;p<(s?Math.min(l.length,4):l.length);p++)g(l[p]);t=h.container.scrollTop+h.container.offsetHeight,t=a.offsetTop+a.clientHeight-t;0<t&&(a.style.top=Math.max(h.container.scrollTop+22,n-t)+"px");t=h.container.scrollLeft+h.container.offsetWidth,t=a.offsetLeft+a.clientWidth-t;0<t&&(a.style.left=Math.max(h.container.scrollLeft+22,i-t)+"px")}return a},EditorUi.prototype.getCellsForShapePicker=function(t,e){var i=mxUtils.bind(this,function(t,e,i,n){return this.editor.graph.createVertex(null,null,n||"",0,0,e||120,i||60,t,!1)});return[null!=t?this.editor.graph.cloneCell(t):i("text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;",40,20,"Text"),i("whiteSpace=wrap;html=1;"),i("ellipse;whiteSpace=wrap;html=1;"),i("rhombus;whiteSpace=wrap;html=1;",80,80),i("rounded=1;whiteSpace=wrap;html=1;"),i("shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;"),i("shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;",120,60),i("shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;",120,80),i("shape=step;perimeter=stepPerimeter;whiteSpace=wrap;html=1;fixedSize=1;",120,80),i("shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;"),i("triangle;whiteSpace=wrap;html=1;",60,80),i("shape=document;whiteSpace=wrap;html=1;boundedLbl=1;",120,80),i("shape=tape;whiteSpace=wrap;html=1;",120,100),i("ellipse;shape=cloud;whiteSpace=wrap;html=1;",120,80),i("shape=singleArrow;whiteSpace=wrap;html=1;arrowWidth=0.4;arrowSize=0.4;",80,60),i("shape=waypoint;sketch=0;size=6;pointerEvents=1;points=[];fillColor=none;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;",40,40)]},EditorUi.prototype.hideShapePicker=function(t){null!=this.shapePicker&&(this.shapePicker.parentNode.removeChild(this.shapePicker),this.shapePicker=null,t||null==this.shapePickerCallback||this.shapePickerCallback(),this.shapePickerCallback=null)},EditorUi.prototype.onKeyDown=function(t){var e=this.editor.graph;if(9==t.which&&e.isEnabled()&&!mxEvent.isControlDown(t)){if(e.isEditing())if(mxEvent.isAltDown(t))e.stopEditing(!1);else try{e.cellEditor.isContentEditing()&&e.cellEditor.isTextSelected()?document.execCommand(mxEvent.isShiftDown(t)?"outdent":"indent",!1,null):mxEvent.isShiftDown(t)?e.stopEditing(!1):e.cellEditor.insertTab(e.cellEditor.isContentEditing()?null:4)}catch(t){}else mxEvent.isAltDown(t)?e.selectParentCell():e.selectCell(!mxEvent.isShiftDown(t));mxEvent.consume(t)}},EditorUi.prototype.onKeyPress=function(t){var e=this.editor.graph;!this.isImmediateEditingEvent(t)||e.isEditing()||e.isSelectionEmpty()||0===t.which||27===t.which||mxEvent.isAltDown(t)||mxEvent.isControlDown(t)||mxEvent.isMetaDown(t)||(e.escape(),e.startEditing(),!mxClient.IS_FF||null!=(e=e.cellEditor).textarea&&(e.textarea.innerHTML=String.fromCharCode(t.which),(t=document.createRange()).selectNodeContents(e.textarea),t.collapse(!1),(e=window.getSelection()).removeAllRanges(),e.addRange(t)))},EditorUi.prototype.isImmediateEditingEvent=function(t){return!0},EditorUi.prototype.getCssClassForMarker=function(t,e,i,n){return"flexArrow"==e?null!=i&&i!=mxConstants.NONE?"geSprite geSprite-"+t+"blocktrans":"geSprite geSprite-noarrow":"box"==i||"halfCircle"==i?"geSprite geSvgSprite geSprite-"+i+("end"==t?" geFlipSprite":""):i==mxConstants.ARROW_CLASSIC?"1"==n?"geSprite geSprite-"+t+"classic":"geSprite geSprite-"+t+"classictrans":i==mxConstants.ARROW_CLASSIC_THIN?"1"==n?"geSprite geSprite-"+t+"classicthin":"geSprite geSprite-"+t+"classicthintrans":i==mxConstants.ARROW_OPEN?"geSprite geSprite-"+t+"open":i==mxConstants.ARROW_OPEN_THIN?"geSprite geSprite-"+t+"openthin":i==mxConstants.ARROW_BLOCK?"1"==n?"geSprite geSprite-"+t+"block":"geSprite geSprite-"+t+"blocktrans":i==mxConstants.ARROW_BLOCK_THIN?"1"==n?"geSprite geSprite-"+t+"blockthin":"geSprite geSprite-"+t+"blockthintrans":i==mxConstants.ARROW_OVAL?"1"==n?"geSprite geSprite-"+t+"oval":"geSprite geSprite-"+t+"ovaltrans":i==mxConstants.ARROW_DIAMOND?"1"==n?"geSprite geSprite-"+t+"diamond":"geSprite geSprite-"+t+"diamondtrans":i==mxConstants.ARROW_DIAMOND_THIN?"1"==n?"geSprite geSprite-"+t+"thindiamond":"geSprite geSprite-"+t+"thindiamondtrans":"openAsync"==i?"geSprite geSprite-"+t+"openasync":"dash"==i?"geSprite geSprite-"+t+"dash":"cross"==i?"geSprite geSprite-"+t+"cross":"async"==i?"1"==n?"geSprite geSprite-"+t+"async":"geSprite geSprite-"+t+"asynctrans":"circle"==i||"circlePlus"==i?"1"==n||"circle"==i?"geSprite geSprite-"+t+"circle":"geSprite geSprite-"+t+"circleplus":"ERone"==i?"geSprite geSprite-"+t+"erone":"ERmandOne"==i?"geSprite geSprite-"+t+"eronetoone":"ERmany"==i?"geSprite geSprite-"+t+"ermany":"ERoneToMany"==i?"geSprite geSprite-"+t+"eronetomany":"ERzeroToOne"==i?"geSprite geSprite-"+t+"eroneopt":"ERzeroToMany"==i?"geSprite geSprite-"+t+"ermanyopt":"geSprite geSprite-noarrow"},EditorUi.prototype.createMenus=function(){return null},EditorUi.prototype.updatePasteActionStates=function(){var t=this.editor.graph,e=this.actions.get("paste"),i=this.actions.get("pasteHere");e.setEnabled(this.editor.graph.cellEditor.isContentEditing()||(!mxClient.IS_FF&&null!=navigator.clipboard||!mxClipboard.isEmpty())&&t.isEnabled()&&!t.isCellLocked(t.getDefaultParent())),i.setEnabled(e.isEnabled())},EditorUi.prototype.initClipboard=function(){var h=this,e=mxClipboard.cut;mxClipboard.cut=function(t){t.cellEditor.isContentEditing()?document.execCommand("cut",!1,null):e.apply(this,arguments),h.updatePasteActionStates()};mxClipboard.copy;mxClipboard.copy=function(t){var e=null;if(t.cellEditor.isContentEditing())document.execCommand("copy",!1,null);else{e=e||t.getSelectionCells();for(var e=t.getExportableCells(t.model.getTopmostCells(e)),i=new Object,n=t.createCellLookup(e),o=t.cloneCells(e,null,i),r=new mxGraphModel,l=r.getChildAt(r.getRoot(),0),s=0;s<o.length;s++){r.add(l,o[s]);var a,d=t.view.getState(e[s]);null==d||null!=(a=t.getCellGeometry(o[s]))&&a.relative&&!r.isEdge(e[s])&&null==n[mxObjectIdentity.get(r.getParent(e[s]))]&&(a.offset=null,a.relative=!1,a.x=d.x/d.view.scale-d.view.translate.x,a.y=d.y/d.view.scale-d.view.translate.y)}t.updateCustomLinks(t.createCellMapping(i,n),o),mxClipboard.insertCount=1,mxClipboard.setCells(o)}return h.updatePasteActionStates(),e};var i=mxClipboard.paste;mxClipboard.paste=function(t){var e=null;return t.cellEditor.isContentEditing()?document.execCommand("paste",!1,null):e=i.apply(this,arguments),h.updatePasteActionStates(),e};var t=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){t.apply(this,arguments),h.updatePasteActionStates()};var n=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(t,e){n.apply(this,arguments),h.updatePasteActionStates()},this.updatePasteActionStates()},EditorUi.prototype.lazyZoomDelay=20,EditorUi.prototype.wheelZoomDelay=400,EditorUi.prototype.buttonZoomDelay=600,EditorUi.prototype.initCanvas=function(){var g=this.editor.graph;g.timerAutoScroll=!0,g.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round((g.container.offsetWidth-34)/g.view.scale)),Math.max(0,Math.round((g.container.offsetHeight-34)/g.view.scale)))},g.view.getBackgroundPageBounds=function(){var t=this.graph.getPageLayout(),e=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+t.x*e.width),this.scale*(this.translate.y+t.y*e.height),this.scale*t.width*e.width,this.scale*t.height*e.height)},g.getPreferredPageSize=function(t,e,i){var n=this.getPageLayout(),o=this.getPageSize();return new mxRectangle(0,0,n.width*o.width,n.height*o.height)};var i,l,r=null,s=this;if(this.editor.isChromelessView()){r=mxUtils.bind(this,function(t,e,i,n){var o,r,l,s,a,d,h,c,u;null==g.container||g.isViewer()||(i=null!=i?i:0,n=null!=n?n:0,o=g.pageVisible?g.view.getBackgroundPageBounds():g.getGraphBounds(),r=mxUtils.hasScrollbars(g.container),c=g.view.translate,l=g.view.scale,(s=mxRectangle.fromRectangle(o)).x=s.x/l-c.x,s.y=s.y/l-c.y,s.width/=l,s.height/=l,a=g.container.scrollTop,d=g.container.scrollLeft,u=8<=document.documentMode?20:14,8!=document.documentMode&&9!=document.documentMode||(u+=3),h=g.container.offsetWidth-u,c=g.container.offsetHeight-u,t=(h-(u=t?Math.max(.3,Math.min(e||1,h/s.width)):l)*s.width)/2/u,e=0==this.lightboxVerticalDivider?0:(c-u*s.height)/this.lightboxVerticalDivider/u,r&&(t=Math.max(t,0),e=Math.max(e,0)),r||o.width<h||o.height<c?(g.view.scaleAndTranslate(u,Math.floor(t-s.x),Math.floor(e-s.y)),g.container.scrollTop=a*u/l,g.container.scrollLeft=d*u/l):0==i&&0==n||(u=g.view.translate,g.view.setTranslate(Math.floor(u.x+i/l),Math.floor(u.y+n/l))))}),this.chromelessResize=r,this.chromelessWindowResize=mxUtils.bind(this,function(){this.chromelessResize(!1)});var t=mxUtils.bind(this,function(){this.chromelessWindowResize(!1)});if(mxEvent.addListener(window,"resize",t),this.destroyFunctions.push(function(){mxEvent.removeListener(window,"resize",t)}),this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.chromelessResize(!0)})),this.actions.get("zoomIn").funct=mxUtils.bind(this,function(t){g.zoomIn(),this.chromelessResize(!1)}),this.actions.get("zoomOut").funct=mxUtils.bind(this,function(t){g.zoomOut(),this.chromelessResize(!1)}),"0"!=urlParams.toolbar){var e=JSON.parse(decodeURIComponent(urlParams["toolbar-config"]||"{}"));this.chromelessToolbar=document.createElement("div"),this.chromelessToolbar.style.position="fixed",this.chromelessToolbar.style.overflow="hidden",this.chromelessToolbar.style.boxSizing="border-box",this.chromelessToolbar.style.whiteSpace="nowrap",this.chromelessToolbar.style.padding="10px 10px 8px 10px",this.chromelessToolbar.style.left=g.isViewer()?"0":"50%",mxClient.IS_IE||mxClient.IS_IE11?(this.chromelessToolbar.style.backgroundColor="#ffffff",this.chromelessToolbar.style.border="3px solid black"):this.chromelessToolbar.style.backgroundColor="#000000",mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"borderRadius","16px"),mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transition","opacity 600ms ease-in-out");var n=mxUtils.bind(this,function(){var t=mxUtils.getCurrentStyle(g.container);g.isViewer()?this.chromelessToolbar.style.top="0":this.chromelessToolbar.style.bottom=(null!=t?parseInt(t["margin-bottom"]||0):0)+(null!=this.tabContainer?20+parseInt(this.tabContainer.style.height):20)+"px"});this.editor.addListener("resetGraphView",n),n();var o,a,d,h,c=mxUtils.bind(this,function(t,e,i){0;var n=document.createElement("span");n.style.paddingLeft="8px",n.style.paddingRight="8px",n.style.cursor="pointer",mxEvent.addListener(n,"click",t),null!=i&&n.setAttribute("title",i);i=document.createElement("img");return i.setAttribute("border","0"),i.setAttribute("src",e),i.style.width="36px",i.style.filter="invert(100%)",n.appendChild(i),this.chromelessToolbar.appendChild(n),n});null!=e.backBtn&&c(mxUtils.bind(this,function(t){window.location.href=e.backBtn.url,mxEvent.consume(t)}),Editor.backImage,mxResources.get("back",null,"Back")),this.isPagesEnabled()&&(o=c(mxUtils.bind(this,function(t){this.actions.get("previousPage").funct(),mxEvent.consume(t)}),Editor.previousImage,mxResources.get("previousPage")),(a=document.createElement("div")).style.fontFamily=Editor.defaultHtmlFont,a.style.display="inline-block",a.style.verticalAlign="top",a.style.fontWeight="bold",a.style.marginTop="8px",a.style.fontSize="14px",mxClient.IS_IE||mxClient.IS_IE11?a.style.color="#000000":a.style.color="#ffffff",this.chromelessToolbar.appendChild(a),d=c(mxUtils.bind(this,function(t){this.actions.get("nextPage").funct(),mxEvent.consume(t)}),Editor.nextImage,mxResources.get("nextPage")),h=mxUtils.bind(this,function(){null!=this.pages&&1<this.pages.length&&null!=this.currentPage&&(a.innerHTML="",mxUtils.write(a,mxUtils.indexOf(this.pages,this.currentPage)+1+" / "+this.pages.length))}),o.style.paddingLeft="0px",o.style.paddingRight="4px",d.style.paddingLeft="4px",d.style.paddingRight="0px",n=mxUtils.bind(this,function(){null!=this.pages&&1<this.pages.length&&null!=this.currentPage?(d.style.display="",o.style.display="",a.style.display="inline-block"):(d.style.display="none",o.style.display="none",a.style.display="none"),h()}),this.editor.addListener("resetGraphView",n),this.editor.addListener("pageSelected",h)),c(mxUtils.bind(this,function(t){this.actions.get("zoomOut").funct(),mxEvent.consume(t)}),Editor.zoomOutImage,mxResources.get("zoomOut")+" (Alt+Mousewheel)"),c(mxUtils.bind(this,function(t){this.actions.get("zoomIn").funct(),mxEvent.consume(t)}),Editor.zoomInImage,mxResources.get("zoomIn")+" (Alt+Mousewheel)"),c(mxUtils.bind(this,function(t){g.isLightboxView()?(1==g.view.scale?this.lightboxFit():g.zoomTo(1),this.chromelessResize(!1)):this.chromelessResize(!0),mxEvent.consume(t)}),Editor.zoomFitImage,mxResources.get("fit"));var u,p,m=null,f=null,x=mxUtils.bind(this,function(t){null!=m&&(window.clearTimeout(m),m=null),null!=f&&(window.clearTimeout(f),f=null),m=window.setTimeout(mxUtils.bind(this,function(){mxUtils.setOpacity(this.chromelessToolbar,0),m=null,f=window.setTimeout(mxUtils.bind(this,function(){this.chromelessToolbar.style.display="none",f=null}),600)}),t||200)}),y=mxUtils.bind(this,function(t){null!=m&&(window.clearTimeout(m),m=null),null!=f&&(window.clearTimeout(f),f=null),this.chromelessToolbar.style.display="",mxUtils.setOpacity(this.chromelessToolbar,t||30)});if("1"==urlParams.layers&&(this.layersDialog=null,u=c(mxUtils.bind(this,function(t){var e;null!=this.layersDialog?(this.layersDialog.parentNode.removeChild(this.layersDialog),this.layersDialog=null):(this.layersDialog=g.createLayersDialog(null,!0),mxEvent.addListener(this.layersDialog,"mouseleave",mxUtils.bind(this,function(){this.layersDialog.parentNode.removeChild(this.layersDialog),this.layersDialog=null})),e=u.getBoundingClientRect(),mxUtils.setPrefixedStyle(this.layersDialog.style,"borderRadius","5px"),this.layersDialog.style.position="fixed",this.layersDialog.style.fontFamily=Editor.defaultHtmlFont,this.layersDialog.style.width="160px",this.layersDialog.style.padding="4px 2px 4px 2px",this.layersDialog.style.left=e.left+"px",this.layersDialog.style.bottom=parseInt(this.chromelessToolbar.style.bottom)+this.chromelessToolbar.offsetHeight+4+"px",mxClient.IS_IE||mxClient.IS_IE11?(this.layersDialog.style.backgroundColor="#ffffff",this.layersDialog.style.border="2px solid black",this.layersDialog.style.color="#000000"):(this.layersDialog.style.backgroundColor="#000000",this.layersDialog.style.color="#ffffff",mxUtils.setOpacity(this.layersDialog,80)),e=mxUtils.getCurrentStyle(this.editor.graph.container),this.layersDialog.style.zIndex=e.zIndex,document.body.appendChild(this.layersDialog),this.editor.fireEvent(new mxEventObject("layersDialogShown"))),mxEvent.consume(t)}),Editor.layersImage,mxResources.get("layers")),(p=g.getModel()).addListener(mxEvent.CHANGE,function(){u.style.display=1<p.getChildCount(p.root)?"":"none"})),"1"==urlParams.openInSameWin&&!navigator.standalone||this.addChromelessToolbarItems(c),null==this.editor.editButtonLink&&null==this.editor.editButtonFunc||c(mxUtils.bind(this,function(t){null!=this.editor.editButtonFunc?this.editor.editButtonFunc():"_blank"==this.editor.editButtonLink?this.editor.editAsNew(this.getEditBlankXml()):g.openLink(this.editor.editButtonLink,"editWindow"),mxEvent.consume(t)}),Editor.editImage,mxResources.get("edit")),null!=this.lightboxToolbarActions)for(var v=0;v<this.lightboxToolbarActions.length;v++){var E=this.lightboxToolbarActions[v];E.elem=c(E.fn,E.icon,E.tooltip)}null!=e.refreshBtn&&c(mxUtils.bind(this,function(t){e.refreshBtn.url?window.location.href=e.refreshBtn.url:window.location.reload(),mxEvent.consume(t)}),Editor.refreshImage,mxResources.get("refresh",null,"Refresh")),null!=e.fullscreenBtn&&window.self!==window.top&&c(mxUtils.bind(this,function(t){e.fullscreenBtn.url?g.openLink(e.fullscreenBtn.url):g.openLink(window.location.href),mxEvent.consume(t)}),Editor.fullscreenImage,mxResources.get("openInNewWindow",null,"Open in New Window")),(e.closeBtn&&window.self===window.top||g.lightbox&&("1"==urlParams.close||this.container!=document.body))&&c(mxUtils.bind(this,function(t){"1"==urlParams.close||e.closeBtn?window.close():(this.destroy(),mxEvent.consume(t))}),Editor.closeImage,mxResources.get("close")+" (Escape)"),this.chromelessToolbar.style.display="none",g.isViewer()||mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transform","translate(-50%,0)"),g.container.appendChild(this.chromelessToolbar),mxEvent.addListener(g.container,mxClient.IS_POINTER?"pointermove":"mousemove",mxUtils.bind(this,function(t){mxEvent.isTouchEvent(t)||(mxEvent.isShiftDown(t)||y(30),x())})),mxEvent.addListener(this.chromelessToolbar,mxClient.IS_POINTER?"pointermove":"mousemove",function(t){mxEvent.consume(t)}),mxEvent.addListener(this.chromelessToolbar,"mouseenter",mxUtils.bind(this,function(t){g.tooltipHandler.resetTimer(),g.tooltipHandler.hideTooltip(),mxEvent.isShiftDown(t)?x():y(100)})),mxEvent.addListener(this.chromelessToolbar,"mousemove",mxUtils.bind(this,function(t){mxEvent.isShiftDown(t)?x():y(100),mxEvent.consume(t)})),mxEvent.addListener(this.chromelessToolbar,"mouseleave",mxUtils.bind(this,function(t){mxEvent.isTouchEvent(t)||y(30)}));var b=g.getTolerance();g.addMouseListener({startX:0,startY:0,scrollLeft:0,scrollTop:0,mouseDown:function(t,e){this.startX=e.getGraphX(),this.startY=e.getGraphY(),this.scrollLeft=g.container.scrollLeft,this.scrollTop=g.container.scrollTop},mouseMove:function(t,e){},mouseUp:function(t,e){mxEvent.isTouchEvent(e.getEvent())&&Math.abs(this.scrollLeft-g.container.scrollLeft)<b&&Math.abs(this.scrollTop-g.container.scrollTop)<b&&Math.abs(this.startX-e.getGraphX())<b&&Math.abs(this.startY-e.getGraphY())<b&&(0<parseFloat(s.chromelessToolbar.style.opacity||0)?x():y(30))}})}this.editor.editable||this.addChromelessClickHandler()}else this.editor.extendCanvas&&(i=g.view.validate,g.view.validate=function(){var t,e;null!=this.graph.container&&mxUtils.hasScrollbars(this.graph.container)&&(t=this.graph.getPagePadding(),e=this.graph.getPageSize(),this.translate.x,this.translate.y,this.translate.x=t.x-(this.x0||0)*e.width,this.translate.y=t.y-(this.y0||0)*e.height),i.apply(this,arguments)},g.isViewer()||(l=g.sizeDidChange,g.sizeDidChange=function(){if(null!=this.container&&mxUtils.hasScrollbars(this.container)){var t=this.getPageLayout(),e=this.getPagePadding(),i=this.getPageSize(),n=Math.ceil(2*e.x+t.width*i.width),o=Math.ceil(2*e.y+t.height*i.height),r=g.minimumGraphSize;null!=r&&r.width==n&&r.height==o||(g.minimumGraphSize=new mxRectangle(0,0,n,o));o=e.x-t.x*i.width,e=e.y-t.y*i.height;if(!this.autoTranslate&&(this.view.translate.x!=o||this.view.translate.y!=e)){this.autoTranslate=!0,this.view.x0=t.x,this.view.y0=t.y;i=g.view.translate.x,t=g.view.translate.y;return g.view.setTranslate(o,e),g.container.scrollLeft+=Math.round((o-i)*g.view.scale),g.container.scrollTop+=Math.round((e-t)*g.view.scale),void(this.autoTranslate=!1)}l.apply(this,arguments)}else this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",this.getGraphBounds()))}));var C=g.view.getBackgroundPane(),S=g.view.getDrawPane();g.cumulativeZoomFactor=1;function w(t){null!=U&&window.clearTimeout(U),window.setTimeout(function(){g.isMouseDown&&!P||(U=window.setTimeout(mxUtils.bind(this,function(){g.isFastZoomEnabled()&&(null!=g.view.backgroundPageShape&&null!=g.view.backgroundPageShape.node&&(mxUtils.setPrefixedStyle(g.view.backgroundPageShape.node.style,"transform-origin",null),mxUtils.setPrefixedStyle(g.view.backgroundPageShape.node.style,"transform",null)),S.style.transformOrigin="",C.style.transformOrigin="",mxClient.IS_SF?(S.style.transform="scale(1)",C.style.transform="scale(1)",window.setTimeout(function(){S.style.transform="",C.style.transform=""},0)):(S.style.transform="",C.style.transform=""),g.view.getDecoratorPane().style.opacity="",g.view.getOverlayPane().style.opacity="");var t=new mxPoint(g.container.scrollLeft,g.container.scrollTop),e=mxUtils.getOffset(g.container),i=g.view.scale,n=0,o=0;null!=T&&(n=g.container.offsetWidth/2-T.x+e.x,o=g.container.offsetHeight/2-T.y+e.y),g.zoom(g.cumulativeZoomFactor),g.view.scale!=i&&(null!=M&&(n+=t.x-M.x,o+=t.y-M.y),null!=r&&s.chromelessResize(!1,null,n*(g.cumulativeZoomFactor-1),o*(g.cumulativeZoomFactor-1)),!mxUtils.hasScrollbars(g.container)||0==n&&0==o||(g.container.scrollLeft-=n*(g.cumulativeZoomFactor-1),g.container.scrollTop-=o*(g.cumulativeZoomFactor-1))),null!=k&&S.setAttribute("filter",k),g.cumulativeZoomFactor=1,k=P=T=M=U=null}),null!=t?t:g.isFastZoomEnabled()?s.wheelZoomDelay:s.lazyZoomDelay))},0)}var U=null,T=null,M=null,P=null,k=null,A=Date.now();g.lazyZoom=function(t,e,i){var n;(e=e||!g.scrollbars)&&(T=new mxPoint(g.container.offsetLeft+g.container.clientWidth/2,g.container.offsetTop+g.container.clientHeight/2)),!mxClient.IS_IOS&&Date.now()-A<15||(A=Date.now(),t?this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor*=(this.view.scale+.05)/this.view.scale:(this.cumulativeZoomFactor*=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale):this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor*=(this.view.scale-.05)/this.view.scale:(this.cumulativeZoomFactor/=this.zoomFactor,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale),this.cumulativeZoomFactor=Math.max(.05,Math.min(this.view.scale*this.cumulativeZoomFactor,160))/this.view.scale,g.isFastZoomEnabled()&&(null==k&&""!=S.getAttribute("filter")&&(k=S.getAttribute("filter"),S.removeAttribute("filter")),M=new mxPoint(g.container.scrollLeft,g.container.scrollTop),n=e?g.container.scrollLeft+g.container.clientWidth/2:T.x+g.container.scrollLeft-g.container.offsetLeft,t=e?g.container.scrollTop+g.container.clientHeight/2:T.y+g.container.scrollTop-g.container.offsetTop,S.style.transformOrigin=n+"px "+t+"px",S.style.transform="scale("+this.cumulativeZoomFactor+")",C.style.transformOrigin=n+"px "+t+"px",C.style.transform="scale("+this.cumulativeZoomFactor+")",null!=g.view.backgroundPageShape&&null!=g.view.backgroundPageShape.node&&(t=g.view.backgroundPageShape.node,mxUtils.setPrefixedStyle(t.style,"transform-origin",(e?g.container.clientWidth/2+g.container.scrollLeft-t.offsetLeft+"px":T.x+g.container.scrollLeft-t.offsetLeft-g.container.offsetLeft+"px")+" "+(e?g.container.clientHeight/2+g.container.scrollTop-t.offsetTop+"px":T.y+g.container.scrollTop-t.offsetTop-g.container.offsetTop+"px")),mxUtils.setPrefixedStyle(t.style,"transform","scale("+this.cumulativeZoomFactor+")")),g.view.getDecoratorPane().style.opacity="0",g.view.getOverlayPane().style.opacity="0",null!=s.hoverIcons&&s.hoverIcons.reset()),w(i))},mxEvent.addGestureListeners(g.container,function(t){null!=U&&window.clearTimeout(U)},null,function(t){1!=g.cumulativeZoomFactor&&w(0)}),mxEvent.addListener(g.container,"scroll",function(t){null==U||g.isMouseDown||1==g.cumulativeZoomFactor||w(0)}),mxEvent.addMouseWheelListener(mxUtils.bind(this,function(t,e,i,n,o){if(g.fireEvent(new mxEventObject("wheel")),null==this.dialogs||0==this.dialogs.length)if(g.scrollbars||i||!g.isScrollWheelEvent(t)){if(i||g.isZoomWheelEvent(t))for(var r=mxEvent.getSource(t);null!=r;){if(r==g.container)return g.tooltipHandler.hideTooltip(),T=null!=n&&null!=o?new mxPoint(n,o):new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t)),P=i,g.lazyZoom(e),mxEvent.consume(t),!1;r=r.parentNode}}else{var l=g.view.getTranslate(),s=40/g.view.scale;mxEvent.isShiftDown(t)?g.view.setTranslate(l.x+(e?-s:s),l.y):g.view.setTranslate(l.x,l.y+(e?s:-s))}}),g.container),g.panningHandler.zoomGraph=function(t){g.cumulativeZoomFactor=t.scale,g.lazyZoom(0<t.scale,!0),mxEvent.consume(t)}},EditorUi.prototype.addChromelessToolbarItems=function(t){t(mxUtils.bind(this,function(t){this.actions.get("print").funct(),mxEvent.consume(t)}),Editor.printImage,mxResources.get("print"))},EditorUi.prototype.isPagesEnabled=function(){return this.editor.editable||"1"!=urlParams["hide-pages"]},EditorUi.prototype.createTemporaryGraph=function(t){return Graph.createOffscreenGraph(t)},EditorUi.prototype.addChromelessClickHandler=function(){var t=urlParams.highlight;null!=t&&0<t.length&&(t="#"+t),this.editor.graph.addClickHandler(t)},EditorUi.prototype.toggleFormatPanel=function(t){t=null!=t?t:0==this.formatWidth,null!=this.format&&(this.formatWidth=t?240:0,this.formatContainer.style.display=t?"":"none",this.refresh(),this.format.refresh(),this.fireEvent(new mxEventObject("formatWidthChanged")))},EditorUi.prototype.lightboxFit=function(t){var e,i;this.isDiagramEmpty()?this.editor.graph.view.setScale(1):(i=60,null!=(e=urlParams.border)&&(i=parseInt(e)),this.editor.graph.maxFitScale=this.lightboxMaxFitScale,this.editor.graph.fit(i,null,null,null,null,null,t),this.editor.graph.maxFitScale=null)},EditorUi.prototype.isDiagramEmpty=function(){var t=this.editor.graph.getModel();return 1==t.getChildCount(t.root)&&0==t.getChildCount(t.getChildAt(t.root,0))},EditorUi.prototype.isSelectionAllowed=function(t){return"SELECT"==mxEvent.getSource(t).nodeName||"INPUT"==mxEvent.getSource(t).nodeName&&mxUtils.isAncestorNode(this.formatContainer,mxEvent.getSource(t))},EditorUi.prototype.addBeforeUnloadListener=function(){window.onbeforeunload=mxUtils.bind(this,function(){if(!this.editor.isChromelessView())return this.onBeforeUnload()})},EditorUi.prototype.onBeforeUnload=function(){if(this.editor.modified)return mxResources.get("allChangesLost")},EditorUi.prototype.open=function(){try{null!=window.opener&&null!=window.opener.openFile&&window.opener.openFile.setConsumer(mxUtils.bind(this,function(t,e){try{var i=mxUtils.parseXml(t);return this.editor.setGraphXml(i.documentElement),this.editor.setModified(!1),this.editor.undoManager.clear(),void(null!=e&&(this.editor.setFilename(e),this.updateDocumentTitle()))}catch(t){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+t.message)}}))}catch(t){}this.editor.graph.view.validate(),this.editor.graph.sizeDidChange(),this.editor.fireEvent(new mxEventObject("resetGraphView"))},EditorUi.prototype.showPopupMenu=function(t,e,i,n){this.editor.graph.popupMenuHandler.hideMenu();var o=new mxPopupMenu(t);o.div.className+=" geMenubarMenu",o.smartSeparators=!0,o.showDisabled=!0,o.autoExpand=!0,o.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(o,arguments),o.destroy()}),o.popup(e,i,null,n),this.setCurrentMenu(o)},EditorUi.prototype.setCurrentMenu=function(t,e){this.currentMenuElt=e,this.currentMenu=t},EditorUi.prototype.resetCurrentMenu=function(){this.currentMenuElt=null,this.currentMenu=null},EditorUi.prototype.hideCurrentMenu=function(){null!=this.currentMenu&&(this.currentMenu.hideMenu(),this.resetCurrentMenu())},EditorUi.prototype.updateDocumentTitle=function(){var t=this.editor.getOrCreateFilename();null!=this.editor.appName&&(t+=" - "+this.editor.appName),document.title=t},EditorUi.prototype.createHoverIcons=function(){return new HoverIcons(this.editor.graph)},EditorUi.prototype.redo=function(){try{this.editor.graph.isEditing()?document.execCommand("redo",!1,null):this.editor.undoManager.redo()}catch(t){}},EditorUi.prototype.undo=function(){try{var t,e=this.editor.graph;e.isEditing()?(t=e.cellEditor.textarea.innerHTML,document.execCommand("undo",!1,null),t==e.cellEditor.textarea.innerHTML&&(e.stopEditing(!0),this.editor.undoManager.undo())):this.editor.undoManager.undo()}catch(t){}},EditorUi.prototype.canRedo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canRedo()},EditorUi.prototype.canUndo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canUndo()},EditorUi.prototype.getEditBlankXml=function(){return mxUtils.getXml(this.editor.getGraphXml())},EditorUi.prototype.getUrl=function(t){var e,i=null!=t?t:window.location.pathname,n=0<i.indexOf("?")?1:0;for(e in urlParams)i+=0==n?"?":"&",i+=e+"="+urlParams[e],n++;return i},EditorUi.prototype.setScrollbars=function(t){var e=this.editor.graph,i=e.container.style.overflow;e.scrollbars=t,this.editor.updateGraphComponents(),i!=e.container.style.overflow&&(e.container.scrollTop=0,e.container.scrollLeft=0,e.view.scaleAndTranslate(1,0,0),this.resetScrollbars()),this.fireEvent(new mxEventObject("scrollbarsChanged"))},EditorUi.prototype.hasScrollbars=function(){return this.editor.graph.scrollbars},EditorUi.prototype.resetScrollbars=function(){var t,e,i,n=this.editor.graph;this.editor.extendCanvas?this.editor.isChromelessView()||(mxUtils.hasScrollbars(n.container)?n.pageVisible?(e=n.getPagePadding(),n.container.scrollTop=Math.floor(e.y-this.editor.initialTopSpacing)-1,n.container.scrollLeft=Math.floor(Math.min(e.x,(n.container.scrollWidth-n.container.clientWidth)/2))-1,0<(e=n.getGraphBounds()).width&&0<e.height&&(e.x>n.container.scrollLeft+.9*n.container.clientWidth&&(n.container.scrollLeft=Math.min(e.x+e.width-n.container.clientWidth,e.x-10)),e.y>n.container.scrollTop+.9*n.container.clientHeight&&(n.container.scrollTop=Math.min(e.y+e.height-n.container.clientHeight,e.y-10)))):(e=n.getGraphBounds(),i=Math.max(e.width,n.scrollTileSize.width*n.view.scale),t=Math.max(e.height,n.scrollTileSize.height*n.view.scale),n.container.scrollTop=Math.floor(Math.max(0,e.y-Math.max(20,(n.container.clientHeight-t)/4))),n.container.scrollLeft=Math.floor(Math.max(0,e.x-Math.max(0,(n.container.clientWidth-i)/2)))):(t=mxRectangle.fromRectangle(n.pageVisible?n.view.getBackgroundPageBounds():n.getGraphBounds()),e=n.view.translate,i=n.view.scale,t.x=t.x/i-e.x,t.y=t.y/i-e.y,t.width/=i,t.height/=i,i=n.pageVisible?0:Math.max(0,(n.container.clientHeight-t.height)/4),n.view.setTranslate(Math.floor(Math.max(0,(n.container.clientWidth-t.width)/2)-t.x+2),Math.floor(i-t.y+1)))):(n.container.scrollTop=0,n.container.scrollLeft=0,mxUtils.hasScrollbars(n.container)||n.view.setTranslate(0,0))},EditorUi.prototype.setPageVisible=function(t){var e,i=this.editor.graph,n=mxUtils.hasScrollbars(i.container),o=0,r=0;n&&(o=i.view.translate.x*i.view.scale-i.container.scrollLeft,r=i.view.translate.y*i.view.scale-i.container.scrollTop),i.pageVisible=t,i.pageBreaksVisible=t,i.preferPageSize=t,i.view.validateBackground(),n&&(e=i.getSelectionCells(),i.clearSelection(),i.setSelectionCells(e)),i.sizeDidChange(),n&&(i.container.scrollLeft=i.view.translate.x*i.view.scale-o,i.container.scrollTop=i.view.translate.y*i.view.scale-r),i.defaultPageVisible=t,this.fireEvent(new mxEventObject("pageViewChanged"))},ChangeGridColor.prototype.execute=function(){var t=this.ui.editor.graph.view.gridColor;this.ui.setGridColor(this.color),this.color=t},function(){var t=new mxObjectCodec(new ChangeGridColor,["ui"]);mxCodecRegistry.register(t)}(),ChangePageSetup.prototype.execute=function(){var t,e,i=this.ui.editor.graph;this.ignoreColor||(this.color=this.previousColor,e=i.background,this.ui.setBackgroundColor(this.previousColor),this.previousColor=e),this.ignoreImage||(this.image=this.previousImage,e=i.backgroundImage,null!=(t=this.previousImage)&&null!=t.src&&"data:page/id,"==t.src.substring(0,13)&&(t=this.ui.createImageForPageLink(t.src,this.ui.currentPage)),this.ui.setBackgroundImage(t),this.previousImage=e),null!=this.previousFormat&&(this.format=this.previousFormat,e=i.pageFormat,this.previousFormat.width==e.width&&this.previousFormat.height==e.height||(this.ui.setPageFormat(this.previousFormat),this.previousFormat=e)),null!=this.foldingEnabled&&this.foldingEnabled!=this.ui.editor.graph.foldingEnabled&&(this.ui.setFoldingEnabled(this.foldingEnabled),this.foldingEnabled=!this.foldingEnabled),null!=this.previousPageScale&&(e=this.ui.editor.graph.pageScale,this.previousPageScale!=e&&(this.ui.setPageScale(this.previousPageScale),this.previousPageScale=e))},function(){var t=new mxObjectCodec(new ChangePageSetup,["ui","previousColor","previousImage","previousFormat","previousPageScale"]);t.afterDecode=function(t,e,i){return i.previousColor=i.color,i.previousImage=i.image,i.previousFormat=i.format,i.previousPageScale=i.pageScale,null!=i.foldingEnabled&&(i.foldingEnabled=!i.foldingEnabled),i},mxCodecRegistry.register(t)}(),EditorUi.prototype.setBackgroundColor=function(t){this.editor.graph.background=t,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("backgroundColorChanged"))},EditorUi.prototype.setFoldingEnabled=function(t){this.editor.graph.foldingEnabled=t,this.editor.graph.view.revalidate(),this.fireEvent(new mxEventObject("foldingEnabledChanged"))},EditorUi.prototype.setPageFormat=function(t,e){e=null!=e?e:"1"==urlParams.sketch,this.editor.graph.pageFormat=t,e||(this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct()),this.fireEvent(new mxEventObject("pageFormatChanged"))},EditorUi.prototype.setPageScale=function(t){this.editor.graph.pageScale=t,this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct(),this.fireEvent(new mxEventObject("pageScaleChanged"))},EditorUi.prototype.setGridColor=function(t){this.editor.graph.view.gridColor=t,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("gridColorChanged"))},EditorUi.prototype.addUndoListener=function(){var t=this.actions.get("undo"),e=this.actions.get("redo"),i=this.editor.undoManager,n=mxUtils.bind(this,function(){t.setEnabled(this.canUndo()),e.setEnabled(this.canRedo())});i.addListener(mxEvent.ADD,n),i.addListener(mxEvent.UNDO,n),i.addListener(mxEvent.REDO,n),i.addListener(mxEvent.CLEAR,n);var o=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){o.apply(this,arguments),n()};var r=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(t,e){r.apply(this,arguments),n()},n()},EditorUi.prototype.updateActionStates=function(){var t=this.editor.graph,e=!1,i=!1,n=!1,o=!1,r=[],l=t.getSelectionCells();if(null!=l)for(var s=0;s<l.length;s++){var a=l[s];t.isCellEditable(a)&&(r.push(a),o=!0,t.getModel().isEdge(a)&&(n=!0),t.getModel().isVertex(a)&&(e=!0,(0<t.getModel().getChildCount(a)||t.isContainer(a))&&(i=!0)))}for(var d=["cut","copy","bold","italic","underline","delete","duplicate","editStyle","editTooltip","editLink","backgroundColor","borderColor","edit","toFront","toBack","solid","dashed","pasteSize","dotted","fillColor","gradientColor","shadow","fontColor","formattedText","rounded","toggleRounded","sharp","strokeColor"],s=0;s<d.length;s++)this.actions.get(d[s]).setEnabled(o);this.actions.get("lockUnlock").setEnabled(!t.isSelectionEmpty()),this.actions.get("setAsDefaultStyle").setEnabled(1==t.getSelectionCount()),this.actions.get("clearWaypoints").setEnabled(o),this.actions.get("copySize").setEnabled(1==t.getSelectionCount()),this.actions.get("bringForward").setEnabled(1==r.length),this.actions.get("sendBackward").setEnabled(1==r.length),this.actions.get("turn").setEnabled(0<t.getResizableCells(t.getSelectionCells()).length),this.actions.get("curved").setEnabled(n),this.actions.get("rotation").setEnabled(e),this.actions.get("wordWrap").setEnabled(e),this.actions.get("autosize").setEnabled(e);var h=e&&1==t.getSelectionCount();this.actions.get("group").setEnabled(1<t.getSelectionCount()||h&&!t.isContainer(t.getSelectionCell())),this.actions.get("ungroup").setEnabled(i),this.actions.get("removeFromGroup").setEnabled(h&&t.getModel().isVertex(t.getModel().getParent(r[0])));t.view.getState(t.getSelectionCell());this.menus.get("navigation").setEnabled(o||null!=t.view.currentRoot),this.actions.get("collapsible").setEnabled(e&&(t.isContainer(t.getSelectionCell())||0<t.model.getChildCount(t.getSelectionCell()))),this.actions.get("home").setEnabled(null!=t.view.currentRoot),this.actions.get("exitGroup").setEnabled(null!=t.view.currentRoot),this.actions.get("enterGroup").setEnabled(1==t.getSelectionCount()&&t.isValidRoot(t.getSelectionCell()));h=1==t.getSelectionCount()&&t.isCellFoldable(t.getSelectionCell());this.actions.get("expand").setEnabled(h),this.actions.get("collapse").setEnabled(h),this.actions.get("editLink").setEnabled(1==r.length),this.actions.get("openLink").setEnabled(1==t.getSelectionCount()&&null!=t.getLinkForCell(t.getSelectionCell())),this.actions.get("guides").setEnabled(t.isEnabled()),this.actions.get("grid").setEnabled(!this.editor.chromeless||this.editor.editable);h=t.isEnabled()&&!t.isCellLocked(t.getDefaultParent());"1"!=urlParams.customMenu&&this.menus.get("layout").setEnabled(h),this.menus.get("insert").setEnabled(h),this.menus.get("direction").setEnabled(h&&e),this.menus.get("align").setEnabled(h&&e&&1<t.getSelectionCount()),this.menus.get("distribute").setEnabled(h&&e&&1<t.getSelectionCount()),this.actions.get("selectVertices").setEnabled(h),this.actions.get("selectEdges").setEnabled(h),this.actions.get("selectAll").setEnabled(h),this.actions.get("selectNone").setEnabled(h),this.updatePasteActionStates()},EditorUi.prototype.zeroOffset=new mxPoint(0,0),EditorUi.prototype.getDiagramContainerOffset=function(){return this.zeroOffset},EditorUi.prototype.refresh=function(t){t=null==t||t;var e=this.container.clientWidth,i=this.container.clientHeight;this.container==document.body&&(e=document.body.clientWidth||document.documentElement.clientWidth,i=document.documentElement.clientHeight);var n=0;mxClient.IS_IOS&&!window.navigator.standalone&&window.innerHeight!=document.documentElement.clientHeight&&(n=document.documentElement.clientHeight-window.innerHeight,window.scrollTo(0,0));var o=Math.max(0,Math.min(this.hsplitPosition,e-this.splitSize-20)),r=0;null!=this.menubar&&(this.menubarContainer.style.height=this.menubarHeight+"px",r+=this.menubarHeight),null!=this.toolbar&&(this.toolbarContainer.style.top=this.menubarHeight+"px",this.toolbarContainer.style.height=this.toolbarHeight+"px",r+=this.toolbarHeight),0<r&&(r+=1);var l=0;null!=this.sidebarFooterContainer&&(s=this.footerHeight+n,l=Math.max(0,Math.min(i-r-s,this.sidebarFooterHeight)),this.sidebarFooterContainer.style.width=o+"px",this.sidebarFooterContainer.style.height=l+"px",this.sidebarFooterContainer.style.bottom=s+"px");e=null!=this.format?this.formatWidth:0;this.sidebarContainer.style.top=r+"px",this.sidebarContainer.style.width=o+"px",this.formatContainer.style.top=r+"px",this.formatContainer.style.width=e+"px",this.formatContainer.style.display=null!=this.format?"":"none";var i=this.getDiagramContainerOffset(),s=null!=this.hsplit.parentNode?o+this.splitSize:0;this.footerContainer.style.height=this.footerHeight+"px",this.hsplit.style.top=this.sidebarContainer.style.top,this.hsplit.style.bottom=this.footerHeight+n+"px",this.hsplit.style.left=o+"px",this.footerContainer.style.display=0==this.footerHeight?"none":"",null!=this.tabContainer&&(this.tabContainer.style.left=s+"px"),0<this.footerHeight&&(this.footerContainer.style.bottom=n+"px");o=0;null!=this.tabContainer&&(this.tabContainer.style.bottom=this.footerHeight+n+"px",this.tabContainer.style.right=this.diagramContainer.style.right,o=this.tabContainer.clientHeight),this.sidebarContainer.style.bottom=this.footerHeight+l+n+"px",this.formatContainer.style.bottom=this.footerHeight+n+"px","1"!=urlParams.embedInline&&(this.diagramContainer.style.left=s+i.x+"px",this.diagramContainer.style.top=r+i.y+"px",this.diagramContainer.style.right=e+"px",this.diagramContainer.style.bottom=this.footerHeight+n+o+"px"),t&&this.editor.graph.sizeDidChange()},EditorUi.prototype.createTabContainer=function(){return null},EditorUi.prototype.createDivs=function(){this.menubarContainer=this.createDiv("geMenubarContainer"),this.toolbarContainer=this.createDiv("geToolbarContainer"),this.sidebarContainer=this.createDiv("geSidebarContainer"),this.formatContainer=this.createDiv("geSidebarContainer geFormatContainer"),this.diagramContainer=this.createDiv("geDiagramContainer"),this.footerContainer=this.createDiv("geFooterContainer"),this.hsplit=this.createDiv("geHsplit"),this.hsplit.setAttribute("title",mxResources.get("collapseExpand")),this.menubarContainer.style.top="0px",this.menubarContainer.style.left="0px",this.menubarContainer.style.right="0px",this.toolbarContainer.style.left="0px",this.toolbarContainer.style.right="0px",this.sidebarContainer.style.left="0px",this.formatContainer.style.right="0px",this.formatContainer.style.zIndex="1",this.diagramContainer.style.right=(null!=this.format?this.formatWidth:0)+"px",this.footerContainer.style.left="0px",this.footerContainer.style.right="0px",this.footerContainer.style.bottom="0px",this.footerContainer.style.zIndex=mxPopupMenu.prototype.zIndex-3,this.hsplit.style.width=this.splitSize+"px",this.sidebarFooterContainer=this.createSidebarFooterContainer(),this.sidebarFooterContainer&&(this.sidebarFooterContainer.style.left="0px"),this.editor.chromeless?this.diagramContainer.style.border="none":this.tabContainer=this.createTabContainer()},EditorUi.prototype.createSidebarFooterContainer=function(){return null},EditorUi.prototype.createUi=function(){this.menubar=this.editor.chromeless?null:this.menus.createMenubar(this.createDiv("geMenubar")),null!=this.menubar&&this.menubarContainer.appendChild(this.menubar.container),null!=this.menubar&&(this.statusContainer=this.createStatusContainer(),this.editor.addListener("statusChanged",mxUtils.bind(this,function(){console.log('grapheditor-EditorUi.statusChanged(), getStatus:"'+this.editor.getStatus()+'"'),this.setStatusText(this.editor.getStatus())})),this.setStatusText(this.editor.getStatus()),this.menubar.container.appendChild(this.statusContainer),this.container.appendChild(this.menubarContainer)),this.sidebar=this.editor.chromeless?null:this.createSidebar(this.sidebarContainer),null!=this.sidebar&&this.container.appendChild(this.sidebarContainer),this.format=this.editor.chromeless||!this.formatEnabled?null:this.createFormat(this.formatContainer),null!=this.format&&this.container.appendChild(this.formatContainer);var t=this.editor.chromeless?null:this.createFooter();null!=t&&(this.footerContainer.appendChild(t),this.container.appendChild(this.footerContainer)),null!=this.sidebar&&this.sidebarFooterContainer&&this.container.appendChild(this.sidebarFooterContainer),this.container.appendChild(this.diagramContainer),null!=this.container&&null!=this.tabContainer&&this.container.appendChild(this.tabContainer),this.toolbar=this.editor.chromeless?null:this.createToolbar(this.createDiv("geToolbar")),null!=this.toolbar&&(this.toolbarContainer.appendChild(this.toolbar.container),this.container.appendChild(this.toolbarContainer)),null!=this.sidebar&&(this.container.appendChild(this.hsplit),this.addSplitHandler(this.hsplit,!0,0,mxUtils.bind(this,function(t){this.hsplitPosition=t,this.refresh()})))},EditorUi.prototype.createStatusContainer=function(){var t=document.createElement("a");return t.className="geItem geStatus",t},EditorUi.prototype.setStatusText=function(t){this.statusContainer.innerHTML=t},EditorUi.prototype.createToolbar=function(t){return new Toolbar(this,t)},EditorUi.prototype.createSidebar=function(t){return new Sidebar(this,t)},EditorUi.prototype.createFormat=function(t){return new Format(this,t)},EditorUi.prototype.createFooter=function(){return this.createDiv("geFooter")},EditorUi.prototype.createDiv=function(t){var e=document.createElement("div");return e.className=t,e},EditorUi.prototype.addSplitHandler=function(e,i,n,o){var r=null,l=null,s=!0,a=null;mxClient.IS_POINTER&&(e.style.touchAction="none");var d=mxUtils.bind(this,function(){var t=parseInt(i?e.style.left:e.style.bottom);return t=!i?t+n-this.footerHeight:t});function h(t){var e;null!=r&&(e=new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t)),o(Math.max(0,l+(i?e.x-r.x:r.y-e.y)-n)),mxEvent.consume(t),l!=d()&&(s=!0,a=null))}function t(t){h(t),r=l=null}mxEvent.addGestureListeners(e,function(t){r=new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t)),l=d(),s=!1,mxEvent.consume(t)}),mxEvent.addListener(e,"click",mxUtils.bind(this,function(t){var e;!s&&this.hsplitClickEnabled&&(e=null!=a?a-n:0,a=d(),o(e),mxEvent.consume(t))})),mxEvent.addGestureListeners(document,null,h,t),this.destroyFunctions.push(function(){mxEvent.removeGestureListeners(document,null,h,t)})},EditorUi.prototype.handleError=function(t,e,i,n,o){var r,l=null!=t&&null!=t.error?t.error:t;null!=l||null!=e?(r=mxUtils.htmlEntities(mxResources.get("unknownError")),t=mxResources.get("ok"),e=null!=e?e:mxResources.get("error"),null!=l&&null!=l.message&&(r=mxUtils.htmlEntities(l.message)),this.showError(e,r,t,i,null,null,null,null,null,null,null,null,n?i:null)):null!=i&&i()},EditorUi.prototype.showError=function(t,e,i,n,o,r,l,s,a,d,h,c,u){a=new ErrorDialog(this,t,e,i||mxResources.get("ok"),n,o,r,l,c,s,a),e=Math.ceil(null!=e?e.length/50:1);this.showDialog(a.container,d||340,h||100+20*e,!0,!1,u),a.init()},EditorUi.prototype.showDialog=function(t,e,i,n,o,r,l,s,a,d){this.editor.graph.tooltipHandler.resetTimer(),this.editor.graph.tooltipHandler.hideTooltip(),null==this.dialogs&&(this.dialogs=[]),this.dialog=new Dialog(this,t,e,i,n,o,r,l,s,a,d),this.dialogs.push(this.dialog)},EditorUi.prototype.hideDialog=function(t,e,i){null!=this.dialogs&&0<this.dialogs.length&&(null!=i&&i!=this.dialog.container.firstChild||(0!=(i=this.dialogs.pop()).close(t,e)?(this.dialog=0<this.dialogs.length?this.dialogs[this.dialogs.length-1]:null,this.editor.fireEvent(new mxEventObject("hideDialog")),null==this.dialog&&"hidden"!=this.editor.graph.container.style.visibility&&window.setTimeout(mxUtils.bind(this,function(){this.editor.graph.isEditing()&&null!=this.editor.graph.cellEditor.textarea?this.editor.graph.cellEditor.textarea.focus():(mxUtils.clearSelection(),this.editor.graph.container.focus())}),0)):this.dialogs.push(i)))},EditorUi.prototype.ctrlEnter=function(){var t=this.editor.graph;if(t.isEnabled())try{for(var e=t.getSelectionCells(),i=new mxDictionary,n=[],o=0;o<e.length;o++){var r=t.isTableCell(e[o])?t.model.getParent(e[o]):e[o];null==r||i.get(r)||(i.put(r,!0),n.push(r))}t.setSelectionCells(t.duplicateCells(n,!1))}catch(t){this.handleError(t)}},EditorUi.prototype.pickColor=function(t,e){var i=this.editor.graph,n=i.cellEditor.saveSelection(),o=230+17*(Math.ceil(ColorDialog.prototype.presetColors.length/12)+Math.ceil(ColorDialog.prototype.defaultColors.length/12)),t=new ColorDialog(this,t||"none",function(t){i.cellEditor.restoreSelection(n),e(t)},function(){i.cellEditor.restoreSelection(n)});this.showDialog(t.container,230,o,!0,!1),t.init()},EditorUi.prototype.openFile=function(){window.openFile=new OpenFile(mxUtils.bind(this,function(t){this.hideDialog(t)})),this.showDialog(new OpenDialog(this).container,Editor.useLocalStorage?640:320,Editor.useLocalStorage?480:220,!0,!0,function(){window.openFile=null})},EditorUi.prototype.extractGraphModelFromHtml=function(t){var e=null;try{var i,n=t.indexOf("&lt;mxGraphModel ");0<=n&&(n<(i=t.lastIndexOf("&lt;/mxGraphModel&gt;"))&&(e=t.substring(n,i+21).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/\\&quot;/g,'"').replace(/\n/g,"")))}catch(t){}return e},EditorUi.prototype.readGraphModelFromClipboard=function(i){this.readGraphModelFromClipboardWithType(mxUtils.bind(this,function(t){null!=t?i(t):this.readGraphModelFromClipboardWithType(mxUtils.bind(this,function(t){var e;null!=t&&(e=decodeURIComponent(t),this.isCompatibleString(e)&&(t=e)),i(t)}),"text")}),"html")},EditorUi.prototype.readGraphModelFromClipboardWithType=function(l,e){navigator.clipboard.read().then(mxUtils.bind(this,function(t){null!=t&&0<t.length&&"html"==e&&0<=mxUtils.indexOf(t[0].types,"text/html")?t[0].getType("text/html").then(mxUtils.bind(this,function(t){t.text().then(mxUtils.bind(this,function(t){try{var e=this.parseHtmlData(t),i="text/plain"!=e.getAttribute("data-type")?e.innerHTML:mxUtils.trim(null==e.innerText?mxUtils.getTextContent(e):e.innerText);try{var n=i.lastIndexOf("%3E");0<=n&&n<i.length-3&&(i=i.substring(0,n+3))}catch(t){}try{var o=e.getElementsByTagName("span"),r=null!=o&&0<o.length?mxUtils.trim(decodeURIComponent(o[0].textContent)):decodeURIComponent(i);this.isCompatibleString(r)&&(i=r)}catch(t){}}catch(t){}l(this.isCompatibleString(i)?i:null)})).catch(function(t){l(null)})})).catch(function(t){l(null)}):null!=t&&0<t.length&&"text"==e&&0<=mxUtils.indexOf(t[0].types,"text/plain")?t[0].getType("text/plain").then(function(t){t.text().then(function(t){l(t)}).catch(function(){l(null)})}).catch(function(){l(null)}):l(null)})).catch(function(t){l(null)})},EditorUi.prototype.parseHtmlData=function(t){var e=null;if(null!=t&&0<t.length){var i="<meta "==t.substring(0,6);(e=document.createElement("div")).innerHTML=(i?'<meta charset="utf-8">':"")+this.editor.graph.sanitizeHtml(t),asHtml=!0;var n=e.getElementsByTagName("style");if(null!=n)for(;0<n.length;)n[0].parentNode.removeChild(n[0]);null!=e.firstChild&&e.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT&&null!=e.firstChild.nextSibling&&e.firstChild.nextSibling.nodeType==mxConstants.NODETYPE_ELEMENT&&"META"==e.firstChild.nodeName&&"A"==e.firstChild.nextSibling.nodeName&&null==e.firstChild.nextSibling.nextSibling&&(o=null==e.firstChild.nextSibling.innerText?mxUtils.getTextContent(e.firstChild.nextSibling):e.firstChild.nextSibling.innerText)==e.firstChild.nextSibling.getAttribute("href")&&(mxUtils.setTextContent(e,o),asHtml=!1);var o,r,t=i&&null!=e.firstChild?e.firstChild.nextSibling:e.firstChild;null!=t&&null==t.nextSibling&&t.nodeType==mxConstants.NODETYPE_ELEMENT&&"IMG"==t.nodeName?null!=(o=t.getAttribute("src"))&&("data:image/png;base64,"==o.substring(0,22)&&null!=(r=this.extractGraphModelFromPng(o))&&0<r.length&&(o=r),mxUtils.setTextContent(e,o),asHtml=!1):1==(i=e.getElementsByTagName("img")).length&&null!=(o=(t=i[0]).getAttribute("src"))&&t.parentNode==e&&1==e.children.length&&("data:image/png;base64,"==o.substring(0,22)&&null!=(r=this.extractGraphModelFromPng(o))&&0<r.length&&(o=r),mxUtils.setTextContent(e,o),asHtml=!1),asHtml&&Graph.removePasteFormatting(e)}return asHtml||e.setAttribute("data-type","text/plain"),e},EditorUi.prototype.extractGraphModelFromEvent=function(t){var e=null,i=null;return null==t||null!=(t=null!=t.dataTransfer?t.dataTransfer:t.clipboardData)&&(10==document.documentMode||11==document.documentMode?i=t.getData("Text"):(i=0<=mxUtils.indexOf(t.types,"text/html")?t.getData("text/html"):null,mxUtils.indexOf(t.types,null==i||0==i.length)&&(i=t.getData("text/plain"))),null!=i&&(i=Graph.zapGremlins(mxUtils.trim(i)),null!=(t=this.extractGraphModelFromHtml(i))&&(i=t))),e=null!=i&&this.isCompatibleString(i)?i:e},EditorUi.prototype.isCompatibleString=function(t){return!1},EditorUi.prototype.saveFile=function(t){t||null==this.editor.filename?(t=new FilenameDialog(this,this.editor.getOrCreateFilename(),mxResources.get("save"),mxUtils.bind(this,function(t){this.save(t)}),null,mxUtils.bind(this,function(t){return null!=t&&0<t.length||(mxUtils.confirm(mxResources.get("invalidName")),!1)})),this.showDialog(t.container,300,100,!0,!0),t.init()):this.save(this.editor.getOrCreateFilename())},EditorUi.prototype.save=function(t){if(null!=t){this.editor.graph.isEditing()&&this.editor.graph.stopEditing();var e=mxUtils.getXml(this.editor.getGraphXml());try{if(Editor.useLocalStorage){if(null!=localStorage.getItem(t)&&!mxUtils.confirm(mxResources.get("replaceIt",[t])))return;localStorage.setItem(t,e),this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("saved"))+" "+new Date)}else{if(!(e.length<MAX_REQUEST_SIZE))return mxUtils.alert(mxResources.get("drawingTooLarge")),void mxUtils.popup(e);new mxXmlRequest(SAVE_URL,"filename="+encodeURIComponent(t)+"&xml="+encodeURIComponent(e)).simulate(document,"_blank")}this.editor.setModified(!1),this.editor.setFilename(t),this.updateDocumentTitle()}catch(t){this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("errorSavingFile")))}}},EditorUi.prototype.executeLayout=function(t,e,i){var n=this.editor.graph;if(n.isEnabled()){n.getModel().beginUpdate();try{t()}catch(t){throw t}finally{this.allowAnimation&&e&&(null==navigator.userAgent||navigator.userAgent.indexOf("Camino")<0)?((e=new mxMorphing(n)).addListener(mxEvent.DONE,mxUtils.bind(this,function(){n.getModel().endUpdate(),null!=i&&i()})),e.startAnimation()):(n.getModel().endUpdate(),null!=i&&i())}}},EditorUi.prototype.showImageDialog=function(t,e,i,n){var o,r=this.editor.graph.cellEditor,l=r.saveSelection(),s=mxUtils.prompt(t,e);r.restoreSelection(l),null!=s&&0<s.length?((o=new Image).onload=function(){i(s,o.width,o.height)},o.onerror=function(){i(null),mxUtils.alert(mxResources.get("fileNotFound"))},o.src=s):i(null)},EditorUi.prototype.showLinkDialog=function(t,e,i){i=new LinkDialog(this,t,e,i);this.showDialog(i.container,420,90,!0,!0),i.init()},EditorUi.prototype.showDataDialog=function(t){null!=t&&(t=new EditDataDialog(this,t),this.showDialog(t.container,480,420,!0,!1,null,!1),t.init())},EditorUi.prototype.showBackgroundImageDialog=function(t,e){t=null!=t?t:mxUtils.bind(this,function(t){t=new ChangePageSetup(this,null,t);t.ignoreColor=!0,this.editor.graph.model.execute(t)});var i=mxUtils.prompt(mxResources.get("backgroundImage"),null!=e?e.src:"");null!=i&&0<i.length?((e=new Image).onload=function(){t(new mxImage(i,e.width,e.height),!1)},e.onerror=function(){t(null,!0),mxUtils.alert(mxResources.get("fileNotFound"))},e.src=i):t(null)},EditorUi.prototype.setBackgroundImage=function(t){this.editor.graph.setBackgroundImage(t),this.editor.graph.view.validateBackgroundImage(),this.fireEvent(new mxEventObject("backgroundImageChanged"))},EditorUi.prototype.confirm=function(t,e,i){mxUtils.confirm(t)?null!=e&&e():null!=i&&i()},EditorUi.prototype.createOutline=function(t){var e=new mxOutline(this.editor.graph);return mxEvent.addListener(window,"resize",function(){e.update(!1)}),e},EditorUi.prototype.altShiftActions={67:"clearWaypoints",65:"connectionArrows",76:"editLink",80:"connectionPoints",84:"editTooltip",86:"pasteSize",88:"copySize",66:"copyData",69:"pasteData"},EditorUi.prototype.createKeyHandler=function(t){var i=this,c=this.editor.graph,r=new mxKeyHandler(c),e=r.isEventIgnored;r.isEventIgnored=function(t){return!(mxEvent.isShiftDown(t)&&9==t.keyCode)&&(!this.isControlDown(t)||mxEvent.isShiftDown(t)||90!=t.keyCode&&89!=t.keyCode&&188!=t.keyCode&&190!=t.keyCode&&85!=t.keyCode)&&(66!=t.keyCode&&73!=t.keyCode||!this.isControlDown(t)||this.graph.cellEditor.isContentEditing()&&!mxClient.IS_FF&&!mxClient.IS_SF)&&e.apply(this,arguments)},r.isEnabledForEvent=function(t){return!mxEvent.isConsumed(t)&&this.isGraphEvent(t)&&this.isEnabled()&&(null==i.dialogs||0==i.dialogs.length)},r.isControlDown=function(t){return mxEvent.isControlDown(t)||mxClient.IS_MAC&&t.metaKey};var u=null;function n(t,e,i){if(!c.isSelectionEmpty()&&c.isEnabled())if(e=null!=e?e:1,i){c.getModel().beginUpdate();try{for(var n,o=c.getSelectionCells(),r=0;r<o.length;r++)c.getModel().isVertex(o[r])&&c.isCellResizable(o[r])&&(null!=(n=c.getCellGeometry(o[r]))&&(n=n.clone(),37==t?n.width=Math.max(0,n.width-e):38==t?n.height=Math.max(0,n.height-e):39==t?n.width+=e:40==t&&(n.height+=e),c.getModel().setGeometry(o[r],n)))}finally{c.getModel().endUpdate()}}else{var l,s,a=c.getSelectionCell(),d=c.model.getParent(a),h=c.getView().scale,i=null;null!=(i=1==c.getSelectionCount()&&c.model.isVertex(a)&&null!=c.layoutManager&&!c.isCellLocked(a)?c.layoutManager.getLayout(d):i)&&i.constructor==mxStackLayout?(s=d.getIndex(a),37==t||38==t?c.model.add(d,a,Math.max(0,s-1)):39!=t&&40!=t||c.model.add(d,a,Math.min(c.model.getChildCount(d),s+1))):null!=(l=c.graphHandler)&&(null==l.first&&l.start(c.getSelectionCell(),0,0,c.getSelectionCells()),null!=l.first&&(s=d=0,37==t?d=-e:38==t?s=-e:39==t?d=e:40==t&&(s=e),l.currentDx+=d*h,l.currentDy+=s*h,l.checkPreview(),l.updatePreview()),null!=u&&window.clearTimeout(u),u=window.setTimeout(function(){var t,e;null!=l.first&&(t=l.roundLength(l.currentDx/h),e=l.roundLength(l.currentDy/h),l.moveCells(l.cells,t,e),l.reset())},400))}}var o={37:mxConstants.DIRECTION_WEST,38:mxConstants.DIRECTION_NORTH,39:mxConstants.DIRECTION_EAST,40:mxConstants.DIRECTION_SOUTH},l=r.getFunction;mxKeyHandler.prototype.getFunction=function(e){if(c.isEnabled()){if(mxEvent.isShiftDown(e)&&mxEvent.isAltDown(e)){var t=i.actions.get(i.altShiftActions[e.keyCode]);if(null!=t)return t.funct}if(null!=o[e.keyCode]&&!c.isSelectionEmpty()){if(this.isControlDown(e)||!mxEvent.isShiftDown(e)||!mxEvent.isAltDown(e))return this.isControlDown(e)?function(){n(e.keyCode,mxEvent.isShiftDown(e)?c.gridSize:null,!0)}:function(){n(e.keyCode,mxEvent.isShiftDown(e)?c.gridSize:null)};if(c.model.isVertex(c.getSelectionCell()))return function(){var t=c.connectVertex(c.getSelectionCell(),o[e.keyCode],c.defaultEdgeLength,e,!0);null!=t&&0<t.length&&(1==t.length&&c.model.isEdge(t[0])?c.setSelectionCell(c.model.getTerminal(t[0],!1)):c.setSelectionCell(t[t.length-1]),c.scrollCellToVisible(c.getSelectionCell()),null!=i.hoverIcons&&i.hoverIcons.update(c.view.getState(c.getSelectionCell())))}}}return l.apply(this,arguments)},r.bindAction=mxUtils.bind(this,function(t,e,i,n){var o=this.actions.get(i);null!=o&&(i=function(){o.isEnabled()&&o.funct()},e?n?r.bindControlShiftKey(t,i):r.bindControlKey(t,i):n?r.bindShiftKey(t,i):r.bindKey(t,i))});var s=this,a=r.escape;return r.escape=function(t){a.apply(this,arguments)},r.enter=function(){},r.bindControlShiftKey(36,function(){c.exitGroup()}),r.bindControlShiftKey(35,function(){c.enterGroup()}),r.bindShiftKey(36,function(){c.home()}),r.bindKey(35,function(){c.refresh()}),r.bindAction(107,!0,"zoomIn"),r.bindAction(109,!0,"zoomOut"),urlParams.customMenu,r.bindAction(79,!0,"outline",!0),this.editor.chromeless&&!this.editor.editable||(r.bindControlKey(36,function(){c.isEnabled()&&c.foldCells(!0)}),r.bindControlKey(35,function(){c.isEnabled()&&c.foldCells(!1)}),r.bindControlKey(13,function(){s.ctrlEnter()}),r.bindAction(8,!1,"delete"),r.bindAction(8,!0,"deleteAll"),r.bindAction(8,!1,"deleteLabels",!0),r.bindAction(46,!1,"delete"),r.bindAction(46,!0,"deleteAll"),r.bindAction(46,!1,"deleteLabels",!0),r.bindAction(36,!1,"resetView"),r.bindAction(72,!0,"fitWindow",!0),r.bindAction(74,!0,"fitPage"),r.bindAction(74,!0,"fitTwoPages",!0),r.bindAction(48,!0,"customZoom"),r.bindAction(82,!0,"turn"),r.bindAction(82,!0,"clearDefaultStyle",!0),r.bindAction(83,!0,"save"),r.bindAction(83,!0,"saveAs",!0),r.bindAction(65,!0,"selectAll"),r.bindAction(65,!0,"selectNone",!0),r.bindAction(73,!0,"selectVertices",!0),r.bindAction(69,!0,"selectEdges",!0),r.bindAction(69,!0,"editStyle"),r.bindAction(66,!0,"bold"),r.bindAction(66,!0,"toBack",!0),r.bindAction(70,!0,"toFront",!0),r.bindAction(68,!0,"duplicate"),r.bindAction(68,!0,"setAsDefaultStyle",!0),r.bindAction(90,!0,"undo"),r.bindAction(89,!0,"autosize",!0),r.bindAction(88,!0,"cut"),r.bindAction(67,!0,"copy"),r.bindAction(86,!0,"paste"),r.bindAction(71,!0,"group"),r.bindAction(77,!0,"editData"),r.bindAction(71,!0,"grid",!0),r.bindAction(73,!0,"italic"),r.bindAction(76,!0,"lockUnlock"),r.bindAction(76,!0,"layers",!0),r.bindAction(80,!0,"formatPanel",!0),r.bindAction(85,!0,"underline"),r.bindAction(85,!0,"ungroup",!0),r.bindAction(190,!0,"superscript"),r.bindAction(188,!0,"subscript"),r.bindAction(13,!1,"keyPressEnter"),r.bindKey(113,function(){c.isEnabled()&&c.startEditingAtCell()})),mxClient.IS_WIN?r.bindAction(89,!0,"redo"):r.bindAction(90,!0,"redo",!0),r},EditorUi.prototype.destroy=function(){if(null!=this.editor&&(this.editor.destroy(),this.editor=null),null!=this.menubar&&(this.menubar.destroy(),this.menubar=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),null!=this.sidebar&&(this.sidebar.destroy(),this.sidebar=null),null!=this.keyHandler&&(this.keyHandler.destroy(),this.keyHandler=null),null!=this.keydownHandler&&(mxEvent.removeListener(document,"keydown",this.keydownHandler),this.keydownHandler=null),null!=this.keyupHandler&&(mxEvent.removeListener(document,"keyup",this.keyupHandler),this.keyupHandler=null),null!=this.resizeHandler&&(mxEvent.removeListener(window,"resize",this.resizeHandler),this.resizeHandler=null),null!=this.gestureHandler&&(mxEvent.removeGestureListeners(document,this.gestureHandler),this.gestureHandler=null),null!=this.orientationChangeHandler&&(mxEvent.removeListener(window,"orientationchange",this.orientationChangeHandler),this.orientationChangeHandler=null),null!=this.scrollHandler&&(mxEvent.removeListener(window,"scroll",this.scrollHandler),this.scrollHandler=null),null!=this.destroyFunctions){for(var t=0;t<this.destroyFunctions.length;t++)this.destroyFunctions[t]();this.destroyFunctions=null}for(var e=[this.menubarContainer,this.toolbarContainer,this.sidebarContainer,this.formatContainer,this.diagramContainer,this.footerContainer,this.chromelessToolbar,this.hsplit,this.sidebarFooterContainer,this.layersDialog],t=0;t<e.length;t++)null!=e[t]&&null!=e[t].parentNode&&e[t].parentNode.removeChild(e[t])};