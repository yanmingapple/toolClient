function Actions(e){this.editorUi=e,this.actions=new Object,this.init()}function Action(e,t,n,l,i){mxEventSource.call(this),this.label=e,this.funct=this.createFunction(t),this.enabled=null==n||n,this.iconCls=l,this.shortcut=i,this.visible=!0}Actions.prototype.init=function(){function e(){return Action.prototype.isEnabled.apply(this,arguments)&&r.isEnabled()}var a=this.editorUi,d=a.editor,r=d.graph;function n(e){r.escape();e=r.deleteCells(r.getDeletableCells(r.getSelectionCells()),e);null!=e&&r.setSelectionCells(e)}function l(){if(!r.isSelectionEmpty()){r.getModel().beginUpdate();try{for(var e=r.getSelectionCells(),t=0;t<e.length;t++)r.cellLabelChanged(e[t],"")}finally{r.getModel().endUpdate()}}}this.addAction("new...",function(){r.openLink(a.getUrl())}),this.addAction("open...",function(){window.openNew=!0,window.openKey="open",a.openFile()}),this.addAction("smartFit",function(){r.popupMenuHandler.hideMenu();var e=r.view.scale,t=r.view.translate.x,n=r.view.translate.y;a.actions.get("resetView").funct(),Math.abs(e-r.view.scale)<1e-5&&t==r.view.translate.x&&n==r.view.translate.y&&a.actions.get(r.pageVisible?"fitPage":"fitWindow").funct()}),this.addAction("keyPressEnter",function(){r.isEnabled()&&(r.isSelectionEmpty()?a.actions.get("smartFit").funct():r.startEditingAtCell())}),this.addAction("import...",function(){window.openNew=!1,window.openKey="import",window.openFile=new OpenFile(mxUtils.bind(this,function(){a.hideDialog()})),window.openFile.setConsumer(mxUtils.bind(this,function(e,t){try{var n=mxUtils.parseXml(e);d.graph.setSelectionCells(d.graph.importGraphModel(n.documentElement))}catch(e){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+e.message)}})),a.showDialog(new OpenDialog(this).container,320,220,!0,!0,function(){window.openFile=null})}).isEnabled=e,this.addAction("save",function(){a.saveFile(!1)},null,null,Editor.ctrlKey+"+S").isEnabled=e,this.addAction("saveAs...",function(){a.saveFile(!0)},null,null,Editor.ctrlKey+"+Shift+S").isEnabled=e,this.addAction("export...",function(){a.showDialog(new ExportDialog(a).container,300,340,!0,!0)}),this.addAction("editDiagram...",function(){var e=new EditDiagramDialog(a);a.showDialog(e.container,620,420,!0,!1),e.init()}),this.addAction("pageSetup...",function(){a.showDialog(new PageSetupDialog(a).container,320,240,!0,!0)}).isEnabled=e,this.addAction("print...",function(){a.showDialog(new PrintDialog(a).container,300,180,!0,!0)},null,"sprite-print",Editor.ctrlKey+"+P"),this.addAction("preview",function(){mxUtils.show(r,null,10,10)}),this.addAction("undo",function(){a.undo()},null,"sprite-undo",Editor.ctrlKey+"+Z"),this.addAction("redo",function(){a.redo()},null,"sprite-redo",mxClient.IS_WIN?Editor.ctrlKey+"+Y":Editor.ctrlKey+"+Shift+Z"),this.addAction("cut",function(){var e=null;try{null!=(e=a.copyXml())&&r.removeCells(e,!1)}catch(e){}null==e&&mxClipboard.cut(r)},null,"sprite-cut",Editor.ctrlKey+"+X"),this.addAction("copy",function(){try{a.copyXml()}catch(e){}try{mxClipboard.copy(r)}catch(e){a.handleError(e)}},null,"sprite-copy",Editor.ctrlKey+"+C"),this.addAction("paste",function(){if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){var e=!1;try{Editor.enableNativeCipboard&&(a.readGraphModelFromClipboard(function(e){if(null!=e){r.getModel().beginUpdate();try{a.pasteXml(e,!0)}finally{r.getModel().endUpdate()}}else mxClipboard.paste(r)}),e=!0)}catch(e){}e||mxClipboard.paste(r)}},!1,"sprite-paste",Editor.ctrlKey+"+V"),this.addAction("pasteHere",function(e){function t(e){if(null!=e){for(var t=!0,n=0;n<e.length&&t;n++)t=t&&r.model.isEdge(e[n]);var l=r.view.translate,i=r.view.scale,o=l.x,s=l.y,a=null;1!=e.length||!t||null!=(l=r.getCellGeometry(e[0]))&&(a=l.getTerminalPoint(!0)),null!=(a=null!=a?a:r.getBoundingBoxFromGeometry(e,t))&&(o=Math.round(r.snap(r.popupMenuHandler.triggerX/i-o)),s=Math.round(r.snap(r.popupMenuHandler.triggerY/i-s)),r.cellsMoved(e,o-a.x,s-a.y))}}function n(){r.getModel().beginUpdate();try{t(mxClipboard.paste(r))}finally{r.getModel().endUpdate()}}if(r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())){var l=!1;try{Editor.enableNativeCipboard&&(a.readGraphModelFromClipboard(function(e){if(null!=e){r.getModel().beginUpdate();try{t(a.pasteXml(e,!0))}finally{r.getModel().endUpdate()}}else n()}),l=!0)}catch(e){}l||n()}}),this.addAction("copySize",function(){var e=r.getSelectionCell();r.isEnabled()&&null!=e&&r.getModel().isVertex(e)&&(null!=(e=r.getCellGeometry(e))&&(a.copiedSize=new mxRectangle(e.x,e.y,e.width,e.height)))},null,null,"Alt+Shift+X"),this.addAction("pasteSize",function(){if(r.isEnabled()&&!r.isSelectionEmpty()&&null!=a.copiedSize){r.getModel().beginUpdate();try{for(var e,t=r.getResizableCells(r.getSelectionCells()),n=0;n<t.length;n++)!r.getModel().isVertex(t[n])||null!=(e=r.getCellGeometry(t[n]))&&((e=e.clone()).width=a.copiedSize.width,e.height=a.copiedSize.height,r.getModel().setGeometry(t[n],e))}finally{r.getModel().endUpdate()}}},null,null,"Alt+Shift+V"),this.addAction("copyData",function(){var e=r.getSelectionCell()||r.getModel().getRoot();r.isEnabled()&&null!=e&&(null==(e=e.cloneValue())||isNaN(e.nodeType)||(a.copiedValue=e))},null,null,"Alt+Shift+B"),this.addAction("pasteData",function(l,e){var l=null!=e?e:l,i=r.getModel();function t(e,t){var n=i.getValue(e);(t=e.cloneValue(t)).removeAttribute("placeholders"),null==n||isNaN(n.nodeType)||t.setAttribute("placeholders",n.getAttribute("placeholders")),null!=l&&mxEvent.isShiftDown(l)||t.setAttribute("label",r.convertValueToString(e)),i.setValue(e,t)}if(r.isEnabled()&&!r.isSelectionEmpty()&&null!=a.copiedValue){i.beginUpdate();try{var n=r.getEditableCells(r.getSelectionCells());if(0==n.length)t(i.getRoot(),a.copiedValue);else for(var o=0;o<n.length;o++)t(n[o],a.copiedValue)}finally{i.endUpdate()}}},null,null,"Alt+Shift+E"),this.addAction("delete",function(e,t){null!=(e=null!=t?t:e)&&mxEvent.isShiftDown(e)?l():n(null!=e&&(mxEvent.isControlDown(e)||mxEvent.isMetaDown(e)||mxEvent.isAltDown(e)))},null,null,"Delete"),this.addAction("deleteAll",function(){n(!0)}),this.addAction("deleteLabels",function(){l()},null,null,Editor.ctrlKey+"+Delete"),this.addAction("duplicate",function(){try{r.setSelectionCells(r.duplicateCells()),r.scrollCellToVisible(r.getSelectionCell())}catch(e){a.handleError(e)}},null,null,Editor.ctrlKey+"+D"),this.put("turn",new Action(mxResources.get("turn")+" / "+mxResources.get("reverse"),function(e,t){e=null!=t?t:e;r.turnShapes(r.getResizableCells(r.getSelectionCells()),null!=e&&mxEvent.isShiftDown(e))},null,null,Editor.ctrlKey+"+R")),this.put("selectConnections",new Action(mxResources.get("selectEdges"),function(e){var t=r.getSelectionCell();r.isEnabled()&&null!=t&&r.addSelectionCells(r.getEdges(t))})),this.addAction("selectVertices",function(){r.selectVertices(null,!0)},null,null,Editor.ctrlKey+"+Shift+I"),this.addAction("selectEdges",function(){r.selectEdges()},null,null,Editor.ctrlKey+"+Shift+E"),this.addAction("selectAll",function(){r.selectAll(null,!0)},null,null,Editor.ctrlKey+"+A"),this.addAction("selectNone",function(){r.clearSelection()},null,null,Editor.ctrlKey+"+Shift+A"),this.addAction("lockUnlock",function(){if(!r.isSelectionEmpty()){r.getModel().beginUpdate();try{var e=r.getSelectionCells(),t=r.getCurrentCellStyle(r.getSelectionCell()),n=1==mxUtils.getValue(t,mxConstants.STYLE_EDITABLE,1)?0:1;r.setCellStyles(mxConstants.STYLE_MOVABLE,n,e),r.setCellStyles(mxConstants.STYLE_RESIZABLE,n,e),r.setCellStyles(mxConstants.STYLE_ROTATABLE,n,e),r.setCellStyles(mxConstants.STYLE_DELETABLE,n,e),r.setCellStyles(mxConstants.STYLE_EDITABLE,n,e),r.setCellStyles("connectable",n,e)}finally{r.getModel().endUpdate()}}},null,null,Editor.ctrlKey+"+L"),this.addAction("home",function(){r.home()},null,null,"Shift+Home"),this.addAction("exitGroup",function(){r.exitGroup()},null,null,Editor.ctrlKey+"+Shift+Home"),this.addAction("enterGroup",function(){r.enterGroup()},null,null,Editor.ctrlKey+"+Shift+End"),this.addAction("collapse",function(){r.foldCells(!0)},null,null,Editor.ctrlKey+"+Home"),this.addAction("expand",function(){r.foldCells(!1)},null,null,Editor.ctrlKey+"+End"),this.addAction("toFront",function(){r.orderCells(!1)},null,null,Editor.ctrlKey+"+Shift+F"),this.addAction("toBack",function(){r.orderCells(!0)},null,null,Editor.ctrlKey+"+Shift+B"),this.addAction("bringForward",function(e){r.orderCells(!1,null,!0)}),this.addAction("sendBackward",function(e){r.orderCells(!0,null,!0)}),this.addAction("group",function(){var e;r.isEnabled()&&(1!=(e=mxUtils.sortCells(r.getSelectionCells(),!0)).length||r.isTable(e[0])||r.isTableRow(e[0])?1<(e=r.getCellsForGroup(e)).length&&r.setSelectionCell(r.groupCells(null,0,e)):r.setCellStyles("container","1"))},null,null,Editor.ctrlKey+"+G"),this.addAction("ungroup",function(){if(r.isEnabled()){var e=r.getEditableCells(r.getSelectionCells());r.model.beginUpdate();try{var t=r.ungroupCells();if(null!=e)for(var n=0;n<e.length;n++)r.model.contains(e[n])&&(0==r.model.getChildCount(e[n])&&r.model.isVertex(e[n])&&r.setCellStyles("container","0",[e[n]]),t.push(e[n]))}finally{r.model.endUpdate()}0<t.length&&r.setSelectionCells(t)}},null,null,Editor.ctrlKey+"+Shift+U"),this.addAction("removeFromGroup",function(){if(r.isEnabled()){var e=r.getSelectionCells();if(null!=e){for(var t=[],n=0;n<e.length;n++)r.isTableRow(e[n])||r.isTableCell(e[n])||t.push(e[n]);r.removeCellsFromParent(t)}}}),this.addAction("edit",function(){r.isEnabled()&&r.startEditingAtCell()},null,null,"F2/Enter"),this.addAction("editData...",function(){var e=r.getSelectionCell()||r.getModel().getRoot();a.showDataDialog(e)},null,null,Editor.ctrlKey+"+M"),this.addAction("editTooltip...",function(){var e,t,n=r.getSelectionCell();r.isEnabled()&&null!=n&&r.isCellEditable(n)&&(t="",!mxUtils.isNode(n.value)||(e=null)!=(e=null==(e=Graph.translateDiagram&&null!=Graph.diagramLanguage&&n.value.hasAttribute("tooltip_"+Graph.diagramLanguage)?n.value.getAttribute("tooltip_"+Graph.diagramLanguage):e)?n.value.getAttribute("tooltip"):e)&&(t=e),t=new TextareaDialog(a,mxResources.get("editTooltip")+":",t,function(e){r.setTooltipForCell(n,e)}),a.showDialog(t.container,320,200,!0,!0),t.init())},null,null,"Alt+Shift+T"),this.addAction("openLink",function(){var e=r.getLinkForCell(r.getSelectionCell());null!=e&&r.openLink(e)}),this.addAction("editLink...",function(){var e,l=r.getSelectionCell();r.isEnabled()&&null!=l&&r.isCellEditable(l)&&(e=r.getLinkForCell(l)||"",a.showLinkDialog(e,mxResources.get("apply"),function(e,t,n){e=mxUtils.trim(e),r.setLinkForCell(l,0<e.length?e:null),r.setAttributeForCell(l,"linkTarget",n)},!0,r.getLinkTargetForCell(l)))},null,null,"Alt+Shift+L"),"1"!=urlParams.customMenu&&(this.put("insertImage",new Action(mxResources.get("image")+"...",function(){r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())&&(r.clearSelection(),a.actions.get("image").funct())})).isEnabled=e),this.put("insertLink",new Action(mxResources.get("link")+"...",function(){r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())&&a.showLinkDialog("",mxResources.get("insert"),function(e,t,n){if(0<(e=mxUtils.trim(e)).length){var l=null,i=r.getLinkTitle(e);null!=t&&0<t.length&&(l=t[0].iconUrl,30<(i=(i=t[0].name||t[0].type).charAt(0).toUpperCase()+i.substring(1)).length&&(i=i.substring(0,30)+"..."));i=new mxCell(i,new mxGeometry(0,0,100,40),"fontColor=#0000EE;fontStyle=4;rounded=1;overflow=hidden;"+(null!=l?"shape=label;imageWidth=16;imageHeight=16;spacingLeft=26;align=left;image="+l:"spacing=10;"));i.vertex=!0;l=r.getCenterInsertPoint(r.getBoundingBoxFromGeometry([i],!0));i.geometry.x=l.x,i.geometry.y=l.y,r.setAttributeForCell(i,"linkTarget",n),r.setLinkForCell(i,e),r.cellSizeUpdated(i,!0),r.getModel().beginUpdate();try{i=r.addCell(i),r.fireEvent(new mxEventObject("cellsInserted","cells",[i]))}finally{r.getModel().endUpdate()}r.setSelectionCell(i),r.scrollCellToVisible(r.getSelectionCell())}},!0)})).isEnabled=e,this.addAction("link...",mxUtils.bind(this,function(){if(r.isEnabled())if(r.cellEditor.isContentEditing()){var e=r.getSelectedElement(),t=r.getParentByName(e,"A",r.cellEditor.textarea),n="";if(null==t&&null!=e&&null!=e.getElementsByTagName)for(var l=e.getElementsByTagName("a"),i=0;i<l.length&&null==t;i++)l[i].textContent==e.textContent&&(t=l[i]);null!=t&&"A"==t.nodeName&&(n=t.getAttribute("href")||"",r.selectNode(t));var o=r.cellEditor.saveSelection();a.showLinkDialog(n,mxResources.get("apply"),mxUtils.bind(this,function(e){r.cellEditor.restoreSelection(o),null!=e&&r.insertLink(e)}))}else(r.isSelectionEmpty()?this.get("insertLink"):this.get("editLink")).funct()})).isEnabled=e,this.addAction("autosize",function(){var e=r.getSelectionCells();if(null!=e){r.getModel().beginUpdate();try{for(var t=0;t<e.length;t++){var n=e[t];0<r.getModel().getChildCount(n)?r.updateGroupBounds([n],0,!0):r.updateCellSize(n)}}finally{r.getModel().endUpdate()}}},null,null,Editor.ctrlKey+"+Shift+Y"),this.addAction("formattedText",function(){r.stopEditing();var e=r.getCommonStyle(r.getSelectionCells()),t="1"==mxUtils.getValue(e,"html","0")?null:"1";r.getModel().beginUpdate();try{for(var n,l,i,o=r.getEditableCells(r.getSelectionCells()),s=0;s<o.length;s++)state=r.getView().getState(o[s]),null!=state&&("1"==(n=mxUtils.getValue(state.style,"html","0"))&&null==t?(i=r.convertValueToString(state.cell),"0"!=mxUtils.getValue(state.style,"nl2Br","1")&&(i=i.replace(/\n/g,"").replace(/<br\s*.?>/g,"\n")),(l=document.createElement("div")).innerHTML=r.sanitizeHtml(i),i=mxUtils.extractTextWithWhitespace(l.childNodes),r.cellLabelChanged(state.cell,i),r.setCellStyles("html",t,[o[s]])):"0"==n&&"1"==t&&(i=mxUtils.htmlEntities(r.convertValueToString(state.cell),!1),"0"!=mxUtils.getValue(state.style,"nl2Br","1")&&(i=i.replace(/\n/g,"<br/>")),r.cellLabelChanged(state.cell,r.sanitizeHtml(i)),r.setCellStyles("html",t,[o[s]])));a.fireEvent(new mxEventObject("styleChanged","keys",["html"],"values",[null!=t?t:"0"],"cells",o))}finally{r.getModel().endUpdate()}}),this.addAction("wordWrap",function(){var e=r.getView().getState(r.getSelectionCell()),t="wrap";r.stopEditing(),null!=e&&"wrap"==e.style[mxConstants.STYLE_WHITE_SPACE]&&(t=null),r.setCellStyles(mxConstants.STYLE_WHITE_SPACE,t)}),this.addAction("rotation",function(){var e="0",t=r.getView().getState(r.getSelectionCell());null!=t&&(e=t.style[mxConstants.STYLE_ROTATION]||e);e=new FilenameDialog(a,e,mxResources.get("apply"),function(e){null!=e&&0<e.length&&r.setCellStyles(mxConstants.STYLE_ROTATION,e)},mxResources.get("enterValue")+" ("+mxResources.get("rotation")+" 0-360)");a.showDialog(e.container,375,80,!0,!0),e.init()}),this.addAction("resetView",function(){r.zoomTo(1),a.resetScrollbars()},null,null,"Enter/Home"),this.addAction("zoomIn",function(e){r.isFastZoomEnabled()?r.lazyZoom(!0,!0,a.buttonZoomDelay):r.zoomIn()},null,null,Editor.ctrlKey+" + (Numpad) / Alt+Mousewheel"),this.addAction("zoomOut",function(e){r.isFastZoomEnabled()?r.lazyZoom(!1,!0,a.buttonZoomDelay):r.zoomOut()},null,null,Editor.ctrlKey+" - (Numpad) / Alt+Mousewheel"),this.addAction("fitWindow",function(){var e=r.isSelectionEmpty()?r.getGraphBounds():r.getBoundingBox(r.getSelectionCells()),t=r.view.translate,n=r.view.scale;e.x=e.x/n-t.x,e.y=e.y/n-t.y,e.width/=n,e.height/=n,null!=r.backgroundImage&&(e=mxRectangle.fromRectangle(e)).add(new mxRectangle(0,0,r.backgroundImage.width,r.backgroundImage.height)),0==e.width||0==e.height?(r.zoomTo(1),a.resetScrollbars()):(null!=(n=Editor.fitWindowBorders)&&(e.x-=n.x,e.y-=n.y,e.width+=n.width+n.x,e.height+=n.height+n.y),r.fitWindow(e))},null,null,Editor.ctrlKey+"+Shift+H"),this.addAction("fitPage",mxUtils.bind(this,function(){r.pageVisible||this.get("pageView").funct();var e=r.pageFormat,t=r.pageScale,n=r.container.clientWidth-10,l=r.container.clientHeight-10,t=Math.floor(20*Math.min(n/e.width/t,l/e.height/t))/20;r.zoomTo(t),mxUtils.hasScrollbars(r.container)&&(t=r.getPagePadding(),r.container.scrollTop=t.y*r.view.scale-1,r.container.scrollLeft=Math.min(t.x*r.view.scale,(r.container.scrollWidth-r.container.clientWidth)/2)-1)}),null,null,Editor.ctrlKey+"+J"),this.addAction("fitTwoPages",mxUtils.bind(this,function(){r.pageVisible||this.get("pageView").funct();var e=r.pageFormat,t=r.pageScale,n=r.container.clientWidth-10,l=r.container.clientHeight-10,t=Math.floor(20*Math.min(n/(2*e.width)/t,l/e.height/t))/20;r.zoomTo(t),mxUtils.hasScrollbars(r.container)&&(t=r.getPagePadding(),r.container.scrollTop=Math.min(t.y,(r.container.scrollHeight-r.container.clientHeight)/2),r.container.scrollLeft=Math.min(t.x,(r.container.scrollWidth-r.container.clientWidth)/2))}),null,null,Editor.ctrlKey+"+Shift+J"),this.addAction("fitPageWidth",mxUtils.bind(this,function(){r.pageVisible||this.get("pageView").funct();var e=r.pageFormat,t=r.pageScale,n=r.container.clientWidth-10,t=Math.floor(20*n/e.width/t)/20;r.zoomTo(t),mxUtils.hasScrollbars(r.container)&&(t=r.getPagePadding(),r.container.scrollLeft=Math.min(t.x*r.view.scale,(r.container.scrollWidth-r.container.clientWidth)/2))})),this.put("customZoom",new Action(mxResources.get("custom")+"...",mxUtils.bind(this,function(){var e=new FilenameDialog(this.editorUi,parseInt(100*r.getView().getScale()),mxResources.get("apply"),mxUtils.bind(this,function(e){e=parseInt(e);!isNaN(e)&&0<e&&r.zoomTo(e/100)}),mxResources.get("zoom")+" (%)");this.editorUi.showDialog(e.container,300,80,!0,!0),e.init()}),null,null,Editor.ctrlKey+"+0")),this.addAction("pageScale...",mxUtils.bind(this,function(){var e=new FilenameDialog(this.editorUi,parseInt(100*r.pageScale),mxResources.get("apply"),mxUtils.bind(this,function(e){var e=parseInt(e);!isNaN(e)&&0<e&&((e=new ChangePageSetup(a,null,null,null,e/100)).ignoreColor=!0,e.ignoreImage=!0,r.model.execute(e))}),mxResources.get("pageScale")+" (%)");this.editorUi.showDialog(e.container,300,80,!0,!0),e.init()}));var t=null;(t=this.addAction("grid",function(){r.setGridEnabled(!r.isGridEnabled()),r.defaultGridEnabled=r.isGridEnabled(),a.fireEvent(new mxEventObject("gridEnabledChanged"))},null,null,Editor.ctrlKey+"+Shift+G")).setToggleAction(!0),t.setSelectedCallback(function(){return r.isGridEnabled()}),t.setEnabled(!1),(t=this.addAction("guides",function(){r.graphHandler.guidesEnabled=!r.graphHandler.guidesEnabled,a.fireEvent(new mxEventObject("guidesEnabledChanged"))})).setToggleAction(!0),t.setSelectedCallback(function(){return r.graphHandler.guidesEnabled}),t.setEnabled(!1),(t=this.addAction("tooltips",function(){r.tooltipHandler.setEnabled(!r.tooltipHandler.isEnabled()),a.fireEvent(new mxEventObject("tooltipsEnabledChanged"))})).setToggleAction(!0),t.setSelectedCallback(function(){return r.tooltipHandler.isEnabled()}),(t=this.addAction("collapseExpand",function(){var e=new ChangePageSetup(a);e.ignoreColor=!0,e.ignoreImage=!0,e.foldingEnabled=!r.foldingEnabled,r.model.execute(e)})).setToggleAction(!0),t.setSelectedCallback(function(){return r.foldingEnabled}),t.isEnabled=e,(t=this.addAction("scrollbars",function(){a.setScrollbars(!a.hasScrollbars())})).setToggleAction(!0),t.setSelectedCallback(function(){return r.scrollbars}),(t=this.addAction("pageView",mxUtils.bind(this,function(){a.setPageVisible(!r.pageVisible)}))).setToggleAction(!0),t.setSelectedCallback(function(){return r.pageVisible}),(t=this.addAction("connectionArrows",function(){r.connectionArrowsEnabled=!r.connectionArrowsEnabled,a.fireEvent(new mxEventObject("connectionArrowsChanged"))},null,null,"Alt+Shift+A")).setToggleAction(!0),t.setSelectedCallback(function(){return r.connectionArrowsEnabled}),(t=this.addAction("connectionPoints",function(){r.setConnectable(!r.connectionHandler.isEnabled()),a.fireEvent(new mxEventObject("connectionPointsChanged"))},null,null,"Alt+Shift+P")).setToggleAction(!0),t.setSelectedCallback(function(){return r.connectionHandler.isEnabled()}),(t=this.addAction("copyConnect",function(){r.connectionHandler.setCreateTarget(!r.connectionHandler.isCreateTarget()),a.fireEvent(new mxEventObject("copyConnectChanged"))})).setToggleAction(!0),t.setSelectedCallback(function(){return r.connectionHandler.isCreateTarget()}),t.isEnabled=e,(t=this.addAction("autosave",function(){a.editor.setAutosave(!a.editor.autosave)})).setToggleAction(!0),t.setSelectedCallback(function(){return a.editor.autosave}),t.isEnabled=e,t.visible=!1,this.addAction("help",function(){var e="";mxResources.isLanguageSupported(mxClient.language)&&(e="_"+mxClient.language),r.openLink(RESOURCES_PATH+"/help"+e+".html")});var i=!1;this.put("about",new Action(mxResources.get("about")+" Graph Editor...",function(){i||(a.showDialog(new AboutDialog(a).container,320,280,!0,!0,function(){i=!1}),i=!0)}));var o=mxUtils.bind(this,function(e,n,l,t){return this.addAction(e,function(){if(null!=l&&r.cellEditor.isContentEditing())l();else{r.stopEditing(!1),r.getModel().beginUpdate();try{var e=r.getEditableCells(r.getSelectionCells());r.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,n,e),(n&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?r.updateLabelElements(e,function(e){e.style.fontWeight=null,"B"==e.nodeName&&r.replaceElement(e)}):(n&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?r.updateLabelElements(e,function(e){e.style.fontStyle=null,"I"==e.nodeName&&r.replaceElement(e)}):(n&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&r.updateLabelElements(e,function(e){e.style.textDecoration=null,"U"==e.nodeName&&r.replaceElement(e)});for(var t=0;t<e.length;t++)0==r.model.getChildCount(e[t])&&r.autoSizeCell(e[t],!1)}finally{r.getModel().endUpdate()}}},null,null,t)});o("bold",mxConstants.FONT_BOLD,function(){document.execCommand("bold",!1,null)},Editor.ctrlKey+"+B"),o("italic",mxConstants.FONT_ITALIC,function(){document.execCommand("italic",!1,null)},Editor.ctrlKey+"+I"),o("underline",mxConstants.FONT_UNDERLINE,function(){document.execCommand("underline",!1,null)},Editor.ctrlKey+"+U"),this.addAction("fontColor...",function(){a.menus.pickColor(mxConstants.STYLE_FONTCOLOR,"forecolor","000000")}),this.addAction("strokeColor...",function(){a.menus.pickColor(mxConstants.STYLE_STROKECOLOR)}),this.addAction("fillColor...",function(){a.menus.pickColor(mxConstants.STYLE_FILLCOLOR)}),this.addAction("gradientColor...",function(){a.menus.pickColor(mxConstants.STYLE_GRADIENTCOLOR)}),this.addAction("backgroundColor...",function(){a.menus.pickColor(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"backcolor")}),this.addAction("borderColor...",function(){a.menus.pickColor(mxConstants.STYLE_LABEL_BORDERCOLOR)}),this.addAction("vertical",function(){a.menus.toggleStyle(mxConstants.STYLE_HORIZONTAL,!0)}),this.addAction("shadow",function(){a.menus.toggleStyle(mxConstants.STYLE_SHADOW)}),this.addAction("solid",function(){r.getModel().beginUpdate();try{r.setCellStyles(mxConstants.STYLE_DASHED,null),r.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null),a.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",[null,null],"cells",r.getSelectionCells()))}finally{r.getModel().endUpdate()}}),this.addAction("dashed",function(){r.getModel().beginUpdate();try{r.setCellStyles(mxConstants.STYLE_DASHED,"1"),r.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null),a.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1",null],"cells",r.getSelectionCells()))}finally{r.getModel().endUpdate()}}),this.addAction("dotted",function(){r.getModel().beginUpdate();try{r.setCellStyles(mxConstants.STYLE_DASHED,"1"),r.setCellStyles(mxConstants.STYLE_DASH_PATTERN,"1 4"),a.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1","1 4"],"cells",r.getSelectionCells()))}finally{r.getModel().endUpdate()}}),this.addAction("sharp",function(){r.getModel().beginUpdate();try{r.setCellStyles(mxConstants.STYLE_ROUNDED,"0"),r.setCellStyles(mxConstants.STYLE_CURVED,"0"),a.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","0"],"cells",r.getSelectionCells()))}finally{r.getModel().endUpdate()}}),this.addAction("rounded",function(){r.getModel().beginUpdate();try{r.setCellStyles(mxConstants.STYLE_ROUNDED,"1"),r.setCellStyles(mxConstants.STYLE_CURVED,"0"),a.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["1","0"],"cells",r.getSelectionCells()))}finally{r.getModel().endUpdate()}}),this.addAction("toggleRounded",function(){if(!r.isSelectionEmpty()&&r.isEnabled()){r.getModel().beginUpdate();try{var e=r.getSelectionCells(),t=r.getCurrentCellStyle(e[0]),n="1"==mxUtils.getValue(t,mxConstants.STYLE_ROUNDED,"0")?"0":"1";r.setCellStyles(mxConstants.STYLE_ROUNDED,n),r.setCellStyles(mxConstants.STYLE_CURVED,null),a.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",[n,"0"],"cells",r.getSelectionCells()))}finally{r.getModel().endUpdate()}}}),this.addAction("curved",function(){r.getModel().beginUpdate();try{r.setCellStyles(mxConstants.STYLE_ROUNDED,"0"),r.setCellStyles(mxConstants.STYLE_CURVED,"1"),a.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","1"],"cells",r.getSelectionCells()))}finally{r.getModel().endUpdate()}}),this.addAction("collapsible",function(){var e=r.view.getState(r.getSelectionCell()),t="1";null!=e&&null!=r.getFoldingImage(e)&&(t="0"),r.setCellStyles("collapsible",t),a.fireEvent(new mxEventObject("styleChanged","keys",["collapsible"],"values",[t],"cells",r.getSelectionCells()))}),this.addAction("editStyle...",mxUtils.bind(this,function(){var e,t=r.getEditableCells(r.getSelectionCells());null!=t&&0<t.length&&(e=r.getModel(),e=new TextareaDialog(this.editorUi,mxResources.get("editStyle")+":",e.getStyle(t[0])||"",function(e){null!=e&&r.setCellStyle(mxUtils.trim(e),t)},null,null,400,220),this.editorUi.showDialog(e.container,420,300,!0,!0),e.init())}),null,null,Editor.ctrlKey+"+E"),this.addAction("setAsDefaultStyle",function(){r.isEnabled()&&!r.isSelectionEmpty()&&a.setDefaultStyle(r.getSelectionCell())},null,null,Editor.ctrlKey+"+Shift+D"),this.addAction("clearDefaultStyle",function(){r.isEnabled()&&a.clearDefaultStyle()},null,null,Editor.ctrlKey+"+Shift+R"),this.addAction("addWaypoint",function(){var e=r.getSelectionCell();if(null!=e&&r.getModel().isEdge(e)){var t=d.graph.selectionCellsHandler.getHandler(e);if(t instanceof mxEdgeHandler){for(var n=r.view.translate,l=r.view.scale,i=n.x,o=n.y,s=r.getModel().getParent(e),a=r.getCellGeometry(s);r.getModel().isVertex(s)&&null!=a;)i+=a.x,o+=a.y,s=r.getModel().getParent(s),a=r.getCellGeometry(s);e=Math.round(r.snap(r.popupMenuHandler.triggerX/l-i)),l=Math.round(r.snap(r.popupMenuHandler.triggerY/l-o));t.addPointAt(t.state,e,l)}}}),this.addAction("removeWaypoint",function(){var e=a.actions.get("removeWaypoint");null!=e.handler&&e.handler.removePoint(e.handler.state,e.index)}),this.addAction("clearWaypoints",function(e,t){var e=null!=t?t:e,n=r.getSelectionCells();if(null!=n){n=r.getEditableCells(r.addAllEdges(n)),r.getModel().beginUpdate();try{for(var l=0;l<n.length;l++){var i,o=n[l];r.getModel().isEdge(o)&&(i=r.getCellGeometry(o),mxEvent.isShiftDown(e)?(r.setCellStyles(mxConstants.STYLE_EXIT_X,null,[o]),r.setCellStyles(mxConstants.STYLE_EXIT_Y,null,[o]),r.setCellStyles(mxConstants.STYLE_ENTRY_X,null,[o]),r.setCellStyles(mxConstants.STYLE_ENTRY_Y,null,[o])):null!=i&&((i=i.clone()).points=null,i.x=0,i.y=0,i.offset=null,r.getModel().setGeometry(o,i)))}}finally{r.getModel().endUpdate()}}},null,null,"Alt+Shift+C"),t=this.addAction("subscript",mxUtils.bind(this,function(){r.cellEditor.isContentEditing()&&document.execCommand("subscript",!1,null)}),null,null,Editor.ctrlKey+"+,"),t=this.addAction("superscript",mxUtils.bind(this,function(){r.cellEditor.isContentEditing()&&document.execCommand("superscript",!1,null)}),null,null,Editor.ctrlKey+"+."),this.addAction("image...",function(){var e,t,n,c;r.isEnabled()&&!r.isCellLocked(r.getDefaultParent())&&(e=mxResources.get("image")+" ("+mxResources.get("url")+"):",n="",null!=(t=r.getView().getState(r.getSelectionCell()))&&(n=t.style[mxConstants.STYLE_IMAGE]||n),c=r.cellEditor.saveSelection(),a.showImageDialog(e,n,function(e,t,n){if(console.log("加载图片回调"),r.cellEditor.isContentEditing())r.cellEditor.restoreSelection(c),r.insertImage(e,t,n);else{var l=r.getSelectionCells();if(null!=e&&(0<e.length||0<l.length)){var i,o=null;r.getModel().beginUpdate();try{0==l.length&&(l=[r.insertVertex(r.getDefaultParent(),null,"",0,0,t,n,"shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;")],i=r.getCenterInsertPoint(r.getBoundingBoxFromGeometry(l,!0)),l[0].geometry.x=i.x,l[0].geometry.y=i.y,o=l,r.fireEvent(new mxEventObject("cellsInserted","cells",o))),r.setCellStyles(mxConstants.STYLE_IMAGE,0<e.length?e:null,l);var s,a,d=r.getCurrentCellStyle(l[0]);"image"!=d[mxConstants.STYLE_SHAPE]&&"label"!=d[mxConstants.STYLE_SHAPE]?r.setCellStyles(mxConstants.STYLE_SHAPE,"image",l):0==e.length&&r.setCellStyles(mxConstants.STYLE_SHAPE,null,l),1==r.getSelectionCount()&&null!=t&&null!=n&&(s=l[0],null!=(a=r.getModel().getGeometry(s))&&((a=a.clone()).width=t,a.height=n,r.getModel().setGeometry(s,a)))}finally{r.getModel().endUpdate()}null!=o&&(r.setSelectionCells(o),r.scrollCellToVisible(o[0]),console.log(o))}}},r.cellEditor.isContentEditing(),!r.cellEditor.isContentEditing()))}).isEnabled=e,(t=this.addAction("layers",mxUtils.bind(this,function(){null==this.layersWindow?(this.layersWindow=new LayersWindow(a,document.body.offsetWidth-280,120,212,200),this.layersWindow.window.addListener("show",mxUtils.bind(this,function(){a.fireEvent(new mxEventObject("layers")),this.layersWindow.window.fit()})),this.layersWindow.window.addListener("hide",function(){a.fireEvent(new mxEventObject("layers"))}),this.layersWindow.window.setVisible(!0),a.fireEvent(new mxEventObject("layers")),this.layersWindow.init()):this.layersWindow.window.setVisible(!this.layersWindow.window.isVisible())}),null,null,Editor.ctrlKey+"+Shift+L")).setToggleAction(!0),t.setSelectedCallback(mxUtils.bind(this,function(){return null!=this.layersWindow&&this.layersWindow.window.isVisible()})),(t=this.addAction("formatPanel",mxUtils.bind(this,function(){a.toggleFormatPanel()}),null,null,Editor.ctrlKey+"+Shift+P")).setToggleAction(!0),t.setSelectedCallback(mxUtils.bind(this,function(){return 0<a.formatWidth})),(t=this.addAction("outline",mxUtils.bind(this,function(){null==this.outlineWindow?(this.outlineWindow=new OutlineWindow(a,document.body.offsetWidth-260,100,180,180),this.outlineWindow.window.addListener("show",mxUtils.bind(this,function(){a.fireEvent(new mxEventObject("outline")),this.outlineWindow.window.fit()})),this.outlineWindow.window.addListener("hide",function(){a.fireEvent(new mxEventObject("outline"))}),this.outlineWindow.window.setVisible(!0),a.fireEvent(new mxEventObject("outline"))):this.outlineWindow.window.setVisible(!this.outlineWindow.window.isVisible())}),null,null,Editor.ctrlKey+"+Shift+O")).setToggleAction(!0),t.setSelectedCallback(mxUtils.bind(this,function(){return null!=this.outlineWindow&&this.outlineWindow.window.isVisible()}))},Actions.prototype.addAction=function(e,t,n,l,i){var o="..."==e.substring(e.length-3)?(e=e.substring(0,e.length-3),mxResources.get(e)+"..."):mxResources.get(e);return this.put(e,new Action(o,t,n,l,i))},Actions.prototype.put=function(e,t){return this.actions[e]=t},Actions.prototype.get=function(e){return this.actions[e]},mxUtils.extend(Action,mxEventSource),Action.prototype.createFunction=function(e){return e},Action.prototype.setEnabled=function(e){this.enabled!=e&&(this.enabled=e,this.fireEvent(new mxEventObject("stateChanged")))},Action.prototype.isEnabled=function(){return this.enabled},Action.prototype.setToggleAction=function(e){this.toggleAction=e},Action.prototype.setSelectedCallback=function(e){this.selectedCallback=e},Action.prototype.isSelected=function(){return this.selectedCallback()};