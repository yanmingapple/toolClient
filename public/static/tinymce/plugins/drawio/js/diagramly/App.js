App=function(t,e,i){if(console.log("App()"),EditorUi.call(this,t,e,null!=i?i:"1"==urlParams.lightbox||"min"==uiTheme&&"0"!=urlParams.chrome),mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||(window.onunload=mxUtils.bind(this,function(){var t,e=this.getCurrentFile();null!=e&&e.isModified()&&(t={category:"DISCARD-FILE-"+e.getHash(),action:(e.savingFile?"saving":"")+(e.savingFile&&null!=e.savingFileTime?"_"+Math.round((Date.now()-e.savingFileTime.getTime())/1e3):"")+(null!=e.saveLevel?"-sl_"+e.saveLevel:"")+"-age_"+(null!=e.ageStart?Math.round((Date.now()-e.ageStart.getTime())/1e3):"x")+(this.editor.autosave?"":"-nosave")+(e.isAutosave()?"":"-noauto")+"-open_"+(null!=e.opened?Math.round((Date.now()-e.opened.getTime())/1e3):"x")+"-save_"+(null!=e.lastSaved?Math.round((Date.now()-e.lastSaved.getTime())/1e3):"x")+"-change_"+(null!=e.lastChanged?Math.round((Date.now()-e.lastChanged.getTime())/1e3):"x")+"-alive_"+Math.round((Date.now()-App.startTime.getTime())/1e3),label:null!=e.sync?"client_"+e.sync.clientId:"nosync"},e.constructor==DriveFile&&null!=e.desc&&null!=this.drive&&(t.label+=(null!=this.drive.user?"-user_"+this.drive.user.id:"-nouser")+"-rev_"+e.desc.headRevisionId+"-mod_"+e.desc.modifiedDate+"-size_"+e.getSize()+"-mime_"+e.desc.mimeType),EditorUi.logEvent(t))})),this.editor.addListener("autosaveChanged",mxUtils.bind(this,function(){var t=this.getCurrentFile();null!=t&&EditorUi.logEvent({category:(this.editor.autosave?"ON":"OFF")+"-AUTOSAVE-FILE-"+t.getHash(),action:"changed",label:"autosave_"+(this.editor.autosave?"on":"off")})})),mxClient.IS_SVG?mxGraph.prototype.warningImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAE7SURBVHjaYvz//z8DJQAggBjwGXDuHMP/tWuD/uPTCxBAOA0AaQRK/f/+XeJ/cbHlf1wGAAQQTgPu3QNLgfHSpZo4DQAIIKwGwGyH4e/fFbG6AiQJEEAs2Ew2NFzH8OOHBMO6dT/A/KCg7wxGRh+wuhQggDBcALMdFIAcHBxgDGJjcwVIIUAAYbhAUXEdVos4OO4DXcGBIQ4QQCguQPY7sgtgAYruCpAgQACx4LJdU1OCwctLEcyWlLwPJF+AXQE0EMUBAAEEdwF6yMOiD4RRY0QT7gqQAEAAseDzu6XldYYPH9DD4joQa8L5AAEENgWb7SBcXa0JDQMBrK4AcQACiAlfyOMCEFdAnAYQQEz4FLa0XGf4/v0H0IIPONUABBAjyBmMjIwMS5cK/L927QORbtBkaG29DtYLEGAAH6f7oq3Zc+kAAAAASUVORK5CYII=":(new Image).src=mxGraph.prototype.warningImage.src,window.openWindow=mxUtils.bind(this,function(t,e,i){if("1"==urlParams.openInSameWin||navigator.standalone)i();else{var n=null;try{n=window.open(t)}catch(t){}null==n||void 0===n?this.showDialog(new PopupDialog(this,t,e,i).container,320,140,!0,!0):null!=e&&e()}}),this.updateDocumentTitle(),this.updateUi(),window.showOpenAlert=mxUtils.bind(this,function(t){null!=window.openFile&&window.openFile.cancel(!0),this.handleError(t)}),this.editor.chromeless&&!this.editor.editable||this.addFileDropHandler([document]),null!=App.DrawPlugins){for(var n=0;n<App.DrawPlugins.length;n++)try{App.DrawPlugins[n](this)}catch(t){null!=window.console&&console.log("Plugin Error:",t,App.DrawPlugins[n])}finally{App.embedModePluginsCount--,this.initializeEmbedMode()}window.Draw.loadPlugin=mxUtils.bind(this,function(t){try{t(this)}finally{App.embedModePluginsCount--,this.initializeEmbedMode()}}),setTimeout(mxUtils.bind(this,function(){0<App.embedModePluginsCount&&(App.embedModePluginsCount=0,this.initializeEmbedMode())}),5e3)}this.toggleCompactMode(),this.load()},App.ERROR_TIMEOUT="timeout",App.ERROR_BUSY="busy",App.ERROR_UNKNOWN="unknown",App.MODE_GOOGLE="google",App.MODE_DROPBOX="dropbox",App.MODE_ONEDRIVE="onedrive",App.MODE_GITHUB="github",App.MODE_GITLAB="gitlab",App.MODE_DEVICE="device",App.MODE_BROWSER="browser",App.MODE_TRELLO="trello",App.MODE_NOTION="notion",App.MODE_EMBED="embed",App.MODE_ATLAS="atlas",App.DROPBOX_APPKEY=window.DRAWIO_DROPBOX_ID,App.DROPBOX_URL=window.DRAWIO_BASE_URL+"/js/dropbox/Dropbox-sdk.min.js",App.DROPINS_URL="https://www.dropbox.com/static/api/2/dropins.js",App.ONEDRIVE_URL=mxClient.IS_IE11?"https://js.live.net/v7.2/OneDrive.js":window.DRAWIO_BASE_URL+"/js/onedrive/OneDrive.js",App.TRELLO_URL="https://api.trello.com/1/client.js",App.TRELLO_JQUERY_URL=window.DRAWIO_BASE_URL+"/js/jquery/jquery-3.3.1.min.js",App.PUSHER_KEY="1e756b07a690c5bdb054",App.PUSHER_CLUSTER="eu",App.PUSHER_URL="https://js.pusher.com/4.3/pusher.min.js",App.SOCKET_IO_URL=window.DRAWIO_BASE_URL+"/js/socket.io/socket.io.min.js",App.SIMPLE_PEER_URL=window.DRAWIO_BASE_URL+"/js/socket.io/simplepeer9.10.0.min.js",App.SOCKET_IO_SRV="http://localhost:3030",App.GOOGLE_APIS="drive-share",App.startTime=new Date,App.pluginRegistry={"4xAKTrabTpTzahoLthkwPNUn":"plugins/explore.js",ex:"plugins/explore.js",p1:"plugins/p1.js",ac:"plugins/connect.js",acj:"plugins/connectJira.js",ac148:"plugins/cConf-1-4-8.js",ac148cmnt:"plugins/cConf-comments.js",voice:"plugins/voice.js",tips:"plugins/tooltips.js",svgdata:"plugins/svgdata.js",electron:"plugins/electron.js",number:"plugins/number.js",sql:"plugins/sql.js",props:"plugins/props.js",text:"plugins/text.js",anim:"plugins/animation.js",update:"plugins/update.js",trees:"plugins/trees/trees.js",import:"plugins/import.js",replay:"plugins/replay.js",anon:"plugins/anonymize.js",tr:"plugins/trello.js",f5:"plugins/rackF5.js",tickets:"plugins/tickets.js",flow:"plugins/flow.js",webcola:"plugins/webcola/webcola.js",rnd:"plugins/random.js",page:"plugins/page.js",gd:"plugins/googledrive.js",tags:"plugins/tags.js"},App.publicPlugin=["ex","voice","tips","svgdata","number","sql","props","text","anim","update","trees","replay","anon","tickets","flow","webcola","tags"],App.loadScripts=function(t,e){for(var i=t.length,n=0;n<i;n++)mxscript(t[n],function(){0==--i&&null!=e&&e()})},App.getStoredMode=function(){var t=null;if(null==(t=null==t&&isLocalStorage?localStorage.getItem(".mode"):t)&&"undefined"!=typeof Storage){for(var e,i=document.cookie.split(";"),n=0;n<i.length;n++){var s=mxUtils.trim(i[n]);if("MODE="==s.substring(0,5)){t=s.substring(5);break}}null!=t&&isLocalStorage&&((e=new Date).setYear(e.getFullYear()-1),document.cookie="MODE=; expires="+e.toUTCString(),localStorage.setItem(".mode",t))}return t},mxClient.IS_CHROMEAPP||("1"!=urlParams.offline&&("db.draw.io"==window.location.hostname&&null==urlParams.mode&&(urlParams.mode="dropbox"),App.mode=urlParams.mode),null==App.mode&&(App.mode=App.getStoredMode()),null!=window.mxscript&&"1"!=urlParams.embed&&("function"==typeof window.DriveClient&&("0"!=urlParams.gapi&&isSvgBrowser&&(null==document.documentMode||10<=document.documentMode)?App.mode==App.MODE_GOOGLE||null!=urlParams.state&&""==window.location.hash||null!=window.location.hash&&"#G"==window.location.hash.substring(0,2)?mxscript("https://apis.google.com/js/api.js"):"0"!=urlParams.chrome||null!=window.location.hash&&"#Uhttps%3A%2F%2Fdrive.google.com%2Fuc%3Fid%3D"===window.location.hash.substring(0,45)||(window.DriveClient=null):window.DriveClient=null),"function"==typeof window.DropboxClient&&("0"!=urlParams.db&&isSvgBrowser&&(null==document.documentMode||9<document.documentMode)?App.mode==App.MODE_DROPBOX||null!=window.location.hash&&"#D"==window.location.hash.substring(0,2)?mxscript(App.DROPBOX_URL,function(){mxscript(App.DROPINS_URL,null,"dropboxjs",App.DROPBOX_APPKEY,!0)}):"0"==urlParams.chrome&&(window.DropboxClient=null):window.DropboxClient=null),"function"==typeof window.OneDriveClient&&("0"!=urlParams.od&&(null==navigator.userAgent||navigator.userAgent.indexOf("MSIE")<0||10<=document.documentMode)?App.mode==App.MODE_ONEDRIVE||null!=window.location.hash&&"#W"==window.location.hash.substring(0,2)?mxscript(App.ONEDRIVE_URL):"0"==urlParams.chrome&&(window.OneDriveClient=null):window.OneDriveClient=null),"function"==typeof window.TrelloClient&&("1"==urlParams.tr&&isSvgBrowser&&!mxClient.IS_IE11&&(null==document.documentMode||10<=document.documentMode)?App.mode==App.MODE_TRELLO||null!=window.location.hash&&"#T"==window.location.hash.substring(0,2)?mxscript(App.TRELLO_JQUERY_URL,function(){mxscript(App.TRELLO_URL)}):"0"==urlParams.chrome&&(window.TrelloClient=null):window.TrelloClient=null))),App.clearServiceWorker=function(i){navigator.serviceWorker.getRegistrations().then(function(t){if(null!=t&&0<t.length){for(var e=0;e<t.length;e++)t[e].unregister();null!=i&&i()}})},App.main=function(r,a){if(window.onerror=function(t,e,i,n,s){EditorUi.logError("Global: "+(null!=t?t:""),e,i,n,s,null,!0)},window.top==window.self&&(/ac\.draw\.io$/.test(window.location.hostname)||/ac-ent\.draw\.io$/.test(window.location.hostname)||/aj\.draw\.io$/.test(window.location.hostname)))document.body.innerHTML='<div style="margin-top:10%;text-align:center;">Stand-alone mode not allowed for this domain.</div>';else{var t,e;if("1"!=urlParams.embed&&"1"!=urlParams.lightbox||null!=(t=document.getElementById("geInfo"))&&t.parentNode.removeChild(t),null!=document.referrer&&"aws3"==urlParams.libs&&"https://aws.amazon.com/architecture/icons/"==document.referrer.substring(0,42)&&(urlParams.libs="aws4"),null!=window.mxscript){"1"==urlParams.dev&&null!=CryptoJS&&App.mode!=App.MODE_DROPBOX&&App.mode!=App.MODE_TRELLO&&(null!=(t=document.getElementsByTagName("script"))&&0<t.length&&(e=mxUtils.getTextContent(t[0]),"b02227617087e21bd49f2faa15164112"!=CryptoJS.MD5(e).toString()&&console.log("Change bootstrap script MD5 in the previous line:",CryptoJS.MD5(e).toString())),null!=t&&1<t.length&&(e=mxUtils.getTextContent(t[t.length-1]),"d53805dd6f0bbba2da4966491ca0a505"!=CryptoJS.MD5(e).toString()&&console.log("Change main script MD5 in the previous line:",CryptoJS.MD5(e).toString())));try{Editor.enableServiceWorker&&("0"==urlParams.offline||/www\.draw\.io$/.test(window.location.hostname)||"1"!=urlParams.offline&&"1"==urlParams.dev)?App.clearServiceWorker(function(){"0"==urlParams.offline&&alert("Cache cleared")}):Editor.enableServiceWorker&&navigator.serviceWorker.register("/service-worker.js")}catch(t){null!=window.console&&console.error(t)}if(!("ArrayBuffer"in window)||mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||"auto"!=DrawioFile.SYNC||"1"==urlParams.embed&&"1"!=urlParams.embedRT||"1"==urlParams.local||"0"==urlParams.chrome&&"1"!=urlParams.rt||"1"==urlParams.stealth||"1"==urlParams.offline||(mxscript(App.PUSHER_URL),"1"==urlParams.rtCursors&&(mxscript(App.SOCKET_IO_URL),mxscript(App.SIMPLE_PEER_URL))),"0"!=urlParams.plugins&&"1"!=urlParams.offline){var i=null!=mxSettings.settings?mxSettings.getPlugins():null;if(null==mxSettings.settings&&isLocalStorage&&"undefined"!=typeof JSON)try{null!=(n=JSON.parse(localStorage.getItem(mxSettings.key)))&&(i=n.plugins)}catch(t){}var n=urlParams.p;if(App.initPluginCallback(),null!=n&&App.loadPlugins(n.split(";")),null!=i&&0<i.length&&"0"!=urlParams.plugins){for(var s=window.location.protocol+"//"+window.location.host,l=!0,o=0;o<i.length&&l;o++)"/"!=i[o].charAt(0)&&i[o].substring(0,s.length)!=s&&(l=!1);if(l||mxUtils.confirm(mxResources.replacePlaceholders("The page has requested to load the following plugin(s):\n \n {1}\n \n Would you like to load these plugin(s) now?\n \n NOTE : Only allow plugins to run if you fully understand the security implications of doing so.\n",[i.join("\n")]).replace(/\\n/g,"\n")))for(o=0;o<i.length;o++)try{null==App.pluginsLoaded[i[o]]&&(App.pluginsLoaded[i[o]]=!0,App.embedModePluginsCount++,"/"==i[o].charAt(0)&&(i[o]=PLUGINS_BASE_PATH+i[o]),mxscript(i[o]))}catch(t){}}}"function"==typeof window.DriveClient&&"undefined"==typeof gapi&&("1"!=urlParams.embed&&"0"!=urlParams.gapi||"1"==urlParams.embed&&"1"==urlParams.gapi)&&isSvgBrowser&&isLocalStorage&&(null==document.documentMode||10<=document.documentMode)?mxscript("https://apis.google.com/js/api.js?onload=DrawGapiClientCallback",null,null,null,mxClient.IS_SVG):void 0===window.gapi&&(window.DriveClient=null)}if("0"!=urlParams.math&&Editor.initMath(),"1"==urlParams.configure){function u(e){if(e.source==h)try{var t=JSON.parse(e.data);null!=t&&"configure"==t.action&&(mxEvent.removeListener(window,"message",u),Editor.configure(t.config,!0),mxSettings.load(),p())}catch(t){null!=window.console&&console.log("Error in configure message: "+t,e.data)}}var h=window.opener||window.parent;mxEvent.addListener(window,"message",u),h.postMessage(JSON.stringify({event:"configure"}),"*")}else{if(null==Editor.config){if(null!=window.DRAWIO_CONFIG)try{EditorUi.debug("Using global configuration",window.DRAWIO_CONFIG),Editor.configure(window.DRAWIO_CONFIG),mxSettings.load()}catch(t){null!=window.console&&console.error(t)}if(isLocalStorage&&null!=localStorage&&"1"!=urlParams.embed){n=localStorage.getItem(Editor.configurationKey);if(null!=n)try{null!=(n=JSON.parse(n))&&(EditorUi.debug("Using local configuration",n),Editor.configure(n),mxSettings.load())}catch(t){null!=window.console&&console.error(t)}}}p()}}function d(t){mxUtils.getAll("1"!=urlParams.dev?[t]:[t,STYLE_PATH+"/default.xml",STYLE_PATH+"/dark-default.xml"],function(t){if(mxResources.parse(t[0].getText()),isLocalStorage&&null!=localStorage&&null!=window.location.hash&&"#_CONFIG_"==window.location.hash.substring(0,9))try{var i={};for(s in App.pluginRegistry)i[App.pluginRegistry[s]]=!0;var e=JSON.parse(Graph.decompress(window.location.hash.substring(9)));if(null!=e&&function(t){if(null!=t)for(var e=0;e<t.length;e++)if(!i[t[e]])throw new Error(mxResources.get("invalidInput")+' "'+t[e])+'"';return 1}(e.plugins)){if(EditorUi.debug("Setting configuration",JSON.stringify(e)),null!=e.merge){var n=localStorage.getItem(Editor.configurationKey);if(null!=n)try{var s,l=JSON.parse(n);for(s in e.merge)l[s]=e.merge[s];e=l}catch(t){window.location.hash="",alert(t)}else e=e.merge}confirm(mxResources.get("configLinkWarn"))&&confirm(mxResources.get("configLinkConfirm"))&&(localStorage.setItem(Editor.configurationKey,JSON.stringify(e)),window.location.hash="",window.location.reload())}window.location.hash=""}catch(t){window.location.hash="",alert(t)}function o(){var t=null!=a?a():new App(new Editor("0"==urlParams.chrome||"min"==uiTheme,null,null,null,"0"!=urlParams.chrome));null!=window.mxscript&&("function"==typeof window.DropboxClient&&null==window.Dropbox&&null!=window.DrawDropboxClientCallback&&("1"!=urlParams.embed&&"0"!=urlParams.db||"1"==urlParams.embed&&"1"==urlParams.db)&&isSvgBrowser&&(null==document.documentMode||9<document.documentMode)?mxscript(App.DROPBOX_URL,function(){mxscript(App.DROPINS_URL,function(){DrawDropboxClientCallback()},"dropboxjs",App.DROPBOX_APPKEY)}):void 0!==window.Dropbox&&void 0!==window.Dropbox.choose||(window.DropboxClient=null),"function"==typeof window.OneDriveClient&&"undefined"==typeof OneDrive&&null!=window.DrawOneDriveClientCallback&&("1"!=urlParams.embed&&"0"!=urlParams.od||"1"==urlParams.embed&&"1"==urlParams.od)&&(null==navigator.userAgent||navigator.userAgent.indexOf("MSIE")<0||10<=document.documentMode)?mxscript(App.ONEDRIVE_URL,window.DrawOneDriveClientCallback):void 0===window.OneDrive&&(window.OneDriveClient=null),"function"==typeof window.TrelloClient&&!mxClient.IS_IE11&&void 0===window.Trello&&null!=window.DrawTrelloClientCallback&&"1"==urlParams.tr&&(null==navigator.userAgent||navigator.userAgent.indexOf("MSIE")<0||10<=document.documentMode)?mxscript(App.TRELLO_JQUERY_URL,function(){mxscript(App.TRELLO_URL,function(){DrawTrelloClientCallback()})}):void 0===window.Trello&&(window.TrelloClient=null)),null!=r&&r(t),"0"!=urlParams.chrome&&"1"==urlParams.test&&(EditorUi.debug("App.start",[t,(new Date).getTime()-t0.getTime()+"ms"]),null!=urlParams.export&&EditorUi.debug("Export:",EXPORT_URL))}2<t.length&&(Graph.prototype.defaultThemes["default-style2"]=t[1].getDocumentElement(),Graph.prototype.defaultThemes.darkTheme=t[2].getDocumentElement()),"1"==urlParams.dev||EditorUi.isElectronApp?o():(mxStencilRegistry.allowEval=!1,App.loadScripts(["js/shapes-14-6-5.min.js","js/stencils.min.js","js/extensions.min.js"],o))},function(t){var e=document.getElementById("geStatus");null!=e&&(e.innerHTML="Error loading page. <a>Please try refreshing.</a>",e.getElementsByTagName("a")[0].onclick=function(){mxLanguage="en",d(mxResources.getDefaultBundle(RESOURCE_BASE,mxLanguage)||mxResources.getSpecialBundle(RESOURCE_BASE,mxLanguage))})})}function p(){try{var t;null!=mxSettings.settings&&(document.body.style.backgroundColor="dark"==uiTheme||mxSettings.settings.darkMode?Editor.darkColor:"#ffffff",null!=mxSettings.settings.autosaveDelay&&(t=parseInt(mxSettings.settings.autosaveDelay),!isNaN(t)&&0<t?(DrawioFile.prototype.autosaveDelay=t,EditorUi.debug("Setting autosaveDelay",t)):EditorUi.debug("Invalid autosaveDelay",t)),null!=mxSettings.settings.defaultEdgeLength&&(t=parseInt(mxSettings.settings.defaultEdgeLength),!isNaN(t)&&0<t?(Graph.prototype.defaultEdgeLength=t,EditorUi.debug("Using defaultEdgeLength",t)):EditorUi.debug("Invalid defaultEdgeLength",t)))}catch(t){null!=window.console&&console.error(t)}if(null!=Menus.prototype.defaultFonts)for(var e=0;e<Menus.prototype.defaultFonts.length;e++){var i=Menus.prototype.defaultFonts[e];"string"!=typeof i&&null!=i.fontFamily&&null!=i.fontUrl&&Graph.addFont(i.fontFamily,i.fontUrl)}mxResources.loadDefaultBundle=!1,d(mxResources.getDefaultBundle(RESOURCE_BASE,mxLanguage)||mxResources.getSpecialBundle(RESOURCE_BASE,mxLanguage))}},mxUtils.extend(App,EditorUi),App.prototype.defaultUserPicture=IMAGE_PATH+"/default-user.jpg",App.prototype.shareImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowOTgwMTE3NDA3MjA2ODExODhDNkFGMDBEQkQ0RTgwOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoxMjU2NzdEMTcwRDIxMUUxQjc0MDkxRDhCNUQzOEFGRCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxMjU2NzdEMDcwRDIxMUUxQjc0MDkxRDhCNUQzOEFGRCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowNjgwMTE3NDA3MjA2ODExODcxRkM4MUY1OTFDMjQ5OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowNzgwMTE3NDA3MjA2ODExODhDNkFGMDBEQkQ0RTgwOSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PrM/fs0AAADgSURBVHjaYmDAA/7//88MwgzkAKDGFiD+BsQ/QWxSNaf9RwN37twpI8WAS+gGfP78+RpQSoRYA36iG/D379+vQClNdLVMOMz4gi7w79+/n0CKg1gD9qELvH379hzIHGK9oA508ieY8//8+fO5rq4uFCilRKwL1JmYmNhhHEZGRiZ+fn6Q2meEbDYG4u3/cYCfP38uA7kOm0ZOIJ7zn0jw48ePPiDFhmzArv8kgi9fvuwB+w5qwH9ykjswbFSZyM4sEMDPBDTlL5BxkFSd7969OwZ2BZKYGhDzkmjOJ4AAAwBhpRqGnEFb8QAAAABJRU5ErkJggg==",App.prototype.chevronUpImage=mxClient.IS_SVG?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDg2NEE3NUY1MUVBMTFFM0I3MUVEMTc0N0YyOUI4QzEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NDg2NEE3NjA1MUVBMTFFM0I3MUVEMTc0N0YyOUI4QzEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0ODY0QTc1RDUxRUExMUUzQjcxRUQxNzQ3RjI5QjhDMSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo0ODY0QTc1RTUxRUExMUUzQjcxRUQxNzQ3RjI5QjhDMSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pg+qUokAAAAMUExURQAAANnZ2b+/v////5bgre4AAAAEdFJOU////wBAKqn0AAAAL0lEQVR42mJgRgMMRAswMKAKMDDARBjg8lARBoR6KImkH0wTbygT6YaS4DmAAAMAYPkClOEDDD0AAAAASUVORK5CYII=":IMAGE_PATH+"/chevron-up.png",App.prototype.chevronDownImage=mxClient.IS_SVG?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDg2NEE3NUI1MUVBMTFFM0I3MUVEMTc0N0YyOUI4QzEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NDg2NEE3NUM1MUVBMTFFM0I3MUVEMTc0N0YyOUI4QzEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0ODY0QTc1OTUxRUExMUUzQjcxRUQxNzQ3RjI5QjhDMSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo0ODY0QTc1QTUxRUExMUUzQjcxRUQxNzQ3RjI5QjhDMSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PsCtve8AAAAMUExURQAAANnZ2b+/v////5bgre4AAAAEdFJOU////wBAKqn0AAAALUlEQVR42mJgRgMMRAkwQEXBNAOcBSPhclB1cNVwfcxI+vEZykSpoSR6DiDAAF23ApT99bZ+AAAAAElFTkSuQmCC":IMAGE_PATH+"/chevron-down.png",App.prototype.formatShowImage=mxClient.IS_SVG?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODdCREY5REY1NkQ3MTFFNTkyNjNEMTA5NjgwODUyRTgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6ODdCREY5RTA1NkQ3MTFFNTkyNjNEMTA5NjgwODUyRTgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4N0JERjlERDU2RDcxMUU1OTI2M0QxMDk2ODA4NTJFOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4N0JERjlERTU2RDcxMUU1OTI2M0QxMDk2ODA4NTJFOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PlnMQ/8AAAAJUExURQAAAP///3FxcTfTiAsAAAACdFJOU/8A5bcwSgAAACFJREFUeNpiYEQDDEQJMMABTAAixcQ00ALoDiPRcwABBgB6DADly9Yx8wAAAABJRU5ErkJggg==":IMAGE_PATH+"/format-show.png",App.prototype.formatHideImage=mxClient.IS_SVG?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODdCREY5REI1NkQ3MTFFNTkyNjNEMTA5NjgwODUyRTgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6ODdCREY5REM1NkQ3MTFFNTkyNjNEMTA5NjgwODUyRTgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4N0JERjlEOTU2RDcxMUU1OTI2M0QxMDk2ODA4NTJFOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4N0JERjlEQTU2RDcxMUU1OTI2M0QxMDk2ODA4NTJFOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqjT9SMAAAAGUExURQAAAP///6XZn90AAAACdFJOU/8A5bcwSgAAAB9JREFUeNpiYEQDDEQJMMABTAAmNdAC6A4j0XMAAQYAcbwA1Xvj1CgAAAAASUVORK5CYII=":IMAGE_PATH+"/format-hide.png",App.prototype.fullscreenImage=mxClient.IS_SVG?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAAAAAClZ7nPAAAAAXRSTlMAQObYZgAAABpJREFUCNdjgAAbGxAy4AEh5gNwBBGByoIBAIueBd12TUjqAAAAAElFTkSuQmCC":IMAGE_PATH+"/fullscreen.png",App.prototype.warnInterval=3e5,App.prototype.compactMode=!1,App.prototype.fullscreenMode=!1,"1"!=urlParams.embed?App.prototype.menubarHeight=64:App.prototype.footerHeight=0,App.initPluginCallback=function(){null==App.DrawPlugins&&(App.DrawPlugins=[],window.Draw=new Object,window.Draw.loadPlugin=function(t){App.DrawPlugins.push(t)})},App.pluginsLoaded={},App.embedModePluginsCount=0,App.loadPlugins=function(e,t){EditorUi.debug("Loading plugins",e);for(var i=0;i<e.length;i++)if(null!=e[i]&&0<e[i].length)try{var n=PLUGINS_BASE_PATH+App.pluginRegistry[e[i]];null!=n?null==App.pluginsLoaded[n]&&(App.pluginsLoaded[n]=!0,App.embedModePluginsCount++,void 0===window.drawDevUrl?(t?mxinclude:mxscript)(n):t?mxinclude(n):mxscript(drawDevUrl+n)):null!=window.console&&console.log("Unknown plugin:",e[i])}catch(t){null!=window.console&&console.log("Error loading plugin:",e[i],t)}},App.prototype.initializeEmbedMode=function(){"1"==urlParams.embed&&("app.diagrams.net"==window.location.hostname&&this.showBanner("EmbedDeprecationFooter","app.diagrams.net will stop working for embed mode. Please use embed.diagrams.net."),0<App.embedModePluginsCount||this.initEmbedDone||(this.initEmbedDone=!0,EditorUi.prototype.initializeEmbedMode.apply(this,arguments)))},App.prototype.initializeViewerMode=function(){var t=window.opener||window.parent;null!=t&&this.editor.graph.addListener(mxEvent.SIZE,mxUtils.bind(this,function(){t.postMessage(JSON.stringify(this.createLoadMessage("size")),"*")}))},App.prototype.init=function(){var t,e,i,n,s;console.log("App.init()"),EditorUi.prototype.init.apply(this,arguments),this.defaultLibraryName=mxResources.get("untitledLibrary"),this.descriptorChangedListener=mxUtils.bind(this,this.descriptorChanged),this.gitHub=mxClient.IS_IE&&10!=document.documentMode&&!mxClient.IS_IE11&&!mxClient.IS_EDGE||"0"==urlParams.gh||"1"==urlParams.embed&&"1"!=urlParams.gh?null:new GitHubClient(this),null!=this.gitHub&&this.gitHub.addListener("userChanged",mxUtils.bind(this,function(){this.updateUserElement(),this.restoreLibraries(),this.showBanner("GithubFooter","Click to install GitHub app",mxUtils.bind(this,function(){this.openLink("https://github.com/apps/draw-io-app")}))})),this.gitLab=mxClient.IS_IE&&10!=document.documentMode&&!mxClient.IS_IE11&&!mxClient.IS_EDGE||"0"==urlParams.gl||"1"==urlParams.embed&&"1"!=urlParams.gl?null:new GitLabClient(this),null!=this.gitLab&&this.gitLab.addListener("userChanged",mxUtils.bind(this,function(){this.updateUserElement(),this.restoreLibraries()})),this.notion="1"==urlParams.ntn?new NotionClient(this):null,null!=this.notion&&this.notion.addListener("userChanged",mxUtils.bind(this,function(){this.updateUserElement(),this.restoreLibraries()})),"1"==urlParams.embed&&"1"!=urlParams.od||(t=mxUtils.bind(this,function(){"undefined"!=typeof OneDrive?(this.oneDrive=new OneDriveClient(this),this.oneDrive.addListener("userChanged",mxUtils.bind(this,function(){this.updateUserElement(),this.restoreLibraries()})),this.fireEvent(new mxEventObject("clientLoaded","client",this.oneDrive))):null==window.DrawOneDriveClientCallback&&(window.DrawOneDriveClientCallback=t)}))(),"1"==urlParams.embed&&"1"!=urlParams.tr||(e=mxUtils.bind(this,function(){if(void 0!==window.Trello)try{this.trello=new TrelloClient(this),this.trello.addListener("userChanged",mxUtils.bind(this,function(){this.updateUserElement(),this.restoreLibraries()})),this.fireEvent(new mxEventObject("clientLoaded","client",this.trello))}catch(t){null!=window.console&&console.error(t)}else null==window.DrawTrelloClientCallback&&(window.DrawTrelloClientCallback=e)}))(),"1"==urlParams.embed&&"1"!=urlParams.gapi||(i=mxUtils.bind(this,function(){var t;"undefined"!=typeof gapi?(t=mxUtils.bind(this,function(){this.drive=new DriveClient(this),this.drive.addListener("userChanged",mxUtils.bind(this,function(){this.updateUserElement(),this.restoreLibraries(),this.checkLicense()})),this.fireEvent(new mxEventObject("clientLoaded","client",this.drive))}),null!=window.DrawGapiClientCallback?(gapi.load(("0"!=urlParams.picker?"picker,":"")+App.GOOGLE_APIS,t),window.DrawGapiClientCallback=null):t()):null==window.DrawGapiClientCallback&&(window.DrawGapiClientCallback=i)}))(),"1"==urlParams.embed&&"1"!=urlParams.db||(n=mxUtils.bind(this,function(){if("function"==typeof Dropbox&&void 0!==Dropbox.choose){window.DrawDropboxClientCallback=null;try{this.dropbox=new DropboxClient(this),this.dropbox.addListener("userChanged",mxUtils.bind(this,function(){this.updateUserElement(),this.restoreLibraries()})),this.fireEvent(new mxEventObject("clientLoaded","client",this.dropbox))}catch(t){null!=window.console&&console.error(t)}}else null==window.DrawDropboxClientCallback&&(window.DrawDropboxClientCallback=n)}))(),"1"!=urlParams.embed?(this.bg=this.createBackground(),document.body.appendChild(this.bg),this.diagramContainer.style.visibility="hidden",this.formatContainer.style.visibility="hidden",this.hsplit.style.display="none",this.sidebarContainer.style.display="none",this.sidebarFooterContainer.style.display="none","1"==urlParams.local?this.setMode(App.MODE_DEVICE):this.mode=App.mode,"serviceWorker"in navigator&&!this.editor.isChromelessView()&&(mxClient.IS_ANDROID||mxClient.IS_IOS)&&window.addEventListener("beforeinstallprompt",mxUtils.bind(this,function(t){this.showBanner("AddToHomeScreenFooter",mxResources.get("installApp"),function(){t.prompt()})})),mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||this.isOffline()||mxClient.IS_ANDROID||mxClient.IS_IOS||null!=urlParams.open||this.editor.chromeless&&!this.editor.editable||this.editor.addListener("fileLoaded",mxUtils.bind(this,function(){var t=this.getCurrentFile(),t=null!=t?t.getMode():null;"1"==urlParams.extAuth||t!=App.MODE_DEVICE&&t!=App.MODE_BROWSER?"1"!=urlParams.embed&&this.getServiceName():this.showDownloadDesktopBanner()})),mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||"1"==urlParams.embed||"auto"!=DrawioFile.SYNC||"1"==urlParams.local||"1"==urlParams.stealth||this.isOffline()||this.editor.chromeless&&!this.editor.editable||(s=window.setTimeout(mxUtils.bind(this,function(){DrawioFile.SYNC="manual";var t=this.getCurrentFile();null!=t&&null!=t.sync&&(t.sync.destroy(),t.sync=null,t=mxUtils.htmlEntities(mxResources.get("timeout")),this.editor.setStatus('<div title="'+t+'" class="geStatusAlert">'+t+"</div>")),EditorUi.logEvent({category:"TIMEOUT-CACHE-CHECK",action:"timeout",label:408})}),Editor.cacheTimeout),(new Date).getTime(),mxUtils.get(EditorUi.cacheUrl+"?alive",mxUtils.bind(this,function(t){window.clearTimeout(s)})))):null!=this.menubar&&(this.menubar.container.style.paddingTop="0px"),this.updateHeader(),null!=this.menubar&&(this.buttonContainer=document.createElement("div"),this.buttonContainer.style.display="inline-block",this.buttonContainer.style.paddingRight="48px",this.buttonContainer.style.position="absolute",this.buttonContainer.style.right="0px",this.menubar.container.appendChild(this.buttonContainer)),"atlas"!=uiTheme&&"1"!=urlParams.atlas||null==this.menubar||(null!=this.toggleElement&&(this.toggleElement.click(),this.toggleElement.style.display="none"),this.icon=document.createElement("img"),this.icon.setAttribute("src",IMAGE_PATH+"/logo-flat-small.png"),this.icon.setAttribute("title",mxResources.get("draw.io")),this.icon.style.padding="1"==urlParams.atlas?"7px":"6px",this.icon.style.cursor="pointer",mxEvent.addListener(this.icon,"click",mxUtils.bind(this,function(t){this.appIconClicked(t)})),this.menubar.container.insertBefore(this.icon,this.menubar.container.firstChild)),this.editor.graph.isViewer()&&this.initializeViewerMode()},App.prototype.scheduleSanityCheck=function(){mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||null!=this.sanityCheckThread||(this.sanityCheckThread=window.setTimeout(mxUtils.bind(this,function(){this.sanityCheckThread=null,this.sanityCheck()}),this.warnInterval))},App.prototype.stopSanityCheck=function(){null!=this.sanityCheckThread&&(window.clearTimeout(this.sanityCheckThread),this.sanityCheckThread=null)},App.prototype.sanityCheck=function(){var t,e,i=this.getCurrentFile();null!=i&&i.isModified()&&i.isAutosave()&&i.isOverdue()&&(e={category:"WARN-FILE-"+i.getHash(),action:(i.savingFile?"saving":"")+(i.savingFile&&null!=i.savingFileTime?"_"+Math.round((Date.now()-i.savingFileTime.getTime())/1e3):"")+(null!=i.saveLevel?"-sl_"+i.saveLevel:"")+"-age_"+(null!=i.ageStart?Math.round((Date.now()-i.ageStart.getTime())/1e3):"x")+(this.editor.autosave?"":"-nosave")+(i.isAutosave()?"":"-noauto")+"-open_"+(null!=i.opened?Math.round((Date.now()-i.opened.getTime())/1e3):"x")+"-save_"+(null!=i.lastSaved?Math.round((Date.now()-i.lastSaved.getTime())/1e3):"x")+"-change_"+(null!=i.lastChanged?Math.round((Date.now()-i.lastChanged.getTime())/1e3):"x")+"-alive_"+Math.round((Date.now()-App.startTime.getTime())/1e3),label:null!=i.sync?"client_"+i.sync.clientId:"nosync"},i.constructor==DriveFile&&null!=i.desc&&null!=this.drive&&(e.label+=(null!=this.drive.user?"-user_"+this.drive.user.id:"-nouser")+"-rev_"+i.desc.headRevisionId+"-mod_"+i.desc.modifiedDate+"-size_"+i.getSize()+"-mime_"+i.desc.mimeType),EditorUi.logEvent(e),t=mxResources.get("ensureDataSaved"),null!=i.lastSaved&&(null==(e=this.timeSince(i.lastSaved))&&(e=mxResources.get("lessThanAMinute")),t=mxResources.get("lastSaved",[e])),this.spinner.stop(),this.showError(mxResources.get("unsavedChanges"),t,mxResources.get("ignore"),mxUtils.bind(this,function(){this.hideDialog()}),null,mxResources.get("save"),mxUtils.bind(this,function(){this.stopSanityCheck(),this.actions.get(null!=this.mode&&i.isEditable()?"save":"saveAs").funct()}),null,null,360,120,null,mxUtils.bind(this,function(){this.scheduleSanityCheck()})))},App.prototype.isDriveDomain=function(){return"0"!=urlParams.drive&&("test.draw.io"==window.location.hostname||"www.draw.io"==window.location.hostname||"drive.draw.io"==window.location.hostname||"app.diagrams.net"==window.location.hostname||"jgraph.github.io"==window.location.hostname)},App.prototype.getPusher=function(){return null==this.pusher&&"function"==typeof window.Pusher&&(this.pusher=new Pusher(App.PUSHER_KEY,{cluster:App.PUSHER_CLUSTER,encrypted:!0})),this.pusher},App.prototype.showNameChangeBanner=function(){this.showBanner("DiagramsFooter","draw.io is now diagrams.net",mxUtils.bind(this,function(){this.openLink("https://www.diagrams.net/blog/move-diagrams-net")}))},App.prototype.showNameConfBanner=function(){this.showBanner("ConfFooter","Try draw.io for Confluence",mxUtils.bind(this,function(){this.openLink("https://marketplace.atlassian.com/apps/1210933/draw-io-diagrams-for-confluence")}),!0)},App.prototype.showDownloadDesktopBanner=function(){},App.prototype.showRatingBanner=function(){},App.prototype.checkLicense=function(){var t,n,e=this.drive.getUser(),i=null!=e?e.email:null;this.isOffline()||this.editor.chromeless||null==i||null==e.id||(t=i.lastIndexOf("@"),n=0<=t?i.substring(t+1):"",e=Editor.crc32(e.id),mxUtils.post("/license","domain="+encodeURIComponent(n)+"&id="+encodeURIComponent(e)+"&ts="+(new Date).getTime(),mxUtils.bind(this,function(t){try{var e,i;200<=t.getStatus()&&t.getStatus()<=299&&(0<(e=t.getText()).length&&(null!=(i=JSON.parse(e))&&this.handleLicense(i,n)))}catch(t){}})))},App.prototype.handleLicense=function(t,e){null!=t&&null!=t.plugins&&App.loadPlugins(t.plugins.split(";"),!0)},App.prototype.getEditBlankXml=function(){var t=this.getCurrentFile();return null!=t&&this.editor.isChromelessView()&&this.editor.graph.isLightboxView()?t.getData():this.getFileData(!0)},App.prototype.updateActionStates=function(){EditorUi.prototype.updateActionStates.apply(this,arguments),this.actions.get("revisionHistory").setEnabled(this.isRevisionHistoryEnabled())},App.prototype.addRecent=function(t){if(isLocalStorage&&null!=localStorage){var e=this.getRecent();if(null==e)e=[];else for(var i=0;i<e.length;i++)e[i].id==t.id&&e.splice(i,1);null!=e&&(e.unshift(t),e=e.slice(0,10),localStorage.setItem(".recent",JSON.stringify(e)))}},App.prototype.getRecent=function(){if(isLocalStorage&&null!=localStorage){try{var t=localStorage.getItem(".recent");if(null!=t)return JSON.parse(t)}catch(t){}return null}},App.prototype.resetRecent=function(t){if(isLocalStorage&&null!=localStorage)try{localStorage.removeItem(".recent")}catch(t){}},App.prototype.onBeforeUnload=function(){},App.prototype.updateDocumentTitle=function(){var t,e;this.editor.graph.isLightboxView()||(e=this.editor.appName,t=this.getCurrentFile(),this.isOfflineApp()&&(e+=" app"),null!=t&&(e=(null!=t.getTitle()?t.getTitle():this.defaultFilename)+" - "+e),document.title!=e&&(document.title=e,(e=this.editor.graph).invalidateDescendantsWithPlaceholders(e.model.getRoot()),e.view.validate()))},App.prototype.getThumbnail=function(t,e){var i=!1;try{var n=!0,s=window.setTimeout(mxUtils.bind(this,function(){n=!1,e(null)}),this.timeout),l=mxUtils.bind(this,function(t){window.clearTimeout(s),n&&e(t)});null==this.thumbImageCache&&(this.thumbImageCache=new Object);var o,r,a,u,h,d,p,c,m,g,b,w,A,x,f,E=this.editor.graph,y=E.backgroundImage,v=null!=E.themes&&"darkTheme"==E.defaultThemeName;null==this.pages||!v&&this.currentPage==this.pages[0]||(o=E.getGlobalVariable,(E=this.createTemporaryGraph(E.getStylesheet())).setBackgroundImage=this.editor.graph.setBackgroundImage,r=this.pages[0],this.currentPage==r?E.setBackgroundImage(y):null!=r.viewState&&null!=r.viewState&&(y=r.viewState.backgroundImage,E.setBackgroundImage(y)),E.getGlobalVariable=function(t){return"page"==t?r.getName():"pagenumber"==t?1:o.apply(this,arguments)},E.getGlobalVariable=o,document.body.appendChild(E.container),E.model.setRoot(r.root)),mxClient.IS_CHROMEAPP||this.useCanvasForExport?(this.editor.exportToCanvas(mxUtils.bind(this,function(e){try{E!=this.editor.graph&&null!=E.container.parentNode&&E.container.parentNode.removeChild(E.container)}catch(t){e=null}l(e)}),t,this.thumbImageCache,"#ffffff",function(){l()},null,null,null,null,null,null,E,null,null,null,null,"diagram",null),i=!0):this.canvasSupported&&null!=this.getCurrentFile()&&(a=document.createElement("canvas"),u=E.getGraphBounds(),h=E.view.translate,d=E.view.scale,null!=y&&(u=mxRectangle.fromRectangle(u)).add(new mxRectangle((h.x+y.x)*d,(h.y+y.y)*d,y.width*d,y.height*d)),p=t/u.width,p=Math.min(1,Math.min(3*t/(4*u.height),p)),c=Math.floor(u.x),m=Math.floor(u.y),a.setAttribute("width",Math.ceil(p*(u.width+4))),a.setAttribute("height",Math.ceil(p*(u.height+4))),(g=a.getContext("2d")).scale(p,p),g.translate(-c,-m),null!=(b=E.background)&&""!=b&&b!=mxConstants.NONE||(b="#ffffff"),g.save(),g.fillStyle=b,g.fillRect(c,m,Math.ceil(u.width+4),Math.ceil(u.height+4)),g.restore(),null!=y&&((w=new Image).src=y.src,g.drawImage(w,y.x*p,y.y*p,y.width*p,y.height*p)),A=new mxJsCanvas(a),x=new mxAsyncCanvas(this.thumbImageCache),A.images=this.thumbImageCache.images,(f=new mxImageExport).drawShape=function(t,e){t.shape instanceof mxShape&&t.shape.checkBounds()&&(e.save(),e.translate(.5,.5),t.shape.paint(e),e.translate(-.5,-.5),e.restore())},f.drawText=function(t,e){},f.drawState(E.getView().getState(E.model.root),x),x.finish(mxUtils.bind(this,function(){try{f.drawState(E.getView().getState(E.model.root),A),E!=this.editor.graph&&null!=E.container.parentNode&&E.container.parentNode.removeChild(E.container)}catch(t){a=null}l(a)})),i=!0)}catch(t){i=!1,null!=E&&E!=this.editor.graph&&null!=E.container.parentNode&&E.container.parentNode.removeChild(E.container)}return i||window.clearTimeout(s),i},App.prototype.createBackground=function(){var t=this.createDiv("background");return t.style.position="absolute",t.style.background="white",t.style.left="0px",t.style.top="0px",t.style.bottom="0px",t.style.right="0px",mxUtils.setOpacity(t,100),t},function(){var s=EditorUi.prototype.setMode;App.prototype.setMode=function(t,e){var i,n;if(s.apply(this,arguments),null!=this.mode&&(Editor.useLocalStorage=this.mode==App.MODE_BROWSER),null!=this.appIcon&&((t=null!=(i=this.getCurrentFile())?i.getMode():t)==App.MODE_GOOGLE?(this.appIcon.setAttribute("title",mxResources.get("openIt",[mxResources.get("googleDrive")])),this.appIcon.style.cursor="pointer"):t==App.MODE_DROPBOX?(this.appIcon.setAttribute("title",mxResources.get("openIt",[mxResources.get("dropbox")])),this.appIcon.style.cursor="pointer"):t==App.MODE_ONEDRIVE?(this.appIcon.setAttribute("title",mxResources.get("openIt",[mxResources.get("oneDrive")])),this.appIcon.style.cursor="pointer"):(this.appIcon.removeAttribute("title"),this.appIcon.style.cursor=t==App.MODE_DEVICE?"pointer":"default")),e)try{isLocalStorage?localStorage.setItem(".mode",t):"undefined"!=typeof Storage&&((n=new Date).setYear(n.getFullYear()+1),document.cookie="MODE="+t+"; expires="+n.toUTCString())}catch(t){}}}(),App.prototype.appIconClicked=function(t){var e,i,n,s;mxEvent.isAltDown(t)?this.showSplash(!0):(i=null!=(e=this.getCurrentFile())?e.getMode():null)==App.MODE_GOOGLE?null!=e&&null!=e.desc&&null!=e.desc.parents&&0<e.desc.parents.length&&!mxEvent.isShiftDown(t)?this.openLink("https://drive.google.com/drive/folders/"+e.desc.parents[0].id):null!=e&&null!=e.getId()?this.openLink("https://drive.google.com/open?id="+e.getId()):this.openLink("https://drive.google.com/?authuser=0"):i==App.MODE_ONEDRIVE?null!=e&&null!=e.meta&&null!=e.meta.webUrl?(s=e.meta.webUrl,n=encodeURIComponent(e.meta.name),s.substring(s.length-n.length,s.length)==n&&(s=s.substring(0,s.length-n.length)),this.openLink(s)):this.openLink("https://onedrive.live.com/"):i==App.MODE_DROPBOX?null!=e&&null!=e.stat&&null!=e.stat.path_display?(s="https://www.dropbox.com/home/Apps/drawio"+e.stat.path_display,mxEvent.isShiftDown(t)||(s=s.substring(0,s.length-e.stat.name.length)),this.openLink(s)):this.openLink("https://www.dropbox.com/"):i==App.MODE_TRELLO?this.openLink("https://trello.com/"):i==App.MODE_NOTION?this.openLink("https://www.notion.so/"):i==App.MODE_GITHUB?null!=e&&e.constructor==GitHubFile?this.openLink(e.meta.html_url):this.openLink("https://github.com/"):i==App.MODE_GITLAB?null!=e&&e.constructor==GitLabFile?this.openLink(e.meta.html_url):this.openLink(DRAWIO_GITLAB_URL):i==App.MODE_DEVICE&&this.openLink("https://get.draw.io/"),mxEvent.consume(t)},App.prototype.clearMode=function(){var t;isLocalStorage?localStorage.removeItem(".mode"):"undefined"!=typeof Storage&&((t=new Date).setYear(t.getFullYear()-1),document.cookie="MODE=; expires="+t.toUTCString())},App.prototype.getDiagramId=function(){var t,e=window.location.hash;return null!=(e=null!=e&&0<e.length?e.substring(1):e)&&1<e.length&&"T"==e.charAt(0)&&(0<(t=e.indexOf("#"))&&(e=e.substring(0,t))),e},App.prototype.open=function(){console.log("App.open()");try{var t,e;null!=window.opener&&(null!=(t=null!=(t=urlParams.create)?decodeURIComponent(t):t)&&0<t.length&&"http://"!=t.substring(0,7)&&"https://"!=t.substring(0,8)?(e=mxUtils.parseXml(window.opener[t]),this.editor.setGraphXml(e.documentElement)):null!=window.opener.openFile&&window.opener.openFile.setConsumer(mxUtils.bind(this,function(t,e,i){var n;this.spinner.stop(),null==e&&(i=!0,e=null!=(n=urlParams.title)?decodeURIComponent(n):this.defaultFilename),0<(this.useCanvasForExport?-1:".png"==e.substring(e.length-4))&&(e=e.substring(0,e.length-4)+".drawio"),this.fileLoaded(mxClient.IS_IOS?new StorageFile(this,t,e):new LocalFile(this,t,e,i))})))}catch(t){}},App.prototype.loadGapi=function(t){"undefined"!=typeof gapi&&gapi.load(("0"!=urlParams.picker?"picker,":"")+App.GOOGLE_APIS,t)},App.prototype.load=function(){if(console.log("App.load()"),"1"!=urlParams.embed){if(this.spinner.spin(document.body,mxResources.get("starting"))){try{this.stateArg=null!=urlParams.state&&null!=this.drive?JSON.parse(decodeURIComponent(urlParams.state)):null}catch(t){}this.editor.graph.setEnabled(null!=this.getCurrentFile()),null!=window.location.hash&&0!=window.location.hash.length||null==this.drive||null==this.stateArg||null==this.stateArg.userId||this.drive.setUserId(this.stateArg.userId),null!=urlParams.fileId?(window.location.hash="G"+urlParams.fileId,window.location.search=this.getSearch(["fileId"])):null==this.drive?(this.mode==App.MODE_GOOGLE&&(this.mode=null),this.start()):this.loadGapi(mxUtils.bind(this,function(){this.start()}))}}else this.restoreLibraries(),"1"==urlParams.gapi&&this.loadGapi(function(){})},App.prototype.showRefreshDialog=function(t,e){this.showingRefreshDialog||(this.showingRefreshDialog=!0,this.showError(t||mxResources.get("externalChanges"),e||mxResources.get("redirectToNewApp"),mxResources.get("refresh"),mxUtils.bind(this,function(){var t=this.getCurrentFile();null!=t&&t.setModified(!1),this.spinner.spin(document.body,mxResources.get("connecting")),this.editor.graph.setEnabled(!1),window.location.reload()}),null,null,null,null,null,340,180),null!=this.dialog&&null!=this.dialog.container&&((e=this.createRealtimeNotice()).style.left="0",e.style.right="0",e.style.borderRadius="0",e.style.borderLeftStyle="none",e.style.borderRightStyle="none",e.style.marginBottom="26px",e.style.padding="8px 0 8px 0",this.dialog.container.appendChild(e)))},App.prototype.showAlert=function(t){var e;null!=t&&0<t.length&&((e=document.createElement("div")).className="geAlert",e.style.zIndex=2e9,e.style.left="50%",e.style.top="-100%",e.style.maxWidth="80%",e.style.width="max-content",e.style.whiteSpace="pre-wrap",mxUtils.setPrefixedStyle(e.style,"transform","translate(-50%,0%)"),mxUtils.setPrefixedStyle(e.style,"transition","all 1s ease"),e.innerHTML=t,(t=document.createElement("a")).className="geAlertLink",t.style.textAlign="right",t.style.marginTop="20px",t.style.display="block",t.setAttribute("title",mxResources.get("close")),t.innerHTML=mxResources.get("close"),e.appendChild(t),mxEvent.addListener(t,"click",function(t){null!=e.parentNode&&(e.parentNode.removeChild(e),mxEvent.consume(t))}),document.body.appendChild(e),window.setTimeout(function(){e.style.top="30px"},10),window.setTimeout(function(){mxUtils.setPrefixedStyle(e.style,"transition","all 2s ease"),e.style.opacity="0",window.setTimeout(function(){null!=e.parentNode&&e.parentNode.removeChild(e)},2e3)},15e3))},App.prototype.start=function(){console.log("App.start()"),null!=this.bg&&null!=this.bg.parentNode&&this.bg.parentNode.removeChild(this.bg),this.restoreLibraries(),this.spinner.stop();try{var l=this;if(window.onerror=function(t,e,i,n,s){"ResizeObserver loop limit exceeded"!=t&&(EditorUi.logError("Uncaught: "+(null!=t?t:""),e,i,n,s,null,!0),l.handleError({message:t},mxResources.get("unknownError"),null,null,null,null,!0))},"1"!=urlParams.client&&"1"!=urlParams.embed){try{isLocalStorage&&window.addEventListener("storage",mxUtils.bind(this,function(t){var e=this.getCurrentFile();EditorUi.debug("storage event",t,e),null!=e&&".draft-alive-check"==t.key&&null!=t.newValue&&null!=e.draftId&&(this.draftAliveCheck=t.newValue,e.saveDraft())})),mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||this.isOfflineApp()||null!=urlParams.open||!/www\.draw\.io$/.test(window.location.hostname)||this.editor.chromeless&&!this.editor.editable||this.showNameChangeBanner()}catch(t){}mxEvent.addListener(window,"hashchange",mxUtils.bind(this,function(t){try{this.hideDialog();var e=this.getDiagramId(),i=this.getCurrentFile();null!=i&&i.getHash()==e||this.loadFile(e,!0)}catch(t){null!=document.body&&this.handleError(t,mxResources.get("errorLoadingFile"),mxUtils.bind(this,function(){var t=this.getCurrentFile();window.location.hash=null!=t?t.getHash():""}))}}))}if((null==window.location.hash||window.location.hash.length<=1)&&null!=urlParams.desc)try{this.loadDescriptor(JSON.parse(Graph.decompress(urlParams.desc)),null,mxUtils.bind(this,function(t){this.handleError(t,mxResources.get("errorLoadingFile"))}))}catch(t){this.handleError(t,mxResources.get("errorLoadingFile"))}else if((null==window.location.hash||window.location.hash.length<=1)&&null!=urlParams.url)this.loadFile("U"+urlParams.url,!0);else if(null==this.getCurrentFile()){var t=mxUtils.bind(this,function(){if("1"!=urlParams.client||null!=window.location.hash&&0!=window.location.hash.length&&"#P"!=window.location.hash.substring(0,2)){if(null==this.dialog)if("1"==urlParams.demo){var t=Editor.useLocalStorage;this.createFile(this.defaultFilename,null,null,null,null,null,null,!0),Editor.useLocalStorage=t}else{t=!1;try{t=null!=window.opener&&null!=window.opener.openFile}catch(t){}t?this.spinner.spin(document.body,mxResources.get("loading")):(e=this.getDiagramId(),!EditorUi.enableDrafts||null!=urlParams.mode&&!EditorUi.isElectronApp||"draw.io"!=this.getServiceName()||null!=e&&0!=e.length||this.editor.isChromelessView()?null!=e&&0<e.length?this.loadFile(e,null,null,mxUtils.bind(this,function(){var t=decodeURIComponent(urlParams.viewbox||"");if(""!=t)try{var e=JSON.parse(t);this.editor.graph.fitWindow(e,e.border)}catch(t){console.error(t)}})):"0"!=urlParams.splash?this.loadFile():this.createFile(this.defaultFilename,this.getFileData(),null,null,null,null,null,!0):this.checkDrafts())}}else{var e,i=mxUtils.bind(this,function(t){"data:image/png;base64,"==t.substring(0,22)&&(t=this.extractGraphModelFromPng(t));var e=null!=(e=urlParams.title)?decodeURIComponent(e):this.defaultFilename,e=new LocalFile(this,t,e,!0);null!=window.location.hash&&"#P"==window.location.hash.substring(0,2)&&(e.getHash=function(){return window.location.hash.substring(1)}),this.fileLoaded(e),this.getCurrentFile().setModified(!this.editor.chromeless)}),n=window.opener||window.parent;n!=window&&(null!=(e=urlParams.create)?i(n[decodeURIComponent(e)]):null!=(e=urlParams.data)?i(decodeURIComponent(e)):this.installMessageHandler(mxUtils.bind(this,function(t,e){e.source==n&&i(t)})))}}),e=decodeURIComponent(urlParams.create||"");if((null==window.location.hash||window.location.hash.length<=1)&&null!=e&&0<e.length&&this.spinner.spin(document.body,mxResources.get("loading"))){var i=mxUtils.bind(this,function(){this.spinner.spin(document.body,mxResources.get("reconnecting"))&&(window.location.search=this.getSearch(["create","title"]))}),n=mxUtils.bind(this,function(t){var e,i;this.spinner.stop(),"0"!=urlParams.splash&&(this.fileLoaded(new LocalFile(this,t,null)),this.editor.graph.setEnabled(!1),this.mode=urlParams.mode,i=null!=(i=urlParams.title)?decodeURIComponent(i):this.defaultFilename,e=this.getServiceCount(!0),isLocalStorage&&e++,t=e<=4?2:6<e?4:3,i=new CreateDialog(this,i,mxUtils.bind(this,function(e,i){var t;null==i?(this.hideDialog(),t=Editor.useLocalStorage,this.createFile(0<e.length?e:this.defaultFilename,this.getFileData(),null,null,null,!0,null,!0),Editor.useLocalStorage=t):this.pickFolder(i,mxUtils.bind(this,function(t){this.createFile(e,this.getFileData(!0),null,i,null,!0,t)}))}),null,null,null,null,"1"==urlParams.browser,null,null,!0,t,null,null,null,this.editor.fileExtensions),this.showDialog(i.container,400,t<e?390:270,!0,!1,mxUtils.bind(this,function(t){t&&null==this.getCurrentFile()&&this.showSplash()})),i.init())});if("http://"!=(e=decodeURIComponent(e)).substring(0,7)&&"https://"!=e.substring(0,8))try{null!=window.opener&&null!=window.opener[e]?n(window.opener[e]):this.handleError(null,mxResources.get("errorLoadingFile"))}catch(t){this.handleError(t,mxResources.get("errorLoadingFile"))}else this.loadTemplate(e,function(t){n(t)},mxUtils.bind(this,function(){this.handleError(null,mxResources.get("errorLoadingFile"),i)}))}else(null==window.location.hash||window.location.hash.length<=1)&&null!=urlParams.state&&null!=this.stateArg&&"open"==this.stateArg.action?null!=this.stateArg.ids&&(window.history&&window.history.replaceState&&window.history.replaceState(null,null,window.location.pathname+this.getSearch(["state"])),window.location.hash="G"+this.stateArg.ids[0]):(null==window.location.hash||window.location.hash.length<=1)&&null!=this.drive&&null!=this.stateArg&&"create"==this.stateArg.action?(window.history&&window.history.replaceState&&window.history.replaceState(null,null,window.location.pathname+this.getSearch(["state"])),this.setMode(App.MODE_GOOGLE),"0"==urlParams.splash?this.createFile(null!=urlParams.title?decodeURIComponent(urlParams.title):this.defaultFilename):this.actions.get("new").funct()):(null!=urlParams.open&&window.history&&window.history.replaceState&&(window.history.replaceState(null,null,window.location.pathname+this.getSearch(["open"])),window.location.hash=urlParams.open),t())}}catch(t){this.handleError(t)}},App.prototype.loadDraft=function(t,e){this.createFile(this.defaultFilename,t,null,null,mxUtils.bind(this,function(){window.setTimeout(mxUtils.bind(this,function(){var t=this.getCurrentFile();null!=t&&(t.fileChanged(),null!=e&&e())}),0)}),null,null,!0)},App.prototype.checkDrafts=function(){try{var o=Editor.guid();localStorage.setItem(".draft-alive-check",o),window.setTimeout(mxUtils.bind(this,function(){localStorage.removeItem(".draft-alive-check"),this.getDatabaseItems(mxUtils.bind(this,function(t){for(var e,i=[],n=0;n<t.length;n++)try{var s,l=t[n].key;null==l||".draft_"!=l.substring(0,7)||null!=(s=JSON.parse(t[n].data))&&"draft"==s.type&&s.aliveCheck!=o&&(s.key=l,i.push(s))}catch(t){}1==i.length?this.loadDraft(i[0].data,mxUtils.bind(this,function(){this.removeDatabaseItem(i[0].key)})):1<i.length?(e=new Date(i[0].modified),e=new DraftDialog(this,1<i.length?mxResources.get("selectDraft"):mxResources.get("draftFound",[e.toLocaleDateString()+" "+e.toLocaleTimeString()]),1<i.length?null:i[0].data,mxUtils.bind(this,function(t){this.hideDialog(),t=""!=t?t:0,this.loadDraft(i[t].data,mxUtils.bind(this,function(){this.removeDatabaseItem(i[t].key)}))}),mxUtils.bind(this,function(t,e){t=""!=t?t:0,this.confirm(mxResources.get("areYouSure"),null,mxUtils.bind(this,function(){this.removeDatabaseItem(i[t].key),null!=e&&e()}),mxResources.get("no"),mxResources.get("yes"))}),null,null,null,1<i.length?i:null),this.showDialog(e.container,640,480,!0,!1,mxUtils.bind(this,function(t){"0"!=urlParams.splash?this.loadFile():this.createFile(this.defaultFilename,this.getFileData(),null,null,null,null,null,!0)})),e.init()):"0"!=urlParams.splash?this.loadFile():this.createFile(this.defaultFilename,this.getFileData(),null,null,null,null,null,!0)}),mxUtils.bind(this,function(){"0"!=urlParams.splash?this.loadFile():this.createFile(this.defaultFilename,this.getFileData(),null,null,null,null,null,!0)}))}),0)}catch(t){}},App.prototype.showSplash=function(t){var e,i,n;"1"!=urlParams.noFileMenu&&(e=this.getServiceCount(!0),i=mxUtils.bind(this,function(){var t=new SplashDialog(this);this.showDialog(t.container,340,mxClient.IS_CHROMEAPP||EditorUi.isElectronApp?200:230,!0,!0,mxUtils.bind(this,function(t){t&&!mxClient.IS_CHROMEAPP&&(t=Editor.useLocalStorage,this.createFile(this.defaultFilename+(EditorUi.isElectronApp?".drawio":""),null,null,null,null,null,null,"1"!=urlParams.local),Editor.useLocalStorage=t)}),!0)}),this.editor.isChromelessView()?this.handleError({message:mxResources.get("noFileSelected")},mxResources.get("errorLoadingFile"),mxUtils.bind(this,function(){this.showSplash()})):mxClient.IS_CHROMEAPP||null!=this.mode&&!t?null==urlParams.create&&i():(n=4==e?2:3,t=new StorageDialog(this,mxUtils.bind(this,function(){this.hideDialog(),i()}),n),this.showDialog(t.container,n<3?200:300,3<e?320:210,!0,!1)))},App.prototype.addLanguageMenu=function(t,e){var n=null;return null!=this.menus.get("language")&&((n=document.createElement("div")).setAttribute("title",mxResources.get("language")),n.className="geIcon geSprite geSprite-globe",n.style.position="absolute",n.style.cursor="pointer",n.style.bottom="20px",n.style.right="20px",e&&(n.style.direction="rtl",n.style.textAlign="right",n.style.right="24px",(e=document.createElement("span")).style.display="inline-block",e.style.fontSize="12px",e.style.margin="5px 24px 0 0",e.style.color="gray",e.style.userSelect="none",mxUtils.write(e,mxResources.get("language")),n.appendChild(e)),mxEvent.addListener(n,"click",mxUtils.bind(this,function(t){this.editor.graph.popupMenuHandler.hideMenu();var e=new mxPopupMenu(this.menus.get("language").funct);e.div.className+=" geMenubarMenu",e.smartSeparators=!0,e.showDisabled=!0,e.autoExpand=!0,e.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(e,arguments),e.destroy()});var i=mxUtils.getOffset(n);e.popup(i.x,i.y+n.offsetHeight,null,t),this.setCurrentMenu(e)})),t.appendChild(n)),n},App.prototype.loadFileSystemEntry=function(n,s,l){l=null!=l?l:mxUtils.bind(this,function(t){this.handleError(t)});try{n.getFile().then(mxUtils.bind(this,function(i){var t=new FileReader;t.onload=mxUtils.bind(this,function(t){try{var e;null!=s?(e=t.target.result,"image/png"==i.type&&(e=this.extractGraphModelFromPng(e)),s(new LocalFile(this,e,i.name,null,n,i))):this.openFileHandle(t.target.result,i.name,i,!1,n)}catch(t){l(t)}}),t.onerror=l,"image"!==i.type.substring(0,5)&&"application/pdf"!==i.type||"image/svg"===i.type.substring(0,9)?t.readAsText(i):t.readAsDataURL(i)}),l)}catch(t){l(t)}},App.prototype.createFileSystemOptions=function(t){var e,i=[],n=null;null==t||0<(e=t.lastIndexOf("."))&&(n=t.substring(e+1));for(var s=0;s<this.editor.diagramFileTypes.length;s++){var l={description:mxResources.get(this.editor.diagramFileTypes[s].description)+(mxClient.IS_MAC?" (."+this.editor.diagramFileTypes[s].extension+")":""),accept:{}};l.accept[this.editor.diagramFileTypes[s].mimeType]=["."+this.editor.diagramFileTypes[s].extension],this.editor.diagramFileTypes[s].extension==n||this.editor.diagramFileTypes[s].extension==n?i.splice(0,0,l):i.push(l)}return{types:i,fileName:t}},App.prototype.showSaveFilePicker=function(i,t,e){t=null!=t?t:mxUtils.bind(this,function(t){"AbortError"!=t.name&&this.handleError(t)}),e=null!=e?e:this.createFileSystemOptions(),window.showSaveFilePicker(e).then(mxUtils.bind(this,function(e){null!=e&&e.getFile().then(mxUtils.bind(this,function(t){i(e,t)}),t)}),t)},App.prototype.pickFile=function(s){try{var t,e,i,n,l;(s=null!=s?s:this.mode)==App.MODE_GOOGLE?null!=this.drive&&"undefined"!=typeof google&&void 0!==google.picker?this.drive.pickFile():this.openLink("https://drive.google.com"):null!=(t=this.getPeerForMode(s))?t.pickFile():s==App.MODE_DEVICE&&EditorUi.nativeFileSupport?window.showOpenFilePicker().then(mxUtils.bind(this,function(t){null!=t&&0<t.length&&this.spinner.spin(document.body,mxResources.get("loading"))&&this.loadFileSystemEntry(t[0])}),mxUtils.bind(this,function(t){"AbortError"!=t.name&&this.handleError(t)})):s==App.MODE_DEVICE&&Graph.fileSupport?(null==this.openFileInputElt&&((e=document.createElement("input")).setAttribute("type","file"),mxEvent.addListener(e,"change",mxUtils.bind(this,function(){null!=e.files&&(this.openFiles(e.files),e.type="",e.type="file",e.value="")})),e.style.display="none",document.body.appendChild(e),this.openFileInputElt=e),this.openFileInputElt.click()):(this.hideDialog(),window.openNew=null!=this.getCurrentFile()&&!this.isDiagramEmpty(),window.baseUrl=this.getUrl(),window.openKey="open",window.listBrowserFiles=mxUtils.bind(this,function(t,e){StorageFile.listFiles(this,"F",t,e)}),window.openBrowserFile=mxUtils.bind(this,function(t,e,i){StorageFile.getFileContent(this,t,e,i)}),window.deleteBrowserFile=mxUtils.bind(this,function(t,e,i){StorageFile.deleteFile(this,t,e,i)}),i=Editor.useLocalStorage,Editor.useLocalStorage=s==App.MODE_BROWSER,this.openFile(),window.openFile.setConsumer(mxUtils.bind(this,function(t,e){var i=mxUtils.bind(this,function(){this.useCanvasForExport||".png"!=e.substring(e.length-4)||(e=e.substring(0,e.length-4)+".drawio"),this.fileLoaded(new(s==App.MODE_BROWSER?StorageFile:LocalFile)(this,t,e))}),n=this.getCurrentFile();null!=n&&n.isModified()?this.confirm(mxResources.get("allChangesLost"),null,i,mxResources.get("cancel"),mxResources.get("discardChanges")):i()})),n=this.dialog,l=n.close,this.dialog.close=mxUtils.bind(this,function(t){Editor.useLocalStorage=i,l.apply(n,arguments),null==this.getCurrentFile()&&this.showSplash()}))}catch(t){this.handleError(t)}},App.prototype.pickLibrary=function(i){var n,e,t;(i=null!=i?i:this.mode)==App.MODE_GOOGLE||i==App.MODE_DROPBOX||i==App.MODE_ONEDRIVE||i==App.MODE_GITHUB||i==App.MODE_GITLAB||i==App.MODE_TRELLO||i==App.MODE_NOTION?null!=(n=i==App.MODE_GOOGLE?this.drive:i==App.MODE_ONEDRIVE?this.oneDrive:i==App.MODE_GITHUB?this.gitHub:i==App.MODE_GITLAB?this.gitLab:i==App.MODE_TRELLO?this.trello:i==App.MODE_NOTION?this.notion:this.dropbox)&&n.pickLibrary(mxUtils.bind(this,function(t,e){if(null!=e)try{this.loadLibrary(e)}catch(t){this.handleError(t,mxResources.get("errorLoadingFile"))}else this.spinner.spin(document.body,mxResources.get("loading"))&&n.getLibrary(t,mxUtils.bind(this,function(t){this.spinner.stop();try{this.loadLibrary(t)}catch(t){this.handleError(t,mxResources.get("errorLoadingFile"))}}),mxUtils.bind(this,function(t){this.handleError(t,null!=t?mxResources.get("errorLoadingFile"):null)}))})):i==App.MODE_DEVICE&&Graph.fileSupport?(null==this.libFileInputElt&&((e=document.createElement("input")).setAttribute("type","file"),mxEvent.addListener(e,"change",mxUtils.bind(this,function(){if(null!=e.files){for(var t=0;t<e.files.length;t++)mxUtils.bind(this,function(e){var t=new FileReader;t.onload=mxUtils.bind(this,function(t){try{this.loadLibrary(new LocalLibrary(this,t.target.result,e.name))}catch(t){this.handleError(t,mxResources.get("errorLoadingFile"))}}),t.readAsText(e)})(e.files[t]);e.type="",e.type="file",e.value=""}})),e.style.display="none",document.body.appendChild(e),this.libFileInputElt=e),this.libFileInputElt.click()):(window.openNew=!1,window.openKey="open",window.listBrowserFiles=mxUtils.bind(this,function(t,e){StorageFile.listFiles(this,"L",t,e)}),window.openBrowserFile=mxUtils.bind(this,function(t,e,i){StorageFile.getFileContent(this,t,e,i)}),window.deleteBrowserFile=mxUtils.bind(this,function(t,e,i){StorageFile.deleteFile(this,t,e,i)}),t=Editor.useLocalStorage,Editor.useLocalStorage=i==App.MODE_BROWSER,window.openFile=new OpenFile(mxUtils.bind(this,function(t){this.hideDialog(t)})),window.openFile.setConsumer(mxUtils.bind(this,function(t,e){try{this.loadLibrary(new(i==App.MODE_BROWSER?StorageLibrary:LocalLibrary)(this,t,e))}catch(t){this.handleError(t,mxResources.get("errorLoadingFile"))}})),this.showDialog(new OpenDialog(this).container,Editor.useLocalStorage?640:360,Editor.useLocalStorage?480:220,!0,!0,function(){Editor.useLocalStorage=t,window.openFile=null}))},App.prototype.saveLibrary=function(e,i,n,s,t,l,o){try{s=null!=s?s:this.mode,t=null!=t&&t,l=null!=l&&l;var r,a,u=this.createLibraryDataFromImages(i),h=mxUtils.bind(this,function(t){this.spinner.stop(),null!=o&&o(),this.handleError(t,null!=t?mxResources.get("errorSavingFile"):null)});null==(n=null==n&&s==App.MODE_DEVICE?new LocalLibrary(this,u,e):n)?this.pickFolder(s,mxUtils.bind(this,function(t){s==App.MODE_GOOGLE&&null!=this.drive&&this.spinner.spin(document.body,mxResources.get("inserting"))?this.drive.insertFile(e,u,t,mxUtils.bind(this,function(t){this.spinner.stop(),this.hideDialog(!0),this.libraryLoaded(t,i)}),h,this.drive.libraryMimeType):s==App.MODE_GITHUB&&null!=this.gitHub&&this.spinner.spin(document.body,mxResources.get("inserting"))?this.gitHub.insertLibrary(e,u,mxUtils.bind(this,function(t){this.spinner.stop(),this.hideDialog(!0),this.libraryLoaded(t,i)}),h,t):s==App.MODE_GITLAB&&null!=this.gitLab&&this.spinner.spin(document.body,mxResources.get("inserting"))?this.gitLab.insertLibrary(e,u,mxUtils.bind(this,function(t){this.spinner.stop(),this.hideDialog(!0),this.libraryLoaded(t,i)}),h,t):s==App.MODE_NOTION&&null!=this.notion&&this.spinner.spin(document.body,mxResources.get("inserting"))?this.notion.insertLibrary(e,u,mxUtils.bind(this,function(t){this.spinner.stop(),this.hideDialog(!0),this.libraryLoaded(t,i)}),h,t):s==App.MODE_TRELLO&&null!=this.trello&&this.spinner.spin(document.body,mxResources.get("inserting"))?this.trello.insertLibrary(e,u,mxUtils.bind(this,function(t){this.spinner.stop(),this.hideDialog(!0),this.libraryLoaded(t,i)}),h,t):s==App.MODE_DROPBOX&&null!=this.dropbox&&this.spinner.spin(document.body,mxResources.get("inserting"))?this.dropbox.insertLibrary(e,u,mxUtils.bind(this,function(t){this.spinner.stop(),this.hideDialog(!0),this.libraryLoaded(t,i)}),h,t):s==App.MODE_ONEDRIVE&&null!=this.oneDrive&&this.spinner.spin(document.body,mxResources.get("inserting"))?this.oneDrive.insertLibrary(e,u,mxUtils.bind(this,function(t){this.spinner.stop(),this.hideDialog(!0),this.libraryLoaded(t,i)}),h,t):s==App.MODE_BROWSER?(t=mxUtils.bind(this,function(){var t=new StorageLibrary(this,u,e);t.saveFile(e,!1,mxUtils.bind(this,function(){this.hideDialog(!0),this.libraryLoaded(t,i)}),h)}),null==localStorage.getItem(e)?t():this.confirm(mxResources.get("replaceIt",[e]),t)):this.handleError({message:mxResources.get("serviceUnavailableOrBlocked")})})):(t||this.spinner.spin(document.body,mxResources.get("saving")))&&(n.setData(u),r=mxUtils.bind(this,function(){n.save(!0,mxUtils.bind(this,function(t){this.spinner.stop(),this.hideDialog(!0),l||this.libraryLoaded(n,i),null!=o&&o()}),h)}),e!=n.getTitle()?(a=n.getHash(),n.rename(e,mxUtils.bind(this,function(t){n.constructor!=LocalLibrary&&a!=n.getHash()&&(mxSettings.removeCustomLibrary(a),mxSettings.addCustomLibrary(n.getHash())),this.removeLibrarySidebar(a),r()}),h)):r())}catch(t){this.handleError(t)}},App.prototype.saveFile=function(t,e){var n,i,s,l,o,r=this.getCurrentFile();null!=r&&(n=mxUtils.bind(this,function(){EditorUi.enableDrafts&&r.removeDraft(),this.getCurrentFile()==r||r.isModified()||(r.getMode()!=App.MODE_DEVICE?this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("allChangesSaved"))):this.editor.setStatus("")),null!=e&&e()}),t||null==r.getTitle()||null!=r.invalidFileHandle||null==this.mode?null!=r&&r.constructor==LocalFile&&null!=r.fileHandle?this.showSaveFilePicker(mxUtils.bind(this,function(t,e){r.invalidFileHandle=null,r.fileHandle=t,r.title=e.name,r.desc=e,this.save(e.name,n)}),null,this.createFileSystemOptions(r.getTitle())):(i=null!=r.getTitle()?r.getTitle():this.defaultFilename,o=!mxClient.IS_IOS||!navigator.standalone,s=this.mode,l=this.getServiceCount(!0),isLocalStorage&&l++,t=l<=4?2:6<l?4:3,o=new CreateDialog(this,i,mxUtils.bind(this,function(e,i,t){null!=e&&0<e.length&&(/(\.pdf)$/i.test(e)?this.confirm(mxResources.get("didYouMeanToExportToPdf"),mxUtils.bind(this,function(){this.hideDialog(),this.actions.get("exportPdf").funct()}),mxUtils.bind(this,function(){t.value=e.split(".").slice(0,-1).join("."),t.focus(),mxClient.IS_GC||mxClient.IS_FF||5<=document.documentMode?t.select():document.execCommand("selectAll",!1,null)}),mxResources.get("yes"),mxResources.get("no")):(this.hideDialog(),null==s&&i==App.MODE_DEVICE?null!=r&&EditorUi.nativeFileSupport?this.showSaveFilePicker(mxUtils.bind(this,function(t,e){r.fileHandle=t,r.mode=App.MODE_DEVICE,r.title=e.name,r.desc=e,this.setMode(App.MODE_DEVICE),this.save(e.name,n)}),mxUtils.bind(this,function(t){"AbortError"!=t.name&&this.handleError(t)}),this.createFileSystemOptions(e)):(this.setMode(App.MODE_DEVICE),this.save(e,n)):"download"==i?new LocalFile(this,null,e).save():"_blank"==i?(window.openFile=new OpenFile(function(){window.openFile=null}),window.openFile.setData(this.getFileData(!0)),this.openLink(this.getUrl(window.location.pathname),null,!0)):s!=i?this.pickFolder(i,mxUtils.bind(this,function(t){this.createFile(e,this.getFileData(/(\.xml)$/i.test(e)||e.indexOf(".")<0||/(\.drawio)$/i.test(e),/(\.svg)$/i.test(e),/(\.html)$/i.test(e)),null,i,n,null==this.mode,t)})):null!=i&&this.save(e,n)))}),mxUtils.bind(this,function(){this.hideDialog()}),mxResources.get("saveAs"),mxResources.get("download"),null,null,o,null,!0,t,null,null,null,this.editor.fileExtensions,!1),"1"==urlParams.customMenu?window.editorUi.js2exe_SaveToAnswerArea(!1,1):(this.showDialog(o.container,400,t<l?390:270,!0,!0),o.init())):this.save(r.getTitle(),n))},App.prototype.loadTemplate=function(n,s,l,t,o){var e,r=!1,i=n;this.editor.isCorsEnabledForUrl(i)||(e="t="+(new Date).getTime(),i=PROXY_URL+"?url="+encodeURIComponent(n)+"&base64=1&"+e,r=!0);var a=null!=t?t:n;this.editor.loadUrl(i,mxUtils.bind(this,function(t){try{var e=r?!window.atob||mxClient.IS_IE||mxClient.IS_IE11?Base64.decode(t):atob(t):t,i=/(\.v(dx|sdx?))($|\?)/i.test(a)||/(\.vs(x|sx?))($|\?)/i.test(a);i||this.isVisioData(e)?(i||(a=o?this.isRemoteVisioData(e)?"raw.vss":"raw.vssx":this.isRemoteVisioData(e)?"raw.vsd":"raw.vsdx"),this.importVisio(this.base64ToBlob(t.substring(t.indexOf(",")+1)),function(t){s(t)},l,a)):!this.isOffline()&&(new XMLHttpRequest).upload&&this.isRemoteFileFormat(e,a)?this.parseFile(new Blob([e],{type:"application/octet-stream"}),mxUtils.bind(this,function(t){4==t.readyState&&200<=t.status&&t.status<=299&&"<mxGraphModel"==t.responseText.substring(0,13)&&s(t.responseText)}),n):this.isLucidChartData(e)?this.convertLucidChart(e,mxUtils.bind(this,function(t){s(t)}),mxUtils.bind(this,function(t){l(t)})):((/(\.png)($|\?)/i.test(a)||this.isPngData(e))&&(e=this.extractGraphModelFromPng(t)),s(e))}catch(t){l(t)}}),l,/(\.png)($|\?)/i.test(a)||/(\.v(dx|sdx?))($|\?)/i.test(a)||/(\.vs(x|sx?))($|\?)/i.test(a),null,null,r)},App.prototype.getPeerForMode=function(t){return t==App.MODE_GOOGLE?this.drive:t==App.MODE_GITHUB?this.gitHub:t==App.MODE_GITLAB?this.gitLab:t==App.MODE_DROPBOX?this.dropbox:t==App.MODE_ONEDRIVE?this.oneDrive:t==App.MODE_TRELLO?this.trello:t==App.MODE_NOTION?this.notion:null},App.prototype.createFile=function(t,n,s,e,l,o,i,r,a){if(e=r?null:null!=e?e:this.mode,null!=t&&this.spinner.spin(document.body,mxResources.get("inserting"))){n=null!=n?n:this.emptyDiagramXml;var u=mxUtils.bind(this,function(){this.spinner.stop()}),h=mxUtils.bind(this,function(t){u(),null==t&&null==this.getCurrentFile()&&null==this.dialog?this.showSplash():null!=t&&this.handleError(t)});try{e==App.MODE_GOOGLE&&null!=this.drive?(null==i&&null!=this.stateArg&&null!=this.stateArg.folderId&&(i=this.stateArg.folderId),this.drive.insertFile(t,n,i,mxUtils.bind(this,function(t){u(),this.fileCreated(t,s,o,l,a)}),h)):e==App.MODE_GITHUB&&null!=this.gitHub?this.gitHub.insertFile(t,n,mxUtils.bind(this,function(t){u(),this.fileCreated(t,s,o,l,a)}),h,!1,i):e==App.MODE_GITLAB&&null!=this.gitLab?this.gitLab.insertFile(t,n,mxUtils.bind(this,function(t){u(),this.fileCreated(t,s,o,l,a)}),h,!1,i):e==App.MODE_NOTION&&null!=this.notion?this.notion.insertFile(t,n,mxUtils.bind(this,function(t){u(),this.fileCreated(t,s,o,l,a)}),h,!1,i):e==App.MODE_TRELLO&&null!=this.trello?this.trello.insertFile(t,n,mxUtils.bind(this,function(t){u(),this.fileCreated(t,s,o,l,a)}),h,!1,i):e==App.MODE_DROPBOX&&null!=this.dropbox?this.dropbox.insertFile(t,n,mxUtils.bind(this,function(t){u(),this.fileCreated(t,s,o,l,a)}),h):e==App.MODE_ONEDRIVE&&null!=this.oneDrive?this.oneDrive.insertFile(t,n,mxUtils.bind(this,function(t){u(),this.fileCreated(t,s,o,l,a)}),h,!1,i):e==App.MODE_BROWSER?StorageFile.insertFile(this,t,n,mxUtils.bind(this,function(t){u(),this.fileCreated(t,s,o,l,a)}),h):!r&&e==App.MODE_DEVICE&&EditorUi.nativeFileSupport?(u(),this.showSaveFilePicker(mxUtils.bind(this,function(t,e){var i=new LocalFile(this,n,e.name,null,t,e);i.saveFile(e.name,!1,mxUtils.bind(this,function(){this.fileCreated(i,s,o,l,a)}),h,!0)}),mxUtils.bind(this,function(t){"AbortError"!=t.name&&h(t)}),this.createFileSystemOptions(t))):(u(),this.fileCreated(new LocalFile(this,n,t,null==e),s,o,l,a))}catch(t){u(),this.handleError(t)}}},App.prototype.fileCreated=function(n,s,l,o,r){var t,e,i,a,u,h,d=window.location.pathname;null!=s&&0<s.length&&(d+="?libs="+s),null!=r&&0<r.length&&(d+="?clibs="+r),d=this.getUrl(d),n.getMode()!=App.MODE_DEVICE&&(d+="#"+n.getHash()),this.spinner.spin(document.body,mxResources.get("inserting"))&&(t=0<(i=n.getData()).length?this.editor.extractGraphModel(mxUtils.parseXml(i).documentElement,!0):null,e=window.location.protocol+"//"+window.location.hostname+d,(a=null)!=(i=t)&&/\.svg$/i.test(n.getTitle())&&(a=this.createTemporaryGraph(this.editor.graph.getStylesheet()),document.body.appendChild(a.container),i=this.decodeNodeIntoGraph(i,a)),n.setData(this.createFileData(t,a,n,e)),null!=a&&a.container.parentNode.removeChild(a.container),u=mxUtils.bind(this,function(){this.spinner.stop()}),h=mxUtils.bind(this,function(){u();var t=this.getCurrentFile();null==l&&null!=t&&(l=!t.isModified()&&null==t.getMode());var e=mxUtils.bind(this,function(){if(window.openFile=null,this.fileLoaded(n),l&&n.addAllSavedStatus(),null!=s&&this.sidebar.showEntries(s),null!=r){for(var t=[],e=r.split(";"),i=0;i<e.length;i++)t.push(decodeURIComponent(e[i]));this.loadLibraries(t)}}),i=mxUtils.bind(this,function(){l||null==t||!t.isModified()?e():this.confirm(mxResources.get("allChangesLost"),null,e,mxResources.get("cancel"),mxResources.get("discardChanges"))});null!=o&&o(),null==l||l?i():(n.constructor==LocalFile&&(window.openFile=new OpenFile(function(){window.openFile=null}),window.openFile.setData(n.getData(),n.getTitle(),null==n.getMode())),null!=o&&o(),window.openWindow(d,null,i))}),n.constructor==LocalFile?h():n.saveFile(n.getTitle(),!1,mxUtils.bind(this,function(){h()}),mxUtils.bind(this,function(t){u(),this.handleError(t)})))},App.prototype.loadFile=function(r,n,s,a,t){console.log("App.loadFile()"),"1"!=urlParams.openInSameWin&&!navigator.standalone||(n=!0),this.hideDialog();var e=mxUtils.bind(this,function(){var e,l,o,t,i;null==r||0==r.length?(this.editor.setStatus(""),this.fileLoaded(null)):this.spinner.spin(document.body,mxResources.get("loading"))&&("L"==r.charAt(0)?(this.spinner.stop(),isLocalStorage?(e=mxUtils.bind(this,function(t){this.handleError(t,mxResources.get("errorLoadingFile"),mxUtils.bind(this,function(){var t=this.getCurrentFile();window.location.hash=null!=t?t.getHash():""}))}),r=decodeURIComponent(r.substring(1)),StorageFile.getFileContent(this,r,mxUtils.bind(this,function(t){null!=t?(this.fileLoaded(new StorageFile(this,t,r)),null!=a&&a()):e({message:mxResources.get("fileNotFound")})}),e)):this.handleError({message:mxResources.get("serviceUnavailableOrBlocked")},mxResources.get("errorLoadingFile"),mxUtils.bind(this,function(){var t=this.getCurrentFile();window.location.hash=null!=t?t.getHash():""}))):null!=s?(this.spinner.stop(),this.fileLoaded(s),null!=a&&a()):"S"==r.charAt(0)?(this.spinner.stop(),this.alert("[Deprecation] #S is no longer supported, go to https://app.diagrams.net/?desc="+r.substring(1).substring(0,10),mxUtils.bind(this,function(){window.location.href="https://app.diagrams.net/?desc="+r.substring(1)}))):"R"==r.charAt(0)?(this.spinner.stop(),"<"!=(t=decodeURIComponent(r.substring(1))).charAt(0)&&(t=Graph.decompress(t)),(t=new LocalFile(this,t,null!=urlParams.title?decodeURIComponent(urlParams.title):this.defaultFilename,!0)).getHash=function(){return r},this.fileLoaded(t),null!=a&&a()):"E"==r.charAt(0)?null==this.getCurrentFile()?this.handleError({message:mxResources.get("serviceUnavailableOrBlocked")},mxResources.get("errorLoadingFile")):this.remoteInvoke("getDraftFileContent",null,null,mxUtils.bind(this,function(t,e){this.spinner.stop(),this.fileLoaded(new EmbedFile(this,t,e)),null!=a&&a()}),mxUtils.bind(this,function(){this.handleError({message:mxResources.get("serviceUnavailableOrBlocked")},mxResources.get("errorLoadingFile"))})):"U"==r.charAt(0)?(l=decodeURIComponent(r.substring(1)),o=mxUtils.bind(this,function(){if("https://drive.google.com/uc?id="!=l.substring(0,31)||null==this.drive&&"function"!=typeof window.DriveClient)return!1;this.hideDialog();var t=mxUtils.bind(this,function(){if(this.spinner.stop(),null==this.drive)return!1;var e=l.substring(31,l.lastIndexOf("&ex"));return this.loadFile("G"+e,n,null,mxUtils.bind(this,function(){var t=this.getCurrentFile();null!=t&&this.editor.chromeless&&!this.editor.editable&&(t.getHash=function(){return"G"+e},window.location.hash="#"+t.getHash()),null!=a&&a()})),!0});return!t()&&this.spinner.spin(document.body,mxResources.get("loading"))&&this.addListener("clientLoaded",t),!0}),this.loadTemplate(l,mxUtils.bind(this,function(t){var e,i,n,s;this.spinner.stop(),null!=t&&0<t.length?(s=this.defaultFilename,null==urlParams.title&&"1"!=urlParams.notitle&&(n=(i=l).lastIndexOf("."),(e=i.lastIndexOf("/"))<n&&0<e&&(i=i.substring(e+1,n),n=l.substring(n),".svg"!==(n=!this.useCanvasForExport&&".png"==n?".drawio":n)&&".xml"!==n&&".html"!==n&&".png"!==n&&".drawio"!==n||(s=i+n))),(s=new LocalFile(this,t,null!=urlParams.title?decodeURIComponent(urlParams.title):s,!0)).getHash=function(){return r},this.fileLoaded(s,!0)?null!=a&&a():o()||this.handleError({message:mxResources.get("fileNotFound")},mxResources.get("errorLoadingFile"))):o()||this.handleError({message:mxResources.get("fileNotFound")},mxResources.get("errorLoadingFile"))}),mxUtils.bind(this,function(){o()||(this.spinner.stop(),this.handleError({message:mxResources.get("fileNotFound")},mxResources.get("errorLoadingFile")))}),null!=urlParams["template-filename"]?decodeURIComponent(urlParams["template-filename"]):null)):(t=null,"G"==r.charAt(0)?t=this.drive:"D"==r.charAt(0)?t=this.dropbox:"W"==r.charAt(0)?t=this.oneDrive:"H"==r.charAt(0)?t=this.gitHub:"A"==r.charAt(0)?t=this.gitLab:"T"==r.charAt(0)?t=this.trello:"N"==r.charAt(0)&&(t=this.notion),null==t?this.handleError({message:mxResources.get("serviceUnavailableOrBlocked")},mxResources.get("errorLoadingFile"),mxUtils.bind(this,function(){var t=this.getCurrentFile();window.location.hash=null!=t?t.getHash():""})):(i=r.charAt(0),r=decodeURIComponent(r.substring(1)),t.getFile(r,mxUtils.bind(this,function(t){this.spinner.stop(),this.fileLoaded(t);var e=this.getCurrentFile();null==e?(window.location.hash="",this.showSplash()):this.editor.chromeless&&!this.editor.editable?(e.getHash=function(){return i+r},window.location.hash="#"+e.getHash()):t==e&&null==t.getMode()&&(t=mxResources.get("copyCreated"),this.editor.setStatus('<div title="'+t+'" class="geStatusAlert">'+t+"</div>")),null!=a&&a()}),mxUtils.bind(this,function(t){null!=window.console&&null!=t&&console.log("error in loadFile:",r,t),this.handleError(t,null!=t?mxResources.get("errorLoadingFile"):null,mxUtils.bind(this,function(){var t=this.getCurrentFile();null==t?(window.location.hash="",this.showSplash()):window.location.hash="#"+t.getHash()}),null,null,"#"+i+r)})))))}),i=this.getCurrentFile(),l=mxUtils.bind(this,function(){t||null==i||!i.isModified()?e():this.confirm(mxResources.get("allChangesLost"),mxUtils.bind(this,function(){null!=i&&(window.location.hash=i.getHash())}),e,mxResources.get("cancel"),mxResources.get("discardChanges"))});null==r||0==r.length||null==i||n?l():this.showDialog(new PopupDialog(this,this.getUrl()+"#"+r,null,l).container,320,140,!0,!0)},App.prototype.getLibraryStorageHint=function(t){var e=t.getTitle();return t.constructor!=LocalLibrary&&(e+="\n"+t.getHash()),t.constructor==DriveLibrary?e+=" ("+mxResources.get("googleDrive")+")":t.constructor==GitHubLibrary?e+=" ("+mxResources.get("github")+")":t.constructor==TrelloLibrary?e+=" ("+mxResources.get("trello")+")":t.constructor==DropboxLibrary?e+=" ("+mxResources.get("dropbox")+")":t.constructor==OneDriveLibrary?e+=" ("+mxResources.get("oneDrive")+")":t.constructor==StorageLibrary?e+=" ("+mxResources.get("browser")+")":t.constructor==LocalLibrary&&(e+=" ("+mxResources.get("device")+")"),e},App.prototype.restoreLibraries=function(){this.loadLibraries(mxSettings.getCustomLibraries(),mxUtils.bind(this,function(){this.loadLibraries((urlParams.clibs||"").split(";"))}))},App.prototype.loadLibraries=function(e,i){if(null!=this.sidebar){null==this.pendingLibraries&&(this.pendingLibraries=new Object);var a=mxUtils.bind(this,function(t,e){e||mxSettings.removeCustomLibrary(t),delete this.pendingLibraries[t]}),u=0,h=[],d=mxUtils.bind(this,function(){if(0==u){if(null!=e)for(var t=e.length-1;0<=t;t--)null!=h[t]&&this.loadLibrary(h[t]);null!=i&&i()}});if(null!=e){for(var t=0;t<e.length;t++){var n=encodeURIComponent(decodeURIComponent(e[t]));mxUtils.bind(this,function(i,e){if(null!=i&&0<i.length&&null==this.pendingLibraries[i]&&null==this.sidebar.palettes[i]){u++;var n=mxUtils.bind(this,function(t){delete this.pendingLibraries[i],h[e]=t,u--,d()}),s=mxUtils.bind(this,function(t){a(i,t),u--,d()});this.pendingLibraries[i]=!0;var t=i.substring(0,1);if("L"==t)(isLocalStorage||mxClient.IS_CHROMEAPP)&&window.setTimeout(mxUtils.bind(this,function(){try{var e=decodeURIComponent(i.substring(1));StorageFile.getFileContent(this,e,mxUtils.bind(this,function(t){null!=(t=".scratchpad"==e&&null==t?this.emptyLibraryXml:t)?n(new StorageLibrary(this,t,e)):s()}),s)}catch(t){s()}}),0);else if("U"==t){var l=decodeURIComponent(i.substring(1));this.isOffline()||this.loadTemplate(l,mxUtils.bind(this,function(t){null!=t&&0<t.length?n(new UrlLibrary(this,t,l)):s()}),function(){s()},null,!0)}else if("R"==t){var o=decodeURIComponent(i.substring(1));try{var r={id:(o=JSON.parse(o))[0],title:o[1],downloadUrl:o[2]};this.remoteInvoke("getFileContent",[r.downloadUrl],null,mxUtils.bind(this,function(t){try{n(new RemoteLibrary(this,t,r))}catch(t){s()}}),function(){s()})}catch(t){s()}}else if("S"==t&&null!=this.loadDesktopLib)try{this.loadDesktopLib(decodeURIComponent(i.substring(1)),function(t){n(t)},s)}catch(t){s()}else{o=null;"G"==t?null!=this.drive&&null!=this.drive.user&&(o=this.drive):"H"==t?null!=this.gitHub&&null!=this.gitHub.getUser()&&(o=this.gitHub):"T"==t?null!=this.trello&&this.trello.isAuthorized()&&(o=this.trello):"D"==t?null!=this.dropbox&&null!=this.dropbox.getUser()&&(o=this.dropbox):"W"==t&&null!=this.oneDrive&&null!=this.oneDrive.getUser()&&(o=this.oneDrive),null!=o?o.getLibrary(decodeURIComponent(i.substring(1)),mxUtils.bind(this,function(t){try{n(t)}catch(t){s()}}),function(t){s()}):s(!0)}}})(n,t)}d()}else d()}},App.prototype.updateButtonContainer=function(){var t;null!=this.buttonContainer&&(t=this.getCurrentFile(),"1"==urlParams.embed&&("atlas"==uiTheme||"1"==urlParams.atlas?(this.buttonContainer.style.paddingRight="12px",this.buttonContainer.style.paddingTop="6px",this.buttonContainer.style.right="1"==urlParams.noLangIcon?"0":"25px"):"min"!=uiTheme&&(this.buttonContainer.style.paddingRight="38px",this.buttonContainer.style.paddingTop="6px")),this.commentsSupported()&&"1"!=urlParams.sketch?null==this.commentButton&&(this.commentButton=document.createElement("a"),this.commentButton.setAttribute("title",mxResources.get("comments")),this.commentButton.className="geToolbarButton",this.commentButton.style.cssText="display:inline-block;position:relative;box-sizing:border-box;margin-right:4px;float:left;cursor:pointer;width:24px;height:24px;background-size:24px 24px;background-position:center center;background-repeat:no-repeat;background-image:url("+Editor.commentImage+");","atlas"==uiTheme?(this.commentButton.style.marginRight="10px",this.commentButton.style.marginTop="-3px"):"min"==uiTheme?this.commentButton.style.marginTop="1px":"1"==urlParams.atlas?this.commentButton.style.marginTop="-2px":this.commentButton.style.marginTop="-5px",mxEvent.addListener(this.commentButton,"click",mxUtils.bind(this,function(){this.actions.get("comments").funct()})),this.buttonContainer.appendChild(this.commentButton),"dark"!=uiTheme&&"atlas"!=uiTheme||(this.commentButton.style.filter="invert(100%)")):null!=this.commentButton&&(this.commentButton.parentNode.removeChild(this.commentButton),this.commentButton=null),"1"==urlParams.embed||"draw.io"!=this.getServiceName()||mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||this.isOfflineApp()?null!=urlParams.notif&&this.fetchAndShowNotification(urlParams.notif):(null!=t?null==this.shareButton&&(this.shareButton=document.createElement("div"),this.shareButton.className="geBtn gePrimaryBtn",this.shareButton.style.display="inline-block",this.shareButton.style.backgroundColor="#F2931E",this.shareButton.style.borderColor="#F08705",this.shareButton.style.backgroundImage="none",this.shareButton.style.padding="2px 10px 0 10px",this.shareButton.style.marginTop="-10px",this.shareButton.style.height="28px",this.shareButton.style.lineHeight="28px",this.shareButton.style.minWidth="0px",this.shareButton.style.cssFloat="right",this.shareButton.setAttribute("title",mxResources.get("share")),(t=document.createElement("img")).setAttribute("src",this.shareImage),t.setAttribute("align","absmiddle"),t.style.marginRight="4px",t.style.marginTop="-3px",this.shareButton.appendChild(t),Editor.isDarkMode()||"atlas"==uiTheme||(this.shareButton.style.color="black",t.style.filter="invert(100%)"),mxUtils.write(this.shareButton,mxResources.get("share")),mxEvent.addListener(this.shareButton,"click",mxUtils.bind(this,function(){this.actions.get("share").funct()}))):null!=this.shareButton&&(this.shareButton.parentNode.removeChild(this.shareButton),this.shareButton=null),"1"!=urlParams.extAuth&&this.fetchAndShowNotification("online",this.mode)))},App.prototype.fetchAndShowNotification=function(s,l){if(!this.fetchingNotif){s=s||"online";var e=".notifCache",t=null,i=mxUtils.bind(this,function(t){t=t.filter(function(t){return!t.targets||-1<t.targets.indexOf(s)||null!=l&&-1<t.targets.indexOf(l)});for(var e=s+"NotifReadTS",i=null==localStorage||parseInt(localStorage.getItem(e)),n=0;n<t.length;n++)t[n].isNew=!i||t[n].timestamp>i;this.showNotification(t,e)});try{null!=localStorage&&(t=JSON.parse(localStorage.getItem(e)))}catch(t){}null==t||t.ts+864e5<Date.now()?(this.fetchingNotif=!0,mxUtils.get(NOTIFICATIONS_URL,mxUtils.bind(this,function(t){200<=t.getStatus()&&t.getStatus()<=299&&((t=JSON.parse(t.getText())).sort(function(t,e){return e.timestamp-t.timestamp}),isLocalStorage&&localStorage.setItem(e,JSON.stringify({ts:Date.now(),notifs:t})),this.fetchingNotif=!1,i(t))}))):i(t.notifs)}},App.prototype.showNotification=function(i,n){var t=i.length;if("min"==uiTheme)for(var t=0,e=0;e<i.length;e++)i[e].isNew&&t++;if(0!=t){mxUtils.bind(this,function(){this.notificationWin.style.display="none";for(var t=this.notificationWin.querySelectorAll(".circle.active"),e=0;e<t.length;e++)t[e].className="circle";isLocalStorage&&i[0]&&localStorage.setItem(n,i[0].timestamp)});var s=0,l=document.getElementById("geNotifList");if(null!=l){l.innerHTML='<div class="line"></div>';for(var o,r,e=0;e<i.length;e++)!function(t,e){e.isNew&&s++;var i=document.createElement("div");i.className="notification";var n=new Date(e.timestamp),n=t.timeSince(n);null==n&&(n=mxResources.get("lessThanAMinute")),i.innerHTML='<div class="circle'+(e.isNew?" active":"")+'"></div><span class="time">'+mxUtils.htmlEntities(mxResources.get("timeAgo",[n],"{1} ago"))+"</span><p>"+mxUtils.htmlEntities(e.content)+"</p>",e.link&&mxEvent.addListener(i,"click",function(){window.open(e.link,"notifWin")}),l.appendChild(i)}(this,i[e]);o=s,null!=(r=document.querySelector(".geNotification-count"))&&(r.innerHTML=o,r.style.display=0==o?"none":"",(r=document.querySelector(".geNotification-bell")).style.animation=0==o?"none":"",r.className="geNotification-bell"+(0==o?" geNotification-bellOff":""),document.querySelector(".geBell-rad").style.animation=0==o?"none":"")}}else null!=this.notificationBtn&&(this.notificationBtn.style.display="none",this.editor.fireEvent(new mxEventObject("statusChanged")))},App.prototype.save=function(e,i){var n=this.getCurrentFile();if(null!=n&&this.spinner.spin(document.body,mxResources.get("saving"))){this.editor.setStatus(""),this.editor.graph.isEditing()&&this.editor.graph.stopEditing();var t=mxUtils.bind(this,function(){n.handleFileSuccess(!0),null!=i&&i()}),s=mxUtils.bind(this,function(t){n.isModified()&&Editor.addRetryToError(t,mxUtils.bind(this,function(){this.save(e,i)})),n.handleFileError(t,!0)});try{e==n.getTitle()?n.save(!0,t,s):n.saveAs(e,t,s)}catch(t){s(t)}}},App.prototype.pickFolder=function(t,i,e,n,s){e=null==e||e;var l=this.spinner.pause();e&&t==App.MODE_GOOGLE&&null!=this.drive?this.drive.pickFolder(mxUtils.bind(this,function(t){var e;l(),t.action==google.picker.Action.PICKED&&((e=null)!=t.docs&&0<t.docs.length&&"folder"==t.docs[0].type&&(e=t.docs[0].id),i(e))}),s):e&&t==App.MODE_ONEDRIVE&&null!=this.oneDrive?this.oneDrive.pickFolder(mxUtils.bind(this,function(t){l(),null!=t&&null!=t.value&&0<t.value.length&&(t=OneDriveFile.prototype.getIdOf(t.value[0]),i(t))}),n):e&&t==App.MODE_GITHUB&&null!=this.gitHub?this.gitHub.pickFolder(mxUtils.bind(this,function(t){l(),i(t)})):e&&t==App.MODE_GITLAB&&null!=this.gitLab?this.gitLab.pickFolder(mxUtils.bind(this,function(t){l(),i(t)})):e&&t==App.MODE_NOTION&&null!=this.notion?this.notion.pickFolder(mxUtils.bind(this,function(t){l(),i(t)})):e&&t==App.MODE_TRELLO&&null!=this.trello?this.trello.pickFolder(mxUtils.bind(this,function(t){l(),i(t)})):EditorUi.prototype.pickFolder.apply(this,arguments)},App.prototype.exportFile=function(t,e,i,n,s,l){s==App.MODE_DROPBOX?null!=this.dropbox&&this.spinner.spin(document.body,mxResources.get("saving"))&&this.dropbox.insertFile(e,n?this.base64ToBlob(t,i):t,mxUtils.bind(this,function(){this.spinner.stop()}),mxUtils.bind(this,function(t){this.spinner.stop(),this.handleError(t)})):s==App.MODE_GOOGLE?null!=this.drive&&this.spinner.spin(document.body,mxResources.get("saving"))&&this.drive.insertFile(e,t,l,mxUtils.bind(this,function(t){this.spinner.stop()}),mxUtils.bind(this,function(t){this.spinner.stop(),this.handleError(t)}),i,n):s==App.MODE_ONEDRIVE?null!=this.oneDrive&&this.spinner.spin(document.body,mxResources.get("saving"))&&this.oneDrive.insertFile(e,n?this.base64ToBlob(t,i):t,mxUtils.bind(this,function(){this.spinner.stop()}),mxUtils.bind(this,function(t){this.spinner.stop(),this.handleError(t)}),!1,l):s==App.MODE_GITHUB?null!=this.gitHub&&this.spinner.spin(document.body,mxResources.get("saving"))&&this.gitHub.insertFile(e,t,mxUtils.bind(this,function(){this.spinner.stop()}),mxUtils.bind(this,function(t){this.spinner.stop(),this.handleError(t)}),!0,l,n):s==App.MODE_GITLAB?null!=this.gitHub&&this.spinner.spin(document.body,mxResources.get("saving"))&&this.gitLab.insertFile(e,t,mxUtils.bind(this,function(){this.spinner.stop()}),mxUtils.bind(this,function(t){this.spinner.stop(),this.handleError(t)}),!0,l,n):s==App.MODE_TRELLO?null!=this.trello&&this.spinner.spin(document.body,mxResources.get("saving"))&&this.trello.insertFile(e,n?this.base64ToBlob(t,i):t,mxUtils.bind(this,function(){this.spinner.stop()}),mxUtils.bind(this,function(t){this.spinner.stop(),this.handleError(t)}),!1,l):s==App.MODE_BROWSER&&(s=mxUtils.bind(this,function(){localStorage.setItem(e,t)}),null==localStorage.getItem(e)?s():this.confirm(mxResources.get("replaceIt",[e]),s))},App.prototype.descriptorChanged=function(){var t,e,i=this.getCurrentFile();null!=i&&(null!=this.fname&&(this.fnameWrapper.style.display="block",this.fname.innerHTML="",e=null!=i.getTitle()?i.getTitle():this.defaultFilename,mxUtils.write(this.fname,e),this.fname.setAttribute("title",e+" - "+mxResources.get("rename"))),t=this.editor.graph,e=i.isEditable()&&!i.invalidChecksum,t.isEnabled()&&!e&&t.reset(),t.setEnabled(e),null==urlParams.rev&&(this.updateDocumentTitle(),0<(e=i.getHash()).length?window.location.hash=e:0<window.location.hash.length&&(window.location.hash=""))),this.updateUi(),null==this.format||null!=i&&this.fileEditable==i.isEditable()||!this.editor.graph.isSelectionEmpty()||(this.format.refresh(),this.fileEditable=null!=i?i.isEditable():null),this.fireEvent(new mxEventObject("fileDescriptorChanged","file",i))},App.prototype.showAuthDialog=function(t,e,i,n){var s=this.spinner.pause();this.showDialog(new AuthDialog(this,t,e,mxUtils.bind(this,function(t){try{null!=i&&i(t,mxUtils.bind(this,function(){this.hideDialog(),s()}))}catch(t){this.editor.setStatus(mxUtils.htmlEntities(t.message))}})).container,300,e?180:140,!0,!0,mxUtils.bind(this,function(t){null!=n&&n(t),t&&null==this.getCurrentFile()&&null==this.dialog&&this.showSplash()}))},App.prototype.convertFile=function(i,n,t,e,s,l,o,r){var a=n;/\.svg$/i.test(a)||(a=a.substring(0,n.lastIndexOf("."))+e);var u=!1;if(null!=this.gitHub&&i.substring(0,this.gitHub.baseUrl.length)==this.gitHub.baseUrl&&(u=!0),/\.v(dx|sdx?)$/i.test(n)&&Graph.fileSupport&&(new XMLHttpRequest).upload&&"string"==typeof(new XMLHttpRequest).responseType){var h=new XMLHttpRequest;if(h.open("GET",i,!0),u||(h.responseType="blob"),r)for(var d in r)h.setRequestHeader(d,r[d]);h.onload=mxUtils.bind(this,function(){var t,e;200<=h.status&&h.status<=299?(e=null,e=u?(t=JSON.parse(h.responseText),this.base64ToBlob(t.content,"application/octet-stream")):new Blob([h.response],{type:"application/octet-stream"}),this.importVisio(e,mxUtils.bind(this,function(t){s(new LocalFile(this,t,a,!0))}),l,n)):null!=l&&l({message:mxResources.get("errorLoadingFile")})}),h.onerror=l,h.send()}else{var p=mxUtils.bind(this,function(t){try{var e;/\.pdf$/i.test(n)?null!=(e=Editor.extractGraphModelFromPdf(t))&&0<e.length&&s(new LocalFile(this,e,a,!0)):/\.png$/i.test(n)?(e=this.extractGraphModelFromPng(t),s(null!=e?new LocalFile(this,e,a,!0):new LocalFile(this,t,n,!0))):Graph.fileSupport&&(new XMLHttpRequest).upload&&this.isRemoteFileFormat(t,i)?this.parseFile(new Blob([t],{type:"application/octet-stream"}),mxUtils.bind(this,function(t){4==t.readyState&&(200<=t.status&&t.status<=299?s(new LocalFile(this,t.responseText,a,!0)):null!=l&&l({message:mxResources.get("errorLoadingFile")}))}),n):s(new LocalFile(this,t,a,!0))}catch(t){null!=l&&l(t)}}),t=/\.png$/i.test(n)||/\.jpe?g$/i.test(n)||/\.pdf$/i.test(n)||null!=t&&"image/"==t.substring(0,6);u?mxUtils.get(i,mxUtils.bind(this,function(t){var e;200<=t.getStatus()&&t.getStatus()<=299?null!=s&&(t=(e=JSON.parse(t.getText())).content,"base64"===e.encoding&&(t=/\.png$/i.test(n)?"data:image/png;base64,"+t:/\.pdf$/i.test(n)?"data:application/pdf;base64,"+t:!window.atob||mxClient.IS_IE||mxClient.IS_IE11?Base64.decode(t):atob(t)),p(t)):null!=l&&l({code:App.ERROR_UNKNOWN})}),function(){null!=l&&l({code:App.ERROR_UNKNOWN})},!1,this.timeout,function(){null!=l&&l({code:App.ERROR_TIMEOUT,retry:fn})},r):null!=o?o(i,p,l,t):this.editor.loadUrl(i,p,l,t,null,null,null,r)}},App.prototype.updateHeader=function(){var t,e,i;null!=this.menubar&&(this.appIcon=document.createElement("a"),this.appIcon.style.display="block",this.appIcon.style.position="absolute",this.appIcon.style.width="32px",this.appIcon.style.height=this.menubarHeight-28+"px",this.appIcon.style.margin="14px 0px 8px 16px",this.appIcon.style.opacity="0.85",this.appIcon.style.borderRadius="3px","dark"!=uiTheme&&(this.appIcon.style.backgroundColor="#f08705"),mxEvent.disableContextMenu(this.appIcon),mxEvent.addListener(this.appIcon,"click",mxUtils.bind(this,function(t){this.appIconClicked(t)})),t=mxClient.IS_SVG?"dark"==uiTheme?"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMzA2LjE4NSAxMjAuMjk2IgogICB2aWV3Qm94PSIyNCAyNiA2OCA2OCIKICAgeT0iMHB4IgogICB4PSIwcHgiCiAgIHZlcnNpb249IjEuMSI+CiAgIAkgPGc+PGxpbmUKICAgICAgIHkyPSI3Mi4zOTQiCiAgICAgICB4Mj0iNDEuMDYxIgogICAgICAgeTE9IjQzLjM4NCIKICAgICAgIHgxPSI1OC4wNjkiCiAgICAgICBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiCiAgICAgICBzdHJva2Utd2lkdGg9IjMuNTUyOCIKICAgICAgIHN0cm9rZT0iI0ZGRkZGRiIKICAgICAgIGZpbGw9Im5vbmUiIC8+PGxpbmUKICAgICAgIHkyPSI3Mi4zOTQiCiAgICAgICB4Mj0iNzUuMDc2IgogICAgICAgeTE9IjQzLjM4NCIKICAgICAgIHgxPSI1OC4wNjgiCiAgICAgICBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiCiAgICAgICBzdHJva2Utd2lkdGg9IjMuNTAwOCIKICAgICAgIHN0cm9rZT0iI0ZGRkZGRiIKICAgICAgIGZpbGw9Im5vbmUiIC8+PGc+PHBhdGgKICAgICAgICAgZD0iTTUyLjc3Myw3Ny4wODRjMCwxLjk1NC0xLjU5OSwzLjU1My0zLjU1MywzLjU1M0gzNi45OTljLTEuOTU0LDAtMy41NTMtMS41OTktMy41NTMtMy41NTN2LTkuMzc5ICAgIGMwLTEuOTU0LDEuNTk5LTMuNTUzLDMuNTUzLTMuNTUzaDEyLjIyMmMxLjk1NCwwLDMuNTUzLDEuNTk5LDMuNTUzLDMuNTUzVjc3LjA4NHoiCiAgICAgICAgIGZpbGw9IiNGRkZGRkYiIC8+PC9nPjxnCiAgICAgICBpZD0iZzM0MTkiPjxwYXRoCiAgICAgICAgIGQ9Ik02Ny43NjIsNDguMDc0YzAsMS45NTQtMS41OTksMy41NTMtMy41NTMsMy41NTNINTEuOTg4Yy0xLjk1NCwwLTMuNTUzLTEuNTk5LTMuNTUzLTMuNTUzdi05LjM3OSAgICBjMC0xLjk1NCwxLjU5OS0zLjU1MywzLjU1My0zLjU1M0g2NC4yMWMxLjk1NCwwLDMuNTUzLDEuNTk5LDMuNTUzLDMuNTUzVjQ4LjA3NHoiCiAgICAgICAgIGZpbGw9IiNGRkZGRkYiIC8+PC9nPjxnPjxwYXRoCiAgICAgICAgIGQ9Ik04Mi43NTIsNzcuMDg0YzAsMS45NTQtMS41OTksMy41NTMtMy41NTMsMy41NTNINjYuOTc3Yy0xLjk1NCwwLTMuNTUzLTEuNTk5LTMuNTUzLTMuNTUzdi05LjM3OSAgICBjMC0xLjk1NCwxLjU5OS0zLjU1MywzLjU1My0zLjU1M2gxMi4yMjJjMS45NTQsMCwzLjU1MywxLjU5OSwzLjU1MywzLjU1M1Y3Ny4wODR6IgogICAgICAgICBmaWxsPSIjRkZGRkZGIiAvPjwvZz48L2c+PC9zdmc+)":"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJFYmVuZV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMjI1IDIyNSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjI1IDIyNTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MXtmaWxsOiNERjZDMEM7fQoJLnN0MntmaWxsOiNGRkZGRkY7fQo8L3N0eWxlPgo8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMjI1LDIxNS40YzAsNS4zLTQuMyw5LjYtOS41LDkuNmwwLDBINzcuMWwtNDQuOC00NS41TDYwLjIsMTM0bDgyLjctMTAyLjdsODIuMSw4NC41VjIxNS40eiIvPgo8cGF0aCBjbGFzcz0ic3QyIiBkPSJNMTg0LjYsMTI1LjhoLTIzLjdsLTI1LTQyLjdjNS43LTEuMiw5LjgtNi4yLDkuNy0xMlYzOWMwLTYuOC01LjQtMTIuMy0xMi4yLTEyLjNoLTAuMUg5MS42CgljLTYuOCwwLTEyLjMsNS40LTEyLjMsMTIuMlYzOXYzMi4xYzAsNS44LDQsMTAuOCw5LjcsMTJsLTI1LDQyLjdINDAuNGMtNi44LDAtMTIuMyw1LjQtMTIuMywxMi4ydjAuMXYzMi4xCgljMCw2LjgsNS40LDEyLjMsMTIuMiwxMi4zaDAuMWg0MS43YzYuOCwwLDEyLjMtNS40LDEyLjMtMTIuMnYtMC4xdi0zMi4xYzAtNi44LTUuNC0xMi4zLTEyLjItMTIuM2gtMC4xaC00bDI0LjgtNDIuNGgxOS4zCglsMjQuOSw0Mi40SDE0M2MtNi44LDAtMTIuMyw1LjQtMTIuMywxMi4ydjAuMXYzMi4xYzAsNi44LDUuNCwxMi4zLDEyLjIsMTIuM2gwLjFoNDEuN2M2LjgsMCwxMi4zLTUuNCwxMi4zLTEyLjJ2LTAuMXYtMzIuMQoJYzAtNi44LTUuNC0xMi4zLTEyLjItMTIuM0MxODQuNywxMjUuOCwxODQuNywxMjUuOCwxODQuNiwxMjUuOHoiLz4KPC9zdmc+Cg==)":"url('"+IMAGE_PATH+"/logo-white.png')",this.appIcon.style.backgroundImage=t,this.appIcon.style.backgroundPosition="center center",this.appIcon.style.backgroundSize="100% 100%",this.appIcon.style.backgroundRepeat="no-repeat",mxUtils.setPrefixedStyle(this.appIcon.style,"transition","all 125ms linear"),mxEvent.addListener(this.appIcon,"mouseover",mxUtils.bind(this,function(){var t=this.getCurrentFile();null!=t&&((t=t.getMode())==App.MODE_GOOGLE?(this.appIcon.style.backgroundImage="url("+IMAGE_PATH+"/google-drive-logo-white.svg)",this.appIcon.style.backgroundSize="70% 70%"):t==App.MODE_DROPBOX?(this.appIcon.style.backgroundImage="url("+IMAGE_PATH+"/dropbox-logo-white.svg)",this.appIcon.style.backgroundSize="70% 70%"):t==App.MODE_ONEDRIVE?(this.appIcon.style.backgroundImage="url("+IMAGE_PATH+"/onedrive-logo-white.svg)",this.appIcon.style.backgroundSize="70% 70%"):t==App.MODE_GITHUB?(this.appIcon.style.backgroundImage="url("+IMAGE_PATH+"/github-logo-white.svg)",this.appIcon.style.backgroundSize="70% 70%"):t==App.MODE_GITLAB?(this.appIcon.style.backgroundImage="url("+IMAGE_PATH+"/gitlab-logo-white.svg)",this.appIcon.style.backgroundSize="100% 100%"):t==App.MODE_NOTION?(this.appIcon.style.backgroundImage="url("+IMAGE_PATH+"/notion-logo-white.svg)",this.appIcon.style.backgroundSize="70% 70%"):t==App.MODE_TRELLO&&(this.appIcon.style.backgroundImage="url("+IMAGE_PATH+"/trello-logo-white-orange.svg)",this.appIcon.style.backgroundSize="70% 70%"))})),mxEvent.addListener(this.appIcon,"mouseout",mxUtils.bind(this,function(){this.appIcon.style.backgroundImage=t,this.appIcon.style.backgroundSize="90% 90%"})),"1"!=urlParams.embed&&this.menubarContainer.appendChild(this.appIcon),this.fnameWrapper=document.createElement("div"),this.fnameWrapper.style.position="absolute",this.fnameWrapper.style.right="120px",this.fnameWrapper.style.left="60px",this.fnameWrapper.style.top="9px",this.fnameWrapper.style.height="26px",this.fnameWrapper.style.display="none",this.fnameWrapper.style.overflow="hidden",this.fnameWrapper.style.textOverflow="ellipsis",this.fname=document.createElement("a"),this.fname.setAttribute("title",mxResources.get("rename")),this.fname.className="geItem",this.fname.style.padding="2px 8px 2px 8px",this.fname.style.display="inline",this.fname.style.fontSize="18px",this.fname.style.whiteSpace="nowrap",mxEvent.addListener(this.fname,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(t){t.preventDefault()})),mxEvent.addListener(this.fname,"click",mxUtils.bind(this,function(t){var e=this.getCurrentFile();null!=e&&e.isRenamable()&&(this.editor.graph.isEditing()&&this.editor.graph.stopEditing(),this.actions.get("rename").funct()),mxEvent.consume(t)})),this.fnameWrapper.appendChild(this.fname),"1"!=urlParams.embed&&(this.menubarContainer.appendChild(this.fnameWrapper),this.menubar.container.style.position="absolute",this.menubar.container.style.paddingLeft="59px",this.toolbar.container.style.paddingLeft="16px",this.menubar.container.style.boxSizing="border-box",this.menubar.container.style.top="34px"),this.toggleFormatElement=document.createElement("a"),this.toggleFormatElement.setAttribute("title",mxResources.get("formatPanel")+" ("+Editor.ctrlKey+"+Shift+P)"),this.toggleFormatElement.style.position="absolute",this.toggleFormatElement.style.display="inline-block",this.toggleFormatElement.style.top="atlas"==uiTheme?"8px":"6px",this.toggleFormatElement.style.right="atlas"!=uiTheme&&"1"!=urlParams.embed?"30px":"10px",this.toggleFormatElement.style.padding="2px",this.toggleFormatElement.style.fontSize="14px",this.toggleFormatElement.className="atlas"!=uiTheme?"geButton":"",this.toggleFormatElement.style.width="16px",this.toggleFormatElement.style.height="16px",this.toggleFormatElement.style.backgroundPosition="50% 50%",this.toggleFormatElement.style.backgroundRepeat="no-repeat",this.toolbarContainer.appendChild(this.toggleFormatElement),"dark"==uiTheme&&(this.toggleFormatElement.style.filter="invert(100%)"),mxEvent.addListener(this.toggleFormatElement,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(t){t.preventDefault()})),mxEvent.addListener(this.toggleFormatElement,"click",mxUtils.bind(this,function(t){this.actions.get("formatPanel").funct(),mxEvent.consume(t)})),e=mxUtils.bind(this,function(){0<this.formatWidth?this.toggleFormatElement.style.backgroundImage="url('"+this.formatShowImage+"')":this.toggleFormatElement.style.backgroundImage="url('"+this.formatHideImage+"')"}),this.addListener("formatWidthChanged",e),e(),this.fullscreenElement=document.createElement("a"),this.fullscreenElement.setAttribute("title",mxResources.get("fullscreen")),this.fullscreenElement.style.position="absolute",this.fullscreenElement.style.display="inline-block",this.fullscreenElement.style.top="atlas"==uiTheme?"8px":"6px",this.fullscreenElement.style.right="atlas"!=uiTheme&&"1"!=urlParams.embed?"50px":"30px",this.fullscreenElement.style.padding="2px",this.fullscreenElement.style.fontSize="14px",this.fullscreenElement.className="atlas"!=uiTheme?"geButton":"",this.fullscreenElement.style.width="16px",this.fullscreenElement.style.height="16px",this.fullscreenElement.style.backgroundPosition="50% 50%",this.fullscreenElement.style.backgroundRepeat="no-repeat",this.fullscreenElement.style.backgroundImage="url('"+this.fullscreenImage+"')",mxEvent.addListener(this.fullscreenElement,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(t){t.preventDefault()})),"atlas"==uiTheme&&(mxUtils.setOpacity(this.toggleFormatElement,70),mxUtils.setOpacity(this.fullscreenElement,70)),i=this.hsplitPosition,"dark"==uiTheme&&(this.fullscreenElement.style.filter="invert(100%)"),mxEvent.addListener(this.fullscreenElement,"click",mxUtils.bind(this,function(t){var e=this.fullscreenMode;"atlas"!=uiTheme&&"1"!=urlParams.embed&&this.toggleCompactMode(e),e||(i=this.hsplitPosition),this.hsplitPosition=e?i:0,this.toggleFormatPanel(e),this.fullscreenMode=!e,mxEvent.consume(t)})),"1"!=urlParams.embed&&(this.toggleElement=document.createElement("a"),this.toggleElement.setAttribute("title",mxResources.get("collapseExpand")),this.toggleElement.className="geButton",this.toggleElement.style.position="absolute",this.toggleElement.style.display="inline-block",this.toggleElement.style.width="16px",this.toggleElement.style.height="16px",this.toggleElement.style.color="#666",this.toggleElement.style.top="atlas"==uiTheme?"8px":"6px",this.toggleElement.style.right="10px",this.toggleElement.style.padding="2px",this.toggleElement.style.fontSize="14px",this.toggleElement.style.textDecoration="none",this.toggleElement.style.backgroundImage="url('"+this.chevronUpImage+"')",this.toggleElement.style.backgroundPosition="50% 50%",this.toggleElement.style.backgroundRepeat="no-repeat","dark"==uiTheme&&(this.toggleElement.style.filter="invert(100%)"),mxEvent.addListener(this.toggleElement,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(t){t.preventDefault()})),mxEvent.addListener(this.toggleElement,"click",mxUtils.bind(this,function(t){this.toggleCompactMode(),mxEvent.consume(t)})),uiTheme,!mxClient.IS_FF&&screen.height<=740&&void 0!==this.toggleElement.click&&window.setTimeout(mxUtils.bind(this,function(){this.toggleElement.click()}),0)))},App.prototype.toggleCompactMode=function(t){(t=null!=t?t:this.compactMode)?(this.menubar.container.style.position="absolute",this.menubar.container.style.paddingLeft="59px",this.menubar.container.style.paddingTop="",this.menubar.container.style.paddingBottom="",this.menubar.container.style.top="34px",this.toolbar.container.style.paddingLeft="16px",this.buttonContainer.style.visibility="visible",this.appIcon.style.display="block",this.fnameWrapper.style.display="block",this.fnameWrapper.style.visibility="visible",this.menubarHeight=App.prototype.menubarHeight,this.refresh(),this.toggleElement.style.backgroundImage="url('"+this.chevronUpImage+"')"):(this.menubar.container.style.position="relative",this.menubar.container.style.paddingLeft="4px",this.menubar.container.style.paddingTop="0px",this.menubar.container.style.paddingBottom="0px",this.menubar.container.style.top="0px",this.toolbar.container.style.paddingLeft="8px",this.buttonContainer.style.visibility="hidden",this.appIcon.style.display="none",this.fnameWrapper.style.display="none",this.fnameWrapper.style.visibility="hidden",this.menubarHeight=EditorUi.prototype.menubarHeight,this.refresh(),this.toggleElement.style.backgroundImage="url('"+this.chevronDownImage+"')"),this.compactMode=!t},App.prototype.updateUserElement=function(){var t;null!=this.drive&&null!=this.drive.getUser()||null!=this.oneDrive&&null!=this.oneDrive.getUser()||null!=this.dropbox&&null!=this.dropbox.getUser()||null!=this.gitHub&&null!=this.gitHub.getUser()||null!=this.gitLab&&null!=this.gitLab.getUser()||null!=this.notion&&null!=this.notion.getUser()||null!=this.trello&&this.trello.isAuthorized()?(null==this.userElement&&(this.userElement=document.createElement("a"),this.userElement.className="geItem",this.userElement.style.position="absolute",this.userElement.style.fontSize="8pt",this.userElement.style.top="atlas"==uiTheme?"8px":"2px",this.userElement.style.right="30px",this.userElement.style.margin="4px",this.userElement.style.padding="2px",this.userElement.style.paddingRight="16px",this.userElement.style.verticalAlign="middle",this.userElement.style.backgroundImage="url("+IMAGE_PATH+"/expanded.gif)",this.userElement.style.backgroundPosition="100% 60%",this.userElement.style.backgroundRepeat="no-repeat",this.menubarContainer.appendChild(this.userElement),mxEvent.addListener(this.userElement,mxClient.IS_POINTER?"pointerdown":"mousedown",mxUtils.bind(this,function(t){t.preventDefault()})),mxEvent.addListener(this.userElement,"click",mxUtils.bind(this,function(t){if(null==this.userPanel&&((r=document.createElement("div")).className="geDialog",r.style.position="absolute",r.style.top=this.userElement.clientTop+this.userElement.clientHeight+6+"px",r.style.zIndex=5,r.style.right="36px",r.style.padding="0px",r.style.cursor="default",r.style.minWidth="300px",this.userPanel=r),null!=this.userPanel.parentNode)this.userPanel.parentNode.removeChild(this.userPanel);else{var d=!1;this.userPanel.innerHTML="";var e=document.createElement("img");if(e.setAttribute("src",Dialog.prototype.closeImage),e.setAttribute("title",mxResources.get("close")),e.className="geDialogClose",e.style.top="8px",e.style.right="8px",mxEvent.addListener(e,"click",mxUtils.bind(this,function(){null!=this.userPanel.parentNode&&this.userPanel.parentNode.removeChild(this.userPanel)})),this.userPanel.appendChild(e),null!=this.drive){var l=this.drive.getUsersList();if(0<l.length){var o=mxUtils.bind(this,function(t,e){var i=this.getCurrentFile();null!=i&&i.constructor==DriveFile?(this.spinner.spin(document.body,e),this.fileLoaded(null),window.setTimeout(mxUtils.bind(this,function(){this.spinner.stop(),t()}),2e3)):t()}),i=mxUtils.bind(this,function(e){var t=document.createElement("tr");t.setAttribute("title","User ID: "+e.id);var i=document.createElement("td");i.setAttribute("valig","middle"),i.style.height="59px",i.style.width="66px";var n=document.createElement("img");n.setAttribute("width","50"),n.setAttribute("height","50"),n.setAttribute("border","0"),n.setAttribute("src",null!=e.pictureUrl?e.pictureUrl:this.defaultUserPicture),n.style.borderRadius="50%",n.style.margin="4px 8px 0 8px",i.appendChild(n),t.appendChild(i),(i=document.createElement("td")).setAttribute("valign","middle"),i.style.whiteSpace="nowrap",i.style.paddingTop="4px",i.style.maxWidth="0",i.style.overflow="hidden",i.style.textOverflow="ellipsis",mxUtils.write(i,e.displayName+(e.isCurrent&&1<l.length?" ("+mxResources.get("default")+")":"")),null!=e.email&&(mxUtils.br(i),(s=document.createElement("small")).style.color="gray",mxUtils.write(s,e.email),i.appendChild(s));n=document.createElement("div");n.style.marginTop="4px";var s=document.createElement("i");return mxUtils.write(s,mxResources.get("googleDrive")),n.appendChild(s),i.appendChild(n),t.appendChild(i),e.isCurrent||(t.style.cursor="pointer",t.style.opacity="0.3",mxEvent.addListener(t,"click",mxUtils.bind(this,function(t){o(mxUtils.bind(this,function(){this.stateArg=null,this.drive.setUser(e),this.drive.authorize(!0,mxUtils.bind(this,function(){this.setMode(App.MODE_GOOGLE),this.hideDialog(),this.showSplash()}),mxUtils.bind(this,function(t){this.handleError(t)}),!0)}),mxResources.get("closingFile")+"..."),mxEvent.consume(t)}))),t}),d=!0,n=document.createElement("table");n.style.borderSpacing="0",n.style.fontSize="10pt",n.style.width="100%",n.style.padding="10px";for(var s=0;s<l.length;s++)n.appendChild(i(l[s]));this.userPanel.appendChild(n),(r=document.createElement("div")).style.textAlign="left",r.style.padding="10px",r.style.whiteSpace="nowrap",r.style.borderTop="1px solid rgb(224, 224, 224)",(a=mxUtils.button(mxResources.get("signOut"),mxUtils.bind(this,function(){this.confirm(mxResources.get("areYouSure"),mxUtils.bind(this,function(){o(mxUtils.bind(this,function(){this.stateArg=null,this.drive.logout(),this.setMode(App.MODE_GOOGLE),this.hideDialog(),this.showSplash()}),mxResources.get("signOut"))}))}))).className="geBtn",a.style.float="right",r.appendChild(a),(a=mxUtils.button(mxResources.get("addAccount"),mxUtils.bind(this,function(){var t=this.drive.createAuthWin();t.blur(),window.focus(),o(mxUtils.bind(this,function(){this.stateArg=null,this.drive.authorize(!1,mxUtils.bind(this,function(){this.setMode(App.MODE_GOOGLE),this.hideDialog(),this.showSplash()}),mxUtils.bind(this,function(t){this.handleError(t)}),!0,t)}),mxResources.get("closingFile")+"...")}))).className="geBtn",a.style.margin="0px",r.appendChild(a),this.userPanel.appendChild(r)}}var r,a,e=mxUtils.bind(this,function(t,e,i,n){var s,l,o,r,a,u,h;null!=t&&(d&&this.userPanel.appendChild(document.createElement("hr")),d=!0,(s=document.createElement("table")).style.borderSpacing="0",s.style.fontSize="10pt",s.style.width="100%",s.style.padding="10px",l=document.createElement("tbody"),o=document.createElement("tr"),(a=document.createElement("td")).setAttribute("valig","top"),a.style.width="40px",null!=e&&((r=document.createElement("img")).setAttribute("width","40"),r.setAttribute("height","40"),r.setAttribute("border","0"),r.setAttribute("src",e),r.style.marginRight="6px",a.appendChild(r)),o.appendChild(a),(a=document.createElement("td")).setAttribute("valign","middle"),a.style.whiteSpace="nowrap",a.style.maxWidth="0",a.style.overflow="hidden",a.style.textOverflow="ellipsis",mxUtils.write(a,t.displayName),null!=t.email&&(mxUtils.br(a),(u=document.createElement("small")).style.color="gray",mxUtils.write(u,t.email),a.appendChild(u)),null!=n&&((h=document.createElement("div")).style.marginTop="4px",u=document.createElement("i"),mxUtils.write(u,n),h.appendChild(u),a.appendChild(h)),o.appendChild(a),l.appendChild(o),s.appendChild(l),this.userPanel.appendChild(s),(h=document.createElement("div")).style.textAlign="center",h.style.padding="10px",h.style.whiteSpace="nowrap",null!=i&&((i=mxUtils.button(mxResources.get("signOut"),i)).className="geBtn",h.appendChild(i)),this.userPanel.appendChild(h))});null!=this.dropbox&&e(this.dropbox.getUser(),IMAGE_PATH+"/dropbox-logo.svg",mxUtils.bind(this,function(){var t,e=this.getCurrentFile();null!=e&&e.constructor==DropboxFile?(t=mxUtils.bind(this,function(){this.dropbox.logout(),window.location.hash=""}),e.isModified()?this.confirm(mxResources.get("allChangesLost"),null,t,mxResources.get("cancel"),mxResources.get("discardChanges")):t()):this.dropbox.logout()}),mxResources.get("dropbox")),null!=this.oneDrive&&e(this.oneDrive.getUser(),IMAGE_PATH+"/onedrive-logo.svg",this.oneDrive.noLogout?null:mxUtils.bind(this,function(){var t,e=this.getCurrentFile();null!=e&&e.constructor==OneDriveFile?(t=mxUtils.bind(this,function(){this.oneDrive.logout(),window.location.hash=""}),e.isModified()?this.confirm(mxResources.get("allChangesLost"),null,t,mxResources.get("cancel"),mxResources.get("discardChanges")):t()):this.oneDrive.logout()}),mxResources.get("oneDrive")),null!=this.gitHub&&e(this.gitHub.getUser(),IMAGE_PATH+"/github-logo.svg",mxUtils.bind(this,function(){var t,e=this.getCurrentFile();null!=e&&e.constructor==GitHubFile?(t=mxUtils.bind(this,function(){this.gitHub.logout(),window.location.hash=""}),e.isModified()?this.confirm(mxResources.get("allChangesLost"),null,t,mxResources.get("cancel"),mxResources.get("discardChanges")):t()):this.gitHub.logout()}),mxResources.get("github")),null!=this.gitLab&&e(this.gitLab.getUser(),IMAGE_PATH+"/gitlab-logo.svg",mxUtils.bind(this,function(){var t,e=this.getCurrentFile();null!=e&&e.constructor==GitLabFile?(t=mxUtils.bind(this,function(){this.gitLab.logout(),window.location.hash=""}),e.isModified()?this.confirm(mxResources.get("allChangesLost"),null,t,mxResources.get("cancel"),mxResources.get("discardChanges")):t()):this.gitLab.logout()}),mxResources.get("gitlab")),null!=this.notion&&e(this.notion.getUser(),IMAGE_PATH+"/notion-logo.svg",mxUtils.bind(this,function(){var t,e=this.getCurrentFile();null!=e&&e.constructor==NotionFile?(t=mxUtils.bind(this,function(){this.notion.logout(),window.location.hash=""}),e.isModified()?this.confirm(mxResources.get("allChangesLost"),null,t,mxResources.get("cancel"),mxResources.get("discardChanges")):t()):this.notion.logout()}),mxResources.get("notion")),null!=this.trello&&e(this.trello.getUser(),IMAGE_PATH+"/trello-logo.svg",mxUtils.bind(this,function(){var t,e=this.getCurrentFile();null!=e&&e.constructor==TrelloFile?(t=mxUtils.bind(this,function(){this.trello.logout(),window.location.hash=""}),e.isModified()?this.confirm(mxResources.get("allChangesLost"),null,t,mxResources.get("cancel"),mxResources.get("discardChanges")):t()):this.trello.logout()}),mxResources.get("trello")),d||((r=document.createElement("div")).style.textAlign="center",r.style.padding="10px",r.innerHTML=mxResources.get("notConnected"),this.userPanel.appendChild(r)),(r=document.createElement("div")).style.textAlign="center",r.style.padding="10px",r.style.background=Editor.isDarkMode()?"":"whiteSmoke",r.style.borderTop="1px solid #e0e0e0",r.style.whiteSpace="nowrap","1"==urlParams.sketch?((a=mxUtils.button(mxResources.get("share"),mxUtils.bind(this,function(){this.actions.get("share").funct()}))).className="geBtn",r.appendChild(a),this.userPanel.appendChild(r),this.commentsSupported()&&((a=mxUtils.button(mxResources.get("comments"),mxUtils.bind(this,function(){this.actions.get("comments").funct()}))).className="geBtn",r.appendChild(a),this.userPanel.appendChild(r))):((a=mxUtils.button(mxResources.get("close"),mxUtils.bind(this,function(){mxEvent.isConsumed(t)||null==this.userPanel||null==this.userPanel.parentNode||this.userPanel.parentNode.removeChild(this.userPanel)}))).className="geBtn",r.appendChild(a),this.userPanel.appendChild(r)),document.body.appendChild(this.userPanel)}mxEvent.consume(t)})),mxEvent.addListener(document.body,"click",mxUtils.bind(this,function(t){mxEvent.isConsumed(t)||null==this.userPanel||null==this.userPanel.parentNode||this.userPanel.parentNode.removeChild(this.userPanel)}))),(t=null)!=this.drive&&null!=this.drive.getUser()?t=this.drive.getUser():null!=this.oneDrive&&null!=this.oneDrive.getUser()?t=this.oneDrive.getUser():null!=this.dropbox&&null!=this.dropbox.getUser()?t=this.dropbox.getUser():null!=this.gitHub&&null!=this.gitHub.getUser()?t=this.gitHub.getUser():null!=this.gitLab&&null!=this.gitLab.getUser()?t=this.gitLab.getUser():null!=this.notion&&null!=this.notion.getUser()&&(t=this.notion.getUser()),null!=t?(this.userElement.innerHTML="",560<screen.width&&(mxUtils.write(this.userElement,t.displayName),this.userElement.style.display="block")):this.userElement.style.display="none"):null!=this.userElement&&(this.userElement.parentNode.removeChild(this.userElement),this.userElement=null)},App.prototype.getCurrentUser=function(){var t=null;return null!=this.drive&&null!=this.drive.getUser()?t=this.drive.getUser():null!=this.oneDrive&&null!=this.oneDrive.getUser()?t=this.oneDrive.getUser():null!=this.dropbox&&null!=this.dropbox.getUser()?t=this.dropbox.getUser():null!=this.gitHub&&null!=this.gitHub.getUser()&&(t=this.gitHub.getUser()),t};var editorResetGraph=Editor.prototype.resetGraph;Editor.prototype.resetGraph=function(){editorResetGraph.apply(this,arguments),null==this.graph.defaultPageFormat&&(this.graph.pageFormat=mxSettings.getPageFormat())};