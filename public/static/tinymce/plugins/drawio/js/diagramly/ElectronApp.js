window.PLUGINS_BASE_PATH=".",window.TEMPLATE_PATH="templates",window.DRAW_MATH_URL="math",window.DRAWIO_BASE_URL=".",FeedbackDialog.feedbackUrl="https://log.draw.io/email",mxStencilRegistry.allowEval=!1,function(){App.mode=App.MODE_DEVICE,EmbedDialog.showPreviewOption=!1,EditDiagramDialog.showNewWindowOption=!1,PrintDialog.previewEnabled=!1,PrintDialog.electronPrint=function(e,t,i,n,s,r,l,o,a,c){var u="",p="",e=e.getCurrentFile();e&&(e.updateFileData(),u=e.getData(),p=e.title),new m("export",{print:!0,format:"pdf",xml:u,from:i-1,to:n-1,allPages:t,pageWidth:c.width,pageHeight:c.height,pageScale:a,fit:s,sheetsAcross:r,sheetsDown:l,scale:o,fileTitle:p}).send(function(){},function(){})};var i=window.open;window.open=function(e){if(null==e||!e.startsWith("http"))return i(e);{const t=require("electron")["shell"];t.openExternal(e)}};var s=App.main;App.main=function(){App.filesWorker=new Worker("electronFilesWorker.js"),App.filesWorkerReqId=1,App.filesWorkerReqInfo={},App.filesWorkerReq=function(e,t,i){e.reqId=App.filesWorkerReqId++,App.filesWorkerReqInfo[e.reqId]={callback:t,error:i},App.filesWorker.postMessage(e)},App.filesWorker.onmessage=function(e){var t=e.data,e=App.filesWorkerReqInfo[t.reqId];t.error?e.error(t.msg,t.e):e.callback(t.data),delete App.filesWorkerReqInfo[t.reqId]};var e=null!=mxSettings.settings?mxSettings.getPlugins():null;if(App.initPluginCallback(),null!=e&&0<e.length)for(var t=0;t<e.length;t++)try{if(e[t].startsWith("/plugins/"))e[t]="."+e[t];else if(e[t].startsWith("plugins/"))e[t]="./"+e[t];else if(!e[t].startsWith("file://")){var i=require("fs"),n=require("path").join(a(),"/plugins",e[t]);if(!i.existsSync(n))continue;e[t]="file://"+n}mxscript(e[t])}catch(e){}urlParams.plugins="0",s.apply(this,arguments)};var e=Menus.prototype.init;function d(){try{return require("@electron/remote").app.getPath("documents")}catch(e){}return"."}function a(){try{var e=require("fs"),t=require("@electron/remote").app.getPath("appData")+"/draw.io";return e.existsSync(t)||e.mkdirSync(t),t}catch(e){}return"."}Menus.prototype.init=function(){e.apply(this,arguments);var s=this.editorUi;s.actions.put("useOffline",new Action(mxResources.get("useOffline")+"...",function(){s.openLink("https://www.draw.io/")})),this.put("openRecent",new Menu(function(e,t){var i=s.getRecent();if(null!=i){for(var n=0;n<i.length;n++)!function(i){e.addItem(i.title,null,function(){function e(){s.loadArgs({args:[i.id]})}var t=s.getCurrentFile();null!=t&&t.isModified()?s.confirm(mxResources.get("allChangesLost"),null,e,mxResources.get("cancel"),mxResources.get("discardChanges")):e()},t)}(i[n]);e.addSeparator(t)}e.addItem(mxResources.get("reset"),null,function(){s.resetRecent()},t)})),this.put("file",new Menu(mxUtils.bind(this,function(e,t){this.addMenuItems(e,["new","open"],t),this.addSubmenu("openRecent",e,t),this.addMenuItems(e,["-","synchronize","-","save","saveAs","-","import"],t),this.addSubmenu("exportAs",e,t),e.addSeparator(t),this.addSubmenu("embed",e,t),e.addSeparator(t),this.addMenuItems(e,["newLibrary","openLibrary"],t);var i=s.getCurrentFile();null!=i&&null!=s.fileNode&&(i=null!=i.getTitle()?i.getTitle():s.defaultFilename,/(\.html)$/i.test(i)||/(\.svg)$/i.test(i)||this.addMenuItems(e,["-","properties"])),this.addMenuItems(e,["-","pageSetup","print","-","close"],t)})))};var n=Graph.prototype.createLinkForHint;Graph.prototype.createLinkForHint=function(e,t){var i=n.call(this,e,t);return null==e||this.isCustomLink(e)||mxEvent.addListener(i,"click",mxUtils.bind(this,function(e){this.openLink(i.getAttribute("href"),i.getAttribute("target")),mxEvent.consume(e)})),i},Graph.prototype.openLink=function(e,t){require("electron").shell.openExternal(e)};var p=EditorUi.prototype.init;EditorUi.prototype.init=function(){p.apply(this,arguments);var c=this,u=this.editor.graph;global.__emt_isModified=e=>!!c.getCurrentFile()&&c.getCurrentFile().isModified(),this.actions.addAction("newLibrary...",mxUtils.bind(this,function(){c.showLibraryDialog(null,null,null,null,App.MODE_DEVICE)})),this.actions.addAction("openLibrary...",mxUtils.bind(this,function(){c.pickLibrary(App.MODE_DEVICE)})),this.actions.addAction("import...",mxUtils.bind(this,function(){if(null!=c.getCurrentFile()){var e=require("@electron/remote").dialog;const i=require("path");var o,a,t=localStorage.getItem(".lastImpDir"),t=e.showOpenDialogSync({defaultPath:t||d(),properties:["openFile"]});void 0!==t&&null!=t[0]&&(o=t[0],localStorage.setItem(".lastImpDir",i.dirname(o)),t=(a=/\.png$/i.test(o)||/\.gif$/i.test(o)||/\.jpe?g$/i.test(o))||/\.pdf$/i.test(o)||/\.vsdx$/i.test(o)||/\.vssx$/i.test(o)?"base64":"utf-8",c.spinner.spin(document.body,mxResources.get("loading"))&&require("fs").readFile(o,t,mxUtils.bind(this,function(e,t){if(e)c.spinner.stop(),c.handleError(e);else try{var i,n,s,r,l;c.isLucidChartData(t)?c.convertLucidChart(t,function(e){c.spinner.stop(),u.setSelectionCells(c.importXml(e))},function(e){c.spinner.stop(),c.handleError(e)}):/(\.vsdx)($|\?)/i.test(o)?c.importVisio(c.base64ToBlob(t,"application/octet-stream"),function(e){c.spinner.stop(),u.setSelectionCells(c.importXml(e))}):!c.isOffline()&&(new XMLHttpRequest).upload&&c.isRemoteFileFormat(t,o)?c.parseFile(new Blob([t],{type:"application/octet-stream"}),mxUtils.bind(this,function(e){4==e.readyState&&(c.spinner.stop(),200<=e.status&&e.status<=299&&u.setSelectionCells(c.importXml(e.responseText)))}),o):(/\.pdf$/i.test(o)?null!=(i=Editor.extractGraphModelFromPdf(t))&&(t=i):/\.png$/i.test(o)?null!=(i=c.extractGraphModelFromPng(t))&&(a=!1,t=i):!/\.svg$/i.test(o)||0<(n=mxUtils.parseXml(t).getElementsByTagName("svg")).length&&(null==(s=null!=(s=null!=(s=n[0].getAttribute("content"))&&"<"!=s.charAt(0)&&"%"!=s.charAt(0)?unescape(window.atob?atob(s):Base64.decode(s,!0)):s)&&"%"==s.charAt(0)?decodeURIComponent(s):s)||"<mxfile "!==s.substring(0,8)&&"<mxGraphModel "!==s.substring(0,14)?a=!0:(a=!1,t=s)),a?((r=new Image).onload=function(){c.resizeImage(r,r.src,function(e,t,i){c.spinner.stop();var n=u.getInsertPoint();u.setSelectionCell(u.insertVertex(null,null,"",n.x,n.y,t,i,"shape=image;aspect=fixed;image="+c.convertDataUri(e)+";"))},!0)},r.onerror=function(e){c.spinner.stop(),c.handleError()},l=o.substring(o.lastIndexOf(".")+1),r.src="svg"==l?Editor.createSvgDataUri(t):"data:image/"+l+";base64,"+t):(c.spinner.stop(),null!=t&&u.setSelectionCells(c.importXml(t))))}catch(e){c.spinner.stop(),c.handleError(e)}})))}}));var t=this.actions.get("new").funct;function r(){var e=new Graph;return e.setExtendParents(!1),e.setExtendParentsOnAdd(!1),e.setConstrainChildren(!1),e.setHtmlLabels(!0),e.getModel().maintainEdgeParent=!1,e}function e(){var e=mxClipboard.getCells();if(e&&0<e.length)try{var t=r();t.importCells(e,0,0,t.getDefaultParent());var i=require("@electron/remote").clipboard,n=(new mxCodec).encode(t.getModel()),s=mxUtils.getXml(n);i.writeText(encodeURIComponent(s))}catch(e){}}function i(){try{var e,t,i,n,s=require("@electron/remote").clipboard.readText();s&&(s=decodeURIComponent(s),e=mxUtils.parseXml(s),t=r(),i=new mxCodec(e),n=t.getModel(),i.decode(e.documentElement,n),mxClipboard.setCells(n.root.children[0].children))}catch(e){}}this.actions.addAction("new...",mxUtils.bind(this,function(){if(null==this.getCurrentFile())t();else{const e=require("electron").ipcRenderer;e.sendSync("winman",{action:"newfile",opt:{width:1600}})}}),null,null,Editor.ctrlKey+"+N"),this.actions.get("open").shortcut=Editor.ctrlKey+"+O",c.keyHandler.bindAction(78,!0,"new"),c.keyHandler.bindAction(79,!0,"open");var n=this.actions.get("cut").funct;c.actions.addAction("cut",function(){n(),e()},null,"sprite-cut",Editor.ctrlKey+"+X");var s=this.actions.get("copy").funct;c.actions.addAction("copy",function(){s(),e()},null,"sprite-copy",Editor.ctrlKey+"+C");var l=this.actions.get("paste").funct;c.actions.addAction("paste",function(){i(),l()},!1,"sprite-paste",Editor.ctrlKey+"+V");var o=this.actions.get("pasteHere").funct;c.actions.addAction("pasteHere",function(){i(),o()}),c.updatePasteActionStates=function(){var e=this.editor.graph,t=this.actions.get("paste"),i=this.actions.get("pasteHere");t.setEnabled(this.editor.graph.cellEditor.isContentEditing()||e.isEnabled()&&!e.isCellLocked(e.getDefaultParent())),i.setEnabled(t.isEnabled())},c.actions.addAction("plugins...",function(){c.showDialog(new PluginsDialog(c,function(r){var e=document.createElement("div"),t=document.createElement("span");t.style.marginTop="6px",mxUtils.write(t,mxResources.get("builtinPlugins")+": "),e.appendChild(t);var i=document.createElement("select");i.style.width="150px";for(var n=0;n<App.publicPlugin.length;n++){var s=document.createElement("option");mxUtils.write(s,App.publicPlugin[n]),s.value=App.publicPlugin[n],i.appendChild(s)}e.appendChild(i),mxUtils.br(e),mxUtils.br(e),t=document.createElement("span"),mxUtils.write(t,mxResources.get("extPlugins")+": "),e.appendChild(t);t=mxUtils.button(mxResources.get("selectFile")+"...",function(){var e=require("@electron/remote").dialog;const t=require("path");var i,n=localStorage.getItem(".lastPluginDir"),s=e.showOpenDialogSync({defaultPath:n||d(),filters:[{name:"draw.io Plugins",extensions:["js"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});void 0!==s&&null!=s[0]&&(localStorage.setItem(".lastPluginDir",t.dirname(s[0])),e=require("fs"),n=t.join(a(),"/plugins"),e.existsSync(n)||e.mkdirSync(n),i=t.basename(s[0]),n=t.join(n,i),e.existsSync(n)?alert(mxResources.get("fileExists")):e.copyFile(s[0],n,e=>{e?alert("Adding plugin failed."):(r(i),c.hideDialog())}))});t.className="geBtn",e.appendChild(t);e=new CustomDialog(c,e,mxUtils.bind(this,function(){r(App.pluginRegistry[i.value])}));c.showDialog(e.container,300,120,!0,!0)},function(e){var t=require("fs");const i=require("path");e=i.join(a(),"/plugins",e);t.existsSync(e)&&t.unlinkSync(e)}).container,360,170,!0,!1)})};var t=App.prototype.load;App.prototype.load=function(){t.apply(this,arguments);const r=require("electron")["ipcRenderer"];r.on("args-obj",(e,t)=>{this.loadArgs(t)});var i=this;r.on("export-vsdx",(e,t)=>{t=new LocalFile(i,t.xml,"");i.fileLoaded(t);try{i.saveData=function(e,t,i,n,s){r.send("export-vsdx-finished",i)},new VsdxExport(i).exportCurrentDiagrams()||r.send("export-vsdx-finished",null)}catch(e){r.send("export-vsdx-finished",null)}}),r.send("app-load-finished",null)},App.prototype.loadArgs=function(e){var n,t,i=e.args;void 0!==i&&null!=i[0]&&0!=i[0].indexOf("-")&&this.spinner.spin(document.body,mxResources.get("loading"))?(n=i[0],this.hideDialog(),t=mxUtils.bind(this,function(e,t,i,n,s){this.spinner.stop(),null!=t&&((n=new LocalFile(this,t,n||"")).fileObject=e,n.stat=i,n.setModified(!!s),this.fileLoaded(n))}),i=mxUtils.bind(this,function(e){var t,i;this.spinner.stop(),"ENOENT"===e.code?(t=n.replace(/^.*[\\\/]/,""),i=this.emptyDiagramXml,(i=new LocalFile(this,i,t,null)).fileObject=new Object,i.fileObject.path=n,i.fileObject.name=t,i.fileObject.type="utf-8",this.fileCreated(i,null,null,null),this.saveFile()):this.handleError(e)}),this.readGraphFile(t,i,n)):null!=e.create&&(e=this.emptyDiagramXml,e=new LocalFile(this,e,"Untitled document",null),this.fileCreated(e,null,null,null))};var r=EditorUi.prototype.fileLoaded;EditorUi.prototype.fileLoaded=function(i){var e,t=require("fs"),n=this.getCurrentFile();null!=n&&null!=n.fileObject&&t.unwatchFile(n.fileObject.path),null!=i&&(null==i.fileObject&&(e=i.getTitle(),null!=(n=o[e])&&(i.fileObject={name:n.name,path:n.path,type:n.type||"utf-8"},delete o[e])),null!=i.fileObject&&(100<(e=i.fileObject.path).length&&(e="..."+e.substr(e.length-97)),this.addRecent({id:i.fileObject.path,title:e})),t.watchFile(i.fileObject.path,mxUtils.bind(this,function(e,t){e.mtimeMs!=t.mtimeMs&&(i.unwatchedSaves||null!=i.state&&i.stat.mtimeMs==e.mtimeMs?i.unwatchedSaves=!1:(i.inConflictState=!0,this.showError(mxResources.get("externalChanges"),mxResources.get("fileChangedSyncDialog"),mxResources.get("synchronize"),mxUtils.bind(this,function(){this.spinner.spin(document.body,mxResources.get("updatingDocument"))&&i.synchronizeFile(mxUtils.bind(this,function(){this.spinner.stop()}),mxUtils.bind(this,function(e){i.handleFileError(e,!0)}))}),null,null,null,mxResources.get("cancel"),mxUtils.bind(this,function(){this.hideDialog(),i.handleFileError(null,!1)}),340,150)))}))),r.apply(this,arguments)},App.prototype.pickFile=function(){var e=mxUtils.bind(this,function(){this.chooseFileEntry(mxUtils.bind(this,function(e,t,i,n,s){t=new LocalFile(this,t,"");t.fileObject=e,t.stat=i,t.setModified(!!s),this.fileLoaded(t)}))}),t=this.getCurrentFile();null!=t&&t.isModified()?this.confirm(mxResources.get("allChangesLost"),null,e,mxResources.get("cancel"),mxResources.get("discardChanges")):e()},App.prototype.pickLibrary=function(e){this.chooseFileEntry(mxUtils.bind(this,function(e,t,i){try{var n=new DesktopLibrary(this,t,e);this.loadLibrary(n)}catch(e){this.handleError(e,mxResources.get("errorLoadingFile"))}}))},App.prototype.chooseFileEntry=function(e){var t=require("@electron/remote").dialog;const i=require("path");var n=localStorage.getItem(".lastOpenDir"),n=t.showOpenDialogSync({defaultPath:n||d(),filters:[{name:"draw.io Diagrams",extensions:["drawio","xml","png","svg","html"]},{name:"VSDX Documents",extensions:["vsdx"]},{name:"All Files",extensions:["*"]}],properties:["openFile"]});void 0!==n&&null!=n[0]?(localStorage.setItem(".lastOpenDir",i.dirname(n[0])),this.readGraphFile(e,mxUtils.bind(this,function(e){this.handleError(e)}),n[0])):this.spinner.stop()};var l=EditorUi.prototype.openFiles,o={};EditorUi.prototype.openFiles=function(e,t){o={};for(var i=0;i<e.length;i++)o[e[i].name]=e[i];l.apply(this,arguments)},App.prototype.readGraphFile=function(s,r,l){var o=require("fs"),e=l.lastIndexOf(".png"),a=-1<e&&e==l.length-4,c=/\.vsdx$/i.test(l)||/\.vssx$/i.test(l),u=c?null:a||/\.pdf$/i.test(l)?"base64":"utf-8",p=!1,d=!1,n=mxUtils.bind(this,function(e,i){if(e)r(e),d=!0;else{var n=new Object;if(n.path=l,n.name=l.replace(/^.*[\\\/]/,""),n.type=u,c){var t=n.name;this.importVisio(i,mxUtils.bind(this,function(e){if(0<=t.lastIndexOf(".")?t=t.substring(0,t.lastIndexOf("."))+".drawio":t+=".drawio","<mxlibrary"==e.substring(0,10)){null==this.getCurrentFile()&&"1"!=urlParams.embed&&this.openLocalFile(this.emptyDiagramXml,this.defaultFilename);try{this.loadLibrary(new LocalLibrary(this,e,t))}catch(e){this.handleError(e,mxResources.get("errorLoadingFile"))}s()}else s(null,e,null,t,p);d=!0}),null,t)}else{if(/\.pdf$/i.test(l)){e=Editor.extractGraphModelFromPdf("data:application/pdf;base64,"+i);if(null!=e){t=n.name;return s(null,e,null,t.substring(0,t.lastIndexOf("."))+".drawio",p),void(d=!0)}}else a&&(i=this.extractGraphModelFromPng("data:image/png;base64,"+i));o.stat(l,function(e,t){e?r(e):s(n,i,t,null,p),d=!0})}}});o.readFile(l,u,n);var h=mxUtils.bind(this,function(e,t){var i;d?e||(i=new DraftDialog(this,mxResources.get("backupFound"),t,mxUtils.bind(this,function(){this.hideDialog(),p=!0,n(null,t),o.unlink(m,e=>{})}),mxUtils.bind(this,function(){this.hideDialog(),o.unlink(m,e=>{})})),this.showDialog(i.container,640,480,!0,!1,mxUtils.bind(this,function(e){})),i.init()):setTimeout(function(){h(e,t)},10)}),m=g(l);o.readFile(m,u,h)};var c=LocalFile;function g(e){const t=require("path");return t.join(t.dirname(e),"~$"+t.basename(e)+".bkp")}LocalFile=function(e,t,i,n){c.call(this,e,t,i,!1)},mxUtils.extend(LocalFile,c),LocalFile.prototype.getLatestVersion=function(r,e){null==this.fileObject?null!=e&&e({message:mxResources.get("fileNotFound")}):this.ui.readGraphFile(mxUtils.bind(this,function(e,t,i,n,s){t=new LocalFile(this,t,"");t.stat=i,t.setModified(!!s),r(t)}),e,this.fileObject.path)},LocalFile.prototype.copyFile=function(e,t){this.saveAs(this.ui.getCopyFilename(this),e,t)},LocalFile.prototype.getDescriptor=function(){return this.stat},LocalFile.prototype.setDescriptor=function(e){this.stat=e},LocalFile.prototype.reloadFile=function(a){var e;null==this.fileObject?this.ui.handleError({message:mxResources.get("fileNotFound")}):(this.ui.spinner.stop(),e=mxUtils.bind(this,function(){this.setModified(!1);var r=this.ui.currentPage,l=this.ui.editor.graph.getViewState(),o=this.ui.editor.graph.getSelectionCells();this.ui.spinner.spin(document.body,mxResources.get("loading"))&&this.ui.readGraphFile(mxUtils.bind(this,function(e,t,i,n,s){this.ui.spinner.stop();t=new LocalFile(this.ui,t,"");t.fileObject=e,t.stat=i,t.setModified(!!s),this.ui.fileLoaded(t),this.ui.restoreViewState(r,l,o),null!=this.backupPatch&&this.patch([this.backupPatch]),null!=a&&a()}),mxUtils.bind(this,function(e){this.handleFileError(e)}),this.fileObject.path)}),this.isModified()&&null==this.backupPatch?this.ui.confirm(mxResources.get("allChangesLost"),mxUtils.bind(this,function(){this.handleFileSuccess("manual"==DrawioFile.SYNC)}),e,mxResources.get("cancel"),mxResources.get("discardChanges")):e())},LocalFile.prototype.isAutosave=function(){return null!=this.fileObject&&DrawioFile.prototype.isAutosave.apply(this,arguments)},LocalFile.prototype.isAutosaveOptional=function(){return null!=this.fileObject},LocalFile.prototype.getTitle=function(){return null!=this.fileObject?this.fileObject.name:this.title},LocalFile.prototype.isRenamable=function(){return!1},LocalFile.prototype.open=DrawioFile.prototype.open,LocalFile.prototype.save=function(e,t,i,n,s){DrawioFile.prototype.save.apply(this,[e,mxUtils.bind(this,function(){this.saveFile(e,t,i,n,s)}),i,n,s])},LocalFile.prototype.isConflict=function(e){return null!=e&&null!=this.stat&&e.mtimeMs!=this.stat.mtimeMs},LocalFile.prototype.getFilename=function(){var e=this.title;return!(0<e.length)||/(\.xml)$/i.test(e)||/(\.html)$/i.test(e)||/(\.svg)$/i.test(e)||/(\.png)$/i.test(e)||/(\.drawio)$/i.test(e)||(e+=".drawio"),e},LocalLibrary.prototype.getFilename=LocalFile.prototype.getFilename,LocalFile.prototype.saveFile=function(e,s,r,t,l){if("function"==typeof s){if(!this.savingFile){var i=mxUtils.bind(this,function(){var e,t=mxUtils.bind(this,function(e,t){var i=this.data;this.setShadowModified(!1),this.savingFile=!0;var n=mxUtils.bind(this,function(e){this.savingFile=!1,null!=r&&r(e)});null==this.fileObject.bkpPath&&(this.fileObject.bkpPath=g(this.fileObject.path)),this.unwatchedSaves=!0,App.filesWorkerReq({action:"saveFile",fileObject:this.fileObject,defEnc:t,data:e,origStat:this.stat,overwrite:l},mxUtils.bind(this,function(e){this.setModified(this.getShadowModified()),this.savingFile=!1;var t=this.stat;this.stat=e.stat,this.fileSaved(i,t,mxUtils.bind(this,function(){this.contentChanged(),null!=s&&s()}),r)}),mxUtils.bind(this,function(e,t){"empty data"==e?this.ui.handleError({message:mxResources.get("errorSavingFile")}):"conflict"==e&&(this.inConflictState=!0),n()}))});/(\.png)$/i.test(this.fileObject.name)?(e=this.ui.getPngFileProperties(this.ui.fileNode),this.ui.getEmbeddedPng(function(e){t(atob(e),"binary")},r,null,e.scale,e.border)):t(this.getData())});if(null==this.fileObject){var n=require("@electron/remote").dialog;const p=require("path");var o,a=localStorage.getItem(".lastSaveDir"),c=this.getFilename(),u=null;null==c||0<(o=c.lastIndexOf("."))&&(u=c.substring(o+1),c=c.substring(0,o));u=n.showSaveDialogSync({defaultPath:(a||d())+"/"+c,filters:this.ui.createFileSystemFilters(u)});null!=u?(localStorage.setItem(".lastSaveDir",p.dirname(u)),this.fileObject=new Object,this.fileObject.path=u,this.fileObject.name=u.replace(/^.*[\\\/]/,""),this.fileObject.type="utf-8",i()):this.ui.spinner.stop()}else i()}}else"function"==typeof t&&t({message:"This is a bug, please report!"})},LocalFile.prototype.saveAs=function(e,t,i){var n=require("@electron/remote").dialog;const s=require("path");var r,l=localStorage.getItem(".lastSaveDir"),o=this.getFilename(),a=null;""!=o||null==this.fileObject||null==this.fileObject.name||0<(r=(o=this.fileObject.name).lastIndexOf("."))&&(a=o.substring(r+1),o=o.substring(0,r));a=n.showSaveDialogSync({defaultPath:(l||d())+"/"+o,filters:this.ui.createFileSystemFilters(a)});null!=a&&(localStorage.setItem(".lastSaveDir",s.dirname(a)),this.fileObject=new Object,this.fileObject.path=a,this.fileObject.name=a.replace(/^.*[\\\/]/,""),this.fileObject.type="utf-8",this.save(!1,t,i,null,!0))},App.prototype.createFileSystemFilters=function(e){for(var t=[],i=0;i<this.editor.diagramFileTypes.length;i++){var n={name:mxResources.get(this.editor.diagramFileTypes[i].description)+" (."+this.editor.diagramFileTypes[i].extension+")",extensions:[this.editor.diagramFileTypes[i].extension]};this.editor.diagramFileTypes[i].extension==e?t.splice(0,0,n):t.push(n)}return t},App.prototype.saveFile=function(e){var t=this.getCurrentFile();null!=t&&(e||null==t.getTitle()?t.saveAs(null,mxUtils.bind(this,function(){EditorUi.enableDrafts&&t.removeDraft(),t.handleFileSuccess(!0)}),mxUtils.bind(this,function(e){t.handleFileError(e,!0)})):t.save(!0,mxUtils.bind(this,function(){EditorUi.enableDrafts&&t.removeDraft(),t.handleFileSuccess(!0)}),mxUtils.bind(this,function(e){t.handleFileError(e,!0)})))},App.prototype.saveLibrary=function(e,t,i,n,s,r,l){n=null!=n?n:this.mode,s=null!=s&&s,r=null!=r&&r;var o,a,n=this.createLibraryDataFromImages(t),c=mxUtils.bind(this,function(e){this.spinner.stop(),null!=l&&l(),null!=e&&this.handleError(e,mxResources.get("errorSavingFile"))});null==i&&(i=new LocalLibrary(this,n,e)),(s||this.spinner.spin(document.body,mxResources.get("saving")))&&(i.setData(n),o=mxUtils.bind(this,function(){i.save(!0,mxUtils.bind(this,function(e){this.spinner.stop(),this.hideDialog(!0),r||this.libraryLoaded(i,t),null!=l&&l()}),c)}),e!=i.getTitle()?(a=i.getHash(),i.rename(e,mxUtils.bind(this,function(e){i.constructor!=LocalLibrary&&a!=i.getHash()&&(mxSettings.removeCustomLibrary(a),mxSettings.addCustomLibrary(i.getHash())),this.removeLibrarySidebar(a),o()}),c)):o())},EditorUi.prototype.writeImageToClipboard=function(e,t,i,n){try{const s=require("@electron/remote");s.clipboard.write({image:s.nativeImage.createFromDataURL(e),html:'<img src="'+e+'" width="'+t+'" height="'+i+'">'})}catch(e){n(e)}};var u=EditorUi.prototype.updateActionStates;function m(e,t){this.reqType=e,this.reqObj=t}EditorUi.prototype.updateActionStates=function(){u.apply(this,arguments);var e=this.getCurrentFile(),e=null!=e&&null!=e.fileObject;this.actions.get("synchronize").setEnabled(e)},EditorUi.prototype.saveLocalFile=function(e,t,i,n,s,r){this.saveData(t,s,e,i,n)},EditorUi.prototype.saveRequest=function(e,t,i,n,s,r){var l=i(null,"1");null!=l&&this.spinner.spin(document.body,mxResources.get("saving"))&&l.send(mxUtils.bind(this,function(){this.spinner.stop(),200<=l.getStatus()&&l.getStatus()<=299?this.saveData(e,t,l.getText(),r,!0):this.handleError({message:mxResources.get("errorSavingFile")})}),mxUtils.bind(this,function(e){this.spinner.stop(),this.handleError(e)}))},mxUtils.extend(m,mxXmlRequest),m.prototype.send=function(i,n){const s=require("electron").ipcRenderer;s.send(this.reqType,this.reqObj),s.once(this.reqType+"-success",(e,t)=>{this.response=t,i(),s.send(this.reqType+"-finalize")}),s.once(this.reqType+"-error",(e,t)=>{this.hasError=!0,n(t),s.send(this.reqType+"-finalize")})},m.prototype.getStatus=function(){return this.hasError?500:200},m.prototype.getText=function(){return this.response},EditorUi.prototype.createDownloadRequest=function(e,t,i,n,s,r,l,o,a,c){var u=this.editor.graph,p=(u.getGraphBounds(),this.getFileData(!0,null,null,null,i,0!=r&&"xmlpng"!=t)),d=null,i=null,c=c?"1":"0";if("pdf"==t&&0==r&&(i="1"),"xmlpng"==t&&(c="1",t="png",null!=this.pages&&null!=this.currentPage))for(var h=0;h<this.pages.length;h++)if(this.pages[h]==this.currentPage){d=h;break}r=u.background;"png"==t&&s?r=mxConstants.NONE:s||null!=r&&r!=mxConstants.NONE||(r="#ffffff");s={globalVars:u.getExportVariables()};return a&&(s.grid={size:u.gridSize,steps:u.view.gridSteps,color:u.view.gridColor}),new m("export",{format:t,xml:p,from:d,bg:null!=r?r:mxConstants.NONE,filename:null!=e?e:null,allPages:i,base64:n,embedXml:c,extras:encodeURIComponent(JSON.stringify(s)),scale:l,border:o})};var h=ExportDialog.exportFile;ExportDialog.exportFile=function(e,t,i,n,s,r,l){var o=e.editor.graph;if("xml"==i||"svg"==i)return h.apply(this,arguments);var a,c=e.getFileData(!0,null,null,null,null,!0),u=o.getGraphBounds(),p=Math.floor(u.width*s/o.view.scale),d=Math.floor(u.height*s/o.view.scale);e.hideDialog(),"png"!=i&&"jpg"!=i&&"jpeg"!=i||!e.isExportToCanvas()?(a={globalVars:o.getExportVariables()},e.saveRequest(t,i,function(e,t){return new m("export",{format:i,xml:c,bg:null!=n?n:mxConstants.NONE,filename:null!=e?e:null,w:p,h:d,border:r,base64:t||"0",extras:JSON.stringify(a),dpi:0<l?l:null})})):"png"==i?e.exportImage(s,null==n||"none"==n,!0,!1,!1,r,!0,!1,null,null,l):e.exportImage(s,!1,!0,!1,!1,r,!0,!1,"jpeg")},EditorUi.prototype.saveData=function(s,r,l,e,o){var a=require("@electron/remote").dialog,c=null!=this.spinner&&null!=this.spinner.pause?this.spinner.pause():function(){};const u=require("path");var p=localStorage.getItem(".lastExpDir");window.setTimeout(mxUtils.bind(this,function(){var e={defaultPath:(p||d())+"/"+s},t=null;switch(r){case"xmlpng":case"png":t=[{name:"PNG Images",extensions:["png"]}];break;case"jpg":case"jpeg":t=[{name:"JPEG Images",extensions:["jpg","jpeg"]}];break;case"svg":t=[{name:"SVG Images",extensions:["svg"]}];break;case"pdf":t=[{name:"PDF Documents",extensions:["pdf"]}];break;case"vsdx":t=[{name:"VSDX Documents",extensions:["vsdx"]}];break;case"html":t=[{name:"HTML Documents",extensions:["html"]}];break;case"xml":t=[{name:"XML Documents",extensions:["xml"]}]}e.filters=t;var i,n=a.showSaveDialogSync(e);null!=n&&(localStorage.setItem(".lastExpDir",u.dirname(n)),null==l||0==l.length?this.handleError({message:mxResources.get("errorSavingFile")}):(i=require("fs"),c(),(e=new Object).path=n,e.name=n.replace(/^.*[\\\/]/,""),e.type=o?"base64":"utf-8",i.writeFile(e.path,l,e.type,mxUtils.bind(this,function(e){this.spinner.stop(),e&&this.handleError({message:mxResources.get("errorSavingFile")})}))))}),50)},EditorUi.prototype.addBeforeUnloadListener=function(){},EditorUi.prototype.loadDesktopLib=function(e,n,t){this.readGraphFile(mxUtils.bind(this,function(e,t,i){e=new DesktopLibrary(this,t,e);this.loadLibrary(e),n(e)}),t,e)}}();