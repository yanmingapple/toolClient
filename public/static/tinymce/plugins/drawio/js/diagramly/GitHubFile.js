GitHubFile=function(t,i,e){DrawioFile.call(this,t,i),this.meta=e,this.peer=this.ui.gitHub},mxUtils.extend(GitHubFile,DrawioFile),GitHubFile.prototype.share=function(){this.ui.editor.graph.openLink("https://github.com/"+encodeURIComponent(this.meta.org)+"/"+encodeURIComponent(this.meta.repo)+"/settings/access")},GitHubFile.prototype.getId=function(){return encodeURIComponent(this.meta.org)+"/"+(null!=this.meta.repo?encodeURIComponent(this.meta.repo)+"/"+(null!=this.meta.ref?this.meta.ref+(null!=this.meta.path?"/"+this.meta.path:""):""):"")},GitHubFile.prototype.getHash=function(){return encodeURIComponent("H"+this.getId())},GitHubFile.prototype.getPublicUrl=function(i){null!=this.meta.download_url?mxUtils.get(this.meta.download_url,mxUtils.bind(this,function(t){i(200<=t.getStatus()&&t.getStatus()<=299?this.meta.download_url:null)}),mxUtils.bind(this,function(){i(null)})):i(null)},GitHubFile.prototype.isConflict=function(t){return null!=t&&409==t.status},GitHubFile.prototype.getMode=function(){return App.MODE_GITHUB},GitHubFile.prototype.isAutosave=function(){return!1},GitHubFile.prototype.getTitle=function(){return this.meta.name},GitHubFile.prototype.isRenamable=function(){return!1},GitHubFile.prototype.getLatestVersion=function(t,i){this.peer.getFile(this.getId(),t,i)},GitHubFile.prototype.isCompressedStorage=function(){return!1},GitHubFile.prototype.getDescriptor=function(){return this.meta},GitHubFile.prototype.setDescriptor=function(t){this.meta=t},GitHubFile.prototype.getDescriptorEtag=function(t){return t.sha},GitHubFile.prototype.setDescriptorEtag=function(t,i){t.sha=i},GitHubFile.prototype.save=function(t,i,e,s,n,o){this.doSave(this.getTitle(),i,e,s,n,o)},GitHubFile.prototype.saveAs=function(t,i,e){this.doSave(t,i,e)},GitHubFile.prototype.doSave=function(t,i,e,s,n,o){var l=this.meta.name;this.meta.name=t,DrawioFile.prototype.save.apply(this,[null,mxUtils.bind(this,function(){this.meta.name=l,this.saveFile(t,!1,i,e,s,n,o)}),e,s,n])},GitHubFile.prototype.saveFile=function(n,t,o,l,i,a,e){var s;this.isEditable()?this.savingFile?null!=l&&l({code:App.ERROR_BUSY}):(s=mxUtils.bind(this,function(i){if(this.getTitle()==n)try{this.savingFileTime=new Date,this.setShadowModified(!1),this.savingFile=!0;var e=this.getCurrentEtag(),s=this.data;this.peer.saveFile(this,mxUtils.bind(this,function(t){this.setModified(this.getShadowModified()),this.savingFile=!1,this.setDescriptorEtag(this.meta,t),this.fileSaved(s,e,mxUtils.bind(this,function(){this.contentChanged(),null!=o&&o()}),l)}),mxUtils.bind(this,function(t){this.savingFile=!1,this.isConflict(t)?(this.inConflictState=!0,null!=l&&l({commitMessage:i})):null!=l&&l(t)}),a,i)}catch(t){if(this.savingFile=!1,null==l)throw t;l(t)}else this.savingFileTime=new Date,this.setShadowModified(!1),this.savingFile=!0,this.ui.pickFolder(this.getMode(),mxUtils.bind(this,function(t){this.peer.insertFile(n,this.getData(),mxUtils.bind(this,function(t){this.setModified(this.getShadowModified()),this.savingFile=!1,null!=o&&o(),this.ui.fileLoaded(t)}),mxUtils.bind(this,function(){this.savingFile=!1,null!=l&&l()}),!1,t,i)}))}),null!=e?s(e):this.peer.showCommitDialog(this.meta.name,null==this.getDescriptorEtag(this.meta)||this.meta.isNew,mxUtils.bind(this,function(t){s(t)}),l)):null!=o&&o()};