function DiagramPage(e,t){this.node=e,null!=t?this.node.setAttribute("id",t):null==this.getId()&&this.node.setAttribute("id",Editor.guid())}function RenamePage(e,t,i){this.ui=e,this.page=t,this.name=i,this.previous=i}function MovePage(e,t,i){this.ui=e,this.oldIndex=t,this.newIndex=i}function SelectPage(e,t,i){this.ui=e,this.page=t,this.previousPage=t,this.neverShown=!0,null!=t&&(this.neverShown=null==t.viewState,this.ui.updatePageRoot(t),null!=i&&(t.viewState=i,this.neverShown=!1))}function ChangePage(e,t,i,n,a){SelectPage.call(this,e,i),this.relatedPage=t,this.index=n,this.previousIndex=null,this.noSelect=a}DiagramPage.prototype.node=null,DiagramPage.prototype.root=null,DiagramPage.prototype.viewState=null,DiagramPage.prototype.getId=function(){return this.node.getAttribute("id")},DiagramPage.prototype.getName=function(){return this.node.getAttribute("name")},DiagramPage.prototype.setName=function(e){null==e?this.node.removeAttribute("name"):this.node.setAttribute("name",e)},RenamePage.prototype.execute=function(){var e=this.page.getName();this.page.setName(this.previous),this.name=this.previous,this.previous=e,this.ui.editor.graph.updatePlaceholders(),this.ui.editor.fireEvent(new mxEventObject("pageRenamed"))},MovePage.prototype.execute=function(){this.ui.pages.splice(this.newIndex,0,this.ui.pages.splice(this.oldIndex,1)[0]);var e=this.oldIndex;this.oldIndex=this.newIndex,this.newIndex=e,this.ui.editor.graph.updatePlaceholders(),this.ui.editor.fireEvent(new mxEventObject("pageMoved"))},SelectPage.prototype.execute=function(){var e,t,i,n=mxUtils.indexOf(this.ui.pages,this.previousPage);null!=this.page&&0<=n&&(e=this.ui.currentPage,i=(t=this.ui.editor).graph,n=Graph.compressNode(t.getGraphXml(!0)),mxUtils.setTextContent(e.node,n),e.viewState=i.getViewState(),e.root=i.model.root,null!=e.model&&e.model.rootChanged(e.root),i.view.clear(e.root,!0),i.clearSelection(),this.ui.currentPage=this.previousPage,this.previousPage=e,e=this.ui.currentPage,i.model.prefix=Editor.guid()+"-",i.model.rootChanged(e.root),i.setViewState(e.viewState),i.gridEnabled=i.gridEnabled&&(!this.ui.editor.isChromelessView()||"1"==urlParams.grid),t.updateGraphComponents(),i.view.validate(),i.blockMathRender=!0,i.sizeDidChange(),i.blockMathRender=!1,this.neverShown&&(this.neverShown=!1,i.selectUnlockedLayer()),t.graph.fireEvent(new mxEventObject(mxEvent.ROOT)),t.fireEvent(new mxEventObject("pageSelected","change",this)))},mxUtils.extend(ChangePage,SelectPage),ChangePage.prototype.execute=function(){var e;this.ui.editor.fireEvent(new mxEventObject("beforePageChange","change",this)),this.previousIndex=this.index,null==this.index?(e=mxUtils.indexOf(this.ui.pages,this.relatedPage),this.ui.pages.splice(e,1),this.index=e):(this.ui.pages.splice(this.index,0,this.relatedPage),this.index=null),this.noSelect||SelectPage.prototype.execute.apply(this,arguments)},EditorUi.prototype.tabContainerHeight=38,EditorUi.prototype.getSelectedPageIndex=function(){return this.getPageIndex(this.currentPage)},EditorUi.prototype.getPageIndex=function(e){var t=null;if(null!=this.pages&&null!=e)for(var i=0;i<this.pages.length;i++)if(this.pages[i]==e){t=i;break}return t},EditorUi.prototype.getPageById=function(e){if(null!=this.pages)for(var t=0;t<this.pages.length;t++)if(this.pages[t].getId()==e)return this.pages[t];return null},EditorUi.prototype.createImageForPageLink=function(e,t,i){var n=e.indexOf(","),a=null;return 0<n&&(null!=(n=this.getPageById(e.substring(n+1)))&&n!=t&&((a=this.getImageForPage(n,t,i)).originalSrc=e)),a=null==a?{originalSrc:e}:a},EditorUi.prototype.getImageForPage=function(e,t,i){var n=(i=null!=i?i:this.editor.graph).getGlobalVariable,a=this.createTemporaryGraph(i.getStylesheet());a.defaultPageBackgroundColor=i.defaultPageBackgroundColor,a.defaultForegroundColor=i.defaultForegroundColor;var r=this.getPageIndex(null!=t?t:this.currentPage);a.getGlobalVariable=function(e){return"pagenumber"==e?r+1:"page"==e&&null!=t?t.getName():n.apply(this,arguments)},document.body.appendChild(a.container),this.updatePageRoot(e),a.model.setRoot(e.root);i=a.getSvg(null,null,null,null,null,null,null,null,null,null,null,!0),e=a.getGraphBounds();return document.body.removeChild(a.container),new mxImage(Editor.createSvgDataUri(mxUtils.getXml(i)),e.width,e.height,e.x,e.y)},EditorUi.prototype.initPages=function(){var t,i,n,a;this.editor.graph.standalone||(this.actions.addAction("previousPage",mxUtils.bind(this,function(){this.selectNextPage(!1)})),this.actions.addAction("nextPage",mxUtils.bind(this,function(){this.selectNextPage(!0)})),this.isPagesEnabled()&&(this.keyHandler.bindAction(33,!0,"previousPage",!0),this.keyHandler.bindAction(34,!0,"nextPage",!0)),t=this.editor.graph,i=t.view.validateBackground,t.view.validateBackground=mxUtils.bind(this,function(){var e;null!=this.tabContainer&&(e=this.tabContainer.style.height,null==this.fileNode||null==this.pages||1==this.pages.length&&"0"==urlParams.pages?this.tabContainer.style.height="0px":this.tabContainer.style.height=this.tabContainerHeight+"px",e!=this.tabContainer.style.height&&this.refresh(!1)),i.apply(t.view,arguments)}),n=null,a=mxUtils.bind(this,function(){this.updateTabContainer();var e=this.currentPage;null!=e&&e!=n&&(null==e.viewState||null==e.viewState.scrollLeft?(this.resetScrollbars(),t.isLightboxView()&&this.lightboxFit(),null!=this.chromelessResize&&(t.container.scrollLeft=0,t.container.scrollTop=0,this.chromelessResize())):(t.container.scrollLeft=t.view.translate.x*t.view.scale+e.viewState.scrollLeft,t.container.scrollTop=t.view.translate.y*t.view.scale+e.viewState.scrollTop),n=e),null!=this.actions.layersWindow&&this.actions.layersWindow.refreshLayers(),"undefined"!=typeof MathJax&&void 0!==MathJax.Hub?1!=MathJax.Hub.queue.pending||null==this.editor||this.editor.graph.mathEnabled||MathJax.Hub.Queue(mxUtils.bind(this,function(){null!=this.editor&&this.editor.graph.refresh()})):void 0===Editor.MathJaxClear||null!=this.editor&&this.editor.graph.mathEnabled||Editor.MathJaxClear()}),this.editor.graph.model.addListener(mxEvent.CHANGE,mxUtils.bind(this,function(e,t){for(var i=t.getProperty("edit").changes,n=0;n<i.length;n++)if(i[n]instanceof SelectPage||i[n]instanceof RenamePage||i[n]instanceof MovePage||i[n]instanceof mxRootChange){a();break}})),null!=this.toolbar&&this.editor.addListener("pageSelected",this.toolbar.updateZoom))},EditorUi.prototype.restoreViewState=function(e,t,i){var n=null!=e?this.getPageById(e.getId()):null,e=this.editor.graph;null!=n&&null!=this.currentPage&&null!=this.pages&&(n!=this.currentPage?this.selectPage(n,!0,t):(e.setViewState(t),this.editor.updateGraphComponents(),e.view.revalidate(),e.sizeDidChange()),e.container.scrollLeft=e.view.translate.x*e.view.scale+t.scrollLeft,e.container.scrollTop=e.view.translate.y*e.view.scale+t.scrollTop,e.restoreSelection(i))},Graph.prototype.createViewState=function(e){var t=e.getAttribute("page"),i=parseFloat(e.getAttribute("pageScale")),n=parseFloat(e.getAttribute("pageWidth")),a=parseFloat(e.getAttribute("pageHeight")),r=e.getAttribute("background"),s=this.parseBackgroundImage(e.getAttribute("backgroundImage")),o=e.getAttribute("extFonts");if(o)try{o=o.split("|").map(function(e){e=e.split("^");return{name:e[0],url:e[1]}})}catch(e){console.log("ExtFonts format error: "+e.message)}return{gridEnabled:"0"!=e.getAttribute("grid"),gridSize:parseFloat(e.getAttribute("gridSize"))||mxGraph.prototype.gridSize,guidesEnabled:"0"!=e.getAttribute("guides"),foldingEnabled:"0"!=e.getAttribute("fold"),shadowVisible:"1"==e.getAttribute("shadow"),pageVisible:!this.isLightboxView()&&(null!=t?"0"!=t:this.defaultPageVisible),background:null!=r&&0<r.length?r:null,backgroundImage:s,pageScale:isNaN(i)?mxGraph.prototype.pageScale:i,pageFormat:isNaN(n)||isNaN(a)?"undefined"==typeof mxSettings||null!=this.defaultPageFormat?mxGraph.prototype.pageFormat:mxSettings.getPageFormat():new mxRectangle(0,0,n,a),tooltips:"0"!=e.getAttribute("tooltips"),connect:"0"!=e.getAttribute("connect"),arrows:"0"!=e.getAttribute("arrows"),mathEnabled:"1"==e.getAttribute("math"),selectionCells:null,defaultParent:null,scrollbars:this.defaultScrollbars,scale:1,hiddenTags:[],extFonts:o||[]}},Graph.prototype.saveViewState=function(e,t,i,n){i||(t.setAttribute("grid",null==e||e.gridEnabled?"1":"0"),t.setAttribute("gridSize",(null!=e?e:mxGraph.prototype).gridSize),t.setAttribute("guides",null==e||e.guidesEnabled?"1":"0"),t.setAttribute("tooltips",null==e||e.tooltips?"1":"0"),t.setAttribute("connect",null==e||e.connect?"1":"0"),t.setAttribute("arrows",null==e||e.arrows?"1":"0"),t.setAttribute("page",null==e&&this.defaultPageVisible||null!=e&&e.pageVisible?"1":"0"),t.setAttribute("fold",null==e||e.foldingEnabled?"1":"0")),t.setAttribute("pageScale",(null!=e&&null!=e.pageScale?e:mxGraph.prototype).pageScale);i=null!=e?e.pageFormat:"undefined"==typeof mxSettings||null!=this.defaultPageFormat?mxGraph.prototype.pageFormat:mxSettings.getPageFormat();null!=i&&(t.setAttribute("pageWidth",i.width),t.setAttribute("pageHeight",i.height)),null!=e&&(null!=e.background&&t.setAttribute("background",e.background),null!=(n=this.getBackgroundImageObject(e.backgroundImage,n))&&t.setAttribute("backgroundImage",JSON.stringify(n))),t.setAttribute("math",null!=e&&e.mathEnabled?"1":"0"),t.setAttribute("shadow",null!=e&&e.shadowVisible?"1":"0"),null!=e&&null!=e.extFonts&&0<e.extFonts.length&&t.setAttribute("extFonts",e.extFonts.map(function(e){return e.name+"^"+e.url}).join("|"))},Graph.prototype.getViewState=function(){return{defaultParent:this.defaultParent,currentRoot:this.view.currentRoot,gridEnabled:this.gridEnabled,gridSize:this.gridSize,guidesEnabled:this.graphHandler.guidesEnabled,foldingEnabled:this.foldingEnabled,shadowVisible:this.shadowVisible,scrollbars:this.scrollbars,pageVisible:this.pageVisible,background:this.background,backgroundImage:this.backgroundImage,pageScale:this.pageScale,pageFormat:this.pageFormat,tooltips:this.tooltipHandler.isEnabled(),connect:this.connectionHandler.isEnabled(),arrows:this.connectionArrowsEnabled,scale:this.view.scale,scrollLeft:this.container.scrollLeft-this.view.translate.x*this.view.scale,scrollTop:this.container.scrollTop-this.view.translate.y*this.view.scale,translate:this.view.translate.clone(),lastPasteXml:this.lastPasteXml,pasteCounter:this.pasteCounter,mathEnabled:this.mathEnabled,hiddenTags:this.hiddenTags,extFonts:this.extFonts}},Graph.prototype.setViewState=function(e,t){if(null!=e){this.lastPasteXml=e.lastPasteXml,this.pasteCounter=e.pasteCounter||0,this.mathEnabled=e.mathEnabled,this.gridEnabled=e.gridEnabled,this.gridSize=e.gridSize,this.graphHandler.guidesEnabled=e.guidesEnabled,this.foldingEnabled=e.foldingEnabled,this.setShadowVisible(e.shadowVisible,!1),this.scrollbars=e.scrollbars,this.pageVisible=!this.isViewer()&&e.pageVisible,this.background=e.background,this.pageScale=e.pageScale,this.pageFormat=e.pageFormat,this.view.currentRoot=e.currentRoot,this.defaultParent=e.defaultParent,this.connectionArrowsEnabled=e.arrows,this.setTooltips(e.tooltips),this.setConnectable(e.connect),this.setBackgroundImage(e.backgroundImage),this.hiddenTags=e.hiddenTags;var i=this.extFonts;if(this.extFonts=e.extFonts||[],t&&null!=i)for(var n=0;n<i.length;n++){var a=document.getElementById("extFont_"+i[n].name);null!=a&&a.parentNode.removeChild(a)}for(n=0;n<this.extFonts.length;n++)this.addExtFont(this.extFonts[n].name,this.extFonts[n].url,!0);null!=e.scale?this.view.scale=e.scale:this.view.scale=1,null==this.view.currentRoot||this.model.contains(this.view.currentRoot)||(this.view.currentRoot=null),null==this.defaultParent||this.model.contains(this.defaultParent)||(this.setDefaultParent(null),this.selectUnlockedLayer()),null!=e.translate&&(this.view.translate=e.translate)}else this.view.currentRoot=null,this.view.scale=1,this.gridEnabled=this.defaultGridEnabled,this.gridSize=mxGraph.prototype.gridSize,this.pageScale=mxGraph.prototype.pageScale,this.pageFormat="undefined"==typeof mxSettings||null!=this.defaultPageFormat?mxGraph.prototype.pageFormat:mxSettings.getPageFormat(),this.pageVisible=this.defaultPageVisible,this.background=null,this.backgroundImage=null,this.scrollbars=this.defaultScrollbars,this.graphHandler.guidesEnabled=!0,this.foldingEnabled=!0,this.setShadowVisible(!1,!1),this.defaultParent=null,this.setTooltips(!0),this.setConnectable(!0),this.lastPasteXml=null,this.pasteCounter=0,this.mathEnabled=this.defaultMathEnabled,this.connectionArrowsEnabled=!0,this.hiddenTags=[],this.extFonts=[];this.pageBreaksVisible=this.pageVisible,this.preferPageSize=this.pageVisible,this.fireEvent(new mxEventObject("viewStateChanged","state",e))},Graph.prototype.addExtFont=function(e,t,i){if(e&&t){"1"!=urlParams["ext-fonts"]&&(Graph.recentCustomFonts[e.toLowerCase()]={name:e,url:t});var n,a="extFont_"+e;if(null==document.getElementById(a)&&(0==t.indexOf(Editor.GOOGLE_FONTS)?mxClient.link("stylesheet",t,null,a):(document.getElementsByTagName("head")[0],(n=document.createElement("style")).appendChild(document.createTextNode('@font-face {\n\tfont-family: "'+e+'";\n\tsrc: url("'+t+'");\n}')),n.setAttribute("id",a),document.getElementsByTagName("head")[0].appendChild(n))),!i){null==this.extFonts&&(this.extFonts=[]);for(var r=this.extFonts,s=!0,o=0;o<r.length;o++)if(r[o].name==e){s=!1;break}s&&this.extFonts.push({name:e,url:t})}}},EditorUi.prototype.updatePageRoot=function(e,t){if(null==e.root){var i=this.editor.extractGraphModel(e.node,null,t);if(n=Editor.extractParserError(i))throw new Error(n);null!=i?(e.graphModelNode=i,e.viewState=this.editor.graph.createViewState(i),t=new mxCodec(i.ownerDocument),e.root=t.decode(i).root):e.root=this.editor.graph.model.createRoot()}else if(null==e.viewState){if(null==e.graphModelNode){var n,i=this.editor.extractGraphModel(e.node);if(n=Editor.extractParserError(i))throw new Error(n);null!=i&&(e.graphModelNode=i)}null!=e.graphModelNode&&(e.viewState=this.editor.graph.createViewState(e.graphModelNode))}return e},EditorUi.prototype.selectPage=function(e,t,i){try{var n,a;e!=this.currentPage&&(this.editor.graph.isEditing()&&this.editor.graph.stopEditing(!1),t=null!=t&&t,this.editor.graph.isMouseDown=!1,this.editor.graph.reset(),(n=this.editor.graph.model.createUndoableEdit()).ignoreEdit=!0,(a=new SelectPage(this,e,i)).execute(),n.add(a),n.notify(),this.editor.graph.tooltipHandler.hide(),t||this.editor.graph.model.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",n)))}catch(e){this.handleError(e)}},EditorUi.prototype.selectNextPage=function(e){var t=this.currentPage;null!=t&&null!=this.pages&&(t=mxUtils.indexOf(this.pages,t),e?this.selectPage(this.pages[mxUtils.mod(t+1,this.pages.length)]):this.selectPage(this.pages[mxUtils.mod(t-1,this.pages.length)]))},EditorUi.prototype.insertPage=function(e,t){return this.editor.graph.isEnabled()&&(this.editor.graph.isEditing()&&this.editor.graph.stopEditing(!1),e=null!=e?e:this.createPage(null,this.createPageId()),t=new ChangePage(this,e,e,t=null!=t?t:this.pages.length),this.editor.graph.model.execute(t)),e},EditorUi.prototype.createPageId=function(){for(var e=null;e=Editor.guid(),null!=this.getPageById(e););return e},EditorUi.prototype.createPage=function(e,t){t=new DiagramPage(this.fileNode.ownerDocument.createElement("diagram"),t);return t.setName(null!=e?e:this.createPageName()),t},EditorUi.prototype.createPageName=function(){for(var e={},t=0;t<this.pages.length;t++){var i=this.pages[t].getName();null!=i&&0<i.length&&(e[i]=i)}for(var n=this.pages.length,a=null;null!=e[a=mxResources.get("pageWithNumber",[++n])];);return a},EditorUi.prototype.removePage=function(e){try{var t=this.editor.graph,i=mxUtils.indexOf(this.pages,e);if(t.isEnabled()&&0<=i){this.editor.graph.isEditing()&&this.editor.graph.stopEditing(!1),t.model.beginUpdate();try{var n=this.currentPage;n==e&&1<this.pages.length?(i==this.pages.length-1?i--:i++,n=this.pages[i]):this.pages.length<=1&&(n=this.insertPage(),t.model.execute(new RenamePage(this,n,mxResources.get("pageWithNumber",[1])))),t.model.execute(new ChangePage(this,e,n))}finally{t.model.endUpdate()}}}catch(e){this.handleError(e)}return e},EditorUi.prototype.duplicatePage=function(e,t){var i=null;try{var n,a,r,s=this.editor.graph;s.isEnabled()&&(s.isEditing()&&s.stopEditing(),(n=e.node.cloneNode(!1)).removeAttribute("id"),a=new Object,r=s.createCellLookup([s.model.root]),(i=new DiagramPage(n)).root=s.cloneCell(s.model.root,null,a),i.viewState=s.getViewState(),i.viewState.scale=1,i.viewState.scrollLeft=null,i.viewState.scrollTop=null,i.viewState.currentRoot=null,i.viewState.defaultParent=null,i.setName(t),i=this.insertPage(i,mxUtils.indexOf(this.pages,e)+1),s.updateCustomLinks(s.createCellMapping(a,r),[i.root]))}catch(e){this.handleError(e)}return i},EditorUi.prototype.renamePage=function(t){var e;return this.editor.graph.isEnabled()&&(e=new FilenameDialog(this,t.getName(),mxResources.get("rename"),mxUtils.bind(this,function(e){null!=e&&0<e.length&&this.editor.graph.model.execute(new RenamePage(this,t,e))}),mxResources.get("rename")),this.showDialog(e.container,300,80,!0,!0),e.init()),t},EditorUi.prototype.movePage=function(e,t){this.editor.graph.model.execute(new MovePage(this,e,t))},EditorUi.prototype.createTabContainer=function(){},EditorUi.prototype.updateTabContainer=function(){if(null!=this.tabContainer&&null!=this.pages){var i=this.editor.graph,n=document.createElement("div");n.style.position="relative",n.style.display="inline-block",n.style.verticalAlign="top",n.style.height=this.tabContainer.style.height,n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.fontSize="13px",n.style.marginLeft="30px";for(var e=this.editor.isChromelessView()?29:59,t=Math.min(140,Math.max(20,(this.tabContainer.clientWidth-e)/this.pages.length)+1),a=null,r=0;r<this.pages.length;r++)mxUtils.bind(this,function(t,e){this.pages[t]==this.currentPage?(e.className="geActivePage",e.style.backgroundColor=Editor.isDarkMode()?Editor.darkColor:"#fff"):e.className="geInactivePage",e.setAttribute("draggable","true"),mxEvent.addListener(e,"dragstart",mxUtils.bind(this,function(e){i.isEnabled()?(mxClient.IS_FF&&e.dataTransfer.setData("Text","<diagram/>"),a=t):mxEvent.consume(e)})),mxEvent.addListener(e,"dragend",mxUtils.bind(this,function(e){a=null,e.stopPropagation(),e.preventDefault()})),mxEvent.addListener(e,"dragover",mxUtils.bind(this,function(e){null!=a&&(e.dataTransfer.dropEffect="move"),e.stopPropagation(),e.preventDefault()})),mxEvent.addListener(e,"drop",mxUtils.bind(this,function(e){null!=a&&t!=a&&this.movePage(a,t),e.stopPropagation(),e.preventDefault()})),n.appendChild(e)})(r,this.createTabForPage(this.pages[r],t,this.pages[r]!=this.currentPage,r+1));this.tabContainer.innerHTML="",this.tabContainer.appendChild(n);var s=this.createPageMenuTab();this.tabContainer.appendChild(s);var o,l,d,s=null;this.isPageInsertTabVisible()&&(s=this.createPageInsertTab(),this.tabContainer.appendChild(s)),n.clientWidth>this.tabContainer.clientWidth-e&&(null!=s&&(s.style.position="absolute",s.style.right="0px",n.style.marginRight="30px"),(o=this.createControlTab(4,"&nbsp;&#10094;&nbsp;")).style.position="absolute",o.style.right=this.editor.chromeless?"29px":"55px",o.style.fontSize="13pt",this.tabContainer.appendChild(o),(l=this.createControlTab(4,"&nbsp;&#10095;")).style.position="absolute",l.style.right=this.editor.chromeless?"0px":"29px",l.style.fontSize="13pt",this.tabContainer.appendChild(l),d=Math.max(0,this.tabContainer.clientWidth-(this.editor.chromeless?86:116)),n.style.width=d+"px",mxEvent.addListener(o,"click",mxUtils.bind(this,function(e){n.scrollLeft-=Math.max(20,d-20),mxUtils.setOpacity(o,0<n.scrollLeft?100:50),mxUtils.setOpacity(l,n.scrollLeft<n.scrollWidth-n.clientWidth?100:50),mxEvent.consume(e)})),mxUtils.setOpacity(o,0<n.scrollLeft?100:50),mxUtils.setOpacity(l,n.scrollLeft<n.scrollWidth-n.clientWidth?100:50),mxEvent.addListener(l,"click",mxUtils.bind(this,function(e){n.scrollLeft+=Math.max(20,d-20),mxUtils.setOpacity(o,0<n.scrollLeft?100:50),mxUtils.setOpacity(l,n.scrollLeft<n.scrollWidth-n.clientWidth?100:50),mxEvent.consume(e)})))}},EditorUi.prototype.isPageInsertTabVisible=function(){return 1==urlParams.embed||null!=this.getCurrentFile()&&this.getCurrentFile().isEditable()},EditorUi.prototype.createTab=function(e){var t=document.createElement("div");return t.style.display="inline-block",t.style.whiteSpace="nowrap",t.style.boxSizing="border-box",t.style.position="relative",t.style.overflow="hidden",t.style.textAlign="center",t.style.marginLeft="-1px",t.style.height=this.tabContainer.clientHeight+"px",t.style.padding="12px 4px 8px 4px",t.style.border=Editor.isDarkMode()?"1px solid #505759":"1px solid #e8eaed",t.style.borderTopStyle="none",t.style.borderBottomStyle="none",t.style.backgroundColor=this.tabContainer.style.backgroundColor,t.style.cursor="move",t.style.color="gray",e&&(mxEvent.addListener(t,"mouseenter",mxUtils.bind(this,function(e){this.editor.graph.isMouseDown||(t.style.backgroundColor=Editor.isDarkMode()?"black":"#e8eaed",mxEvent.consume(e))})),mxEvent.addListener(t,"mouseleave",mxUtils.bind(this,function(e){t.style.backgroundColor=this.tabContainer.style.backgroundColor,mxEvent.consume(e)}))),t},EditorUi.prototype.createControlTab=function(e,t,i){i=this.createTab(null==i||i);return i.style.lineHeight=this.tabContainerHeight+"px",i.style.paddingTop=e+"px",i.style.cursor="pointer",i.style.width="30px",i.innerHTML=t,null!=i.firstChild&&null!=i.firstChild.style&&mxUtils.setOpacity(i.firstChild,40),i},EditorUi.prototype.createPageMenuTab=function(e){var t=this.createControlTab(3,'<div class="geSprite geSprite-dots"></div>',e);t.setAttribute("title",mxResources.get("pages")),t.style.position="absolute",t.style.marginLeft="0px",t.style.top="0px",t.style.left="1px";e=t.getElementsByTagName("div")[0];return e.style.display="inline-block",e.style.marginTop="5px",e.style.width="21px",e.style.height="21px",mxEvent.addListener(t,"click",mxUtils.bind(this,function(e){this.editor.graph.popupMenuHandler.hideMenu();var t=new mxPopupMenu(mxUtils.bind(this,function(n,a){for(var e,t,i=0;i<this.pages.length;i++)mxUtils.bind(this,function(e){var t=n.addItem(this.pages[e].getName(),null,mxUtils.bind(this,function(){this.selectPage(this.pages[e])}),a),i=this.pages[e].getId();t.setAttribute("title",this.pages[e].getName()+(null!=i?" ("+i+")":"")+" ["+(e+1)+"]"),this.pages[e]==this.currentPage&&n.addCheckmark(t,Editor.checkmarkImage)})(i);this.editor.graph.isEnabled()&&(n.addSeparator(a),n.addItem(mxResources.get("insertPage"),null,mxUtils.bind(this,function(){this.insertPage()}),a),null!=(e=this.currentPage)&&(n.addSeparator(a),t=e.getName(),n.addItem(mxResources.get("removeIt",[t]),null,mxUtils.bind(this,function(){this.removePage(e)}),a),n.addItem(mxResources.get("renameIt",[t]),null,mxUtils.bind(this,function(){this.renamePage(e,e.getName())}),a),n.addSeparator(a),n.addItem(mxResources.get("duplicateIt",[t]),null,mxUtils.bind(this,function(){this.duplicatePage(e,mxResources.get("copyOf",[e.getName()]))}),a)))}));t.div.className+=" geMenubarMenu",t.smartSeparators=!0,t.showDisabled=!0,t.autoExpand=!0,t.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(t,arguments),t.destroy()});var i=mxEvent.getClientX(e),n=mxEvent.getClientY(e);t.popup(i,n,null,e),this.setCurrentMenu(t),mxEvent.consume(e)})),t},EditorUi.prototype.createPageInsertTab=function(){var e=this.createControlTab(4,'<div class="geSprite geSprite-plus"></div>');e.setAttribute("title",mxResources.get("insertPage"));this.editor.graph;mxEvent.addListener(e,"click",mxUtils.bind(this,function(e){this.insertPage(),mxEvent.consume(e)}));var t=e.getElementsByTagName("div")[0];return t.style.display="inline-block",t.style.width="21px",t.style.height="21px",e},EditorUi.prototype.createTabForPage=function(e,t,i,n){var a=this.createTab(i),r=e.getName()||mxResources.get("untitled"),i=e.getId();return a.setAttribute("title",r+(null!=i?" ("+i+")":"")+" ["+n+"]"),mxUtils.write(a,r),a.style.maxWidth=t+"px",a.style.width=t+"px",this.addTabListeners(e,a),42<t&&(a.style.textOverflow="ellipsis"),a},EditorUi.prototype.addTabListeners=function(a,r){mxEvent.disableContextMenu(r);var s=this.editor.graph;s.model;mxEvent.addListener(r,"dblclick",mxUtils.bind(this,function(e){this.renamePage(a),mxEvent.consume(e)}));var o=!1,l=!1;mxEvent.addGestureListeners(r,mxUtils.bind(this,function(e){o=null!=this.currentMenu,l=a==this.currentPage,s.isMouseDown||l||this.selectPage(a)}),null,mxUtils.bind(this,function(e){var t,i,n;s.isEnabled()&&!s.isMouseDown&&(mxEvent.isTouchEvent(e)&&l||mxEvent.isPopupTrigger(e))&&(s.popupMenuHandler.hideMenu(),this.hideCurrentMenu(),mxEvent.isTouchEvent(e)&&o||((t=new mxPopupMenu(this.createPageMenu(a))).div.className+=" geMenubarMenu",t.smartSeparators=!0,t.showDisabled=!0,t.autoExpand=!0,t.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(t,arguments),this.resetCurrentMenu(),t.destroy()}),i=mxEvent.getClientX(e),n=mxEvent.getClientY(e),t.popup(i,n,null,e),this.setCurrentMenu(t,r)),mxEvent.consume(e))}))},EditorUi.prototype.getLinkForPage=function(e,t,i){if(!mxClient.IS_CHROMEAPP&&!EditorUi.isElectronApp){var n=this.getCurrentFile();if(null!=n&&n.constructor!=LocalFile&&"draw.io"==this.getServiceName()){var a=this.getSearch(["create","title","mode","url","drive","splash","state","clibs","ui","viewbox","hide-pages"]);return a+=(0==a.length?"?":"&")+"page-id="+e.getId(),null!=t&&(a+="&"+t.join("&")),(i&&"1"!=urlParams.dev?EditorUi.lightboxHost:mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||!/.*\.draw\.io$/.test(window.location.hostname)?EditorUi.drawHost:"https://"+window.location.host)+"/"+a+"#"+n.getHash()}}return null},EditorUi.prototype.createPageMenu=function(o,i){return mxUtils.bind(this,function(e,t){var s=this.editor.graph;s.model;e.addItem(mxResources.get("insert"),null,mxUtils.bind(this,function(){this.insertPage(null,mxUtils.indexOf(this.pages,o)+1)}),t),e.addItem(mxResources.get("delete"),null,mxUtils.bind(this,function(){this.removePage(o)}),t),e.addItem(mxResources.get("rename"),null,mxUtils.bind(this,function(){this.renamePage(o,i)}),t),null!=this.getLinkForPage(o)&&(e.addSeparator(t),e.addItem(mxResources.get("link"),null,mxUtils.bind(this,function(){this.showPublishLinkDialog(mxResources.get("url"),!0,null,null,mxUtils.bind(this,function(e,t,i,n,a,r){t=this.createUrlParameters(e,t,i,n,a,r);i||t.push("hide-pages=1"),s.isSelectionEmpty()||(a=s.getBoundingBox(s.getSelectionCells()),r=s.view.translate,i=s.view.scale,a.width/=i,a.height/=i,a.x=a.x/i-r.x,a.y=a.y/i-r.y,t.push("viewbox="+encodeURIComponent(JSON.stringify({x:Math.round(a.x),y:Math.round(a.y),width:Math.round(a.width),height:Math.round(a.height),border:100}))));n=new EmbedDialog(this,this.getLinkForPage(o,t,n));this.showDialog(n.container,450,240,!0,!0),n.init()}))}))),e.addSeparator(t),e.addItem(mxResources.get("duplicate"),null,mxUtils.bind(this,function(){this.duplicatePage(o,mxResources.get("copyOf",[o.getName()]))}),t),mxClient.IS_CHROMEAPP||EditorUi.isElectronApp||"draw.io"!=this.getServiceName()||(e.addSeparator(t),e.addItem(mxResources.get("openInNewWindow"),null,mxUtils.bind(this,function(){this.editor.editAsNew(this.getFileData(!0,null,null,null,!0,!0))}),t))})},function(){var t=EditorUi.prototype.refresh;EditorUi.prototype.refresh=function(e){t.apply(this,arguments),this.updateTabContainer()}}(),mxCodecRegistry.getCodec(ChangePageSetup).exclude.push("page"),function(){var e=new mxObjectCodec(new MovePage,["ui"]);e.beforeDecode=function(e,t,i){return i.ui=e.ui,t},e.afterDecode=function(e,t,i){var n=i.oldIndex;return i.oldIndex=i.newIndex,i.newIndex=n,i},mxCodecRegistry.register(e)}(),function(){var e=new mxObjectCodec(new RenamePage,["ui","page"]);e.beforeDecode=function(e,t,i){return i.ui=e.ui,t},e.afterDecode=function(e,t,i){var n=i.previous;return i.previous=i.name,i.name=n,i},mxCodecRegistry.register(e)}(),function(){var e=new mxObjectCodec(new ChangePage,["ui","relatedPage","index","neverShown","page","previousPage"]),n=["defaultParent","currentRoot","scrollLeft","scrollTop","scale","translate","lastPasteXml","pasteCounter"];e.afterEncode=function(e,t,i){return i.setAttribute("relatedPage",t.relatedPage.getId()),null==t.index&&(i.setAttribute("name",t.relatedPage.getName()),null!=t.relatedPage.viewState&&i.setAttribute("viewState",JSON.stringify(t.relatedPage.viewState,function(e,t){return mxUtils.indexOf(n,e)<0?t:void 0})),null!=t.relatedPage.root&&e.encodeCell(t.relatedPage.root,i)),i},e.beforeDecode=function(e,t,i){if(i.ui=e.ui,i.relatedPage=i.ui.getPageById(t.getAttribute("relatedPage")),null==i.relatedPage){var n=t.ownerDocument.createElement("diagram");n.setAttribute("id",t.getAttribute("relatedPage")),n.setAttribute("name",t.getAttribute("name")),i.relatedPage=new DiagramPage(n);n=t.getAttribute("viewState");null!=n&&(i.relatedPage.viewState=JSON.parse(n),t.removeAttribute("viewState"));var a=(t=t.cloneNode(!0)).firstChild;if(null!=a){i.relatedPage.root=e.decodeCell(a,!1);var r=a.nextSibling;for(a.parentNode.removeChild(a),a=r;null!=a;){var s,r=a.nextSibling;a.nodeType==mxConstants.NODETYPE_ELEMENT&&(s=a.getAttribute("id"),null==e.lookup(s)&&e.decodeCell(a)),a.parentNode.removeChild(a),a=r}}}return t},e.afterDecode=function(e,t,i){return i.index=i.previousIndex,i},mxCodecRegistry.register(e)}();