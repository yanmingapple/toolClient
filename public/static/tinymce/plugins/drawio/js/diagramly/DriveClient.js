!function(){var h=null,u={};window.DriveClient=function(e,t){null==t&&null!=window.urlParams&&"1"==window.urlParams.extAuth&&(t=!0),mxEventSource.call(this),DrawioClient.call(this,e,"gDriveAuthInfo"),this.isExtAuth=t,this.ui=e,this.xmlMimeType="application/vnd.jgraph.mxfile",this.mimeType="application/vnd.jgraph.mxfile.realtime",this.ui.editor.chromeless&&!this.ui.editor.editable&&"1"!=urlParams.rt&&"1"!=urlParams.extAuth?(this.cookieName="gDriveViewerAuthInfo",this.token=this.getPersistentToken(),this.appId=window.DRAWIO_GOOGLE_VIEWER_APP_ID||"850530949725",this.clientId=window.DRAWIO_GOOGLE_VIEWER_CLIENT_ID||"850530949725.apps.googleusercontent.com",this.scopes=["https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/userinfo.profile"]):(this.appId=window.DRAWIO_GOOGLE_APP_ID||"671128082532",this.clientId=window.DRAWIO_GOOGLE_CLIENT_ID||"671128082532-jhphbq6d0e1gnsus9mn7vf8a6fjn10mp.apps.googleusercontent.com"),this.mimeTypes=this.xmlMimeType+",application/mxe,application/mxr,application/vnd.jgraph.mxfile.realtime,application/vnd.jgraph.mxfile.rtlegacy";e=JSON.parse(this.token);null!=e&&null!=e.current&&(this.userId=e.current.userId,this.authCalled=!1)},mxUtils.extend(DriveClient,mxEventSource),mxUtils.extend(DriveClient,DrawioClient),DriveClient.prototype.redirectUri=window.location.protocol+"//"+window.location.host+"/google",DriveClient.prototype.GDriveBaseUrl="https://www.googleapis.com/drive/v2",DriveClient.prototype.scopes=["https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.install","https://www.googleapis.com/auth/userinfo.profile"],DriveClient.prototype.allFields="kind,id,parents,headRevisionId,etag,title,mimeType,modifiedDate,editable,copyable,canComment,labels,properties,downloadUrl,webContentLink,userPermission,fileSize",DriveClient.prototype.catchupFields="etag,headRevisionId,modifiedDate,properties(key,value)",DriveClient.prototype.enableThumbnails=!0,DriveClient.prototype.thumbnailWidth=1e3,DriveClient.prototype.maxThumbnailSize=2e6,DriveClient.prototype.placeholderThumbnail="iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAMAAAAL34HQAAACN1BMVEXwhwXvhgX4iwXzhwXgbQzvhgXhbAzocgzqcwzldAoAAADhbgvjcQnmdgrlbgDwhgXsfwXufgjwhgXwgQfziAXxgADibgz4iwX4jAX3iwTpcwr1igXoewjsfgj3igX4iwXqcQv4jAX3iwXtfQnndQrvhAbibArwhwXgbQz//////v39jwX6jQX+/v7fagHfawzdVQDwhADgbhPgbhXwhwPocQ3uvKvwiA/faQDscgzxiAT97+XgciTgcSP6jAXgbQ3gcCHwiRfpcQzwhwfeXQD77ef74NLvhgTvegD66uPgbAf66+TvfADwjCzgcCfwiSD67ObhcjjwiBHhczvwiyrgbxj///777ujgcSHgcB/xiRzgbhveWgDeVwDhdEDgbRDqfgffYgDfXwD97+bvfQDxiz7//vvwiRr118rrcgztggbfZgDfZAD++PT98+3gbBPsgAb99vD33tPgcB7icAvuhAX//Pn66N/00sTyy7vuuqbjekLwhwzkcgr88er449n++vfutp/kh1vgcBvhbwvmdwnwgwDwgADeWQD87eLxxrTssJjqpIf0roHmjWTkhFP759n63czvvanomnjnlHDhczD22cr4y6/wwa/3xKX2wJ3rqpH0tY7qp4vpnoDymlbjf0vxjjntcwzldAroegj/kgX12s7518PzqnnnkWfynmLieUjpewjrdAD40Lj1uZTzpm3idTbiciLydQzzfwnyiQTsfgD3xqnzp3TxlkzgbCrdTwDdSwBLKUlNAAAAJ3RSTlP8/b2X/YH8wb+FAIuIggJbQin5opAM9+a/ubaubyD78NjSyr2WgRp4sjN4AAAI70lEQVR42u2cZ38SQRDGT8WGvfde4E4BxVMRRaKiUURRlJhQRDCCSgQVO/bee++9994+nMt5ywoezFJd/fm8uITi3p9n5mbYkcCpO6rVnVu2YEXd+3dRIySuo7pLv4GjGNKg7j3UHTl1l14PajmG9OFBnx7Ird4PumpYEtf1QXc112l0M7OGKXEfeg3guo3iNIyJG92Jaz61mYYxcaNacs1H/8f6j6X5j1WI/mMVIsawRFEzI49SjwOqAJa43emclk8Rp2c7AFZ+LDGyvXE2kmO2Q1Lq17RSd6ND48QIwFVuLNHTOPbEpTOz8ujMpccHGz0AV5mxIo4TpwUeUPj0YwfAVVYs0Tn7VZjnBUA8v+n6CyfERY8FR/DEJj7MQ6oL85vOvfDUAsuVC8s19s5yXuAppOPnvPk4EeSCsehCeBVTwVzHfE6RcFUQa4an8Qw91kpbw2oz4aoc1sSxniO0WAI/J24wriabmEpizZtM79bc+fr4/tUarEpiLabGElJYRsOGjbJfjGDpJCxtmosRLOEnVpqLESzZLYlLg65H1rAkLo2GESwcROwXI1jELcS1Y6OGQSzEVaupZQJLDiLhYtCtFBcbbslYhOueqKllDwtzwVhTq4RFuBh0C3EdEBl0C3OBWNUrEISLvSD+5GLQLYmLoSqfwcUiFuaqzhYDxiJc981lxqqdVsCGbHPcQLBgrtK3rwLt9tWqhblKxxI9hW3267U5ZHhuBrCKzXl4NIJTS5FrmbmMWGIEDZIouOp0/O6boYQ2jxBXWcdu13fzRILuF/2Ku+aGr96uBbhALHo5Z38+XcfXyVRZVx/+Ed513ldDCCCu0rFE0Xlo2mu5TAj8ki0XV0q6ePHilhi+d/15b9ACQGGusg3AFzc+XSMBCPzu89+CNlnB7zfD8t1z4iaLXUvDVT6sGdMOnv5pi47f6r9Qk9YF3xZ0l8S11UfMArlgLMpZM6bamYy6rWnta9q7TrZrzZPgPgoqg3atubY8WK6D8lQXHfb4p/wSK7vFfxmxSsAPQ96AlZ4LxoLNeompdkUDGQVznL5mLr4ar5ESD3PBWHA9fbpbjlT4pq1Bm6H6w9dwfOd69ePouNDYt3S3ULPGZ96S3YqtAW/Tepz1E8bgAANc+xEXhAX36ut1cslcd6rJq81SIvgEe7lmL3kY5iqxVYvOI9isswp22KeMOcrriJlWai5giwHl+yec73Ma9Mbfz+qOJndKz6hLpR5V1uPxavFuTTt0K1XfpbNeO0wKeUaR2IPBN5sMRlqu1eY8bsFmPeIFUpi0CjIGTLvSZY2EGeYSi3VL9Dgeb0I+SQl9MlcZT4TObZKzfmfS5NZSx1GsLQ5r+8Sxp7ERR/1TtDlUn2qNuGXCrZGM5URlLDiEVzDVkje5fdjXdDsm27XpXChBz4XG0UpYcDOMYaxjGc3wtyJxFtu1PohaI71f2K2imqEONcN4nrMZ9TWbMf81wg9z3VNwC26Gr3enY4ObobLqbccFefuz5AKONpVfzQp2y3NoVvrN32GLNl9orA22lTiM+Nqg5CJY1DueOjkwsdtNgAP7gidR2SWVhFqt3o9QwoKHIuiwDcwX+xT/UWztSlvCaqXGmtQBY1GadQmfh6anuE0XlkhhRFs3tGGkd+tuIVhiJN0M+brj0mlAu46lX0bcbizVLbgZrgwl4JhYA+NQa9TJQUetsSJYHscJvAVct7eJKoUbQudxPYmdirqzsYsIojhjoitD01yadH287J+vpZF1/uGt2K4ttinjshQo2C2XMzI2U64X6WY4tyZq99a7wZS3eA3BpNyrUPn1x00Z0uM1ACzilOfg7EN3VmRo8dN16WYYerYw6G9qCOSDCjQ0jQkufRbalt65LVyapaA/2mClxhK3Rxy3rsyavDxDR/DL5sMLFiyYu/7sXps7z8VldPv2Xl6PnjlTwOOuJQuytH7CXpvXCOQWoZrYeHWd4nw2Q+v22OLGnFSG0Nk1PCi0xjgjpVvTGi8hht9F+ARBGq8dtXmtOSLoDm1FhUSHnihkTecESalHkPAaWVhtFbA8jqvQGBmbt8fWkKtNn0Xw9GvAWK6DX9bBVHjzqtyvvcG9a+jXyC5oKoKV/a4YFG7Yij2ofszlgtaA3ZoRwW+pIOH3w0qZFURNh3oNtKsDsAr9LNvMC0pj93H6hTPpX9ocg8FIgTVvcgFYC03jFLBMi6ix0MDAoi8/lh7Cgt2q0VfNrSX0ayhjTa2IW0tKdotNrMq4NbPkILKZW+xdiSoGgshogfh7Ul7FcIEoFevfrPLC3+XWf6y/CEvHZoFQqlts9sQigqjLxFpQCJauakFcsqhKPXH79rGb6bE2B5Qmu0b91zn0WJtN8Wys9tgtIqfjEf2SWw7XKI8gHuKQ0X0eDsQSI44TaGBN6dYN5dlI/eFj9I7f8GWtoUJYOIgkiq6Ds/gw5T7dZDUqTrfscbLbB9eIB7JmEKsUgiii/4uO8ToBfJlhfif5tEGWEsGTMT4Mr6HDa0BBlP5Y88lcnkdkCtLhnyjMM0+Gcn2WzW6xnd/J8zn+LZq4SUeEvUBaA8LCs6Tk1p1AetXt3JoMWexWZSyr3RK6vSUGrRHbmkRUVgCLpP1HW/L4tgl5tO140mdKKFFhrkTUdxta4xleA8DCXC6n/vCYvPJFa9zAWL4m6qNaA8IiqjW73lreWnJrSj0AJYFZpvwq6RZRzjVUGEtB5tX7DdoqCXaL+PXHuEjdYsuvVqva4Sqv6NdabdW4YLeIKsoFYzHGhYPIGBd2izGuVpPaSVgAV7VEsOQgsuUXdosxLuwWxLVMW0WRK5ExLiiIpN4vq2YYVTiIbPmFgii5xRiXimCBqmIcVSS3WMqvdMqz5VcKqzdKeca4UrnVT/ryR6bi2Opuf64TwYJlfl4FLqu2Zxeux5BRXZnisvZ8103NqTtzoziuGa24+wZVRdVK9W7wyNSX1nYeOmrU6JSmjp6KhH5BR+kGvk++Ld0c/X66rPH4SEQeGl+kpq8a33eAumPqK347durWpzm9hrWhUevi1Hd4ZzVC+gGMHY0TYnDOYwAAAABJRU5ErkJggg==".replace(/\+/g,"-").replace(/\//g,"_"),DriveClient.prototype.placeholderMimeType="image/png",DriveClient.prototype.libraryMimeType="application/vnd.jgraph.mxlibrary",DriveClient.prototype.newAppHostname="www.draw.io",DriveClient.prototype.extension=".drawio",DriveClient.prototype.tokenRefreshInterval=0,DriveClient.prototype.lastTokenRefresh=0,DriveClient.prototype.maxRetries=5,DriveClient.prototype.staleEtagMaxRetries=3,DriveClient.prototype.coolOff=1e3,DriveClient.prototype.mimeTypeCheckCoolOff=6e4,DriveClient.prototype.user=null,DriveClient.prototype.sameWinAuthMode=!1,DriveClient.prototype.sameWinRedirectUrl=null,DriveClient.prototype.setUser=function(e){this.user=e,null==this.user?(this.userId=null)!=this.tokenRefreshThread&&(window.clearTimeout(this.tokenRefreshThread),this.tokenRefreshThread=null):this.userId=e.id,this.fireEvent(new mxEventObject("userChanged"))},DriveClient.prototype.setUserId=function(e){this.userId=e,null!=this.user&&this.user.id!=this.userId&&(this.user=null)},DriveClient.prototype.getUser=function(){return this.user},DriveClient.prototype.getUsersList=function(){var e=[],t=JSON.parse(this.getPersistentToken(!0)),i=null;if(null!=t)for(var r in null!=t.current&&(i=t.current.userId,e.push(t[i].user),e[0].isCurrent=!0),t)"current"!=r&&r!=i&&e.push(t[r].user);return e},DriveClient.prototype.logout=function(){this.ui.editor.loadUrl(this.redirectUri+"?doLogout=1&userId="+this.userId+"&state="+encodeURIComponent("cId="+this.clientId+"&domain="+window.location.hostname)),this.clearPersistentToken(),this.setUser(null),h=null},DriveClient.prototype.execute=function(i){var e=mxUtils.bind(this,function(e){this.ui.showAuthDialog(this,!0,mxUtils.bind(this,function(e,t){this.authorize(!1,mxUtils.bind(this,function(){null!=t&&t(),i()}),mxUtils.bind(this,function(e){var t=mxResources.get("cannotLogin");null!=e&&null!=e.error&&403==e.error.code&&null!=e.error.data&&0<e.error.data.length&&"domainPolicy"==e.error.data[0].reason&&(t=e.error.message),this.logout(),this.ui.showError(mxResources.get("error"),t,mxResources.get("help"),mxUtils.bind(this,function(){this.ui.openLink("https://www.diagrams.net/doc/faq/gsuite-authorisation-troubleshoot")}),null,mxResources.get("ok"))}),e)}))});this.authorize(!0,i,e)},DriveClient.prototype.executeRequest=function(n,l,o){try{var a=!0,u=null,c=0;null!=this.requestThread&&window.clearTimeout(this.requestThread);var d=mxUtils.bind(this,function(){try{this.requestThread=null,this.currentRequest=n,null!=u&&window.clearTimeout(u),u=window.setTimeout(mxUtils.bind(this,function(){a=!1,null!=o&&o({code:App.ERROR_TIMEOUT,message:mxResources.get("timeout"),retry:d})}),this.ui.timeout);var e=null,r=!1;"string"==typeof n.params?e=n.params:null!=n.params&&(e=JSON.stringify(n.params),r=!0);var t=n.fullUrl||this.GDriveBaseUrl+n.url;r&&(t+=(0<t.indexOf("?")?"&":"?")+"alt=json");var i=new mxXmlRequest(t,e,n.method||"GET");i.setRequestHeaders=mxUtils.bind(this,function(e,t){if(null!=n.headers)for(var i in n.headers)e.setRequestHeader(i,n.headers[i]);else null!=n.contentType?e.setRequestHeader("Content-Type",n.contentType):r&&e.setRequestHeader("Content-Type","application/json");e.setRequestHeader("Authorization","Bearer "+h)}),i.send(mxUtils.bind(this,function(e){try{if(window.clearTimeout(u),a){var t,i,r,s;try{t=JSON.parse(e.getText())}catch(e){t=null}200<=e.getStatus()&&e.getStatus()<=299?null!=l&&l(t):(r=null!=(i=null!=t&&null!=t.error?null!=t.error.data?t.error.data:t.error.errors:null)&&0<i.length?i[0].reason:null,null==o||null==t||null==t.error||-1!=t.error.code&&(403!=t.error.code||"domainPolicy"!=r&&"The requested mime type change is forbidden."!=t.error.message)?null!=t&&null!=t.error&&(401==t.error.code||403==t.error.code&&"rateLimitExceeded"!=r)?403==t.error.code&&this.retryAuth||401==t.error.code&&this.retryAuth&&"authError"==r?(null!=o&&o(t),this.retryAuth=!1):(this.retryAuth=!0,this.execute(d)):null!=t&&null!=t.error&&412!=t.error.code&&404!=t.error.code&&400!=t.error.code&&this.currentRequest==n&&c<this.maxRetries?(c++,s=1+.1*(Math.random()-.5),this.requestThread=window.setTimeout(d,Math.round(Math.pow(2,c)*s*this.coolOff))):null!=o&&o(t):o(t))}}catch(e){if(null==o)throw e;o(e)}}))}catch(e){if(null==o)throw e;o(e)}});null!=h&&this.authCalled?d():this.execute(d)}catch(e){if(null==o)throw e;o(e)}},DriveClient.prototype.createAuthWin=function(e){var t=window.screenX,i=window.screenY,r=window.outerWidth,s=window.outerHeight,r=t+Math.max(r-525,0)/2,r=["width=525","height=525","top="+(i+Math.max(s-525,0)/2),"left="+r,"status=no","resizable=yes","toolbar=no","menubar=no","scrollbars=yes"];return window.open(e||"about:blank","gdauth",r.join(","))},DriveClient.prototype.authorize=function(t,i,r,s,n){!this.isExtAuth||t?new mxXmlRequest(this.redirectUri+"?getState=1",null,"GET").send(mxUtils.bind(this,function(e){200<=e.getStatus()&&e.getStatus()<=299?this.authorizeStep2(e.getText(),t,i,r,s,n):null!=r&&r(e)}),r):window.parent.driveAuth(mxUtils.bind(this,function(e){this.updateAuthInfo(e,!0,!0,i,r)}),r)},DriveClient.prototype.updateAuthInfo=function(e,t,i,r,s){var n;h=e.access_token,delete e.access_token,e.expires=Date.now()+1e3*parseInt(e.expires_in),e.remember=t,this.resetTokenRefresh(e),this.authCalled=!0,i||null==this.user?(n=JSON.stringify(e),this.updateUser(mxUtils.bind(this,function(){var e=JSON.parse(n);this.setPersistentToken(e,!t),null!=r&&r()}),s)):null!=r&&(this.setPersistentToken(e,!t),r())},DriveClient.prototype.authorizeStep2=function(e,t,i,r,s,n){try{var l,o;null!=this.ui.stateArg&&null!=this.ui.stateArg.userId&&(this.userId=this.ui.stateArg.userId,null!=this.user&&this.user.id!=this.userId&&(this.user=null)),null!=this.userId||(l=JSON.parse(this.getPersistentToken(!0)))&&null!=l.current&&(this.userId=l.current.userId),t&&null==this.userId?null!=r&&r():t?new mxXmlRequest(this.redirectUri+"?state="+encodeURIComponent("cId="+this.clientId+"&domain="+window.location.hostname+"&token="+e)+"&userId="+this.userId,null,"GET").send(mxUtils.bind(this,function(e){var t;200<=e.getStatus()&&e.getStatus()<=299?(t=JSON.parse(e.getText()),this.updateAuthInfo(t,!0,!1,i,r)):(0!=e.getStatus()&&this.logout(),null!=r&&r(e))}),r):(o="https://accounts.google.com/o/oauth2/v2/auth?client_id="+this.clientId+"&redirect_uri="+encodeURIComponent(this.redirectUri)+"&response_type=code&include_granted_scopes=true"+(s?"&access_type=offline&prompt=consent%20select_account":"")+"&scope="+encodeURIComponent(this.scopes.join(" "))+"&state="+encodeURIComponent("cId="+this.clientId+"&domain="+window.location.hostname+"&token="+e+(this.sameWinRedirectUrl?"&redirect="+this.sameWinRedirectUrl:"")),this.sameWinAuthMode?(window.location.assign(o),n=null):null==n?n=this.createAuthWin(o):n.location=o,null!=n&&(window.onGoogleDriveCallback=mxUtils.bind(this,function(e,t){window.onGoogleDriveCallback=null;try{null==e?null!=r&&r({message:mxResources.get("accessDenied")}):this.updateAuthInfo(e,s,!0,i,r)}catch(e){null!=r&&r(e)}finally{null!=t&&t.close()}}),n.focus()))}catch(e){if(null==r)throw e;r(e)}},DriveClient.prototype.resetTokenRefresh=function(e){null!=this.tokenRefreshThread&&(window.clearTimeout(this.tokenRefreshThread),this.tokenRefreshThread=null),null!=e&&null==e.error&&0<e.expires_in&&(this.tokenRefreshInterval=1e3*parseInt(e.expires_in),this.lastTokenRefresh=(new Date).getTime(),this.tokenRefreshThread=window.setTimeout(mxUtils.bind(this,function(){this.authorize(!0,mxUtils.bind(this,function(){}),mxUtils.bind(this,function(){}))}),900*e.expires_in))},DriveClient.prototype.checkToken=function(e){var t=0<this.lastTokenRefresh;(new Date).getTime()-this.lastTokenRefresh>this.tokenRefreshInterval||null==this.tokenRefreshThread?this.execute(mxUtils.bind(this,function(){e(),t&&this.fireEvent(new mxEventObject("disconnected"))})):e()},DriveClient.prototype.updateUser=function(n,t){try{var e={Authorization:"Bearer "+h};this.ui.editor.loadUrl("https://www.googleapis.com/oauth2/v2/userinfo?alt=json",mxUtils.bind(this,function(e){var s=JSON.parse(e);this.executeRequest({url:"/about"},mxUtils.bind(this,function(e){var t=mxResources.get("notAvailable"),i=t,r=null;null!=e&&null!=e.user&&(t=e.user.emailAddress,i=e.user.displayName,r=null!=e.user.picture?e.user.picture.url:null),this.setUser(new DrawioUser(s.id,t,i,r,s.locale)),this.userId=s.id,null!=n&&n()}),t)}),t,null,null,null,null,e)}catch(e){if(null==t)throw e;t(e)}},DriveClient.prototype.copyFile=function(e,t,i,r){null!=e&&null!=t&&this.executeRequest({url:"/files/"+e+"/copy?fields="+encodeURIComponent(this.allFields)+"&supportsAllDrives=true&enforceSingleParent=true",method:"POST",params:{title:t,properties:[{key:"channel",value:Editor.guid()}]}},i,r)},DriveClient.prototype.renameFile=function(e,t,i,r){null!=e&&null!=t&&this.executeRequest(this.createDriveRequest(e,{title:t}),i,r)},DriveClient.prototype.moveFile=function(e,t,i,r){null!=e&&null!=t&&this.executeRequest(this.createDriveRequest(e,{parents:[{kind:"drive#fileLink",id:t}]}),i,r)},DriveClient.prototype.createDriveRequest=function(e,t){return{url:"/files/"+e+"?uploadType=multipart&supportsAllDrives=true",method:"PUT",contentType:"application/json; charset=UTF-8",params:t}},DriveClient.prototype.getLibrary=function(e,t,i){return this.getFile(e,t,i,!0,!0)},DriveClient.prototype.loadDescriptor=function(e,t,i,r){this.executeRequest({url:"/files/"+e+"?supportsAllDrives=true&fields="+(null!=r?r:this.allFields)},t,i)},DriveClient.prototype.listFiles=function(e,t,i,r,s){this.executeRequest({url:"/files?supportsAllDrives=true&includeItemsFromAllDrives=true&q="+encodeURIComponent("(mimeType contains '"+this.xmlMimeType+"') "+(e?" and (title contains '"+e+"')":"")+(t?" and (modifiedDate > '"+t.toISOString()+"')":"")+(i?" and ('me' in owners)":""))+"&orderBy=modifiedDate desc,title"},r,s)},DriveClient.prototype.getCustomProperty=function(e,t){var i=e.properties,r=null;if(null!=i)for(var s=0;s<i.length;s++)if(i[s].key==t){r=i[s].value;break}return r},DriveClient.prototype.getFile=function(t,s,n,l,o){l=null!=l&&l,o=null!=o&&o,null!=urlParams.rev?this.executeRequest({url:"/files/"+t+"/revisions/"+urlParams.rev+"?supportsAllDrives=true"},mxUtils.bind(this,function(e){e.title=e.originalFilename,e.headRevisionId=e.id,e.id=t,this.getXmlFile(e,s,n)}),n):this.loadDescriptor(t,mxUtils.bind(this,function(e){try{var t,i,r;null!=this.user?(t=/\.png$/i.test(e.title),/\.v(dx|sdx?)$/i.test(e.title)||/\.gliffy$/i.test(e.title)||!this.ui.useCanvasForExport&&t?(i=e.downloadUrl,r={Authorization:"Bearer "+h},this.ui.convertFile(i,e.title,e.mimeType,this.extension,s,n,null,r)):l||o||e.mimeType==this.libraryMimeType||e.mimeType==this.xmlMimeType?this.getXmlFile(e,s,n,!0,o):this.getXmlFile(e,s,n)):n({message:mxResources.get("loggedOut")})}catch(e){if(null==n)throw e;n(e)}}),n)},DriveClient.prototype.isGoogleRealtimeMimeType=function(e){return null!=e&&"application/vnd.jgraph.mxfile."==e.substring(0,30)},DriveClient.prototype.getXmlFile=function(l,o,a,e,u){try{var i,r,t={Authorization:"Bearer "+h},c=l.downloadUrl;null==c?null!=a&&a({message:mxResources.get("exportOptionsDisabledDetails")}):(i=0,(r=mxUtils.bind(this,function(){this.ui.editor.loadUrl(c,mxUtils.bind(this,function(e){try{if(null==e)a({message:mxResources.get("invalidOrMissingFile")});else if(l.mimeType==this.libraryMimeType||u)l.mimeType!=this.libraryMimeType||u?o(new DriveLibrary(this.ui,e,l)):a({message:mxResources.get("notADiagramFile")});else{var t=!1;if(/\.png$/i.test(l.title)){var i=e.lastIndexOf(",");if(0<i)if(null!=(r=this.ui.extractGraphModelFromPng(e))&&0<r.length)e=r;else try{var r=e.substring(i+1),s=!window.atob||mxClient.IS_IE||mxClient.IS_IE11?Base64.decode(r):atob(r),n=this.ui.editor.extractGraphModel(mxUtils.parseXml(s).documentElement,!0);null==n||0<n.getElementsByTagName("parsererror").length?t=!0:e=s}catch(e){t=!0}}else/\.pdf$/i.test(l.title)?null!=(r=Editor.extractGraphModelFromPdf(e))&&0<r.length&&(t=!0,e=r):"data:image/png;base64,PG14ZmlsZS"==e.substring(0,32)&&(s=e.substring(22),e=window.atob&&!mxClient.IS_SF?atob(s):Base64.decode(s));Graph.fileSupport&&(new XMLHttpRequest).upload&&this.ui.isRemoteFileFormat(e,c)?this.ui.parseFile(new Blob([e],{type:"application/octet-stream"}),mxUtils.bind(this,function(e){try{4==e.readyState&&(200<=e.status&&e.status<=299?o(new LocalFile(this.ui,e.responseText,l.title+this.extension,!0)):null!=a&&a({message:mxResources.get("errorLoadingFile")}))}catch(e){if(null==a)throw e;a(e)}}),l.title):o(t?new LocalFile(this.ui,e,l.title,!0):new DriveFile(this.ui,e,l))}}catch(e){if(null==a)throw e;a(e)}}),mxUtils.bind(this,function(e,t){if(i<this.maxRetries&&null!=t&&403==t.getStatus()){i++;t=1+.1*(Math.random()-.5),t=2*i*this.coolOff*t;window.setTimeout(r,t)}else{if(null==a)throw e;a(e)}}),null!=l.mimeType&&"image/"==l.mimeType.substring(0,6)&&"image/svg"!=l.mimeType.substring(0,9)||/\.png$/i.test(l.title)||/\.jpe?g$/i.test(l.title)||/\.pdf$/i.test(l.title),null,null,null,t)}))())}catch(e){if(null==a)throw e;a(e)}},DriveClient.prototype.saveFile=function(c,d,l,i,e,o,h,p,a){try{var m=0;c.saveLevel=1;var g=mxUtils.bind(this,function(e){if(null==i)throw e;i(e);try{var t;c.isConflict(e)||(t="sl_"+c.saveLevel+"-error_"+(c.getErrorMessage(e)||"unknown"),null!=e&&null!=e.error&&null!=e.error.code&&(t+="-code_"+e.error.code),EditorUi.logEvent({category:"ERROR-SAVE-FILE-"+c.getHash()+"-rev_"+c.desc.headRevisionId+"-mod_"+c.desc.modifiedDate+"-size_"+c.getSize()+"-mime_"+c.desc.mimeType+(this.ui.editor.autosave?"":"-nosave")+(c.isAutosave()?"":"-noauto")+(c.changeListenerEnabled?"":"-nolisten")+(c.inConflictState?"-conflict":"")+(c.invalidChecksum?"-invalid":""),action:t,label:(null!=this.user?"user_"+this.user.id:"nouser")+(null!=c.sync?"-client_"+c.sync.clientId:"-nosync")}))}catch(e){}}),v=mxUtils.bind(this,function(e){g(e);try{EditorUi.logError(e.message,null,null,e)}catch(e){}});if(c.isEditable()&&null!=c.desc){var f=(new Date).getTime(),w=c.desc.etag,y=c.desc.modifiedDate,b=c.desc.headRevisionId,x=this.ui.useCanvasForExport&&/(\.png)$/i.test(c.getTitle());e=null!=e?e:"1"==urlParams.ignoremime,o=null!=o&&o;var T=null,D=!1,k={mimeType:c.desc.mimeType,title:c.getTitle()};this.isGoogleRealtimeMimeType(k.mimeType)?(k.mimeType=this.xmlMimeType,T=c.desc,D=d=!0):("application/octet-stream"==k.mimeType||"1"==urlParams["override-mime"]&&k.mimeType!=this.xmlMimeType)&&(k.mimeType=this.xmlMimeType);var r=mxUtils.bind(this,function(e,t,i){try{c.saveLevel=3,c.constructor==DriveFile&&(null==p&&(p=[]),null==c.getChannelId()&&p.push({key:"channel",value:Editor.guid(32)}),null==c.getChannelKey()&&p.push({key:"key",value:Editor.guid(32)}),p.push({key:"secret",value:null!=a?a:Editor.guid(32)})),i||(null!=e||o||(e=this.placeholderThumbnail,t=this.placeholderMimeType),null!=e&&null!=t&&(k.thumbnail={image:e,mimeType:t}));var r,s=c.getData(),u=mxUtils.bind(this,function(e){try{if(c.saveDelay=(new Date).getTime()-f,c.saveLevel=11,null==e)g({message:mxResources.get("errorSavingFile")+": Empty response"});else{var t=new Date(e.modifiedDate).getTime()-new Date(y).getTime();if(t<=0||w==e.etag||d&&b==e.headRevisionId){c.saveLevel=12;var i=[];t<=0&&i.push("invalid modified time"),w==e.etag&&i.push("stale etag"),d&&b==e.headRevisionId&&i.push("stale revision");var r=i.join(", ");g({message:mxResources.get("errorSavingFile")+": "+r},e);try{EditorUi.logError("Critical: Error saving to Google Drive "+c.desc.id,null,"from-"+b+"."+y+"-"+this.ui.hashValue(w)+"-to-"+e.headRevisionId+"."+e.modifiedDate+"-"+this.ui.hashValue(e.etag)+(0<r.length?"-errors-"+r:""),"user-"+(null!=this.user?this.user.id:"nouser")+(null!=c.sync?"-client_"+c.sync.clientId:"-nosync"))}catch(e){}}else if(c.saveLevel=null,l(e,s),null!=T){this.executeRequest({url:"/files/"+T.id+"/revisions/"+T.headRevisionId+"?supportsAllDrives=true"},mxUtils.bind(this,mxUtils.bind(this,function(e){e.pinned=!0,this.executeRequest({url:"/files/"+T.id+"/revisions/"+T.headRevisionId,method:"PUT",params:e})})));try{EditorUi.logEvent({category:c.convertedFrom+"-CONVERT-FILE-"+c.getHash(),action:"from_"+T.id+"."+T.headRevisionId+"-to_"+c.desc.id+"."+c.desc.headRevisionId,label:null!=this.user?"user_"+this.user.id:"nouser"+(null!=c.sync?"-client_"+c.sync.clientId:"nosync")})}catch(e){}}}}catch(e){v(e)}}),n=mxUtils.bind(this,function(r,n){c.saveLevel=4;try{null!=p&&(k.properties=p);var s,l=h||c.constructor!=DriveFile||"manual"!=DrawioFile.SYNC&&"auto"!=DrawioFile.SYNC?null:c.getCurrentEtag(),o=mxUtils.bind(this,function(e){c.saveLevel=5;try{var t=c.desc.mimeType!=this.xmlMimeType&&c.desc.mimeType!=this.mimeType&&c.desc.mimeType!=this.libraryMimeType,i=!0,s=null;try{s=window.setTimeout(mxUtils.bind(this,function(){i=!1,g({code:App.ERROR_TIMEOUT})}),5*this.ui.timeout)}catch(e){}this.executeRequest(this.createUploadRequest(c.getId(),k,r,d||e||t,n,e?null:l,D),mxUtils.bind(this,function(e){window.clearTimeout(s),i&&u(e)}),mxUtils.bind(this,function(r){if(window.clearTimeout(s),i){c.saveLevel=6;try{c.isConflict(r)?this.executeRequest({url:"/files/"+c.getId()+"?supportsAllDrives=true&fields="+this.catchupFields},mxUtils.bind(this,function(e){c.saveLevel=7;try{if(null!=e&&e.etag==l)if(m<this.staleEtagMaxRetries){m++;var t=1+.1*(Math.random()-.5),i=2*m*this.coolOff*t;window.setTimeout(a,i),"1"==urlParams.test&&EditorUi.debug("DriveClient: Stale Etag Detected","retry",m,"delay",i)}else{a(!0);try{EditorUi.logEvent({category:"STALE-ETAG-SAVE-FILE-"+c.getHash(),action:"rev_"+c.desc.headRevisionId+"-mod_"+c.desc.modifiedDate+"-size_"+c.getSize()+"-mime_"+c.desc.mimeType+(this.ui.editor.autosave?"":"-nosave")+(c.isAutosave()?"":"-noauto")+(c.changeListenerEnabled?"":"-nolisten")+(c.inConflictState?"-conflict":"")+(c.invalidChecksum?"-invalid":""),label:(null!=this.user?"user_"+this.user.id:"nouser")+(null!=c.sync?"-client_"+c.sync.clientId:"-nosync")})}catch(e){}}else"1"==urlParams.test&&e.headRevisionId==b&&EditorUi.debug("DriveClient: Remote Etag Changed","local",l,"remote",e.etag,"rev",c.desc.headRevisionId,"response",[e],"file",[c]),g(r,e)}catch(e){v(e)}}),mxUtils.bind(this,function(){g(r)})):g(r)}catch(e){v(e)}}}))}catch(e){v(e)}}),a=mxUtils.bind(this,function(t){if(c.saveLevel=9,t||null==l)o(t);else{var i=!0,r=null;try{r=window.setTimeout(mxUtils.bind(this,function(){i=!1,g({code:App.ERROR_TIMEOUT})}),3*this.ui.timeout)}catch(e){}this.executeRequest({url:"/files/"+c.getId()+"?supportsAllDrives=true&fields="+this.catchupFields},mxUtils.bind(this,function(e){if(window.clearTimeout(r),i){c.saveLevel=10;try{null!=e&&e.headRevisionId==b?("1"==urlParams.test&&l!=e.etag&&EditorUi.debug("DriveClient: Preflight Etag Update","from",l,"to",e.etag,"rev",c.desc.headRevisionId,"response",[e],"file",[c]),l=e.etag,o(t)):g({error:{code:412}},e)}catch(e){v(e)}}}),mxUtils.bind(this,function(e){window.clearTimeout(r),i&&(c.saveLevel=11,g(e))}))}});x&&null==e?(c.saveLevel=8,(s=new Image).onload=mxUtils.bind(this,function(){try{var e=this.thumbnailWidth/s.width,t=document.createElement("canvas");t.width=this.thumbnailWidth,t.height=Math.floor(s.height*e),t.getContext("2d").drawImage(s,0,0,t.width,t.height);var i=(i=t.toDataURL()).substring(i.indexOf(",")+1).replace(/\+/g,"-").replace(/\//g,"_");k.thumbnail={image:i,mimeType:"image/png"},a(!1)}catch(e){try{a(!1)}catch(e){v(e)}}}),s.src="data:image/png;base64,"+r):a(!1)}catch(e){v(e)}});x?(r=this.ui.getPngFileProperties(this.ui.fileNode),this.ui.getEmbeddedPng(mxUtils.bind(this,function(e){n(e,!0)}),g,this.ui.getCurrentFile()!=c?s:null,r.scale,r.border)):n(s,!1)}catch(e){v(e)}});try{c.saveLevel=2,(o||x||c.constructor==DriveLibrary||!this.enableThumbnails||"0"==urlParams.thumb||null!=k.mimeType&&"application/vnd.jgraph.mxfile"!=k.mimeType.substring(0,29)||!this.ui.getThumbnail(this.thumbnailWidth,mxUtils.bind(this,function(e){try{var t=null;try{null!=(t=null!=e?e.toDataURL("image/png"):t)&&(t=t.length>this.maxThumbnailSize?null:t.substring(t.indexOf(",")+1).replace(/\+/g,"-").replace(/\//g,"_"))}catch(e){t=null}r(t,"image/png")}catch(e){v(e)}})))&&r(null,null,c.constructor!=DriveLibrary)}catch(e){v(e)}}else this.ui.editor.graph.reset(),g({message:mxResources.get("readOnly")})}catch(e){v(e)}},DriveClient.prototype.insertFile=function(e,t,i,r,s,n,l){e={mimeType:n=null!=n?n:this.xmlMimeType,title:e};null!=i&&(e.parents=[{kind:"drive#fileLink",id:i}]),this.executeRequest(this.createUploadRequest(null,e,t,!1,l),mxUtils.bind(this,function(e){n==this.libraryMimeType?r(new DriveLibrary(this.ui,t,e)):0==e?null!=s&&s({message:mxResources.get("errorSavingFile")}):r(new DriveFile(this.ui,t,e))}),s)},DriveClient.prototype.createUploadRequest=function(e,t,i,r,s,n,l){s=null!=s&&s;var o="-------314159265358979323846",a="\r\n--"+o+"\r\n",o={"Content-Type":'multipart/mixed; boundary="'+o+'"'};null!=n&&(o["If-Match"]=n);i={fullUrl:"https://content.googleapis.com/upload/drive/v2/files"+(null!=e?"/"+e:"")+"?uploadType=multipart&supportsAllDrives=true&enforceSingleParent=true&fields="+this.allFields,method:null!=e?"PUT":"POST",headers:o,params:a+"Content-Type: application/json\r\n\r\n"+JSON.stringify(t)+a+"Content-Type: application/octect-stream\r\nContent-Transfer-Encoding: base64\r\n\r\n"+(null!=i?s?i:!window.btoa||mxClient.IS_IE||mxClient.IS_IE11?Base64.encode(i):Graph.base64EncodeUnicode(i):"")+"\r\n---------314159265358979323846--"};return r||(i.fullUrl+="&newRevision=false"),l&&(i.fullUrl+="&pinned=true"),i},DriveClient.prototype.createLinkPicker=function(){var e,t,i,r="linkPicker",s=u[r];return null!=s&&u[r+"Token"]==h||(u[r+"Token"]=h,e=new google.picker.DocsView(google.picker.ViewId.FOLDERS).setParent("root").setIncludeFolders(!0).setSelectFolderEnabled(!0),t=(new google.picker.DocsView).setIncludeFolders(!0).setSelectFolderEnabled(!0),i=(new google.picker.DocsView).setIncludeFolders(!0).setEnableDrives(!0).setSelectFolderEnabled(!0),s=(new google.picker.PickerBuilder).setAppId(this.appId).setLocale(mxLanguage).setOAuthToken(u[r+"Token"]).enableFeature(google.picker.Feature.SUPPORT_DRIVES).addView(e).addView(t).addView(i).addView(google.picker.ViewId.RECENTLY_PICKED)),s},DriveClient.prototype.pickFile=function(e,o,a){this.filePickerCallback=null!=e?e:mxUtils.bind(this,function(e){this.ui.loadFile("G"+e)}),this.filePicked=mxUtils.bind(this,function(e){e.action==google.picker.Action.PICKED&&this.filePickerCallback(e.docs[0].id,e.docs[0])}),this.ui.spinner.spin(document.body,mxResources.get("authorizing"))&&this.execute(mxUtils.bind(this,function(){try{this.ui.spinner.stop();var e,t,i,r,s,n=o?"genericPicker":"filePicker",l=mxUtils.bind(this,function(e){"picker modal-dialog-bg picker-dialog-bg"==mxEvent.getSource(e).className&&(mxEvent.removeListener(document,"click",l),this[n].setVisible(!1),a&&a())});null!=u[n]&&u[n+"Token"]==h||(u[n+"Token"]=h,e=new google.picker.DocsView(google.picker.ViewId.FOLDERS).setParent("root").setIncludeFolders(!0),t=(new google.picker.DocsView).setIncludeFolders(!0),i=(new google.picker.DocsView).setEnableDrives(!0).setIncludeFolders(!0),r=(new google.picker.DocsUploadView).setIncludeFolders(!0),o?(e.setMimeTypes("*/*"),t.setMimeTypes("*/*"),i.setMimeTypes("*/*")):(e.setMimeTypes(this.mimeTypes),t.setMimeTypes(this.mimeTypes),i.setMimeTypes(this.mimeTypes)),u[n]=(new google.picker.PickerBuilder).setOAuthToken(u[n+"Token"]).setLocale(mxLanguage).setAppId(this.appId).enableFeature(google.picker.Feature.SUPPORT_DRIVES).addView(e).addView(t).addView(i).addView(google.picker.ViewId.RECENTLY_PICKED).addView(r),urlParams.gPickerSize&&(s=urlParams.gPickerSize.split(","),u[n]=u[n].setSize(s[0],s[1])),urlParams.topBaseUrl&&(u[n]=u[n].setOrigin(decodeURIComponent(urlParams.topBaseUrl))),u[n]=u[n].setCallback(mxUtils.bind(this,function(e){e.action!=google.picker.Action.PICKED&&e.action!=google.picker.Action.CANCEL||(mxEvent.removeListener(document,"click",l),a&&e.action==google.picker.Action.CANCEL&&a()),e.action==google.picker.Action.PICKED&&this.filePicked(e)})).build()),mxEvent.addListener(document,"click",l),u[n].setVisible(!0)}catch(e){this.ui.spinner.stop(),this.ui.handleError(e)}}))},DriveClient.prototype.pickFolder=function(e,t){this.folderPickerCallback=e;var i=mxUtils.bind(this,function(){try{this.ui.spinner.spin(document.body,mxResources.get("authorizing"))&&this.execute(mxUtils.bind(this,function(){try{this.ui.spinner.stop();var e,t,i,r,s="folderPicker",n=mxUtils.bind(this,function(e){"picker modal-dialog-bg picker-dialog-bg"==mxEvent.getSource(e).className&&(mxEvent.removeListener(document,"click",n),u[s].setVisible(!1))});null!=u[s]&&u[s+"Token"]==h||(u[s+"Token"]=h,e=new google.picker.DocsView(google.picker.ViewId.FOLDERS).setParent("root").setIncludeFolders(!0).setSelectFolderEnabled(!0).setMimeTypes("application/vnd.google-apps.folder"),t=(new google.picker.DocsView).setIncludeFolders(!0).setSelectFolderEnabled(!0).setMimeTypes("application/vnd.google-apps.folder"),i=(new google.picker.DocsView).setIncludeFolders(!0).setEnableDrives(!0).setSelectFolderEnabled(!0).setMimeTypes("application/vnd.google-apps.folder"),u[s]=(new google.picker.PickerBuilder).setSelectableMimeTypes("application/vnd.google-apps.folder").setOAuthToken(u[s+"Token"]).setLocale(mxLanguage).setAppId(this.appId).enableFeature(google.picker.Feature.SUPPORT_DRIVES).addView(e).addView(t).addView(i).addView(google.picker.ViewId.RECENTLY_PICKED).setTitle(mxResources.get("pickFolder")),urlParams.gPickerSize&&(r=urlParams.gPickerSize.split(","),u[s]=u[s].setSize(r[0],r[1])),urlParams.topBaseUrl&&(u[s]=u[s].setOrigin(decodeURIComponent(urlParams.topBaseUrl))),u[s]=u[s].setCallback(mxUtils.bind(this,function(e){e.action!=google.picker.Action.PICKED&&e.action!=google.picker.Action.CANCEL||mxEvent.removeListener(document,"click",n),this.folderPickerCallback(e)})).build()),mxEvent.addListener(document,"click",n),u[s].setVisible(!0)}catch(e){this.ui.spinner.stop(),this.ui.handleError(e)}}))}catch(e){this.ui.handleError(e)}});t?i():this.ui.confirm(mxResources.get("useRootFolder"),mxUtils.bind(this,function(){this.folderPickerCallback({action:google.picker.Action.PICKED,docs:[{type:"folder",id:"root"}]})}),mxUtils.bind(this,function(){i()}),mxResources.get("yes"),mxResources.get("noPickFolder")+"...",!0)},DriveClient.prototype.pickLibrary=function(e){this.filePickerCallback=e,this.filePicked=mxUtils.bind(this,function(e){e.action==google.picker.Action.PICKED?this.filePickerCallback(e.docs[0].id):e.action==google.picker.Action.CANCEL&&null==this.ui.getCurrentFile()&&this.ui.showSplash()}),this.ui.spinner.spin(document.body,mxResources.get("authorizing"))&&this.execute(mxUtils.bind(this,function(){try{this.ui.spinner.stop();var e,t,i,r,s,n=mxUtils.bind(this,function(e){"picker modal-dialog-bg picker-dialog-bg"==mxEvent.getSource(e).className&&(mxEvent.removeListener(document,"click",n),u.libraryPicker.setVisible(!1))});null!=u.libraryPicker&&u.libraryPickerToken==h||(u.libraryPickerToken=h,e=new google.picker.DocsView(google.picker.ViewId.FOLDERS).setParent("root").setIncludeFolders(!0).setMimeTypes(this.libraryMimeType+",application/xml,text/plain,application/octet-stream"),t=(new google.picker.DocsView).setIncludeFolders(!0).setMimeTypes(this.libraryMimeType+",application/xml,text/plain,application/octet-stream"),i=(new google.picker.DocsView).setEnableDrives(!0).setIncludeFolders(!0).setMimeTypes(this.libraryMimeType+",application/xml,text/plain,application/octet-stream"),r=(new google.picker.DocsUploadView).setIncludeFolders(!0),u.libraryPicker=(new google.picker.PickerBuilder).setOAuthToken(u.libraryPickerToken).setLocale(mxLanguage).setAppId(this.appId).enableFeature(google.picker.Feature.SUPPORT_DRIVES).addView(e).addView(t).addView(i).addView(google.picker.ViewId.RECENTLY_PICKED).addView(r),urlParams.gPickerSize&&(s=urlParams.gPickerSize.split(","),u.libraryPicker=u.libraryPicker.setSize(s[0],s[1])),urlParams.topBaseUrl&&(u.libraryPicker=u.libraryPicker.setOrigin(decodeURIComponent(urlParams.topBaseUrl))),u.libraryPicker=u.libraryPicker.setCallback(mxUtils.bind(this,function(e){e.action!=google.picker.Action.PICKED&&e.action!=google.picker.Action.CANCEL||mxEvent.removeListener(document,"click",n),e.action==google.picker.Action.PICKED&&this.filePicked(e)})).build()),mxEvent.addListener(document,"click",n),u.libraryPicker.setVisible(!0)}catch(e){this.ui.spinner.stop(),this.ui.handleError(e)}}))},DriveClient.prototype.showPermissions=function(t){var n=mxUtils.bind(this,function(){var e=new ConfirmDialog(this.ui,mxResources.get("googleSharingNotAvailable"),mxUtils.bind(this,function(){this.ui.editor.graph.openLink("https://drive.google.com/open?id="+t)}),null,mxResources.get("open"),null,null,null,null,IMAGE_PATH+"/google-share.png");this.ui.showDialog(e.container,360,190,!0,!0),e.init()});this.sharingFailed?n():this.checkToken(mxUtils.bind(this,function(){try{var e=new gapi.drive.share.ShareClient(this.appId);e.setOAuthToken(h),e.setItemIds([t]),e.showSettingsDialog(),"MutationObserver"in window&&(null!=this.sharingObserver&&(this.sharingObserver.disconnect(),this.sharingObserver=null),this.sharingObserver=new MutationObserver(mxUtils.bind(this,function(e){for(var t=!1,i=0;i<e.length;i++)for(var r=0;r<e[i].addedNodes.length;r++){var s=e[i].addedNodes[r];"BUTTON"==s.nodeName&&"ok"==s.getAttribute("name")&&null!=s.parentNode&&null!=s.parentNode.parentNode&&"dialog"==s.parentNode.parentNode.getAttribute("role")?(this.sharingFailed=!0,s.click(),n(),t=!0):"DIV"==s.nodeName&&"shr-q-shr-r-shr-xb"==s.className&&(t=!0)}t&&(this.sharingObserver.disconnect(),this.sharingObserver=null)})),this.sharingObserver.observe(document,{childList:!0,subtree:!0}))}catch(e){this.ui.handleError(e)}}))},DriveClient.prototype.clearPersistentToken=function(){var e,t=JSON.parse(this.getPersistentToken(!0))||{};for(e in delete t.current,delete t[this.userId],t){t.current={userId:e,expires:0};break}DrawioClient.prototype.setPersistentToken.call(this,JSON.stringify(t))},DriveClient.prototype.setPersistentToken=function(e,t){var i=JSON.parse(this.getPersistentToken(!0))||{};e.userId=this.userId,i.current=e,i[this.userId]={user:this.user},DrawioClient.prototype.setPersistentToken.call(this,JSON.stringify(i),t)}}();