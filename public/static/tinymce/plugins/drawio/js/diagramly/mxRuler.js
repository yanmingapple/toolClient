function mxRuler(e,t,f,i){var s=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,r=window.cancelAnimationFrame||window.mozCancelAnimationFrame,x=this.RULER_THICKNESS,y=this;this.unit=t;var C=Editor.isDarkMode()?{bkgClr:"#202020",outBkgClr:Editor.darkColor,cornerClr:Editor.darkColor,strokeClr:"#505759",fontClr:"#BBBBBB",guideClr:"#0088cf"}:{bkgClr:"#ffffff",outBkgClr:"#e8e9ed",cornerClr:"#fbfbfb",strokeClr:"#dadce0",fontClr:"#BBBBBB",guideClr:"#0000BB"},n=document.createElement("div");function o(){var t=e.diagramContainer;n.style.top=t.offsetTop-x+"px",n.style.left=t.offsetLeft-x+"px",n.style.width=(f?0:t.offsetWidth)+x+"px",n.style.height=(f?t.offsetHeight:0)+x+"px"}n.style.position="absolute",this.updateStyle=mxUtils.bind(this,function(){C=Editor.isDarkMode()?{bkgClr:"#202020",outBkgClr:Editor.darkColor,cornerClr:Editor.darkColor,strokeClr:"#505759",fontClr:"#BBBBBB",guideClr:"#0088cf"}:{bkgClr:"#ffffff",outBkgClr:"#e8e9ed",cornerClr:"#fbfbfb",strokeClr:"#dadce0",fontClr:"#BBBBBB",guideClr:"#0000BB"},n.style.background=C.bkgClr,n.style[f?"borderRight":"borderBottom"]="0.5px solid "+C.strokeClr,n.style.borderLeft="0.5px solid "+C.strokeClr}),this.updateStyle(),document.body.appendChild(n),mxEvent.disableContextMenu(n),this.editorUiRefresh=e.refresh,e.refresh=function(t){y.editorUiRefresh.apply(e,arguments),o()},o();var v=document.createElement("canvas");v.width=n.offsetWidth,v.height=n.offsetHeight,n.style.overflow="hidden",v.style.position="relative",n.appendChild(v);var R=v.getContext("2d"),E=(this.ui=e).editor.graph;this.graph=E,this.container=n,this.canvas=v;var L=function(t,e,i,r,n){t=Math.round(t),e=Math.round(e),i=Math.round(i),r=Math.round(r),R.beginPath(),R.moveTo(t+.5,e+.5),R.lineTo(i+.5,r+.5),R.stroke(),n&&(f?(R.save(),R.translate(t,e),R.rotate(-Math.PI/2),R.fillText(n,0,0),R.restore()):R.fillText(n,t,e))},a=function(){R.clearRect(0,0,v.width,v.height),R.beginPath(),R.lineWidth=.7,R.strokeStyle=C.strokeClr,R.setLineDash([]),R.font="9px Arial",R.textAlign="center";var t,e,i,r=E.view.scale,n=E.view.getBackgroundPageBounds(),o=E.view.translate,a=E.pageVisible,s=a?x+(f?n.y-E.container.scrollTop:n.x-E.container.scrollLeft):x+(f?o.y*r-E.container.scrollTop:o.x*r-E.container.scrollLeft),l=0;switch(a&&(o=E.getPageLayout(),l=f?o.y*E.pageFormat.height:o.x*E.pageFormat.width),y.unit){case mxConstants.POINTS:e=[3,5,5,5,5,t=i=10,5,5,5,5];break;case mxConstants.MILLIMETERS:i=10,t=mxConstants.PIXELS_PER_MM,e=[5,3,3,3,3,6,3,3,3,3];break;case mxConstants.METERS:i=20,t=mxConstants.PIXELS_PER_MM,e=[5,3,3,3,3,6,3,3,3,3,10,3,3,3,3,6,3,3,3,3];break;case mxConstants.INCHES:i=r<=.5||4<=r?8:16,t=mxConstants.PIXELS_PER_INCH/i,e=[5,3,5,3,7,3,5,3,7,3,5,3,7,3,5,3]}var u=t;2<=r?u=t/(2*Math.floor(r/2)):r<=.5&&(u=t*(Math.floor(1/r/2)*(y.unit==mxConstants.MILLIMETERS?2:1)));var h,d=null,g=a?Math.min(s+(f?n.height:n.width),f?v.height:v.width):f?v.height:v.width;a&&(R.fillStyle=C.outBkgClr,f?(0<(h=s-x)&&R.fillRect(0,x,x,h),g<v.height&&R.fillRect(0,g,x,v.height)):(0<(h=s-x)&&R.fillRect(x,0,h,x),g<v.width&&R.fillRect(g,0,v.width,x))),R.fillStyle=C.fontClr;for(var m=a?s:s%(u*r);m<=g;m+=u*r){var p,c=Math.round((m-s)/r/u);m<x||c==d||(p=null,(d=c)%i==0&&(p=y.formatText(l+c*u)+""),f?L(x-e[Math.abs(c)%i],m,x,m,p):L(m,x-e[Math.abs(c)%i],m,x,p))}R.lineWidth=1,L(f?0:x,f?x:0,x,x),R.fillStyle=C.cornerClr,R.fillRect(0,0,x,x)},l=-1,u=function(){null!=s?(null!=r&&r(l),l=s(a)):a()};this.drawRuler=u;var h=d(function(){var t,e=E.container;f?(t=e.offsetHeight+x,v.height!=t&&(v.height=t,n.style.height=t+"px",u())):(e=e.offsetWidth+x,v.width!=e&&(v.width=e,n.style.width=e+"px",u()))},10);this.sizeListener=h,this.pageListener=function(){u()};t=d(function(){var t=f?E.container.scrollTop:E.container.scrollLeft;y.lastScroll!=t&&(y.lastScroll=t,u())},10);function d(r,n,o){return null!=s?r:function(){var t=this,e=arguments,i=o&&!a;clearTimeout(a),a=setTimeout(function(){a=null,o||r.apply(t,e)},n),i&&r.apply(t,e)};var a}this.scrollListener=t,this.unitListener=function(t,e){y.setUnit(e.getProperty("unit"))},E.addListener(mxEvent.SIZE,h),E.container.addEventListener("scroll",t),E.view.addListener("unitChanged",this.unitListener),e.addListener("pageViewChanged",this.pageListener),e.addListener("pageScaleChanged",this.pageListener),e.addListener("pageFormatChanged",this.pageListener),this.setStyle=function(t){C=t,n.style.background=C.bkgClr,a()},this.origGuideMove=mxGuide.prototype.move,mxGuide.prototype.move=function(t,e,i,r){var n,o,a,s,l,u,h,d,g,m=null;if(f&&4<t.height||!f&&4<t.width){if(null!=y.guidePart)try{R.putImageData(y.guidePart.imgData1,y.guidePart.x1,y.guidePart.y1),R.putImageData(y.guidePart.imgData2,y.guidePart.x2,y.guidePart.y2),R.putImageData(y.guidePart.imgData3,y.guidePart.x3,y.guidePart.y3)}catch(t){}m=y.origGuideMove.apply(this,arguments);try{R.lineWidth=.5,R.strokeStyle=C.guideClr,R.setLineDash([2]),f?(o=t.y+m.y+x-this.graph.container.scrollTop,n=0,l=o+t.height/2,s=x/2,d=o+t.height,h=0,a=R.getImageData(n,o-1,x,3),L(n,o,x,o),o--,u=R.getImageData(s,l-1,x,3),L(s,l,x,l),l--,g=R.getImageData(h,d-1,x,3),L(h,d,x,d),d--):(o=0,n=t.x+m.x+x-this.graph.container.scrollLeft,l=x/2,s=n+t.width/2,d=0,h=n+t.width,a=R.getImageData(n-1,o,3,x),L(n,o,n,x),n--,u=R.getImageData(s-1,l,3,x),L(s,l,s,x),s--,g=R.getImageData(h-1,d,3,x),L(h,d,h,x),h--),null!=y.guidePart&&y.guidePart.x1==n&&y.guidePart.y1==o||(y.guidePart={imgData1:a,x1:n,y1:o,imgData2:u,x2:s,y2:l,imgData3:g,x3:h,y3:d})}catch(t){}}else m=y.origGuideMove.apply(this,arguments);return m},this.origGuideDestroy=mxGuide.prototype.destroy,mxGuide.prototype.destroy=function(){var t=y.origGuideDestroy.apply(this,arguments);if(null!=y.guidePart)try{R.putImageData(y.guidePart.imgData1,y.guidePart.x1,y.guidePart.y1),R.putImageData(y.guidePart.imgData2,y.guidePart.x2,y.guidePart.y2),R.putImageData(y.guidePart.imgData3,y.guidePart.x3,y.guidePart.y3),y.guidePart=null}catch(t){}return t}}function mxDualRuler(a,t){var e=new mxPoint(mxRuler.prototype.RULER_THICKNESS,mxRuler.prototype.RULER_THICKNESS);this.editorUiGetDiagContOffset=a.getDiagramContainerOffset,a.getDiagramContainerOffset=function(){return e},this.editorUiRefresh=a.refresh,this.ui=a,this.origGuideMove=mxGuide.prototype.move,this.origGuideDestroy=mxGuide.prototype.destroy,this.vRuler=new mxRuler(a,t,!0),this.hRuler=new mxRuler(a,t,!1,!0);t=mxUtils.bind(this,function(n){var o=!1;mxEvent.addGestureListeners(n,mxUtils.bind(this,function(t){o=null!=a.currentMenu,mxEvent.consume(t)}),null,mxUtils.bind(this,function(t){var e,i,r;a.editor.graph.isEnabled()&&!a.editor.graph.isMouseDown&&(mxEvent.isTouchEvent(t)||mxEvent.isPopupTrigger(t))&&(a.editor.graph.popupMenuHandler.hideMenu(),a.hideCurrentMenu(),mxEvent.isTouchEvent(t)&&o||((e=new mxPopupMenu(mxUtils.bind(this,function(t,e){a.menus.addMenuItems(t,["points","inches","millimeters","meters"],e)}))).div.className+=" geMenubarMenu",e.smartSeparators=!0,e.showDisabled=!0,e.autoExpand=!0,e.hideMenu=mxUtils.bind(this,function(){mxPopupMenu.prototype.hideMenu.apply(e,arguments),a.resetCurrentMenu(),e.destroy()}),i=mxEvent.getClientX(t),r=mxEvent.getClientY(t),e.popup(i,r,null,t),a.setCurrentMenu(e,n)),mxEvent.consume(t))}))});t(this.hRuler.container),t(this.vRuler.container),this.vRuler.drawRuler(),this.hRuler.drawRuler()}mxRuler.prototype.RULER_THICKNESS=14,mxRuler.prototype.unit=mxConstants.POINTS,mxRuler.prototype.setUnit=function(t){this.unit=t,this.drawRuler()},mxRuler.prototype.formatText=function(t){switch(this.unit){case mxConstants.POINTS:return Math.round(t);case mxConstants.MILLIMETERS:return(t/mxConstants.PIXELS_PER_MM).toFixed(1);case mxConstants.METERS:return(t/(1e3*mxConstants.PIXELS_PER_MM)).toFixed(4);case mxConstants.INCHES:return(t/mxConstants.PIXELS_PER_INCH).toFixed(2)}},mxRuler.prototype.destroy=function(){this.ui.refresh=this.editorUiRefresh,mxGuide.prototype.move=this.origGuideMove,mxGuide.prototype.destroy=this.origGuideDestroy,this.graph.removeListener(this.sizeListener),this.graph.container.removeEventListener("scroll",this.scrollListener),this.graph.view.removeListener("unitChanged",this.unitListener),this.ui.removeListener("pageViewChanged",this.pageListener),this.ui.removeListener("pageScaleChanged",this.pageListener),this.ui.removeListener("pageFormatChanged",this.pageListener),null!=this.container&&this.container.parentNode.removeChild(this.container)},mxDualRuler.prototype.updateStyle=function(){this.vRuler.updateStyle(),this.hRuler.updateStyle(),this.vRuler.drawRuler(),this.hRuler.drawRuler()},mxDualRuler.prototype.setUnit=function(t){this.vRuler.setUnit(t),this.hRuler.setUnit(t)},mxDualRuler.prototype.setStyle=function(t){this.vRuler.setStyle(t),this.hRuler.setStyle(t)},mxDualRuler.prototype.destroy=function(){this.vRuler.destroy(),this.hRuler.destroy(),this.ui.refresh=this.editorUiRefresh,mxGuide.prototype.move=this.origGuideMove,mxGuide.prototype.destroy=this.origGuideDestroy,this.ui.getDiagramContainerOffset=this.editorUiGetDiagContOffset};