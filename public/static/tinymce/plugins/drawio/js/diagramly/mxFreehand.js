function mxFreehand(g){var o,y,S,l,O,s,C,w,r,i,b,a,u,h,M,n,x,c,d,m,f,p=null!=g.view&&null!=g.view.canvas?g.view.canvas.ownerSVGElement:null;null!=g.container&&null!=p&&(g.addListener(mxEvent.ESCAPE,mxUtils.bind(this,function(){this.stopDrawing()})),o=mxFreehand.prototype.NORMAL_SMOOTHING,y=null,S=[],b=i=r=w=!(C=!(O=[])),h=!(u=!(a=[])),this.setClosedPath=function(e){C=e},this.setAutoClose=function(e){w=e},this.setAutoInsert=function(e){r=e},this.setAutoScroll=function(e){i=e},this.setOpenFill=function(e){b=e},this.setStopClickEnabled=function(e){h=e},this.setSmoothing=function(e){o=e},M=function(e){u=e,g.getRubberband().setEnabled(!e),g.graphHandler.setSelectEnabled(!e),g.graphHandler.setMoveEnabled(!e),g.container.style.cursor=e?"crosshair":"",g.fireEvent(new mxEventObject("freehandStateChanged"))},this.startDrawing=function(){M(!0)},this.isDrawing=function(){return u},n=mxUtils.bind(this,function(e){var t,n;y&&(t=s.length,(n=h&&0<O.length&&null!=s&&s.length<2)||O.push.apply(O,s),s=[],O.push(null),S.push(y),y=null,(n||r)&&this.stopDrawing(),r&&2<=t&&this.startDrawing(),mxEvent.consume(e))}),this.createStyle=function(e){return mxConstants.STYLE_SHAPE+"="+e+";fillColor=none;"},this.stopDrawing=function(){if(0<S.length){for(var e=O[0].x,t=O[0].x,n=O[0].y,r=O[0].y,i=1;i<O.length;i++)null!=O[i]&&(e=Math.max(e,O[i].x),t=Math.min(t,O[i].x),n=Math.max(n,O[i].y),r=Math.min(r,O[i].y));var l=e-t,s=n-r;if(0<l&&0<s){var o=100/l,a=100/s;O.map(function(e){return null==e||(e.x=(e.x-t)*o,e.y=(e.y-r)*a),e});for(var u='<shape strokewidth="inherit"><foreground>',h=0,i=0;i<O.length;i++){var x,c,d,m,f=O[i];null==f?(m=!1,x=O[h],d=O[i-1],!C&&w&&(c=x.x-d.x,d=x.y-d.y,m=Math.sqrt(c*c+d*d)<=g.tolerance),(C||m)&&(u+='<line x="'+x.x.toFixed(2)+'" y="'+x.y.toFixed(2)+'"/>'),u+="</path>"+(b||C||m?"<fillstroke/>":"<stroke/>"),h=i+1):u+=i==h?'<path><move x="'+f.x.toFixed(2)+'" y="'+f.y.toFixed(2)+'"/>':'<line x="'+f.x.toFixed(2)+'" y="'+f.y.toFixed(2)+'"/>'}if(u+="</foreground></shape>",g.isEnabled()&&!g.isCellLocked(g.getDefaultParent())){var p=this.createStyle("stencil("+Graph.compress(u)+")"),v=g.view.scale,E=g.view.translate,p=new mxCell("",new mxGeometry(t/v-E.x,r/v-E.y,l/v,s/v),p);p.vertex=1,g.model.beginUpdate();try{p=g.addCell(p),g.fireEvent(new mxEventObject("cellsInserted","cells",[p])),g.fireEvent(new mxEventObject("freehandInserted","cell",p))}finally{g.model.endUpdate()}g.setSelectionCells([p])}}for(i=0;i<S.length;i++)S[i].parentNode.removeChild(S[i]);y=null,S=[],O=[]}M(!1)},g.addListener(mxEvent.FIRE_MOUSE_EVENT,mxUtils.bind(this,function(e,t){var n=t.getProperty("eventName"),t=t.getProperty("event");n==mxEvent.MOUSE_MOVE&&u&&(null!=t.sourceState&&t.sourceState.setCursor("crosshair"),t.consume())})),(x=new mxCell).edge=!0,g.addMouseListener({mouseDown:mxUtils.bind(this,function(e,t){var n,r,i;g.isEnabled()&&!g.isCellLocked(g.getDefaultParent())&&(i=t.getEvent(),!u||mxEvent.isPopupTrigger(i)||mxEvent.isMultiTouchEvent(i)||(r=g.getCurrentCellStyle(x),n=parseFloat(g.currentVertexStyle[mxConstants.STYLE_STROKEWIDTH]||1),n=Math.max(1,n*g.view.scale),"default"==(r=mxUtils.getValue(g.currentVertexStyle,mxConstants.STYLE_STROKECOLOR,mxUtils.getValue(r,mxConstants.STYLE_STROKECOLOR,"#000")))&&(r=g.defaultForegroundColor),(y=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("fill","none"),y.setAttribute("stroke",r),y.setAttribute("stroke-width",n),"1"==g.currentVertexStyle[mxConstants.STYLE_DASHED]&&(r=(r=g.currentVertexStyle[mxConstants.STYLE_DASH_PATTERN]||"3 3").split(" ").map(function(e){return parseFloat(e)*n}).join(" "),y.setAttribute("stroke-dasharray",r)),a=[],i=c(i),d(i),l="M"+i.x+" "+i.y,O.push(i),s=[],y.setAttribute("d",l),p.appendChild(y),t.consume()))}),mouseMove:mxUtils.bind(this,function(e,t){var n,r;y&&g.isEnabled()&&!g.isCellLocked(g.getDefaultParent())&&(r=t.getEvent(),n=c(r),d(n),f(),i&&(r=g.view.translate,g.scrollRectToVisible(new mxRectangle(n.x-r.x,n.y-r.y).grow(20))),t.consume())}),mouseUp:mxUtils.bind(this,function(e,t){y&&g.isEnabled()&&!g.isCellLocked(g.getDefaultParent())&&(n(t.getEvent()),t.consume())})}),c=function(e){return mxUtils.convertPoint(g.container,mxEvent.getClientX(e),mxEvent.getClientY(e))},d=function(e){for(a.push(e);a.length>o;)a.shift()},m=function(e){var t=a.length;if(t%2==1||o<=t){for(var n,r=0,i=0,l=0,s=e;s<t;s++)l++,r+=(n=a[s]).x,i+=n.y;return{x:r/l,y:i/l}}return null},f=function(){var e=m(0);if(e){l+=" L"+e.x+" "+e.y,O.push(e);var t="";s=[];for(var n=2;n<a.length;n+=2)t+=" L"+(e=m(n)).x+" "+e.y,s.push(e);y.setAttribute("d",l+t)}})}mxFreehand.prototype.NO_SMOOTHING=1,mxFreehand.prototype.MILD_SMOOTHING=4,mxFreehand.prototype.NORMAL_SMOOTHING=8,mxFreehand.prototype.VERY_SMOOTH_SMOOTHING=12,mxFreehand.prototype.SUPER_SMOOTH_SMOOTHING=16,mxFreehand.prototype.HYPER_SMOOTH_SMOOTHING=20;