var __extends=this&&this.__extends||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i};!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).OneDrive=e()}(function(){return function i(n,o,a){function s(t,e){if(!o[t]){if(!n[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}r=o[t]={exports:{}};n[t][0].call(r.exports,function(e){return s(n[t][1][e]||e)},r,r.exports,i,n,o,a)}return o[t].exports}for(var u="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,r){!function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=(r.SDK_VERSION="js-v"+(r.SDK_VERSION_NUMBER="7.2"),r.TYPE_BOOLEAN="boolean",r.TYPE_FUNCTION="function",r.TYPE_OBJECT="object",r.TYPE_STRING="string",r.TYPE_NUMBER="number",r.VROOM_URL="https://api.onedrive.com/v1.0/",r.VROOM_ENDPOINT_HINT="api.onedrive.com",r.GRAPH_URL="https://graph.microsoft.com/v1.0/",r.NONCE_LENGTH=5,r.CUSTOMER_TID="9188040d-6c67-4c5b-b112-36a304b66dad",r.DEFAULT_QUERY_ITEM_PARAMETER="select=id",r);function r(){}e.default=t}(r)},{}],2:[function(e,t,r){t.exports=function(t,e){"use strict";var r=(i.open=function(e){t.default.open(e)},i.save=function(e){t.default.save(e)},i);function i(){}return e.onAuth(),r}(e("./OneDriveApp"),e("./controllers/Oauth"))},{"./OneDriveApp":3,"./controllers/Oauth":7}],3:[function(e,t,r){!function(e,t,r,i,n,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=(u.open=function(e){u.isReady()&&(e||t.throwError(new n.default(r.default.unknown,"missing picker options")).exposeToPublic(),i.default.logMessage("open started"),new o.default(e).launchInvoker().then(function(){u.reset()}))},u.save=function(e){u.isReady()&&(e||t.throwError(new n.default(r.default.unknown,"missing saver options")),i.default.logMessage("save started"),new a.default(e).launchInvoker().then(function(){u.reset()}))},u.reset=function(){u.checked=!1},u.isReady=function(){return!u.checked&&(u.checked=!0)},u.checked=!1,u);function u(){}e.default=s}(r,e("./utilities/ErrorHandler"),e("./models/ErrorType"),e("./utilities/Logging"),e("./models/OneDriveSdkError"),e("./controllers/Picker"),e("./controllers/Saver"))},{"./controllers/Picker":8,"./controllers/Saver":10,"./models/ErrorType":13,"./models/OneDriveSdkError":16,"./utilities/ErrorHandler":26,"./utilities/Logging":27}],4:[function(e,t,r){!function(e,u,d,c,l,p,f,h,v,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="root";function g(e,t,r){var i=_(e,t.apiEndpointUrl);r&&(i=h.appendToPath(i,"?"+r));var n=new v.default({url:i,clientId:t.clientId,method:v.default.HTTP_GET,apiEndpoint:t.apiEndpoint,headers:{Authorization:"bearer "+t.accessToken}});return c.default.logMessage("performing GET on item with id: "+e.id),new m.Promise(function(r,i){n.start(function(e,t){e=JSON.parse(e.responseText);r(e)},function(e,t,r){i({errorCode:d.default[d.default.webRequestFailure],message:"HTTP error status: "+t})})})}function y(o,e,t){var a=h.appendToPath(_(o,e.apiEndpointUrl),f.format("{0}.createLink",e.apiActionNamingSpace)),r=new v.default({url:a,clientId:e.clientId,method:v.default.HTTP_POST,apiEndpoint:e.apiEndpoint,headers:{Authorization:"bearer "+e.accessToken},json:JSON.stringify(t)});return new m.Promise(function(i,n){r.start(function(e,t,r){c.default.logMessage(f.format("POST createLink succeeded via path {0}",a)),o.permissions=[JSON.parse(e.responseText)],i(o)},function(e,t,r){c.default.logMessage(f.format("POST createLink failed via path {0}",a)),n({errorCode:d.default[d.default.webRequestFailure],message:t})})})}function _(e,t){var r=e.parentReference&&e.parentReference.driveId?h.appendToPath("drives",e.parentReference.driveId):"drive";return r=h.appendToPath(r,e.id===i?"root":"items/"+e.id),h.appendToPath(t,r)}e.getItem=g,e.getItems=function(e,t,r){for(var i=[],n={webUrl:null,value:[]},o=0,a=e.value;o<a.length;o++){var s=a[o];i.push(g(s,t,r))}return m.Promise.all(i).then(function(e){return n.value=e,n},function(e){return c.default.logError("Received ajax error.",e),e})},e.shareItem=y,e.shareItems=function(e,t,r){for(var i=[],n={webUrl:null,value:[]},o=0,a=e.value;o<a.length;o++){var s=a[o];i.push(y(s,t,r))}return m.Promise.all(i).then(function(e){return n.value=e,n},function(e){return c.default.logError("Received sharing error.",e),e})},e.saveItemByFormUpload=function(a,s,e,u,l){var t=null;return new m.Promise(function(n,o){window.File&&e instanceof window.File?t=new FileReader:o(new p.default(d.default.unsupportedFeature,"FileReader is not supported in this browser")),t.onerror=function(e){c.default.logError("failed to read or upload the file",e),o(new p.default(d.default.fileReaderFailure,"failed to read or upload the file, see console log for details"))},t.onload=function(e){var t=h.appendToPath(_(a,u.apiEndpointUrl),"children('"+s.name+"')/content"),r={};r["@name.conflictBehavior"]=s["@name.conflictBehavior"];var i={};i.Authorization="bearer "+u.accessToken,i["Content-Type"]="multipart/form-data";i=new v.default({url:h.appendQueryStrings(t,r),clientId:u.clientId,headers:i,apiEndpoint:u.apiEndpoint}),e=e.target.result;i.upload(e,function(e,t){n({webUrl:null,value:[JSON.parse(e.responseText)]})},function(e,t,r){o(new p.default(d.default.webRequestFailure,f.format("file uploading failed by form uplaod with HTTP status: {0}",t)))},function(e,t){l(t.progressPercentage)})},t.readAsArrayBuffer(e)})},e.saveItemByUriUpload=function(e,t,r,i){if(i.apiEndpoint===u.default.filesV2||i.apiEndpoint===u.default.graph_odb)return new m.Promise(function(e,t){t(new p.default(d.default.unsupportedFeature,"URL upload not supported for OneDrive business"))});var n=h.appendToPath(_(e,i.apiEndpointUrl),"children"),o={Prefer:"respond-async"};o.Authorization="bearer "+i.accessToken,t[(e=i.apiEndpoint)===u.default.graph_odb||e===u.default.graph_odc?"@microsoft.graph.sourceUrl":"@content.sourceUrl"]=r,t.file={};var a,s,t=new v.default({url:n,clientId:i.clientId,method:v.default.HTTP_POST,headers:o,json:JSON.stringify(t),apiEndpoint:i.apiEndpoint});return h.isPathDataUrl(r)?(s=t,new m.Promise(function(r,i){s.start(function(e,t){200===t||201===t?(e={webUrl:null,value:[l.deserializeJSON(e.responseText)]},r(e)):i(new p.default(d.default.webRequestFailure,f.format("file uploading failed by data uri with HTTP status: {0}",t)))},function(e,t,r){i(new p.default(d.default.webRequestFailure,f.format("file uploading failed with HTTP status: {0}",t)))})})):h.isPathFullUrl(r)?(a=t,new m.Promise(function(r,i){a.start(function(e,t){202===t?((e=e.getResponseHeader("Location"))||i({errorCode:d.default.badResponse,message:"missing 'Location' header on response"}),r(e)):i(new p.default(d.default.webRequestFailure,f.format("create upload by url job failed with HTTP status: {0}",t)))},function(e,t,r){i(new p.default(d.default.webRequestFailure,f.format("create upload by url job failed with HTTP status: {0}",t)))})}).then(function(e){return a=e,new m.Promise(function(n,o){!function t(r,i){var e;r--||(i*=2,r=5),e=new v.default({url:a,method:v.default.HTTP_GET}),new m.Promise(function(i,n){e.start(function(e,t){switch(t){case 202:case 200:var r=l.deserializeJSON(e.responseText);i(r);break;default:n(new p.default(d.default.webRequestFailure,f.format("polling upload job failed with HTTP status: {0}",t)))}},function(e,t,r){n(new p.default(d.default.webRequestFailure,f.format("polling upload job failed with HTTP status: {0}",t)))})}).then(function(e){e.resourceId?n(e.resourceId):i<=18e5?setTimeout(t(r,i),i):o(new p.default(d.default.webRequestFailure,"polling the uploading job takes too much time"))})}(5,100)}).then(function(e){return g({id:e},i).then(function(e){return m.Promise.resolve({webUrl:null,value:[e]})})});var a})):void 0},e.getUserTenantUrl=function(e){var t=h.appendQueryString(h.appendToPath(e.apiEndpointUrl,"me"),"$select","mySite"),r={};r.Authorization="bearer "+e.accessToken,r.Accept="application/json";var o=new v.default({url:t,clientId:e.clientId,method:v.default.HTTP_GET,headers:r,apiEndpoint:e.apiEndpoint});return new m.Promise(function(i,n){o.start(function(e,t){var r=l.deserializeJSON(e.responseText);r.mySite?i(r.mySite):n(new p.default(d.default.badResponse,f.format("Cannot find the personal tenant url, response text: {0}",e.responseText)))},function(e,t,r){n(new p.default(d.default.webRequestFailure,f.format("graph/me request failed, status code: '{0}', response text: '{1}'",v.default.statusCodeToString(t),e.responseText)))})})}}(r,e("../models/ApiEndpoint"),e("../models/ErrorType"),e("../utilities/Logging"),e("../utilities/ObjectUtilities"),e("../models/OneDriveSdkError"),e("../utilities/StringUtilities"),e("../utilities/UrlUtilities"),e("../utilities/XHR"),e("es6-promise"))},{"../models/ApiEndpoint":11,"../models/ErrorType":13,"../models/OneDriveSdkError":16,"../utilities/Logging":27,"../utilities/ObjectUtilities":28,"../utilities/StringUtilities":30,"../utilities/UrlUtilities":32,"../utilities/XHR":33,"es6-promise":34}],5:[function(e,t,r){!function(e,i,n,u,l,d,c,r,o,t,p,a,s,f,h,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=(g.prototype.launchInvoker=function(){var e=this,t=this.invokerOptions;return this.launch().catch(function(e){r.default.logError("Failed due to unknown error: ",e),t.error(e)}).then(function(){e.cleanPopupAndIFrame()})},g.prototype.launch=function(e){var s=this;return this.buildOauthPromise(e).then(function(e){return e&&"cancel"===e.type?e:s.buildPickerUI(e)}).then(function(e){var t=s.invokerOptions;if(e.type||d.throwError(new p.default(c.default.badResponse,h.format("received bad response from picker UX: {0}",JSON.stringify(e)))).exposeToPublic(),"switch"===e.type)return s.launch(!0);if("success"!==e.type)return"cancel"===e.type?(t.cancel(),f.Promise.resolve({webUrl:null,value:null})):void 0;for(var r=[],i=!1,n=0,o=e.items;n<o.length;n++){var a=o[n];a.driveItem&&!i&&(i=!0),r.push(a)}e={webUrl:null,value:r};return(!t.needAPICall()||i&&"rps"===t.accessToken.toLowerCase()?f.Promise.resolve(e):(s.apiRequestConfig=s.buildApiConfig(),s.makeApiRequest(e))).then(function(e){return s.oauthResponse&&(e.accessToken=s.oauthResponse.accessToken),s.apiRequestConfig?e.apiEndpoint=s.apiRequestConfig.apiEndpointUrl:s.loginHint&&s.loginHint.endpointHint===l.default.aad&&(e.apiEndpoint=u.default.GRAPH_URL),t.success(e),e})})},g.prototype.buildOauthPromise=function(e){return e||this.invokerOptions.needOauth()?t.auth(t.buildOauthConfig(this.invokerOptions,e),this.popup):f.Promise.resolve(null)},g.prototype.buildPickerUI=function(e){var t,r=this;return t=e?(this.oauthResponse=e,o.updateLoginHint(this.invokerOptions.clientId,this.oauthResponse.idToken,this.invokerOptions)):(this.invokerOptions.endpointHint!==l.default.msa&&this.invokerOptions.endpointHint!==l.default.tenant&&d.throwError(new p.default(c.default.optionsError,"must specify the endpointHint in advanced options as 'api.onedrive.com' for customer picker or the url for business picker/tenant")).exposeToPublic(),{loginHint:null,timeStamp:null,apiEndpoint:(e=this.invokerOptions.endpointHint===l.default.msa)?i.default.msa:i.default.filesV2,endpointHint:e?l.default.msa:l.default.tenant,isConsumerAccount:e}),((this.loginHint=t).apiEndpoint===i.default.graph_odb?n.getUserTenantUrl(this.buildApiConfig()):f.Promise.resolve(void 0)).then(function(e){r.pickerUX=a.generatePickerUX(t.apiEndpoint,t.endpointHint===l.default.tenant?r.invokerOptions.siteUrl:e);e=r.buildPickerUXConfig(r.invokerOptions);return r.invokerOptions.navEntryLocation&&(e.entryLocation=r.invokerOptions.navEntryLocation),r.invokerOptions.navSourceTypes&&(e.sourceTypes=r.invokerOptions.navSourceTypes),r.invokerOptions.linkType&&(e.linkType=r.invokerOptions.linkType),e.trapFocus=r.invokerOptions.trapFocus,r.pickerUX.invokePickerUX(e,r.popup)})},g.prototype.getApiRequestConfig=function(){return this.apiRequestConfig},g.prototype.buildApiConfig=function(){this.loginHint||d.throwError(new p.default(c.default.internalError,"missing loginHint when trying to build API request")).exposeToPublic(),this.oauthResponse||this.invokerOptions.accessToken||d.throwError(new p.default(c.default.internalError,"missing access token when trying to build API request")).exposeToPublic();var e=null,t=null;switch(this.loginHint.apiEndpoint){case i.default.filesV2:case i.default.msa:case i.default.graph_odb:case i.default.graph_odc:e=u.default.GRAPH_URL,t="microsoft.graph";break;case"n.default.msa":e=u.default.VROOM_URL,t="action";break;case"n.default.filesV2":e=v.appendToPath(this.invokerOptions.siteUrl,"_api/v2.0/"),t="action";break;default:d.throwError(new p.default(c.default.internalError,"apiEndpoint in loginHint is not correct"))}return{accessToken:(this.oauthResponse||this.invokerOptions).accessToken,apiEndpoint:this.loginHint.apiEndpoint,apiEndpointUrl:e,apiActionNamingSpace:t,clientId:this.invokerOptions.clientId}},g.prototype.cleanPopupAndIFrame=function(){this.popup&&this.popup.close(),this.pickerUX&&this.pickerUX.removeIFrame()},g);function g(e){this.invokerOptions=e,this.popup=new s.default}e.default=m}(r,e("../models/ApiEndpoint"),e("./ApiRequest"),e("../Constants"),e("../models/DomainHint"),e("../utilities/ErrorHandler"),e("../models/ErrorType"),e("../utilities/Logging"),e("./LoginCache"),e("./Oauth"),e("../models/OneDriveSdkError"),e("./PickerUX"),e("../utilities/Popup"),e("es6-promise"),e("../utilities/StringUtilities"),e("../utilities/UrlUtilities"))},{"../Constants":1,"../models/ApiEndpoint":11,"../models/DomainHint":12,"../models/ErrorType":13,"../models/OneDriveSdkError":16,"../utilities/ErrorHandler":26,"../utilities/Logging":27,"../utilities/Popup":29,"../utilities/StringUtilities":30,"../utilities/UrlUtilities":32,"./ApiRequest":4,"./LoginCache":6,"./Oauth":7,"./PickerUX":9,"es6-promise":34}],6:[function(e,t,r){!function(e,d,c,p,f,r,i,n,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o="preferred_username",h="odsdkLoginHint";e.getLoginHint=function(e){e||r.throwError(new n.default(i.default.optionsError,"invoker option is not defined!"));var t=(c.getCacheItem(h)||{})["od7-"+e.clientId];return!t||e.endpointHint!==t.endpointHint||e.loginHint&&e.loginHint!==t.loginHint?null:t},e.loginHintExpired=function(){var e=c.getCacheItem(h);return 36e5<(new Date).getTime()-e.timeStamp},e.updateLoginHint=function(e,t,r){var i;switch(r.endpointHint){case f.default.aad:var n=this.parseIdToken(t),o=n.preferredUserName,a=n.tid===p.default.CUSTOMER_TID?(i=d.default.graph_odc,!0):(i=d.default.graph_odb,!1),s=f.default.aad;break;case f.default.msa:i=d.default.msa,s=f.default.msa,o=r.loginHint,a=!0;break;case f.default.tenant:i=d.default.filesV2,s=f.default.tenant,o=r.loginHint,a=!1}var u={apiEndpoint:i,loginHint:o,endpointHint:s,timeStamp:(new Date).getTime(),isConsumerAccount:a},l=c.getCacheItem(h)||{};return l["od7-"+e]=u,c.setCacheItem(h,l),u},e.parseIdToken=function(e){e||r.throwError(new n.default(i.default.badResponse,"id_token is missing in oauth response"));e=e.split(".")[1].replace("-","+").replace("_","/"),e=t.deserializeJSON(atob(e));return e.tid||r.throwError(new n.default(i.default.badResponse,"tid is missing in id_token response")),e[o]||r.throwError(new n.default(i.default.badResponse,"preferred_username is missing in id_token response")),{tid:e.tid,preferredUserName:e[o]}}}(r,e("../models/ApiEndpoint"),e("../utilities/Cache"),e("../Constants"),e("../models/DomainHint"),e("../utilities/ErrorHandler"),e("../models/ErrorType"),e("../models/OneDriveSdkError"),e("../utilities/ObjectUtilities"))},{"../Constants":1,"../models/ApiEndpoint":11,"../models/DomainHint":12,"../models/ErrorType":13,"../models/OneDriveSdkError":16,"../utilities/Cache":22,"../utilities/ErrorHandler":26,"../utilities/ObjectUtilities":28}],7:[function(e,t,r){!function(e,t,n,s,o,u,a,l,d,r,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="access_token",p="oauth",f="state",h="[OneDriveSDK-OauthResponse]";function v(e,t){var r;s.displayOverlay(),e[p]?function(e){var t,r,i;switch(e.endpoint){case l.default.AAD:t=c.appendQueryStrings("https://login.microsoftonline.com/common/oauth2/authorize",{redirect_uri:e.redirectUri,client_id:e.clientId,response_type:"token",state:e.state,resource:e.origin});break;case l.default.AADv2:r="profile openid https://graph.microsoft.com/User.Read "+(i=e).scopes.map(function(e){return"https://graph.microsoft.com/"+e}).join(" "),i=c.appendQueryStrings("https://login.microsoftonline.com/common/oauth2/v2.0/authorize",{redirect_uri:i.redirectUri,client_id:i.clientId,scope:r,response_mode:"fragment",state:i.state,nonce:c.generateNonce()}),t=i+="&response_type=id_token+token";break;case l.default.MSA:t=function(e){for(var t=!1,r=0,i=e.scopes;r<i.length;r++)var n=i[r],t=t||1<n.toLowerCase().indexOf("readwrite");return c.appendQueryStrings("https://login.live.com/oauth20_authorize.srf",{redirect_uri:e.redirectUri,client_id:e.clientId,response_type:"token",state:e.state,scope:"onedrive."+(t?"readwrite":"readonly")})}(e);break;default:o.throwError(new d.default(u.default.badResponse,"received bad oauth endpoint, endpoint value is: "+e.endpoint))}e.switchAccount?t=c.appendQueryString(t,"prompt","select_account"):e.loginHint&&(t=c.appendQueryString(t,"login_hint",e.loginHint),t=c.appendQueryString(t,"domain_hint",e.isConsumerAccount?"consumers":"organizations")),c.redirect(t)}(JSON.parse(e[p])):e.error?m({type:"error",error:new d.default(u.default.badResponse,(r=e).error_description),state:r[f]},t):e[i]&&m({type:"success",accessToken:e[i],idToken:e.id_token,state:e[f]},t)}function m(e,t){var r;e.state?(2!==(r=e.state.split("_")).length&&o.throwError(new d.default(u.default.badResponse,"received bad state parameter from Oauth endpoint, state received: "+e.state)).exposeToPublic(),r=r[0],t?t.send(h+JSON.stringify(e),r):o.throwError(new d.default(u.default.popupOpen,"opener is not defined")).exposeToPublic()):o.throwError(new d.default(u.default.badResponse,"missing state parameter from Oauth redirect")).exposeToPublic()}e.onAuth=function(){s.onDocumentReady(function(){var e=c.readCurrentUrlParameters();(e[p]||(e.error||e[i])&&e[f])&&window.opener&&v(e,new t.default(window.opener))})},e.handleOauth=v,e.auth=function(e,o){var a=document.location.origin+"_"+c.generateNonce();return e.state=a,new r.Promise(function(r,i){var n=s.onMessage(function(e){var t;"string"==typeof e.data&&0===e.data.indexOf(h)&&((t=JSON.parse(e.data.substring(h.length))).state===a&&e.source===o.getPopupWindow()?(s.removeMessageListener(n),"error"===t.type||t.error?(e=u.default[t.error.errorCode],i(new d.default(e,t.error.message))):r(t)):i(new d.default(u.default.popupOpen,"Another popup is already opened.")))});return o.openPopup(c.appendQueryString(e.redirectUri,p,JSON.stringify(e))).then(function(){r({type:"cancel",state:a})})})},e.buildOauthConfig=function(t,e){var r;switch(t.endpointHint){case n.default.aad:r=l.default.AADv2;break;case n.default.msa:r=l.default.MSA;break;case n.default.tenant:r=l.default.AAD}var i=t.scopes.map(function(e){return e+(-1<e.indexOf("Files.")&&t.needSharePointPermission?".All":"")}),i={clientId:t.clientId,endpoint:r,scopes:i,origin:window.location.origin,redirectUri:t.redirectUri,switchAccount:e},e=a.getLoginHint(t);return t.loginHint?(i.loginHint=t.loginHint,i.isConsumerAccount=t.isConsumerAccount):e&&(i.loginHint=e.loginHint,i.isConsumerAccount=e.isConsumerAccount),i}}(r,e("../utilities/Channel"),e("../models/DomainHint"),e("../utilities/DomUtilities"),e("../utilities/ErrorHandler"),e("../models/ErrorType"),e("./LoginCache"),e("../models/OauthEndpoint"),e("../models/OneDriveSdkError"),e("es6-promise"),e("../utilities/UrlUtilities"))},{"../models/DomainHint":12,"../models/ErrorType":13,"../models/OauthEndpoint":15,"../models/OneDriveSdkError":16,"../utilities/Channel":24,"../utilities/DomUtilities":25,"../utilities/ErrorHandler":26,"../utilities/UrlUtilities":32,"./LoginCache":6,"es6-promise":34}],8:[function(e,t,r){!function(e,t,i,n,r,o,a,s,u,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d,r=(d=r.default,__extends(c,d),c.prototype.buildPickerUXConfig=function(e){return{applicationId:e.clientId,accessLevel:c.ACCESS_LEVEL,filter:e.filter,id:l.generateNonce(),navEnabled:e.navEnabled,origin:window.location.origin,parentDiv:e.parentDiv,redirectUri:e.redirectUri,selectionMode:e.multiSelect?"multiple":"single",viewType:e.viewType||"files"}},c.prototype.makeApiRequest=function(e){if(this.invokerOptions.action===s.default.share)return this.shareItems(e);var t=this.invokerOptions.action===s.default.download;return this.queryItems(e,t)},c.prototype.queryItems=function(e,t){var r=this.invokerOptions.queryParameters||n.default.DEFAULT_QUERY_ITEM_PARAMETER;return t&&(r=u.format("{0}{1}{2}",r,-1===r.indexOf("select")?"&select=":",","name,size,@content.downloadUrl")),i.getItems(e,this.getApiRequestConfig(),r)},c.prototype.shareItems=function(e){var t=this,r=this.invokerOptions.createLinkParameters||this.getDefaultSharingConfig();return i.getItems(e,this.getApiRequestConfig()).then(function(e){return i.shareItems(e,t.getApiRequestConfig(),r)})},c.prototype.getDefaultSharingConfig=function(){var e={type:"view"};return this.getApiRequestConfig().apiEndpoint===t.default.graph_odc||this.getApiRequestConfig().apiEndpoint===t.default.msa||(e.scope="organization"),e},c.ACCESS_LEVEL="read",c);function c(e){e=o.shallowClone(e),e=new a.default(e);return d.call(this,e)||this}e.default=r}(r,e("../models/ApiEndpoint"),e("./ApiRequest"),e("../Constants"),e("./Invoker"),e("../utilities/ObjectUtilities"),e("../models/PickerOptions"),e("../models/PickerActionType"),e("../utilities/StringUtilities"),e("../utilities/UrlUtilities"))},{"../Constants":1,"../models/ApiEndpoint":11,"../models/PickerActionType":17,"../models/PickerOptions":18,"../utilities/ObjectUtilities":28,"../utilities/StringUtilities":30,"../utilities/UrlUtilities":32,"./ApiRequest":4,"./Invoker":5}],9:[function(e,t,r){!function(e,r,c,p,i,n,o,a,f,t,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v="[OneDrive-FromPicker]";e.generatePickerUX=function(e,t){return new s(e,t)};var s=(u.prototype.invokePickerUX=function(u,l){var d=this;return new t.Promise(function(a,e){var s=p.onMessage(function(e){var t,r,i,n=d.url.split("/"),o=new c.default(d.iframe?d.iframe.contentWindow:l.getPopupWindow());e.origin!==n[0]+"//"+n[2]||0===(i=""+(e.data||"")).indexOf(v)&&e.source===o.getReceiver()&&(r=(t=JSON.parse(i.substring(v.length))).pickerId,n=t.conversationId,i=t.type,r===u.id&&("initialize"===i?o.send("[OneDrive-ToPicker]"+JSON.stringify({pickerId:r,conversationId:n,type:"activate"}),e.origin):(a(t),p.removeMessageListener(s))))}),t={aid:u.applicationId,a:u.accessLevel,id:u.id,l:u.linkType,ln:u.navEnabled,s:u.selectionMode,f:u.filter,v:u.viewType,ru:u.redirectUri,o:u.origin,sdk:h.default.SDK_VERSION_NUMBER,e:u.entryLocation,st:u.sourceTypes,sn:!u.parentDiv,ss:!u.parentDiv,tf:u.trapFocus},r=f.appendQueryString(d.url,"picker",JSON.stringify(t));if(o.default.logMessage("invoke picker with url: "+r),!u.parentDiv)return l.openPopup(r).then(function(){a({type:"cancel"})});l.close();t=document.createElement("iframe");t.id="odpicker"+(new Date).getTime(),t.style.position="relative",t.style.width="100%",t.style.height="100%",t.src=r,u.parentDiv.appendChild(t),d.iframe=t})},u.prototype.removeIFrame=function(){this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),this.iframe=null)},u);function u(e,t){e===r.default.graph_odc||e===r.default.msa?this.url=f.appendQueryStrings("https://onedrive.live.com/",{v:"2"}):e!==r.default.graph_odb&&e!==r.default.filesV2||(t||i.throwError(new a.default(n.default.optionsError,"the site url must be specified")).exposeToPublic(),f.validateUrlProtocol(t,["HTTPS"]),e===r.default.graph_odb&&(t=f.appendToPath(t,"_layouts/onedrive.aspx")),this.url=f.appendQueryString(t,"p","2"))}e.default=s}(r,e("../models/ApiEndpoint"),e("../utilities/Channel"),e("../utilities/DomUtilities"),e("../utilities/ErrorHandler"),e("../models/ErrorType"),e("../utilities/Logging"),e("../models/OneDriveSdkError"),e("../utilities/UrlUtilities"),e("es6-promise"),e("../Constants"))},{"../Constants":1,"../models/ApiEndpoint":11,"../models/ErrorType":13,"../models/OneDriveSdkError":16,"../utilities/Channel":24,"../utilities/DomUtilities":25,"../utilities/ErrorHandler":26,"../utilities/Logging":27,"../utilities/UrlUtilities":32,"es6-promise":34}],10:[function(e,t,r){!function(e,n,o,t,r,a,i,s,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l,t=(l=t.default,__extends(d,l),d.prototype.buildPickerUXConfig=function(e){return{applicationId:e.clientId,accessLevel:"readwrite",id:u.generateNonce(),navEnabled:e.navEnabled,filter:e.filter,origin:window.location.origin,parentDiv:e.parentDiv,redirectUri:e.redirectUri,selectionMode:"single",viewType:"folders"}},d.prototype.makeApiRequest=function(e){var t=this.invokerOptions;if(this.invokerOptions.action===a.default.query){var r=this.invokerOptions.queryParameters||o.default.DEFAULT_QUERY_ITEM_PARAMETER;return n.getItems(e,this.apiRequestConfig,r)}if(t.uploadType===s.default.dataUrl||t.uploadType===s.default.url){var i={name:t.fileName};return n.saveItemByUriUpload(e.value[0],i,t.sourceUri,this.apiRequestConfig)}if(t.uploadType===s.default.form)return i={name:t.fileName,"@name.conflictBehavior":t.nameConflictBehavior},n.saveItemByFormUpload(e.value[0],i,t.fileInput,this.apiRequestConfig,t.progress)},d);function d(e){e=r.shallowClone(e),e=new i.default(e);return l.call(this,e)||this}e.default=t}(r,e("./ApiRequest"),e("../Constants"),e("./Invoker"),e("../utilities/ObjectUtilities"),e("../models/SaverActionType"),e("../models/SaverOptions"),e("../models/UploadType"),e("../utilities/UrlUtilities"))},{"../Constants":1,"../models/SaverActionType":19,"../models/SaverOptions":20,"../models/UploadType":21,"../utilities/ObjectUtilities":28,"../utilities/UrlUtilities":32,"./ApiRequest":4,"./Invoker":5}],11:[function(e,t,r){!function(e){"use strict";var t,r;Object.defineProperty(e,"__esModule",{value:!0}),(r=t=t||{})[r.filesV2=0]="filesV2",r[r.graph_odc=1]="graph_odc",r[r.graph_odb=2]="graph_odb",r[r.msa=3]="msa",e.default=t}(r)},{}],12:[function(e,t,r){!function(e){"use strict";var t,r;Object.defineProperty(e,"__esModule",{value:!0}),(r=t=t||{})[r.aad=0]="aad",r[r.msa=1]="msa",r[r.tenant=2]="tenant",e.default=t}(r)},{}],13:[function(e,t,r){!function(e){"use strict";var t,r;Object.defineProperty(e,"__esModule",{value:!0}),(r=t=t||{})[r.badResponse=0]="badResponse",r[r.fileReaderFailure=1]="fileReaderFailure",r[r.popupOpen=2]="popupOpen",r[r.unknown=3]="unknown",r[r.unsupportedFeature=4]="unsupportedFeature",r[r.webRequestFailure=5]="webRequestFailure",r[r.internalError=6]="internalError",r[r.optionsError=7]="optionsError",r[r.typeError=8]="typeError",r[r.popupClosed=9]="popupClosed",e.default=t}(r)},{}],14:[function(e,t,r){!function(e,i,n,o,a,s,u,l,d,c,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=new RegExp("^[a-fA-F\\d]{8}-([a-fA-F\\d]{4}-){3}[a-fA-F\\d]{12}$"),r=(f.checkClientId=function(e){e?t.test(e)?u.default.logMessage("parsed client id: "+e):a.throwError(new l.default(s.default.unknown,d.format("invalid format for client id '{0}' - AAD: 32 characters (HEX) GUID",e))):a.throwError(new l.default(s.default.unknown,"client id is missing in options"))},f.prototype.needOauth=function(){return this.needAPICall()&&!this.accessToken||this.endpointHint===o.default.aad},f.prototype.parseAdvancedOptions=function(e){if(e.advanced){if(e.advanced.redirectUri&&(p.validateRedirectUrlHost(e.advanced.redirectUri),this.redirectUri=e.advanced.redirectUri),e.advanced.queryParameters){var t,r=p.readUrlParameters("?"+e.advanced.queryParameters);for(t in r)"select"!==t.toLowerCase()&&"expand"!==t.toLowerCase()&&a.throwError(new l.default(s.default.optionsError,d.format("unexpected query key: {0} is found in advanced.queryParameters",t)));var i=r.select,r=r.expand;i&&r?this.queryParameters=d.format("expand={0}&select={1}",r,i):r?this.queryParameters=d.format("expand={0}",r):i&&"select="+i.split(",").sort().join(",")!==n.default.DEFAULT_QUERY_ITEM_PARAMETER&&(this.queryParameters=d.format("select={0}",i))}e.advanced.endpointHint&&(e.advanced.endpointHint.toLowerCase()===n.default.VROOM_ENDPOINT_HINT?(this.endpointHint=o.default.msa,void 0===e.advanced.isConsumerAccount&&(this.isConsumerAccount=!0)):(i=c.validateType(e.advanced.endpointHint,"string",!1),p.validateUrlProtocol(i),this.endpointHint=o.default.tenant,void 0===e.advanced.isConsumerAccount&&(this.isConsumerAccount=!1),this.siteUrl=i),e.advanced.accessToken&&(this.accessToken=e.advanced.accessToken)),e.advanced.iframeParentDiv&&(e.advanced.iframeParentDiv.nodeName&&"div"===e.advanced.iframeParentDiv.nodeName.toLowerCase()||a.throwError(new l.default(s.default.optionsError,"the iframe's parent div element is not a DOM object")).exposeToPublic(),this.parentDiv=e.advanced.iframeParentDiv),e.advanced.scopes&&("string"==typeof e.advanced.scopes?this.scopes=[e.advanced.scopes]:e.advanced.scopes instanceof Array&&(this.scopes=e.advanced.scopes)),this.linkType=e.advanced.linkType,this.parseNavigationOptions(e.advanced.navigation),this.loginHint=e.advanced.loginHint,this.trapFocus=e.advanced.trapFocus,"boolean"==typeof e.advanced.isConsumerAccount&&(this.isConsumerAccount=e.advanced.isConsumerAccount),this.filter=e.advanced.filter}},f.prototype.parseNavigationOptions=function(e){var t,r,i;e&&((i=e.entryLocation)&&(i.sharePoint&&(t=(r=i.sharePoint).sitePath,r=r.listPath,t&&p.validateUrlProtocol(t,["HTTPS"]),r&&p.validateUrlProtocol(r,["HTTPS"])),this.navEntryLocation=i),(i=e.sourceTypes instanceof Array?e.sourceTypes:e.sourceTypes?[e.sourceTypes]:null)&&(this.needSharePointPermission=!(1===i.length&&"onedrive"===i[0].toLowerCase()),this.navSourceTypes=i),this.navEnabled=!e.disable)},f);function f(e){this.navEnabled=!0,this.needSharePointPermission=!0,this.clientId=c.validateType(e.clientId,n.default.TYPE_STRING);var t=c.validateCallback(e.cancel,!0);this.cancel=function(){u.default.logMessage("user cancelled operation"),t&&i.invokeAppCallback(t,!0)};var r=c.validateCallback(e.error,!0);this.error=function(e){if(!r)throw e;i.invokeAppCallback(r,!0,e)},this.parseAdvancedOptions(e),this.redirectUri=this.redirectUri||p.trimUrlQuery(window.location.href),this.endpointHint=this.endpointHint||o.default.aad,f.checkClientId(this.clientId)}e.default=r}(r,e("../utilities/CallbackInvoker"),e("../Constants"),e("./DomainHint"),e("../utilities/ErrorHandler"),e("./ErrorType"),e("../utilities/Logging"),e("./OneDriveSdkError"),e("../utilities/StringUtilities"),e("../utilities/TypeValidators"),e("../utilities/UrlUtilities"))},{"../Constants":1,"../utilities/CallbackInvoker":23,"../utilities/ErrorHandler":26,"../utilities/Logging":27,"../utilities/StringUtilities":30,"../utilities/TypeValidators":31,"../utilities/UrlUtilities":32,"./DomainHint":12,"./ErrorType":13,"./OneDriveSdkError":16}],15:[function(e,t,r){!function(e){"use strict";var t,r;Object.defineProperty(e,"__esModule",{value:!0}),(r=t=t||{})[r.AAD=0]="AAD",r[r.AADv2=1]="AADv2",r[r.MSA=2]="MSA",e.default=t}(r)},{}],16:[function(e,t,r){!function(e,i,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,r=(n=Error,__extends(o,n),o.prototype.toString=function(){return t.format("[OneDriveSDK Error] errorType: {0}, message: {1}",this.errorCode,this.message)},o);function o(e,t){var r=n.call(this,t)||this;return r.errorCode=i.default[e],r.message=t,r}e.default=r}(r,e("../models/ErrorType"),e("../utilities/StringUtilities"))},{"../models/ErrorType":13,"../utilities/StringUtilities":30}],17:[function(e,t,r){!function(e){"use strict";var t,r;Object.defineProperty(e,"__esModule",{value:!0}),(r=t=t||{})[r.download=0]="download",r[r.query=1]="query",r[r.share=2]="share",e.default=t}(r)},{}],18:[function(e,t,r){!function(e,n,o,t,a,s,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l,t=(l=t.default,__extends(r,l),r.prototype.needAPICall=function(){return!!this.queryParameters||this.action!==s.default.query},r);function r(e){var t=l.call(this,e)||this,r=u.validateCallback(e.success,!1);t.success=function(e){a.default.logMessage("picker operation succeeded"),n.invokeAppCallback(r,!0,e)},t.multiSelect=u.validateType(e.multiSelect,o.default.TYPE_BOOLEAN,!0,!1);var i=u.validateType(e.action,o.default.TYPE_STRING,!0,s.default[s.default.query]);return t.action=s.default[i],t.viewType=u.validateType(e.viewType,o.default.TYPE_STRING,!0,"files"),e.advanced&&(t.createLinkParameters=e.advanced.createLinkParameters),t.scopes||(t.scopes=[t.action===s.default.share?"Files.ReadWrite":"Files.Read"]),t}e.default=t}(r,e("../utilities/CallbackInvoker"),e("../Constants"),e("./InvokerOptions"),e("../utilities/Logging"),e("./PickerActionType"),e("../utilities/TypeValidators"))},{"../Constants":1,"../utilities/CallbackInvoker":23,"../utilities/Logging":27,"../utilities/TypeValidators":31,"./InvokerOptions":14,"./PickerActionType":17}],19:[function(e,t,r){!function(e){"use strict";var t,r;Object.defineProperty(e,"__esModule",{value:!0}),(r=t=t||{})[r.save=0]="save",r[r.query=1]="query",e.default=t}(r)},{}],20:[function(e,t,r){!function(e,o,a,t,r,i,n,s,u,l,d,c,p,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h,n=(h=n.default,__extends(v,h),v.prototype.needAPICall=function(){return!!this.queryParameters||this.action===l.default.save},v.prototype._setFileInfo=function(e){e.sourceInputElementId&&e.sourceUri&&r.throwError(new u.default(i.default.optionsError,"sourceUri and sourceInputElementId are provided, only one is required.")),this.sourceInputElementId=e.sourceInputElementId,this.sourceUri=e.sourceUri;e=c.validateType(e.fileName,a.default.TYPE_STRING,!0,null);this.sourceUri?f.isPathFullUrl(this.sourceUri)?(this.uploadType=p.default.url,this.fileName=e||f.getFileNameFromUrl(this.sourceUri),this.fileName||r.throwError(new u.default(i.default.optionsError,"must supply a file name or a URL that ends with a file name"))):f.isPathDataUrl(this.sourceUri)&&(this.uploadType=p.default.dataUrl,this.fileName=e,this.fileName||r.throwError(new u.default(i.default.optionsError,"must supply a file name for data URL uploads"))):this.sourceInputElementId?(this.uploadType=p.default.form,this.fileInput=t.getFileInput(this.sourceInputElementId),this.fileName=e||this.fileInput.name):r.throwError(new u.default(i.default.optionsError,"please specified one type of resource to save"))},v);function v(e){var t=h.call(this,e)||this,r=c.validateCallback(e.success,!1);t.success=function(e){s.default.logMessage("saver operation succeeded"),o.invokeAppCallback(r,!0,e)};var i=c.validateCallback(e.progress,!0);t.progress=function(e){s.default.logMessage(d.format("upload progress: {0}%",e)),i&&o.invokeAppCallback(i,!1,e)};var n=c.validateType(e.action,a.default.TYPE_STRING,!0,l.default[l.default.query]);return t.action=l.default[n],t.action===l.default.save&&t._setFileInfo(e),t.nameConflictBehavior=c.validateType(e.nameConflictBehavior,a.default.TYPE_STRING,!0,"rename"),t.scopes||(t.scopes=["Files.ReadWrite"]),t}e.default=n}(r,e("../utilities/CallbackInvoker"),e("../Constants"),e("../utilities/DomUtilities"),e("../utilities/ErrorHandler"),e("./ErrorType"),e("./InvokerOptions"),e("../utilities/Logging"),e("./OneDriveSdkError"),e("./SaverActionType"),e("../utilities/StringUtilities"),e("../utilities/TypeValidators"),e("./UploadType"),e("../utilities/UrlUtilities"))},{"../Constants":1,"../utilities/CallbackInvoker":23,"../utilities/DomUtilities":25,"../utilities/ErrorHandler":26,"../utilities/Logging":27,"../utilities/StringUtilities":30,"../utilities/TypeValidators":31,"../utilities/UrlUtilities":32,"./ErrorType":13,"./InvokerOptions":14,"./OneDriveSdkError":16,"./SaverActionType":19,"./UploadType":21}],21:[function(e,t,r){!function(e){"use strict";var t,r;Object.defineProperty(e,"__esModule",{value:!0}),(r=t=t||{})[r.dataUrl=0]="dataUrl",r[r.form=1]="form",r[r.url=2]="url",e.default=t}(r)},{}],22:[function(e,t,r){!function(e,t,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="odpickerv7cache";function o(){if(Storage){var e=localStorage.getItem(n);return JSON.parse(e||"{}")}r.throwError(new i.default(t.default.unsupportedFeature,"cache based on Storage is not supported in this browser"))}function a(e){Storage?localStorage.setItem(n,JSON.stringify(e)):r.throwError(new i.default(t.default.unsupportedFeature,"cache based on Storage is not supported in this browser"))}e.getCacheItem=function(e){return o()[e]},e.setCacheItem=function(e,t){var r=o();r[e]=t,a(r)},e.removeCacheItem=function(e){var t=o(),r=t[e];return delete t[e],a(t),r}}(r,e("../models/ErrorType"),e("./ErrorHandler"),e("../models/OneDriveSdkError"))},{"../models/ErrorType":13,"../models/OneDriveSdkError":16,"./ErrorHandler":26}],23:[function(e,t,r){!function(e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.invokeAppCallback=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];typeof e===n.default.TYPE_FUNCTION&&e.apply(null,r)},e.invokeCallbackAsynchronous=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];window.setTimeout(function(){e.apply(null,t)},0)}}(r,e("../Constants"))},{"../Constants":1}],24:[function(e,t,r){!function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=(r.prototype.send=function(e,t){this.receiver&&this.receiver.postMessage(e,t)},r.prototype.getReceiver=function(){return this.receiver},r);function r(e){this.receiver=e}e.default=t}(r)},{}],25:[function(e,t,r){!function(e,t,r,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={};function a(e){return document.getElementById(e)}function s(e){"interactive"===document.readyState||"complete"===document.readyState?e():document.addEventListener("DOMContentLoaded",e,!1)}e.getElementById=a,e.onDocumentReady=s,e.onMessage=function(e){var t=n.generateNonce()+"_"+(new Date).getMilliseconds();return window.addEventListener("message",e),o[t]=e,t},e.removeMessageListener=function(e){e=o[e];e&&window.removeEventListener("message",e)},e.getFileInput=function(e){e=a(e);if(e instanceof HTMLInputElement){if("file"!==e.type&&t.throwError(new i.default(r.default.optionsError,"input elemenet must be of type 'file'")),!e.value)return t.throwError(new i.default(r.default.optionsError,"please a file to upload")),null;e=e.files;e&&window.FileReader||t.throwError(new i.default(r.default.unsupportedFeature,"browser does not support Files API")),1!==e.length&&t.throwError(new i.default(r.default.unsupportedFeature,"can not upload more than one file at a time"));e=e[0];return e||t.throwError(new i.default(r.default.optionsError,"missing file input")),104857600<e.size?(t.throwError(new i.default(r.default.optionsError,"the user has selected a file larger than 100 MB")),null):e}t.throwError(new i.default(r.default.unknown,"element was not an instance of an HTMLInputElement"))},e.displayOverlay=function(){var t=document.createElement("div");t.id="od-overlay",t.style.cssText=["position: fixed","width: 100%","height: 100%","top: 0px","left: 0px","background-color: white","opacity: 1","z-index: 10000","min-width: 40px","min-height: 40px"].join(";");var e=document.createElement("img");e.id="od-spinner",e.src="https://p.sfx.ms/common/spinner_grey_40_transparent.gif",e.style.cssText=["position: absolute","margin: auto","top: 0","left: 0","right: 0","bottom: 0"].join(";"),t.appendChild(e);var r=document.createElement("style");r.type="text/css",r.innerHTML="body { visibility: hidden !important; }",document.head.appendChild(r),s(function(){var e=document.body;null!==e?e.insertBefore(t,e.firstChild):document.createElement("body").appendChild(t),document.head.removeChild(r)})}}(r,e("./ErrorHandler"),e("../models/ErrorType"),e("../models/OneDriveSdkError"),e("./UrlUtilities"))},{"../models/ErrorType":13,"../models/OneDriveSdkError":16,"./ErrorHandler":26,"./UrlUtilities":32}],26:[function(e,t,r){!function(e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=[];e.registerErrorObserver=function(e){n.push(e)},e.throwError=function(e){if(e.errorCode===i.default[i.default.unknown])throw e;for(var t=0,r=n;t<r.length;t++)(0,r[t])(e);return{exposeToPublic:function(){throw e}}}}(r,e("../models/ErrorType"))},{"../models/ErrorType":13}],27:[function(e,t,r){!function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=(n.logError=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];n._log(e,!0,t)},n.logMessage=function(e){n._log(e,!1)},n._log=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];(t||n.loggingEnabled||window.onedrive_enable_logging)&&console.log("[OneDriveSDK] "+e,r)},n.loggingEnabled=!1,n);function n(){}e.default=t}(r)},{}],28:[function(e,t,r){!function(e,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shallowClone=function(e){if(typeof e!==i.default.TYPE_OBJECT||!e)return null;var t,r={};for(t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r},e.deserializeJSON=function(e){var t=null;try{t=JSON.parse(e)}catch(e){r.default.logError("deserialization error"+e)}return t=typeof t!==i.default.TYPE_OBJECT||null===t?{}:t},e.serializeJSON=function(e){return JSON.stringify(e)}}(r,e("../Constants"),e("./Logging"))},{"../Constants":1,"./Logging":27}],29:[function(e,t,r){!function(n,t,r,o,a,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.POPUP_PINGER_INTERVAL=500;var e=(u.getCurrentPopup=function(){return u._currentPopup||new u},u.setCurrentPopup=function(e){u._currentPopup=e},u.createPopupFeatures=function(){var e=window.screenX+Math.max(window.outerWidth-1024,0)/2;return["width=1024","height=650","top="+(window.screenY+Math.max(window.outerHeight-650,0)/2),"left="+e,"status=no","resizable=yes","toolbar=no","menubar=no","scrollbars=yes"].join(",")},u.prototype.close=function(){u.getCurrentPopup().isPopupOpen()&&(u.getCurrentPopup()._popup.close(),u.setCurrentPopup(null))},u.prototype.openPopup=function(e){var i=this;return s.validateUrlProtocol(e),u.getCurrentPopup().isPopupOpen()?(o.default.logMessage("leaving current url: "+this._url),this._url=e,u.getCurrentPopup().getPopupWindow().location.href=e):(this._url=e,this._popup=window.open(e,"_blank",u.createPopupFeatures()),this._popup?this._popup.focus():t.throwError(new a.default(r.default.popupOpen,"popup window is disconnected")).exposeToPublic(),u.setCurrentPopup(this)),new Promise(function(e,t){var r=setInterval(function(){i.isPopupOpen()||(window.clearInterval(r),e())},n.POPUP_PINGER_INTERVAL)})},u.prototype.getPopupWindow=function(){return this._popup},u.prototype.getCurrentUrl=function(){return this._url},u.prototype.isPopupOpen=function(){return!!this._popup&&!this._popup.closed},u);function u(){}n.default=e}(r,e("./ErrorHandler"),e("../models/ErrorType"),e("./Logging"),e("../models/OneDriveSdkError"),e("../utilities/UrlUtilities"))},{"../models/ErrorType":13,"../models/OneDriveSdkError":16,"../utilities/UrlUtilities":32,"./ErrorHandler":26,"./Logging":27}],30:[function(e,t,r){!function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=/[\{\}]/g,n=/\{\d+\}/g;e.format=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e.replace(n,function(e){e=t[e.replace(i,"")];return e=null===e?"":e})}}(r)},{}],31:[function(e,t,r){!function(e,r,o,a,s,u,l,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.validateType=function(e,t,r,i,n){if(void 0===r&&(r=!1),void 0===e){if(r){if(void 0!==i)return s.default.logMessage("applying default value: "+i),i}else o.throwError(new l.default(a.default.typeError,"object was missing and not optional"));return null}i=typeof e;return i!==t?(o.throwError(new l.default(a.default.typeError,d.format("expected object type: '{0}', actual object type: '{1}'",t,i))),null):function(e,t){if(!Array.isArray(t))return 1;for(var r in t)if(e===t[r])return 1}(e,n)?e:(o.throwError(new l.default(a.default.typeError,d.format("object does not match any valid values {0}",u.serializeJSON(n)))),null)},e.validateCallback=function(e,t){if(void 0===t&&(t=!1),void 0===e)return t||o.throwError(new l.default(a.default.typeError,"function was missing and not optional")),null;t=typeof e;return t!==r.default.TYPE_FUNCTION&&o.throwError(new l.default(a.default.typeError,d.format("expected function type: function | string, actual type: {0}",t))),e}}(r,e("../Constants"),e("./ErrorHandler"),e("../models/ErrorType"),e("./Logging"),e("./ObjectUtilities"),e("../models/OneDriveSdkError"),e("./StringUtilities"))},{"../Constants":1,"../models/ErrorType":13,"../models/OneDriveSdkError":16,"./ErrorHandler":26,"./Logging":27,"./ObjectUtilities":28,"./StringUtilities":30}],32:[function(e,t,r){!function(e,i,o,a,s,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function t(e,t){return e+("/"!==e.charAt(e.length-1)?"/":"")+t}function n(e,t,r){if(!t||0===Object.keys(t).length)return e;r?e+="#":-1===e.indexOf("?")?e+="?":"&"!==e.charAt(e.length-1)&&(e+="&");var i,n="";for(i in t)n+=(n.length?"&":"")+u.format("{0}={1}",encodeURIComponent(i),encodeURIComponent(t[i]));return e+n}function r(e){var t,r={},i=e.indexOf("?")+1,n=e.indexOf("#")+1;return 0<i&&(t=i<n?n-1:e.length,c(e.substring(i,t),r)),0<n&&c(e.substring(n),r),r}function l(e){var t,r=["?","#"];for(t in r){var i=e.indexOf(r[t]);0<i&&(e=e.substring(0,i))}return e}function d(e,t){for(var r=0,i=t=t||["HTTP","HTTPS"];r<i.length;r++){var n=i[r];if(0===e.toUpperCase().indexOf(n))return}o.throwError(new s.default(a.default.optionsError,u.format("uri {0} does not match protocol(s): "+t,e))).exposeToPublic()}function c(e,t){for(var r=e.split("&"),i=0;i<r.length;i++){var n,o=r[i],a=o.indexOf("=");-1!==a&&(n=o.substr(0,a),a=o.substr(a+1),t[n]=decodeURIComponent(a))}}e.appendToPath=t,e.appendQueryString=function(e,t,r){return n(e,((e={})[t]=r,e))},e.appendQueryStrings=n,e.readCurrentUrlParameters=function(){return r(window.location.href)},e.readUrlParameters=r,e.redirect=function(e){d(e),window.location.replace(e)},e.trimUrlQuery=l,e.getFileNameFromUrl=function(e){e=l(e);return e.substr(e.lastIndexOf("/")+1)},e.getOrigin=function(e){return t(e.replace(/^((\w+:)?\/\/[^\/]+\/?).*$/,"$1"),"")},e.isPathFullUrl=function(e){return 0===e.indexOf("https://")||0===e.indexOf("http://")},e.isPathDataUrl=function(e){return 0===e.indexOf("data:")},e.generateNonce=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",r=0;r<i.default.NONCE_LENGTH;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},e.validateUrlProtocol=d,e.validateRedirectUrlHost=function(e){d(e),-1<e.indexOf("://")?e.split("/")[2]!==window.location.host&&o.throwError(new s.default(a.default.optionsError,"redirect uri is not in the same domain as picker sdk")).exposeToPublic():o.throwError(new s.default(a.default.optionsError,"redirect uri is not an absolute url")).exposeToPublic()},e.deserializeParameters=c}(r,e("../Constants"),e("./ErrorHandler"),e("../models/ErrorType"),e("../models/OneDriveSdkError"),e("./StringUtilities"))},{"../Constants":1,"../models/ErrorType":13,"../models/OneDriveSdkError":16,"./ErrorHandler":26,"./StringUtilities":30}],33:[function(e,t,r){!function(e,i,n,o,a,s,u,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=new RegExp("^([a-fA-F0-9]){16}$"),t=(c.statusCodeToString=function(e){switch(e){case-1:return"EXCEPTION";case-2:return"TIMEOUT";case-3:return"REQUEST ABORTED";default:return e.toString()}},c.prototype.start=function(e,t){var r=this;try{this._successCallback=e,this._failureCallback=t,this._request=new XMLHttpRequest,this._request.ontimeout=this._onTimeout,this._request.onload=function(){var e=r._request.status;e<400&&0<e?r._callSuccessCallback(e):r._callFailureCallback(e)},this._method||(this._method=this._json?c.HTTP_POST:c.HTTP_GET),this._request.open(this._method,this._url,!0),this._request.timeout=3e4,this._setHeaders(),s.default.logMessage("starting request to: "+this._url),this._request.send(this._json)}catch(e){this._callFailureCallback(-1,e)}},c.prototype.upload=function(e,t,r,i){var n=this;try{this._successCallback=t,this._progressCallback=i,this._failureCallback=r,this._request=new XMLHttpRequest,this._request.ontimeout=this._onTimeout,this._method=c.HTTP_PUT,this._request.open(this._method,this._url,!0),this._setHeaders(),this._request.onload=function(e){n._completed=!0;var t=n._request.status;200===t||201===t||202===t?n._callSuccessCallback(t):n._callFailureCallback(t,e)},this._request.onerror=function(e){n._completed=!0,n._callFailureCallback(n._request.status,e)},this._request.upload.onprogress=function(e){e.lengthComputable&&(e={bytesTransferred:e.loaded,totalBytes:e.total,progressPercentage:0===e.total?0:e.loaded/e.total*100},n._callProgressCallback(e))},s.default.logMessage("starting upload to: "+this._url),this._request.send(e)}catch(e){this._callFailureCallback(-1,e)}},c.prototype._callSuccessCallback=function(e){s.default.logMessage("calling xhr success callback, status: "+c.statusCodeToString(e)),this._successCallback(this._request,e,this._url)},c.prototype._callFailureCallback=function(e,t){s.default.logError("calling xhr failure callback, status: "+c.statusCodeToString(e),this._request,t),this._failureCallback(this._request,e,-2===e)},c.prototype._callProgressCallback=function(e){s.default.logMessage("calling xhr upload progress callback"),this._progressCallback(this._request,e)},c.prototype._abortRequest=function(){if(this&&!this._completed){if(this._completed=!0,this._request)try{this._request.abort()}catch(e){}this._callFailureCallback(-3)}},c.prototype._onTimeout=function(){this._completed||(this._completed=!0,this._callFailureCallback(-2))},c.prototype._setHeaders=function(){for(var e in this._headers)this._request.setRequestHeader(e,this._headers[e]);var t;this._clientId&&(t=this._clientId,d.test(this._clientId)&&(t="0x"+this._clientId),this._request.setRequestHeader("Application","0x"+t));var r=l.format("{0}={1}","SDK-Version",n.default.SDK_VERSION);switch(this._apiEndpoint){case i.default.graph_odb:case i.default.filesV2:this._request.setRequestHeader("X-ClientService-ClientTag",r);break;case i.default.graph_odc:case i.default.msa:this._request.setRequestHeader("X-RequestStats",r);break;default:o.throwError(new u.default(a.default.internalError,"invalid API endpoint: "+this._apiEndpoint))}this._method===c.HTTP_POST&&this._request.setRequestHeader("Content-Type",this._json?"application/json":"text/plain")},c.HTTP_GET="GET",c.HTTP_POST="POST",c.HTTP_PUT="PUT",c);function c(e){this._url=e.url,this._json=e.json,this._headers=e.headers||{},this._method=e.method,this._clientId=e.clientId,this._apiEndpoint=e.apiEndpoint||i.default.msa,o.registerErrorObserver(this._abortRequest)}e.default=t}(r,e("../models/ApiEndpoint"),e("../Constants"),e("./ErrorHandler"),e("../models/ErrorType"),e("./Logging"),e("../models/OneDriveSdkError"),e("./StringUtilities"))},{"../Constants":1,"../models/ApiEndpoint":11,"../models/ErrorType":13,"../models/OneDriveSdkError":16,"./ErrorHandler":26,"./Logging":27,"./StringUtilities":30}],34:[function(F,e,t){var r=function(){"use strict";function l(e){return"function"==typeof e}var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,t=void 0,n=void 0,s=function(e,t){c[i]=e,c[i+1]=t,2===(i+=2)&&(n?n(p):m())},e="undefined"!=typeof window?window:void 0,o=e||{},a=o.MutationObserver||o.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),o="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(p,1)}}var c=new Array(1e3);function p(){for(var e=0;e<i;e+=2)(0,c[e])(c[e+1]),c[e]=void 0,c[e+1]=void 0;i=0}var f,h,v,m=void 0;function g(e,t){var r=arguments,i=this,n=new this.constructor(E);void 0===n[_]&&L(n);var o,a=i._state;return a?(o=r[a-1],s(function(){return M(a,n,o,i._result)})):I(i,n,e,t),n}function y(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(E);return U(t,e),t}var m=u?function(){return process.nextTick(p)}:a?(h=0,a=new a(p),v=document.createTextNode(""),a.observe(v,{characterData:!0}),function(){v.data=h=++h%2}):o?((f=new MessageChannel).port1.onmessage=p,function(){return f.port2.postMessage(0)}):(void 0===e&&"function"==typeof F?function(){try{var e=F("vertx");return t=e.runOnLoop||e.runOnContext,function(){t(p)}}catch(e){return d()}}:d)(),_=Math.random().toString(36).substring(16);function E(){}var w=void 0,T=1,b=2,P=new H;function k(e){try{return e.then}catch(e){return P.error=e,P}}function O(e,t,r){var n,o,i,a;t.constructor===e.constructor&&r===g&&t.constructor.resolve===y?(i=e,(a=t)._state===T?S(i,a._result):a._state===b?A(i,a._result):I(a,void 0,function(e){return U(i,e)},function(e){return A(i,e)})):r===P?A(e,P.error):void 0!==r&&l(r)?(n=t,o=r,s(function(r){var i=!1,e=function(e,t){try{e.call(t,function(e){if(!i){i=!0;n!==e?U(r,e):S(r,e)}},function(e){if(!i){i=!0;A(r,e)}})}catch(e){return e}}(o,n,r._label);!i&&e&&(i=!0,A(r,e))},e)):S(e,t)}function U(e,t){e===t?A(e,new TypeError("You cannot resolve a promise with itself")):"function"==typeof t||"object"==typeof t&&null!==t?O(e,t,k(t)):S(e,t)}function C(e){e._onerror&&e._onerror(e._result),R(e)}function S(e,t){e._state===w&&(e._result=t,e._state=T,0!==e._subscribers.length&&s(R,e))}function A(e,t){e._state===w&&(e._state=b,e._result=t,s(C,e))}function I(e,t,r,i){var n=e._subscribers,o=n.length;e._onerror=null,n[o]=t,n[o+T]=r,n[o+b]=i,0===o&&e._state&&s(R,e)}function R(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var i,n=void 0,o=e._result,a=0;a<t.length;a+=3)i=t[a],n=t[a+r],i?M(r,i,n,o):n(o);e._subscribers.length=0}}function H(){this.error=null}var D=new H;function M(e,t,r,i){var n=l(r),o=void 0,a=void 0,s=void 0,u=void 0;if(n){if((o=function(e,t){try{return e(t)}catch(e){return D.error=e,D}}(r,i))===D?(u=!0,a=o.error,o=null):s=!0,t===o)return void A(t,new TypeError("A promises callback cannot return that same promise."))}else o=i,s=!0;t._state!==w||(n&&s?U(t,o):u?A(t,a):e===T?S(t,o):e===b&&A(t,o))}var q=0;function L(e){e[_]=q++,e._state=void 0,e._result=void 0,e._subscribers=[]}function N(e,t){this._instanceConstructor=e,this.promise=new e(E),this.promise[_]||L(this.promise),r(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):A(this.promise,new Error("Array Methods must be provided an Array"))}function x(e){this[_]=q++,this._result=this._state=void 0,this._subscribers=[],E!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof x?function(t,e){try{e(function(e){U(t,e)},function(e){A(t,e)})}catch(e){A(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}function j(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=x}return N.prototype._enumerate=function(){for(var e=this.length,t=this._input,r=0;this._state===w&&r<e;r++)this._eachEntry(t[r],r)},N.prototype._eachEntry=function(t,e){var r,i,n=this._instanceConstructor,o=n.resolve;o===y?(r=k(t))===g&&t._state!==w?this._settledAt(t._state,e,t._result):"function"!=typeof r?(this._remaining--,this._result[e]=t):n===x?(O(i=new n(E),t,r),this._willSettleAt(i,e)):this._willSettleAt(new n(function(e){return e(t)}),e):this._willSettleAt(o(t),e)},N.prototype._settledAt=function(e,t,r){var i=this.promise;i._state===w&&(this._remaining--,e===b?A(i,r):this._result[t]=r),0===this._remaining&&S(i,this._result)},N.prototype._willSettleAt=function(e,t){var r=this;I(e,void 0,function(e){return r._settledAt(T,t,e)},function(e){return r._settledAt(b,t,e)})},x.all=function(e){return new N(this,e).promise},x.race=function(n){var o=this;return r(n)?new o(function(e,t){for(var r=n.length,i=0;i<r;i++)o.resolve(n[i]).then(e,t)}):new o(function(e,t){return t(new TypeError("You must pass an array to race."))})},x.resolve=y,x.reject=function(e){var t=new this(E);return A(t,e),t},x._setScheduler=function(e){n=e},x._setAsap=function(e){s=e},x._asap=s,x.prototype={constructor:x,then:g,catch:function(e){return this.then(null,e)}},j(),x.polyfill=j,x.Promise=x};"object"==typeof t&&void 0!==e?e.exports=r():this.ES6Promise=r()},{}]},{},[2])(2)});