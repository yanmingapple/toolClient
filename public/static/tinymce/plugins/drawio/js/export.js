var mxIsElectron=null!=navigator.userAgent&&-1<navigator.userAgent.toLowerCase().indexOf(" electron/"),GOOGLE_APPS_MAX_AREA=25e6,GOOGLE_SHEET_MAX_AREA=1048576;function render(w){var b=!1;"auto"==w.scale&&(b=!0,w.scale=1),document.body.innerHTML="";var e=document.createElement("div");e.id="graph",e.style.width="100%",e.style.height="100%",document.body.appendChild(e);var x=new Graph(e);w.border=parseInt(w.border)||0,w.w=parseFloat(w.w)||0,w.h=parseFloat(w.h)||0,w.scale=parseFloat(w.scale)||1;var y=null;try{y=JSON.parse(w.extras)}catch(e){try{y=JSON.parse(decodeURIComponent(w.extras))}catch(e){}}var g=null;null!=y&&null!=y.grid&&(x.gridSize=y.grid.size,x.view.gridSteps=y.grid.steps,g=y.grid.color),null!=y&&null!=y.diagramLanguage&&(Graph.diagramLanguage=y.diagramLanguage,Graph.translateDiagram=!0),("iVBOR"==w.xml.substring(0,5)||null!=y&&y.isPng)&&(w.xml=Editor.extractGraphModelFromPng("data:image/png;base64,"+w.xml)),"<#document>"==w.xml.substring(0,11)&&(w.xml=w.xml.substring(11,w.xml.length-12));e=mxUtils.parseXml(w.xml),e=Editor.extractGraphModel(e.documentElement,!0);if(null==e){try{const R=require("electron")["ipcRenderer"];R.send("render-finished",null)}catch(e){console.log(e)}return x}var v=e.ownerDocument,a=null,t=0;if(!mxIsElectron||"xml"!=w.format){"mxfile"==v.documentElement.nodeName&&(a=v.documentElement.getElementsByTagName("diagram")),null!=y&&null!=y.globalVars&&(x.globalVars=y.globalVars);var n=x.getLinkForCell;x.getLinkForCell=function(e){var t=n.apply(this,arguments);return t=null!=t&&this.isCustomLink(t)?null:t};var l=x.cellRenderer.redrawLabelShape;x.cellRenderer.redrawLabelShape=function(e){if(l.apply(this,arguments),null!=e.node)for(var t=e.node.getElementsByTagName("a"),a=0;a<t.length;a++){var n=t[a].getAttribute("href");null!=n&&x.isCustomLink(n)&&t[a].setAttribute("href","#")}};var E,r,A,M=null,S=1,i=new Object,P=!1,o=Editor.doMathJaxRender;Editor.doMathJaxRender=function(e){o.apply(this,arguments),window.setTimeout(function(){window.MathJax.Hub.Queue(function(){G()})},0)};var d=Graph.addFont;if(Graph.addFont=function(e,t){return S++,d.call(this,e,t,G)},null!=a&&0<a.length){var s=a.length-1;if(!w.allPages)if(null!=w.pageId){for(var h=0;h<a.length;h++)if(w.pageId==a[h].getAttribute("id")){s=t=h;break}}else t=Math.max(0,Math.min(parseInt(w.from)||t,a.length-1)),s=parseInt(w.to),s=isNaN(s)?t:Math.max(t,Math.min(s,a.length-1));var u=x.getGlobalVariable;x.getGlobalVariable=function(e){return"page"==e?null==a?"Page-1":a[t].getAttribute("name")||"Page-"+(t+1):"pagenumber"==e?t+1:u.apply(this,arguments)};for(h=t;h<=s;h++)null!=a[h]&&(null==r&&(r=a[h].getAttribute("id")),null!=(v=Editor.parseDiagramNode(a[h]))&&(v=v.ownerDocument),x.getModel().clear(),t=h,O())}else O();return fallbackFont&&document.querySelectorAll("foreignObject div").forEach(e=>e.style.fontFamily=(e.style.fontFamily||"")+", "+fallbackFont),function(){if(null!=g){var e,t=x.view,a="url(data:image/svg+xml;base64,"+(a=btoa(unescape(encodeURIComponent(t.createSvgGrid(g)))))+")",n=x.gridSize*t.gridSteps*t.scale,l=0,r=0;null!=t.backgroundPageShape&&(l=1+(e=t.getBackgroundPageBounds()).x,r=1+e.y);var n=-Math.round(n-mxUtils.mod(t.translate.x*t.scale-l,n))+"px "+-Math.round(n-mxUtils.mod(t.translate.y*t.scale-r,n))+"px",i=document.querySelectorAll("[id^=mxPage]"),o="margin: 0;padding: 0;background-image: "+a+";background-position: "+n;document.body.style.cssText=o;for(var d=0;d<i.length;d++)i[d].style.cssText=o}}(),f("image","xlink:href"),f("img","src"),e=document.body,P&&null!=Editor.MathJaxRender&&(S++,Editor.MathJaxRender(e)),G(),x}{const C=require("electron")["ipcRenderer"];try{var c=mxUtils.getXml(v);EditorUi.prototype.createUi=function(){},EditorUi.prototype.addTrees=function(){},EditorUi.prototype.updateActionStates=function(){};var m=new EditorUi,p=new LocalFile(m,c);m.setCurrentFile(p),m.setFileData(c),C.send("xml-data",mxUtils.getXml(m.getXmlFileData(null,null,w.uncompressed)))}catch(e){C.send("xml-data-error")}}function G(){--S<1&&document.fonts.ready.then(function(){var e=document.createElement("div"),t=null!=a?a.length:1;if(e.id="LoadingComplete",e.style.display="none",e.setAttribute("bounds",JSON.stringify(E)),e.setAttribute("page-id",r),e.setAttribute("scale",A),e.setAttribute("pageCount",t),document.body.appendChild(e),mxIsElectron)try{const n=require("electron")["ipcRenderer"];n.on("get-svg-data",(e,t)=>{x.mathEnabled=P;var a=x.background;a==mxConstants.NONE&&(a=null);a=x.getSvg(a,1,0,!1,null,!0,null,null,null);x.shadowVisible&&x.addSvgShadow(a),P&&Editor.prototype.addMathCss(a),n.send("svg-data",'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'+mxUtils.getXml(a))}),n.send("render-finished",{bounds:JSON.stringify(E),pageCount:t})}catch(e){console.log(e)}})}function f(e,t){var a=document.body.getElementsByTagName(e);S+=a.length;for(var n=0;n<a.length;n++){var l=a[n].getAttribute(t);null!=l&&0<l.length&&null==i[l]?(i[l]=new Image,i[l].onload=G,i[l].onerror=G,i[l].src=l):G()}}function O(){P|="1"==v.documentElement.getAttribute("math");var e=v.documentElement.getAttribute("extFonts");e&&function(e){try{e=e.split("|").map(function(e){e=e.split("^");return{name:e[0],url:e[1]}})}catch(e){return}S+=e.length;for(var t,a=0;a<e.length;a++)0==e[a].url.indexOf(Editor.GOOGLE_FONTS)?((t=document.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("charset","UTF-8"),t.setAttribute("type","text/css"),t.onload=G,t.onerror=G,t.setAttribute("href",e[a].url),document.getElementsByTagName("head")[0].appendChild(t)):(0==e[a].url.indexOf(PROXY_URL)&&-1==PROXY_URL.indexOf("http")&&(t=(t=window.location.href).substring(0,t.lastIndexOf("/")+1),e[a].url=t+e[a].url),new FontFace(e[a].name,"url("+e[a].url+")").load().then(function(e){document.fonts.add(e),G()}).catch(G))}(e),x.foldingEnabled=!1,x.setEnabled(!1);var t=v.documentElement.getAttribute("backgroundImage");null!=t&&(t=JSON.parse(t),x.setBackgroundImage(new mxImage(t.src,t.width,t.height,t.x,t.y)));var a,n,l,r,i,o,d,g,s,h,u,e=new mxCodec(v),c=x.getModel();if(e.decode(v.documentElement,c),"pdf"==w.format?"none"==w.bg?a=null:"none"!=(a=v.documentElement.getAttribute("background"))&&a||(a="#ffffff"):null==(a="none"==(a=null!=w.bg&&0<w.bg.length?w.bg:v.documentElement.getAttribute("background"))||""==a?null:a)&&"gif"!=w.format&&"png"!=w.format&&(a="#ffffff"),null!=a&&(document.body.style.backgroundColor=a),null!=y&&(null!=y.layers&&0<y.layers.length||null!=y.layerIds&&0<y.layerIds.length)){for(var m=c.getChildCount(c.root),p=0;p<m;p++)c.setVisible(c.getChildAt(c.root,p),!1);if(null!=y.layerIds)for(p=0;p<y.layerIds.length;p++)c.setVisible(c.getCell(y.layerIds[p]),!0);else for(p=0;p<y.layers.length;p++){var f=c.getChildAt(c.root,y.layers[p]);null!=f&&c.setVisible(f,!0)}}x.pdfPageVisible=!1,(w.print||"pdf"==w.format&&"1"==v.documentElement.getAttribute("page")&&0==w.w&&0==w.h&&1==w.scale)&&(n=1,w.print&&(document.title=w.fileTitle,g=x.getGraphBounds(),n=w.pageScale,isNaN(n)&&(n=1),w.fit?(r=parseInt(w.sheetsAcross),l=parseInt(w.sheetsDown),w.scale=Math.min(w.pageHeight*l/(g.height/x.view.scale),w.pageWidth*r/(g.width/x.view.scale))):(w.scale=w.scale/x.pageScale,isNaN(w.scale)&&(n=1/x.pageScale))),l=w.pageWidth||v.documentElement.getAttribute("pageWidth"),r=w.pageHeight||v.documentElement.getAttribute("pageHeight"),x.pdfPageVisible=!0,null!=l&&null!=r&&(x.pageFormat=new mxRectangle(0,0,parseFloat(l),parseFloat(r))),null!=(r=w.pageScale||v.documentElement.getAttribute("pageScale"))&&(x.pageScale=r),x.getPageSize=function(){return new mxRectangle(0,0,this.pageFormat.width*this.pageScale,this.pageFormat.height*this.pageScale)},x.getPageLayout=function(){var e=this.getPageSize(),t=this.getGraphBounds();if(0==t.width||0==t.height)return new mxRectangle(0,0,1,1);var a=Math.ceil(t.x/this.view.scale-this.view.translate.x),n=Math.ceil(t.y/this.view.scale-this.view.translate.y),l=Math.floor(t.width/this.view.scale),r=Math.floor(t.height/this.view.scale),i=Math.floor(a/e.width),t=Math.floor(n/e.height),l=Math.ceil((a+l)/e.width)-i,e=Math.ceil((n+r)/e.height)-t;return new mxRectangle(i,t,l,e)},x.view.getBackgroundPageBounds=function(){var e=this.graph.getPageLayout(),t=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+e.x*t.width),this.scale*(this.translate.y+e.y*t.height),this.scale*e.width*t.width,this.scale*e.height*t.height)}),x.pdfPageVisible?(w.border=0,s=x.getPageLayout(),i=x.getPageSize(),r=s.x*i.width,i=s.y*i.height,0==r&&0==i||x.view.setTranslate(Math.floor(-r),Math.floor(-i))):(d=x.getGraphBounds(),0<w.w||0<w.h?(u=1,u=0<w.w&&0<w.h?Math.min(w.w/d.width,w.h/d.height):0<w.w?w.w/d.width:w.h/d.height,x.view.scaleAndTranslate(u,Math.floor(w.border/u-Math.floor(d.x)),Math.floor(w.border/u-Math.floor(d.y)))):(u=w.scale,b&&(o=null!=y&&null!=y.pageWidth?y.pageWidth:800,d.width<o&d.height<1.5*o?u=4:d.width<2*o&d.height<3*o?u=3:d.width<4*o&&d.height<6*o&&(u=2),null!=y&&null!=y.isGoogleSheet&&(GOOGLE_APPS_MAX_AREA=GOOGLE_SHEET_MAX_AREA),d.width*u*d.height*u>GOOGLE_APPS_MAX_AREA&&(u=Math.sqrt(GOOGLE_APPS_MAX_AREA/(d.width*d.height))-.01)),x.view.scaleAndTranslate(u,Math.floor(w.border-Math.floor(d.x)),Math.floor(w.border-Math.floor(d.y))))),(E=x.pdfPageVisible?x.view.getBackgroundPageBounds():x.getGraphBounds()).width=Math.ceil(E.width+w.border)+1,E.height=Math.ceil(E.height+w.border)+1,A=x.view.scale||1,x.pdfPageVisible?(h=x.pageFormat||mxConstants.PAGE_FORMAT_A4_PORTRAIT,i=w.print?w.scale:1/x.pageScale,o=!(!w.print||null==w.fit)&&w.fit,g=x.getGraphBounds(),g=d=0,(h=mxRectangle.fromRectangle(h)).width=Math.ceil(h.width*n)+1,h.height=Math.ceil(h.height*n)+1,i*=n,o||(d-=(s=x.getPageLayout()).x*h.width,g-=s.y*h.height),null==M?((M=new mxPrintPreview(x,i,h,0,d,g)).printBackgroundImage=!0,M.autoOrigin=o,M.backgroundColor=a,M.open(null,window),x.container.parentNode.removeChild(x.container)):(M.backgroundColor=a,M.autoOrigin=o,M.appendGraph(x,i,d,g)),E=new mxRectangle(0,0,h.width,h.height)):(null!=(t=x.backgroundImage)&&(h=x.view.translate,u=x.view.scale,E.add(new mxRectangle((h.x+t.x)*u,(h.y+t.y)*u,t.width*u,t.height*u))),"pdf"!=w.format&&mxClient.IS_SVG&&"1"==v.documentElement.getAttribute("shadow")&&(x.addSvgShadow(x.view.canvas.ownerSVGElement,null,!0),x.setShadowVisible(!0),E.width+=7,E.height+=7),document.body.style.width=Math.ceil(E.x+E.width)+"px",document.body.style.height=Math.ceil(E.y+E.height)+"px")}}if(Editor.initMath((remoteMath?"https://app.diagrams.net/":"")+"math/MathJax.js"),mxIsElectron)try{const s0=require("electron")["ipcRenderer"];s0.on("render",(e,t)=>{render(t)})}catch(e){console.log(e)}